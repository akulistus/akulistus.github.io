"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[632],{5191:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>hl,contentTitle:()=>dl,default:()=>fl,frontMatter:()=>ll,metadata:()=>cl,toc:()=>ul});var n=i(4848),s=i(8453),a=i(6540);class o{constructor(t){this.type=t.type}}class r extends o{constructor(t){super({type:"rhythm"}),this.id_sourceChannel=t.id_sourceChannel}}class l{}class d extends l{constructor(t){super(),this.id_unit=t.id_unit,this.scale=t.scale,this.text=t.text}}const c=(t,e)=>e in t;var h,u,g,f;!function(t){t[t.OK=0]="OK",t[t.Error=1]="Error"}(h||(h={}));class p{constructor(t){this.status=t}isOk(){return this.status==h.OK}}class v extends p{constructor(t){super(h.OK),this.data=t}}function y(t){return t.isOk()}class m extends p{constructor(t,e){super(h.Error),this.message=t,this.code=e}}function S(t){return t>="0"&&t<="9"||t>="a"&&t<="f"||t>="A"&&t<="F"}function w(t){let e=Number(t).toString(16);return e.length<2&&(e="0"+e),e}class x{static converColorToHex(t){return"#"+w(t[0])+w(t[1])+w(t[2])}static convertWebglRgbaToInt(t){if(4!=t.length)return new m("wrong input array length");const e=[0,0,0,0];for(let i=0;i<4;i++)e[i]=Math.round(255*t[i]);return new v(e)}static convertWebglRgbaToHex(t){if(4!=t.length)return new m("wrong input array length");let e="#";for(let i=0;i<4;++i){let n=Math.round(255*t[i]).toString(16);n.length<2&&(n="0"+n),e+=n}return new v(e)}static convertToRgba(t){const e=[0,0,0,255];if(Array.isArray(t)){if(t.length<3||t.length>4)return new m("wrong input array length");for(let i=0;i<t.length;i++){if(isNaN(t[i]))return new m("wrong input array value");e[i]=t[i]}return new v(e)}const i=Array.from(t);if(i.length<7||i.length>9||"#"!=i[0])return new m("wrong input text length");for(let n=1,s=0;n<i.length;n+=2,s++){if(s>3||!S(i[n])||!S(i[n+1]))return new m("wrong input text value");const t=parseInt(`${i[n]}${i[n+1]}`,16);e[s]=t}return new v(e)}static convertToWebglRgba(t){const e=[0,0,0,1];if(Array.isArray(t)){if(t.length<3||t.length>4)return new m("wrong input array length");for(let i=0;i<t.length;i++){if(isNaN(t[i]))return new m("wrong input array value");e[i]=t[i]/255}return new v(e)}const i=Array.from(t);if(i.length<7||i.length>9||"#"!=i[0])return new m("wrong input text length");for(let n=1,s=0;n<i.length;n+=2,s++){if(s>3||!S(i[n])||!S(i[n+1]))return new m("wrong input text value");const t=parseInt(`${i[n]}${i[n+1]}`,16);e[s]=t/255}return new v(e)}static convertHexToRgb(t){const e=[0,0,0,255];for(let i=1,n=0;i<t.length;i+=2,n++){if(n>3||!S(t[i])||!S(t[i+1]))return new m("wrong input text value");const s=parseInt(`${t[i]}${t[i+1]}`,16);e[n]=s}return new v(e)}static rgbaToHex(t){if(t.length<3||t.length>4)return new m("wrong input array length");let e="#";for(let i=0;i<4;++i){let n=t[i].toString(16);n.length<2&&(n="0"+n),e+=n}return new v(e)}}function C(t,e,i){if(void 0!==i)for(let n=0;n<i.length;n++){const s=i[n];if(t in s){if(s[t]==e)return i[n]}}}class b{constructor(t){void 0===t&&(t=1e4),this.currId=0,this.maxId=t}generateNextId(){return this.currId=(this.currId+1)%this.maxId,this.currId}}function I(t){return"object"==typeof t&&null!=t&&!Array.isArray(t)}class P{static shallowCopy(t){if(void 0!==t){if(null==t)return null;if(Array.isArray(t)){const e=[];for(let i=0;i<t.length;i++)e.push(t[i]);return e}if(I(t)){const e={};for(const i of Object.getOwnPropertyNames(t))e[i]=t[i];return e}return t}}static deepCopy(t){if(void 0!==t){if(null==t)return null;if("function"==typeof t)return t;if(Array.isArray(t)){const e=[];for(let i=0;i<t.length;i++)e.push(P.deepCopy(t[i]));return e}if(I(t)){const e={};for(const i of Object.getOwnPropertyNames(t))e[i]=P.deepCopy(t[i]);return e}return t}}static typedShallowCopy(t){return P.shallowCopy(t)}static typedDeepCopy(t){return P.deepCopy(t)}static deepObjectCopy(t){return P.deepCopy(t)}static addFields(t,e,i){if(I(t)&&I(e))for(const n of Object.getOwnPropertyNames(t))i.includes(n)||(e[n]=P.deepCopy(t[n]))}static merge(t,e){if(void 0===e){if(void 0===t)return;return P.deepObjectCopy(t)}if(void 0===t)return P.deepObjectCopy(e);if(Array.isArray(t))return P.deepObjectCopy(t);if(I(t)){const i=P.typedDeepCopy(t);if(void 0===i)return;for(const t of Object.getOwnPropertyNames(e)){let n;if(I(e)&&t in e){const i=e[t];"object"==typeof i&&null!=i&&(n=i)}if(Object.prototype.hasOwnProperty.call(i,t)){const e=i[t];"object"==typeof e&&null!=e&&(i[t]=P.merge(e,n))}else i[t]=P.deepCopy(n)}return i}return P.typedDeepCopy(t)}static typedMerge(t,e){return P.merge(t,e)}static createCopyFunc(t){return null!=t?t:P.deepCopy}static createMergeFunc(t){return null!=t?t:P.merge}}!function(t){t.Left="left",t.Right="right"}(u||(u={}));function B(t,e){const i=Math.pow(10,e||0),n=t*i*(1+Number.EPSILON);return Math.round(n)/i}function D(t,e){return Array.isArray(t)&&t.every((t=>typeof t===e))}function M(t){return D(t,"object")}function z(t){return D(t,"string")}function k(t){return D(t,"number")}function A(t){return D(t,"object")}class F{constructor(t,e){void 0===e&&(e=0),this.re=t,this.im=e}copy(){return new F(this.re,this.im)}static isValid(t){return t.re!==1/0&&!isNaN(t.re)&&t.im!==1/0&&!isNaN(t.im)}static add(t,e){return new F(t.re+e.re,t.im+e.im)}static sub(t,e){return new F(t.re-e.re,t.im-e.im)}static mul(t,e){return new F(t.re*e.re-t.im*e.im,t.re*e.im+t.im*e.re)}static div(t,e){const i=e.re*e.re+e.im*e.im,n=(t.re*e.re+t.im*e.im)/i,s=(t.im*e.re-t.re*e.im)/i;return new F(n,s)}static addReal(t,e){return new F(t.re+e,t.im)}static subReal(t,e){return new F(t.re-e,t.im)}static mulReal(t,e){return new F(t.re*e,t.im*e)}static divReal(t,e){return new F(t.re/e,t.im/e)}static conj(t){return new F(t.re,-t.im)}static exp(t){if(t.re===1/0)return new F(1/0,0);if(isNaN(t.re))return new F(NaN,0);const e=Math.exp(t.re),i=e*Math.cos(t.im),n=e*Math.sin(t.im);return new F(i,n)}static abs(t){return Math.hypot(t.re,t.im)}}class V{static copy(t){if(null==t)return null;if(Array.isArray(t)){const e=[];e.length=t.length;for(let i=0;i<t.length;++i)e[i]=V.copy(t[i]);return e}if("object"==typeof t){if("copy"in t){const e=t.copy;if(V.isCopyFunction(e))return e()}const e={},i=Object.keys(t);for(const n of i){const i=t[n];"function"!=typeof i&&(e[n]=V.copy(i))}return e}return t}static isCopyFunction(t){return void 0!==t&&"function"==typeof t&&1===t.length}}class _{static subarray(t,e,i){const n=i-e;if(n<0)return;const s=[];s.length=n;for(let a=0;a<n;++a)s[a]=V.copy(t[e+a]);return s}static resize(t,e,i){const n=t.length;t.length=e;if(e-n>0)for(let s=n;s<e;++s)t[s]=V.copy(i)}}class R{static endsWith(t,e){return-1!==t.indexOf(e,t.length-e.length)}static isNumber(t){return/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/.test(t)}static getFirstNotWhiteSpaceSymbol(t,e,i){const n=void 0===e||e<0?0:e,s=void 0===i||i<0||i>t.length?t.length:i,a=new Set([" ","\t","\n"]);for(let o=n;o<s;++o)if(!a.has(t[o]))return o;return-1}static getLastNotWhiteSpaceSymbol(t,e,i){const n=void 0===e||e<0?0:e,s=void 0===i||i<0||i>t.length-1?t.length-1:i,a=new Set([" ","\t","\n"]);for(let o=s;o>=n;--o)if(!a.has(t[o]))return o;return-1}}class L extends l{constructor(t){super(),this.variantGroups=t.variantGroups}}class E extends L{constructor(t){var e,i;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.name=t.name,this.unit=t.unit,this.original=null===(i=t.original)||void 0===i||i,this.maxSignalCount=t.maxSignalCount,this.hasVariableIsoline=t.hasVariableIsoline,this.frequency=t.frequency,this.conversionSettings=t.conversionSettings}getCurrSignalsVariant(){const t=C("name","signals",this.variantGroups);if(void 0!==t)return C("name",t.currVariant,t.variants)}forEachSignalsVariant(t){const e=C("name","signals",this.variantGroups);if(void 0!==e)for(let i=0;i<e.variants.length;++i){t(e.variants[i])}}}class j extends l{constructor(t){super(),this.name=t}}class Y extends j{constructor(t){super(t.name),this.signals=t.signals}}class O extends L{constructor(t){var e,i,n;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.channels=null!==(i=t.channels)&&void 0!==i?i:[],this.marks=null!==(n=t.marks)&&void 0!==n?n:[]}}class U extends l{constructor(t){var e,i,n;super(),this.id=t.id,this.name=null!==(e=t.name)&&void 0!==e?e:null!==(i=t.title)&&void 0!==i?i:"",this.title=null!==(n=t.title)&&void 0!==n?n:this.name}}class T extends L{constructor(t){var e;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.text=t.text,this.scale=t.scale}}function W(t){return e=t,i=g,Object.values(i).includes(e);var e,i}!function(t){t.Central="central",t.Bottom="bottom",t.BottomCentral="bottomCentral",t.Top="top",t.TopCentral="topCentral",t.Left="left",t.LeftCentral="leftCentral",t.Right="right",t.RightCentral="rightCentral"}(g||(g={})),function(t){t.Left="left",t.Right="right"}(f||(f={}));class X{constructor(t){this.length=t,this.beginIndex=-1,this.endIndex=this.length,this.insertDirection=f.Right,this.buffer=[],this.buffer.length=this.length,this.firstIndex=this.beginIndex,this.lastIndex=this.beginIndex,this.actualLength=0}reset(){this.insertDirection=f.Right,this.firstIndex=this.beginIndex,this.lastIndex=this.beginIndex,this.actualLength=0}addData(t,e){const i=this.getInsertDirection(e);let n=!1;const s={firstIndex:this.firstIndex,lastIndex:this.lastIndex};switch(i){case f.Left:this.initForLeftMove(s),this.moveToLeft(s),this.buffer[s.firstIndex]=t,n=!0;break;case f.Right:this.initForRightMove(s),this.moveToRight(s),this.buffer[s.lastIndex]=t,n=!0}this.firstIndex=s.firstIndex,this.lastIndex=s.lastIndex,n&&this.actualLength<this.length&&this.actualLength++}addDataArray(t,e){if(0==t.length)return;const i=this.getInsertDirection(e);let n=t.length-this.length;n<0&&(n=0);const s={firstIndex:this.firstIndex,lastIndex:this.lastIndex};switch(i){case f.Left:this.initForLeftMove(s);for(let t=0;t<n;++t)this.moveToLeft(s);this.actualLength<this.length&&(this.actualLength=Math.min(this.actualLength+n,this.length));for(let e=n;e<t.length;++e)this.moveToLeft(s),this.buffer[s.firstIndex]=t[e],this.actualLength<this.length&&this.actualLength++;break;case f.Right:this.initForRightMove(s);for(let t=0;t<n;++t)this.moveToRight(s);this.actualLength<this.length&&(this.actualLength=Math.min(this.actualLength+n,this.length));for(let e=n;e<t.length;++e)this.moveToRight(s),this.buffer[s.lastIndex]=t[e],this.actualLength<this.length&&this.actualLength++}this.firstIndex=s.firstIndex,this.lastIndex=s.lastIndex}getNextIndex(t){const e=this.getInsertDirection(t);let i=-1;const n={firstIndex:this.firstIndex,lastIndex:this.lastIndex};switch(e){case f.Left:this.initForLeftMove(n),this.moveToLeft(n),i=n.firstIndex;break;case f.Right:this.initForRightMove(n),this.moveToRight(n),i=n.lastIndex}return{bufferIndex:i,firstIndex:n.firstIndex,lastIndex:n.lastIndex}}goToNext(t){const e=this.getInsertDirection(t),i={firstIndex:this.firstIndex,lastIndex:this.lastIndex};switch(e){case f.Left:this.initForLeftMove(i),this.moveToLeft(i);break;case f.Right:this.initForRightMove(i),this.moveToRight(i)}this.firstIndex=i.firstIndex,this.lastIndex=i.lastIndex}getLastData(t){const e=t>this.actualLength?this.actualLength:t;let i=this.lastIndex+1-e,n=!1;i<0&&(i=this.length+i,n=!0),i<this.firstIndex&&(i=this.firstIndex);let s=this.lastIndex-i+1;n&&(s+=this.endIndex);const a=[];a.length=s;let o=0;if(n){for(let t=i;t<this.endIndex;t++)a[o]=this.buffer[t],++o;for(let t=0;t<=this.lastIndex;t++)a[o]=this.buffer[t],++o}else for(let r=i;r<=this.lastIndex;r++)a[o]=this.buffer[r],++o;return a}getInsertDirection(t){return void 0===t||t!=f.Left&&t!=f.Right?this.insertDirection:t}initForRightMove(t){t.firstIndex==this.beginIndex&&(t.firstIndex=0),t.lastIndex==this.beginIndex&&(t.lastIndex=-1)}initForLeftMove(t){t.firstIndex==this.beginIndex&&(t.firstIndex=this.endIndex),t.lastIndex==this.beginIndex&&(t.lastIndex=this.endIndex-1)}moveToRight(t){t.lastIndex++,t.lastIndex==this.endIndex&&(t.lastIndex=0),this.actualLength==this.length&&t.firstIndex==t.lastIndex&&(t.firstIndex++,t.firstIndex==this.endIndex&&(t.firstIndex=0))}moveToLeft(t){t.firstIndex--,t.firstIndex==this.beginIndex&&(t.firstIndex=this.endIndex-1),this.actualLength==this.length&&t.firstIndex==t.lastIndex&&(t.lastIndex--,t.lastIndex==this.beginIndex&&(t.lastIndex=this.endIndex-1))}}class H{constructor(t){var e,i;this.x=null!==(e=null==t?void 0:t.x)&&void 0!==e?e:0,this.y=null!==(i=null==t?void 0:t.y)&&void 0!==i?i:0}copy(){return new H({x:this.x,y:this.y})}}class N{constructor(t){this.value=t}isEquals(t){return t instanceof N&&this.value==t.value}isNeedUpdate(t){return!1}calcValue(t){return this.value}copy(){return new N(this.value)}}class G{constructor(t){var e,i;this.x=null!==(e=null==t?void 0:t.x)&&void 0!==e?e:new N(0),this.y=null!==(i=null==t?void 0:t.y)&&void 0!==i?i:new N(0)}calculate(t){return new H({x:this.x.calcValue(t.width),y:this.y.calcValue(t.height)})}calcValues(t,e){return new H({x:this.x.calcValue(t),y:this.y.calcValue(e)})}copy(){return new G({x:this.x.copy(),y:this.y.copy()})}}class q{constructor(t){var e,i,n,s;this.left=null!==(e=null==t?void 0:t.left)&&void 0!==e?e:0,this.right=null!==(i=null==t?void 0:t.right)&&void 0!==i?i:0,this.top=null!==(n=null==t?void 0:t.top)&&void 0!==n?n:0,this.bottom=null!==(s=null==t?void 0:t.bottom)&&void 0!==s?s:0}copy(){return new q({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}}class ${constructor(t){var e,i,n,s;this.left=null!==(e=null==t?void 0:t.left)&&void 0!==e?e:new N(0),this.right=null!==(i=null==t?void 0:t.right)&&void 0!==i?i:new N(0),this.top=null!==(n=null==t?void 0:t.top)&&void 0!==n?n:new N(0),this.bottom=null!==(s=null==t?void 0:t.bottom)&&void 0!==s?s:new N(0)}calculate(t){return new q({left:this.left.calcValue(t.width),right:this.right.calcValue(t.width),top:this.top.calcValue(t.height),bottom:this.bottom.calcValue(t.height)})}calcValues(t,e){return new q({left:this.left.calcValue(t),right:this.right.calcValue(t),top:this.top.calcValue(e),bottom:this.bottom.calcValue(e)})}copy(){return new $({left:this.left.copy(),right:this.right.copy(),top:this.top.copy(),bottom:this.bottom.copy()})}}class K{constructor(t){var e,i;this.width=null!==(e=null==t?void 0:t.width)&&void 0!==e?e:0,this.height=null!==(i=null==t?void 0:t.height)&&void 0!==i?i:0}copy(){return new K({width:this.width,height:this.height})}}class Z{constructor(t){this.scale=t,this.currValue=0}isEquals(t){return t instanceof Z&&this.scale==t.scale}isNeedUpdate(t){return this.scale*t!=this.currValue}calcValue(t){return this.currValue=this.scale*t,this.currValue}copy(){return new Z(this.scale)}}class J{constructor(t){var e,i;this.width=null!==(e=null==t?void 0:t.width)&&void 0!==e?e:new Z(1),this.height=null!==(i=null==t?void 0:t.height)&&void 0!==i?i:new Z(1)}calculate(t){return new K({width:this.width.calcValue(t.width),height:this.height.calcValue(t.height)})}calcValues(t,e){return new K({width:this.width.calcValue(t),height:this.height.calcValue(e)})}copy(){return new J({width:this.width.copy(),height:this.height.copy()})}}class Q{constructor(t,e){this.info=e,this.callback=t}}class tt{constructor(){this.handled=!0,this.listeners=[]}}const et=Symbol();class it{constructor(t){this.ref=null==t?void 0:t.ref}}class nt{constructor(t){var e,i,n,s,a,o,r;this.name=t.name,this.location=null!==(e=t.location)&&void 0!==e?e:new G,this.size=null!==(i=t.size)&&void 0!==i?i:new J,this.margin=null!==(n=t.margin)&&void 0!==n?n:new $,this.padding=null!==(s=t.padding)&&void 0!==s?s:new $,this.parent=null!==(a=t.parent)&&void 0!==a?a:new it,this.tags=[],this.isDebugMode=null!==(o=t.isDebugMode)&&void 0!==o&&o,this.debug=t.debug,this.isVisible=null===(r=t.isVisible)||void 0===r||r,this.absoluteLocation=new H,this.relatedLocation=new H,this.locationInPixels=new H,this.sizeInPixels=new K,this.marginInPixels=new q,this.paddingInPixels=new q,this.clientLocation=new H,this.clientSize=new K}}class st extends it{constructor(t){var e,i,n;super({ref:null==t?void 0:t.ref}),this.location=null!==(e=null==t?void 0:t.location)&&void 0!==e?e:new H,this.size=null!==(i=null==t?void 0:t.size)&&void 0!==i?i:new K,this.padding=null!==(n=null==t?void 0:t.padding)&&void 0!==n?n:new q}}const at=Symbol();class ot{get[et](){return!0}get[at](){return!0}constructor(t){this.settings=t,this.eventsListeners=new Map}getRoot(){var t,e;let i,n=this;for(void 0!==(null===(t=n.settings.parent)||void 0===t?void 0:t.ref)&&n.settings.parent.ref instanceof ot&&(i=n.settings.parent.ref);void 0!==i;)n=i,i=void 0,void 0!==(null===(e=n.settings.parent)||void 0===e?void 0:e.ref)&&n.settings.parent.ref instanceof ot&&(i=n.settings.parent.ref);return n}getName(){return this.settings.name}async initAsync(){this.init()}init(){ot.calculateBorders(this.settings),this.settings.isDebugMode=!1}getVisibility(){return this.settings.isVisible}setVisibility(t){this.settings.isVisible=t}addEventListener(t,e,i){let n=this.eventsListeners.get(t);void 0===n&&(n=new tt,this.eventsListeners.set(t,n)),n.listeners.push(new Q(e,i))}getEventListeners(t){return this.eventsListeners.get(t)}async handleEvent(t,e){const i=this.eventsListeners.get(t);if(void 0!==i&&i.handled)for(let n=0;n<i.listeners.length;++n){const t=i.listeners[n];void 0!==e?await t.callback(e,t.info):await t.callback(t.info)}}runEventHandle(t){const e=this.eventsListeners.get(t);void 0!==e&&(e.handled=!0)}stopEventHandle(t){const e=this.eventsListeners.get(t);void 0!==e&&(e.handled=!1)}async addTag(t){this.settings.tags.includes(t)||(this.settings.tags.push(t),await this.handleEvent("AddTag",t))}async removeTag(t){for(let e=0;e<this.settings.tags.length;++e)if(this.settings.tags[e]==t)return this.settings.tags.splice(e,1),void await this.handleEvent("RemoveTag",t)}setLocationSettings(t,e){this.settings.location=new G({x:t,y:e})}setSizeSettings(t,e){this.settings.size=new J({width:t,height:e})}setBordersSettings(t,e){this.settings.location=t,this.settings.size=e}setParentSizeSettings(t,e){if(!(this.settings.parent instanceof st))return;this.settings.parent.size=new K({width:t,height:e})}updateParentSizeSettings(){}async setLocation(t,e){return(!this.settings.location.x.isEquals(t)||!this.settings.location.y.isEquals(e))&&(this.setLocationSettings(t,e),await this.createBorders(),!0)}async setSize(t,e){return(!this.settings.size.width.isEquals(t)||!this.settings.size.height.isEquals(e))&&(this.setSizeSettings(t,e),await this.createBorders(),!0)}async setBorders(t,e){return!(this.settings.location.x.isEquals(t.x)&&this.settings.location.y.isEquals(t.y)&&this.settings.size.width.isEquals(e.width)&&this.settings.size.height.isEquals(e.height))&&(this.setBordersSettings(t,e),await this.createBorders(),!0)}async setParentSize(t,e){if(this.settings.parent instanceof st){const i=this.settings.parent;if(i.size.width==t&&i.size.height==e)return!1;this.setParentSizeSettings(t,e)}return await this.createBorders(),!0}async createBorders(){ot.calculateBorders(this.settings)}setDebugMode(t){this.settings.isDebugMode=!0,this.settings.debug=t}forEach(t){t(this)}async forEachAsync(t){await t(this)}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];!function(t,e){if(Array.isArray(t)||"function"==typeof t||!(e in t))return;const i=t[e];if(void 0!==(o=i)&&"function"==typeof o&&1===o.length){for(var n=arguments.length,s=new Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];i(...s)}var o}(this,t,...i)}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await async function(t,e){if(Array.isArray(t)||"function"==typeof t||!(e in t))return;const i=t[e];if(void 0!==(o=i)&&"function"==typeof o&&1===o.length){for(var n=arguments.length,s=new Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];await i(...s)}var o}(this,t,...i)}static calculateBorders(t){let e,i;if(t.relatedLocation.x=0,t.relatedLocation.y=0,t.absoluteLocation.x=0,t.absoluteLocation.y=0,t.parent instanceof st){const n=t.parent;e=n.size.width,i=n.size.height,t.relatedLocation.x+=n.padding.left,t.relatedLocation.y+=n.padding.bottom,t.absoluteLocation.x+=n.location.x,t.absoluteLocation.y+=n.location.y}else{const n=t.parent;if(void 0!==n.ref&&n.ref instanceof ot){const s=n.ref;e=s.settings.clientSize.width,i=s.settings.clientSize.height,t.relatedLocation.x+=s.settings.clientLocation.x,t.relatedLocation.y+=s.settings.clientLocation.y,t.absoluteLocation.x+=s.settings.absoluteLocation.x,t.absoluteLocation.y+=s.settings.absoluteLocation.y}else e=0,i=0}t.marginInPixels=t.margin.calcValues(e,i),t.locationInPixels=t.location.calcValues(e,i),t.relatedLocation.x+=t.locationInPixels.x+t.marginInPixels.left,t.relatedLocation.y+=t.locationInPixels.y+t.marginInPixels.bottom,t.absoluteLocation.x+=t.relatedLocation.x,t.absoluteLocation.y+=t.relatedLocation.y,t.sizeInPixels.width=t.size.width.calcValue(e)-t.marginInPixels.left-t.marginInPixels.right,t.sizeInPixels.height=t.size.height.calcValue(i)-t.marginInPixels.top-t.marginInPixels.bottom,t.paddingInPixels=t.padding.calculate(t.sizeInPixels),t.clientLocation.x=t.paddingInPixels.left,t.clientLocation.y=t.paddingInPixels.bottom,t.clientSize.width=t.sizeInPixels.width-t.clientLocation.x-t.paddingInPixels.right,t.clientSize.height=t.sizeInPixels.height-t.clientLocation.y-t.paddingInPixels.top}}class rt extends nt{constructor(t){var e;super({name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode}),this.id=t.id,this.idGenerator=t.idGenerator,this.type=null!==(e=t.type)&&void 0!==e?e:"object",this.commonData=t.commonData}}const lt=Symbol();function dt(t){return lt in t}function ct(t,e){let i=t;do{if(e(i))return i;if(void 0!==i.settings.parent.ref){if(!(i.settings.parent.ref instanceof ot))return;i=i.settings.parent.ref}else i=void 0}while(void 0!==i)}class ht{constructor(t){this.name=t,this.items=[]}getName(){return this.name}forEach(t){for(let e=0;e<this.items.length;++e)this.items[e].forEach(t)}async forEachAsync(t){for(let e=0;e<this.items.length;e++)await this.items[e].forEachAsync(t)}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(let s=0;s<this.items.length;s++)this.items[s].recursiveExecute(t,...i)}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(let s=0;s<this.items.length;s++)await this.items[s].asyncRecursiveExecute(t,...i)}forEachChild(t){for(let e=0;e<this.items.length;e++)t(this.items[e])}async forEachChildAsync(t){for(let e=0;e<this.items.length;e++)await t(this.items[e])}add(t){this.items.push(t)}addUnique(t){const e=t.getName();if(void 0===e)return;const i=this.findIndex(e);i<0?this.items.push(t):this.items[i]=t}insert(t,e){t<0?t=0:t>this.items.length&&(t=this.items.length),this.items.splice(t,0,e)}remove(t){t>=0&&t<this.items.length&&this.items.splice(t,1)}removeByName(t){const e=this.findIndex(t);e>=0&&this.items.splice(e,1)}clear(){this.items=[]}findIndex(t){for(let e=0;e<this.items.length;e++){if(this.items[e].getName()===t)return e}return-1}findItem(t){const e=this.findIndex(t);if(!(e<0))return this.items[e]}getItem(t){if(!(t<0||t>=this.items.length))return this.items[t]}}const ut=Symbol();const gt=Symbol();class ft extends ot{get[lt](){return!0}get[ut](){return!0}get[gt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,this.ppi=1,this.deviceScale=1,this.items=new ht("items")}init(){super.init(),this.items=new ht("items")}getHtmlElement(){return this.typedSettings.htmlElement}addItem(t){this.items.add(t)}async createBorders(){await super.createBorders(),await this.items.forEachAsync((async t=>{const e=t;e.updateParentSizeSettings(),await e.createBorders()}))}setDebugMode(t){super.setDebugMode(t),this.items.forEach((e=>{e.setDebugMode(t)}))}getDeviceScale(){return this.deviceScale}setDeviceScale(t){this.deviceScale!=t&&(this.deviceScale=t,this.items.recursiveExecute("setDeviceScale",t))}getPpi(){return this.ppi}setPpi(t){this.ppi!=t&&(this.ppi=t,this.items.recursiveExecute("setPpi",t))}findRootJagmHtmlElements(){return[]}draw(){this.items.forEach((t=>{dt(t)&&t.draw()}))}}class pt extends nt{constructor(t){super({name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode}),this.htmlElement=t.htmlElement,this.drawEnabled=!0}}class vt{}class yt extends rt{constructor(t){var e,i,n;super(void 0===t?{type:"column-grid"}:{id:t.id,idGenerator:t.idGenerator,type:null!==(e=t.type)&&void 0!==e?e:"column-grid",name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData}),this.columnsSpace=null!==(i=null==t?void 0:t.columnsSpace)&&void 0!==i?i:new N(0),this.columns=[],this.commonSpaceBetweenColumns=0,this.columnsSpaceInPixels=this.columnsSpace.calcValue(this.clientSize.width),void 0!==(null==t?void 0:t.columns)&&t.columns.length>1&&(this.commonSpaceBetweenColumns=this.columnsSpaceInPixels*(t.columns.length-1)),this.panelsAreaWidth=this.clientSize.width-this.commonSpaceBetweenColumns,null===(n=null==t?void 0:t.columns)||void 0===n||n.forEach((t=>{var e,i,n;const s=null!==(e=t.width)&&void 0!==e?e:new Z(1),a=s.calcValue(this.panelsAreaWidth),o=null!==(i=t.rowsSpace)&&void 0!==i?i:new N(0),r=o.calcValue(this.clientSize.height);let l=0;void 0!==t.rows&&t.rows.length>1&&(l=r*(t.rows.length-1));const d={width:s,widthInPixels:a,rowsSpace:o,rowsSpaceInPixels:r,commonSpaceBetweenRows:l,panelsAreaHeight:this.clientSize.height-l,rows:[]};this.columns.push(d),null===(n=t.rows)||void 0===n||n.forEach((t=>{var e;const i=null!==(e=t.height)&&void 0!==e?e:new Z(1),n=i.calcValue(d.panelsAreaHeight),s={height:i,heightInPixels:n};d.rows.push(s)}))}))}update(){this.commonSpaceBetweenColumns=0,this.columnsSpaceInPixels=this.columnsSpace.calcValue(this.clientSize.width),this.columns.length>1&&(this.commonSpaceBetweenColumns=this.columnsSpaceInPixels*(this.columns.length-1)),this.panelsAreaWidth=this.clientSize.width-this.commonSpaceBetweenColumns,this.columns.forEach((t=>{const e=t.width.calcValue(this.panelsAreaWidth),i=t.rowsSpace.calcValue(this.clientSize.height);let n=0;t.rows.length>1&&(n=i*(t.rows.length-1));const s=this.clientSize.height-n;t.widthInPixels=e,t.rowsSpaceInPixels=i,t.commonSpaceBetweenRows=n,t.panelsAreaHeight=s,t.rows.forEach((e=>{const i=e.height.calcValue(t.panelsAreaHeight);e.heightInPixels=i}))}))}}class mt extends ot{get[lt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,this.items=new ht("items")}addItem(t){this.items.add(t)}addUniqueItem(t){this.items.addUnique(t)}insertItem(t,e){this.items.insert(t,e)}removeItem(t){this.items.remove(t)}removeItemByName(t){this.items.removeByName(t)}clear(){this.items.clear()}findItemIndex(t){return this.items.findIndex(t)}findItem(t){return this.items.findItem(t)}getItem(t){return this.items.getItem(t)}async createBorders(){await super.createBorders(),await this.items.forEachAsync((async t=>{t.updateParentSizeSettings(),await t.createBorders()}))}setDebugMode(t){super.setDebugMode(t),this.items.forEach((e=>{void 0!==e&&e.setDebugMode(t)}))}forEach(t){super.forEach(t),this.items.forEach(t)}async forEachAsync(t){await super.forEachAsync(t),await this.items.forEachAsync(t)}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i),this.items.recursiveExecute(t,...i)}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i),await this.items.asyncRecursiveExecute(t,...i)}draw(){this.items.forEach((t=>{const e=t;void 0!==e&&dt(e)&&e.draw()}))}}class St{constructor(t){var e,i;this.boxFillColor=null!==(e=null==t?void 0:t.boxFillColor)&&void 0!==e?e:[0,0,0,0],this.boxStrokeColor=null!==(i=null==t?void 0:t.boxStrokeColor)&&void 0!==i?i:[1,0,0,1]}}class wt extends rt{constructor(t){var e;super(void 0===t?{type:"panel"}:{id:t.id,idGenerator:t.idGenerator,type:null!==(e=t.type)&&void 0!==e?e:"panel",name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData})}}class xt extends ot{constructor(t){super(t),this.columns=[],this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new St({boxFillColor:[0,.8,0,1],boxStrokeColor:[0,.2,0,1]}):(this.settings.debug.boxFillColor=[0,.8,0,1],this.settings.debug.boxStrokeColor=[0,.2,0,1])}init(){var t;super.init(),this.typedSettings.update();let e=0;for(let i=0;i<this.typedSettings.columns.length;i++){const n=this.typedSettings.columns[i],s={rows:[]};let a=0;for(let i=0;i<n.rows.length;i++){const o=n.rows[i],r=new mt(new wt({id:null===(t=this.typedSettings.idGenerator)||void 0===t?void 0:t.generateNextId(),idGenerator:this.typedSettings.idGenerator,location:new G({x:new N(e),y:new N(this.settings.clientSize.height-a-o.heightInPixels)}),size:new J({width:n.width,height:o.height}),parent:new st({ref:this,location:new H({x:this.settings.absoluteLocation.x,y:this.settings.absoluteLocation.y}),size:new K({width:this.typedSettings.panelsAreaWidth,height:n.panelsAreaHeight}),padding:new q({left:this.settings.paddingInPixels.left,right:this.settings.paddingInPixels.right,top:this.settings.paddingInPixels.top,bottom:this.settings.paddingInPixels.bottom})})}));r.init();const l={panel:r};s.rows.push(l),a+=o.heightInPixels+n.rowsSpaceInPixels}this.columns.push(s),e+=n.widthInPixels+this.typedSettings.columnsSpaceInPixels}}async createBorders(){await super.createBorders(),this.typedSettings.update();let t=0;for(let e=0;e<this.typedSettings.columns.length;e++){const i=this.typedSettings.columns[e],n=this.columns[e];let s=0;for(let e=0;e<i.rows.length;e++){const a=i.rows[e],o=n.rows[e];o.panel.setLocationSettings(new N(t),new N(this.settings.clientSize.height-s-a.heightInPixels)),o.panel.setParentSizeSettings(this.typedSettings.panelsAreaWidth,i.panelsAreaHeight),await o.panel.createBorders(),s+=a.heightInPixels+i.rowsSpaceInPixels}t+=i.widthInPixels+this.typedSettings.columnsSpaceInPixels}}setRowHeight(t,e,i){if(e<0||e>=this.typedSettings.columns.length||t<0||t>=this.typedSettings.columns[e].rows.length)return;const n=this.typedSettings.columns[e],s=this.columns[e];let a=n.rows[t],o=s.rows[t];a.height=i,o.panel.setSizeSettings(o.panel.settings.size.width,i),this.typedSettings.update();const r=o.panel.settings.locationInPixels.x;let l=this.settings.clientSize.height-o.panel.settings.locationInPixels.y+n.rowsSpaceInPixels;for(let d=t+1;d<s.rows.length;d++)o=s.rows[d],a=n.rows[d],o.panel.setLocationSettings(new N(r),new N(this.settings.clientSize.height-l-a.heightInPixels)),l+=a.heightInPixels+n.rowsSpaceInPixels}setColumnWidth(t,e){if(t<0||t>=this.typedSettings.columns.length)return;const i=this.typedSettings.columns[t],n=this.columns[t];i.width=e,this.typedSettings.update();for(let s=0;s<i.rows.length;s++){let a=i.rows[s],o=n.rows[s];o.panel.setSizeSettings(e,o.panel.settings.size.height);let r=o.panel.settings.locationInPixels.x+i.widthInPixels+this.typedSettings.columnsSpaceInPixels;for(let e=t+1;e<this.typedSettings.columns.length;e++){const t=this.typedSettings.columns[e],i=this.columns[e];let n=0;for(let e=0;e<t.rows.length;e++)a=t.rows[e],o=i.rows[e],o.panel.setLocationSettings(new N(r),new N(this.settings.clientSize.height-n-a.heightInPixels)),n+=a.heightInPixels+t.rowsSpaceInPixels;r+=t.widthInPixels+this.typedSettings.columnsSpaceInPixels}}}getCell(t,e){if(!(t<0||t>=this.columns.length||e<0||e>=this.columns[t].rows.length))return this.columns[t].rows[e].panel}addItem(t,e,i){this.columns[t].rows[e].panel.addItem(i)}setDebugMode(t){super.setDebugMode(t);for(let e=0;e<this.columns.length;e++){const i=this.columns[e].rows;for(let e=0;e<i.length;e++)i[e].panel.setDebugMode(t)}}forEach(t){super.forEach(t);for(let e=0;e<this.columns.length;e++){const i=this.columns[e].rows;for(let e=0;e<i.length;e++)i[e].panel.forEach(t)}}async forEachAsync(t){await super.forEachAsync(t);for(let e=0;e<this.columns.length;e++){const i=this.columns[e].rows;for(let e=0;e<i.length;e++)await i[e].panel.forEachAsync(t)}}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i);for(let s=0;s<this.columns.length;s++){const e=this.columns[s].rows;for(let n=0;n<e.length;n++)e[n].panel.recursiveExecute(t,...i)}}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i);for(let s=0;s<this.columns.length;s++){const e=this.columns[s].rows;for(let n=0;n<e.length;n++)await e[n].panel.asyncRecursiveExecute(t,...i)}}}class Ct extends rt{constructor(t){var e,i,n;super(void 0===t?{type:"grid"}:{id:t.id,idGenerator:t.idGenerator,type:null!==(e=t.type)&&void 0!==e?e:"grid",name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData}),this.rowsSpace=null!==(i=null==t?void 0:t.rowsSpace)&&void 0!==i?i:new N(0),this.rows=[],this.commonSpaceBetweenRows=0,this.rowsSpaceInPixels=this.rowsSpace.calcValue(this.clientSize.height),void 0!==(null==t?void 0:t.rows)&&t.rows.length>1&&(this.commonSpaceBetweenRows=this.rowsSpaceInPixels*(t.rows.length-1)),this.panelsAreaHeight=this.clientSize.height-this.commonSpaceBetweenRows,null===(n=null==t?void 0:t.rows)||void 0===n||n.forEach((t=>{var e,i,n;const s=null!==(e=t.height)&&void 0!==e?e:new Z(1),a=s.calcValue(this.panelsAreaHeight),o=null!==(i=t.columnsSpace)&&void 0!==i?i:new N(0),r=o.calcValue(this.clientSize.width);let l=0;void 0!==t.columns&&t.columns.length>1&&(l=r*(t.columns.length-1));const d={height:s,heightInPixels:a,columnsSpace:o,columnsSpaceInPixels:r,commonSpaceBetweenColumns:l,panelsAreaWidth:this.clientSize.width-l,columns:[]};this.rows.push(d),null===(n=t.columns)||void 0===n||n.forEach((t=>{var e;const i=null!==(e=t.width)&&void 0!==e?e:new Z(1),n=i.calcValue(d.panelsAreaWidth),s={width:i,widthInPixels:n};d.columns.push(s)}))}))}update(){this.commonSpaceBetweenRows=0,this.rowsSpaceInPixels=this.rowsSpace.calcValue(this.clientSize.height),this.rows.length>1&&(this.commonSpaceBetweenRows=this.rowsSpaceInPixels*(this.rows.length-1)),this.panelsAreaHeight=this.clientSize.height-this.commonSpaceBetweenRows,this.rows.forEach((t=>{const e=t.height.calcValue(this.panelsAreaHeight),i=t.columnsSpace.calcValue(this.clientSize.width);let n=0;t.columns.length>1&&(n=i*(t.columns.length-1));const s=this.clientSize.width-n;t.heightInPixels=e,t.columnsSpaceInPixels=i,t.commonSpaceBetweenColumns=n,t.panelsAreaWidth=s,t.columns.forEach((e=>{const i=e.width.calcValue(t.panelsAreaWidth);e.widthInPixels=i}))}))}}class bt extends ot{constructor(t){super(t),this.rows=[],this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new St({boxFillColor:[0,.8,0,1],boxStrokeColor:[0,.2,0,1]}):(this.settings.debug.boxFillColor=[0,.8,0,1],this.settings.debug.boxStrokeColor=[0,.2,0,1])}init(){var t;super.init(),this.typedSettings.update();let e=0;this.rows=[];for(let i=0;i<this.typedSettings.rows.length;i++){const n=this.typedSettings.rows[i],s={columns:[]};let a=0;for(let i=0;i<n.columns.length;i++){const o=n.columns[i],r=new mt(new wt({id:null===(t=this.typedSettings.idGenerator)||void 0===t?void 0:t.generateNextId(),idGenerator:this.typedSettings.idGenerator,location:new G({x:new N(a),y:new N(this.settings.clientSize.height-e-n.heightInPixels)}),size:new J({width:o.width.copy(),height:n.height.copy()}),parent:new st({ref:this,location:new H({x:this.settings.absoluteLocation.x,y:this.settings.absoluteLocation.y}),size:new K({width:n.panelsAreaWidth,height:this.typedSettings.panelsAreaHeight}),padding:new q({left:this.settings.paddingInPixels.left,right:this.settings.paddingInPixels.right,top:this.settings.paddingInPixels.top,bottom:this.settings.paddingInPixels.bottom})})}));r.init();const l={panel:r};s.columns.push(l),a+=o.widthInPixels+n.columnsSpaceInPixels}this.rows.push(s),e+=n.heightInPixels+this.typedSettings.rowsSpaceInPixels}}async createBorders(){await super.createBorders(),this.typedSettings.update();let t=0;for(let e=0;e<this.rows.length;e++){const i=this.typedSettings.rows[e],n=this.rows[e];let s=0;for(let e=0;e<n.columns.length;e++){const a=i.columns[e],o=n.columns[e];o.panel.settings.location.x=new N(s),o.panel.settings.location.y=new N(this.settings.clientSize.height-t-i.heightInPixels),o.panel.setLocationSettings(new N(s),new N(this.settings.clientSize.height-t-i.heightInPixels)),o.panel.setParentSizeSettings(i.panelsAreaWidth,this.typedSettings.panelsAreaHeight),await o.panel.createBorders(),s+=a.widthInPixels+i.columnsSpaceInPixels}t+=i.heightInPixels+this.typedSettings.rowsSpaceInPixels}}setRowHeight(t,e){if(t<0||t>=this.typedSettings.rows.length)return;let i=this.typedSettings.rows[t],n=this.rows[t];i.height=e,this.typedSettings.update();for(let a=0;a<n.columns.length;a++){const t=n.columns[a].panel;t.setSizeSettings(t.settings.size.width,e)}let s=this.settings.clientSize.height-n.columns[0].panel.settings.locationInPixels.y+this.typedSettings.rowsSpaceInPixels;for(let a=t+1;a<this.rows.length;a++){i=this.typedSettings.rows[a],n=this.rows[a];let t=0;for(let e=0;e<n.columns.length;e++){const a=i.columns[e];n.columns[e].panel.setLocationSettings(new N(t),new N(this.settings.clientSize.height-s-i.heightInPixels)),t+=a.widthInPixels+i.columnsSpaceInPixels}s+=i.heightInPixels+this.typedSettings.rowsSpaceInPixels}}setColumnWidth(t,e,i){if(t<0||t>=this.typedSettings.rows.length||e<0||e>=this.typedSettings.rows[t].columns.length)return;const n=this.typedSettings.rows[t],s=this.rows[t];let a=n.columns[e],o=s.columns[e];a.width=i,o.panel.setSizeSettings(i,o.panel.settings.size.height),this.typedSettings.update();let r=o.panel.settings.locationInPixels.x+a.widthInPixels+n.columnsSpaceInPixels;const l=o.panel.settings.locationInPixels.y;for(let d=e+1;d<s.columns.length;d++)a=n.columns[d],o=s.columns[d],o.panel.setLocationSettings(new N(r),new N(l)),r+=a.widthInPixels+n.columnsSpaceInPixels}getCell(t,e){if(!(t<0||t>=this.rows.length||e<0||e>=this.rows[t].columns.length))return this.rows[t].columns[e].panel}addItem(t,e,i){this.rows[t].columns[e].panel.addItem(i)}setDebugMode(t){super.setDebugMode(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e].columns;for(let e=0;e<i.length;e++)i[e].panel.setDebugMode(t)}}forEach(t){super.forEach(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e].columns;for(let e=0;e<i.length;e++)i[e].panel.forEach(t)}}async forEachAsync(t){await super.forEachAsync(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e].columns;for(let e=0;e<i.length;e++)await i[e].panel.forEachAsync(t)}}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i);for(let s=0;s<this.rows.length;s++){const e=this.rows[s].columns;for(let n=0;n<e.length;n++)e[n].panel.recursiveExecute(t,...i)}}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i);for(let s=0;s<this.rows.length;s++){const e=this.rows[s].columns;for(let n=0;n<e.length;n++)await e[n].panel.asyncRecursiveExecute(t,...i)}}}class It extends rt{constructor(t){var e,i,n,s;super(void 0===t?{type:"table"}:{type:null!==(e=t.type)&&void 0!==e?e:"table",id:t.id,idGenerator:t.idGenerator,name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData}),this.rowsSpace=null!==(i=null==t?void 0:t.rowsSpace)&&void 0!==i?i:new N(0),this.columnsSpace=null!==(n=null==t?void 0:t.columnsSpace)&&void 0!==n?n:new N(0),this.rows=[],this.columns=[],void 0!==t&&(void 0!==t.rows&&t.rows.forEach((t=>{var e;this.rows.push({height:null!==(e=t.height)&&void 0!==e?e:new Z(1)})})),void 0!==t.columns&&t.columns.forEach((t=>{var e;this.columns.push({width:null!==(e=t.width)&&void 0!==e?e:new Z(1)})}))),this.mergedCells=null!==(s=null==t?void 0:t.mergedCells)&&void 0!==s?s:[],this.commonSpaceBetweenRows=0,this.rowsSpaceInPixels=this.rowsSpace.calcValue(this.clientSize.height),this.rows.length>1&&(this.commonSpaceBetweenRows=this.rowsSpaceInPixels*(this.rows.length-1)),this.panelsAreaHeight=this.clientSize.height-this.commonSpaceBetweenRows,this.commonSpaceBetweenColumns=0,this.columnsSpaceInPixels=this.columnsSpace.calcValue(this.clientSize.width),this.columns.length>1&&(this.commonSpaceBetweenColumns=this.columnsSpaceInPixels*(this.columns.length-1)),this.panelsAreaWidth=this.clientSize.width-this.commonSpaceBetweenColumns}update(){this.commonSpaceBetweenRows=0,this.rowsSpaceInPixels=this.rowsSpace.calcValue(this.clientSize.height),this.rows.length>1&&(this.commonSpaceBetweenRows=this.rowsSpaceInPixels*(this.rows.length-1)),this.panelsAreaHeight=this.clientSize.height-this.commonSpaceBetweenRows,this.commonSpaceBetweenColumns=0,this.columnsSpaceInPixels=this.columnsSpace.calcValue(this.clientSize.width),this.columns.length>1&&(this.commonSpaceBetweenColumns=this.columnsSpaceInPixels*(this.columns.length-1)),this.panelsAreaWidth=this.clientSize.width-this.commonSpaceBetweenColumns}}class Pt extends ot{constructor(t){super(t),this.typedSettings=this.settings,this.rows=[]}init(){var t,e;super.init(),this.typedSettings.update();let i=0;for(let n=0;n<this.typedSettings.rows.length;n++){const s=this.typedSettings.rows[n],a={columns:[]};this.rows.push(a);const o=s.height.calcValue(this.typedSettings.panelsAreaHeight);let r=0;for(let l=0;l<this.typedSettings.columns.length;l++){const d=this.typedSettings.columns[l],c=new mt(new wt({id:null===(t=this.typedSettings.idGenerator)||void 0===t?void 0:t.generateNextId(),idGenerator:this.typedSettings.idGenerator,location:new G({x:new N(r),y:new N(this.settings.clientSize.height-i-o)}),size:new J({width:d.width,height:s.height}),parent:new st({ref:this,location:new H({x:this.settings.absoluteLocation.x,y:this.settings.absoluteLocation.y}),size:new K({width:this.typedSettings.panelsAreaWidth,height:this.typedSettings.panelsAreaHeight}),padding:new q({left:this.settings.paddingInPixels.left,right:this.settings.paddingInPixels.right,top:this.settings.paddingInPixels.top,bottom:this.settings.paddingInPixels.bottom})})}));c.init();const h=Pt.getCellMergeStatus(n,l,this.typedSettings.mergedCells),u={width:d.width,mergeStatus:h,panel:c,mergedPanel:h.status>0?void 0:c};if(a.columns.push(u),2==h.status){const t=this.typedSettings.mergedCells[h.mergedCellsIndex],i=this.rows[t.rowBegin].columns[t.columnBegin],n=c.settings.absoluteLocation.x+c.settings.sizeInPixels.width-i.panel.settings.absoluteLocation.x,s=i.panel.settings.absoluteLocation.y+i.panel.settings.sizeInPixels.height-c.settings.absoluteLocation.y,a=new mt(new wt({id:null===(e=this.typedSettings.idGenerator)||void 0===e?void 0:e.generateNextId(),idGenerator:this.typedSettings.idGenerator,location:new G({x:new N(i.panel.settings.absoluteLocation.x),y:new N(c.settings.absoluteLocation.y)}),size:new J({width:new N(n),height:new N(s)}),parent:new st({ref:this,location:new H({x:this.settings.absoluteLocation.x,y:this.settings.absoluteLocation.y}),size:new K({width:this.typedSettings.clientSize.width,height:this.typedSettings.clientSize.height}),padding:new q({left:this.settings.paddingInPixels.left,right:this.settings.paddingInPixels.right,top:this.settings.paddingInPixels.top,bottom:this.settings.paddingInPixels.bottom})})}));a.init(),i.mergedPanel=a}r+=u.width.calcValue(this.typedSettings.panelsAreaWidth)+this.typedSettings.columnsSpaceInPixels}i+=o+this.typedSettings.rowsSpaceInPixels}}setRowHeight(t,e){let i=0,n=this.typedSettings.rows[t];n.height=e;let s=n.height.calcValue(this.typedSettings.panelsAreaHeight),a=this.rows[t],o=this.settings.clientSize.height-a.columns[0].panel.settings.locationInPixels.y;for(let r=0;r<a.columns.length;r++){const t=a.columns[r];t.panel.setBordersSettings(new G({x:new N(i),y:new N(this.settings.clientSize.height-o-s)}),new J({width:t.panel.settings.size.width,height:e})),this.updateMergedCellsPanel(t),i+=t.width.calcValue(this.typedSettings.panelsAreaWidth)+this.typedSettings.columnsSpaceInPixels}o+=s+this.typedSettings.rowsSpaceInPixels;for(let r=t+1;r<this.typedSettings.rows.length;r++){n=this.typedSettings.rows[r],s=n.height.calcValue(this.typedSettings.panelsAreaHeight),i=0,a=this.rows[r];for(let t=0;t<a.columns.length;t++){const e=a.columns[t];this.updateCellLocation(e,i,o,s),i+=e.width.calcValue(this.typedSettings.panelsAreaWidth)+this.typedSettings.columnsSpaceInPixels}o+=s+this.typedSettings.rowsSpaceInPixels}}setColumnWidth(t,e){let i=0;const n=e.calcValue(this.typedSettings.panelsAreaWidth),s=this.rows[0].columns[t].panel.settings.locationInPixels.x+n;for(let a=0;a<this.typedSettings.rows.length;a++){const n=this.typedSettings.rows[a],o=this.rows[a],r=n.height.calcValue(this.typedSettings.panelsAreaHeight);let l=o.columns[t];l.panel.setSizeSettings(e,l.panel.settings.size.height),this.updateMergedCellsPanel(l);let d=s;for(let e=t+1;e<o.columns.length;e++)l=o.columns[e],this.updateCellLocation(l,d,i,r),d+=l.width.calcValue(this.typedSettings.panelsAreaWidth)+this.typedSettings.columnsSpaceInPixels;i+=r+this.typedSettings.rowsSpaceInPixels}}getCell(t,e){if(t<0||t>=this.rows.length||e<0||e>=this.rows[t].columns.length)return;const i=this.rows[t].columns[e];if(0==i.mergeStatus.status)return i.panel;{const t=this.typedSettings.mergedCells[i.mergeStatus.mergedCellsIndex];return this.rows[t.rowBegin].columns[t.columnBegin].mergedPanel}}addItem(t,e,i){var n;const s=this.rows[t].columns[e];if(0==s.mergeStatus.status)s.panel.addItem(i);else{const t=this.typedSettings.mergedCells[s.mergeStatus.mergedCellsIndex];null===(n=this.rows[t.rowBegin].columns[t.columnBegin].mergedPanel)||void 0===n||n.addItem(i)}}async createBorders(){await super.createBorders(),this.typedSettings.update();let t=0;for(let e=0;e<this.typedSettings.rows.length;e++){const i=this.typedSettings.rows[e],n=this.rows[e],s=i.height.calcValue(this.typedSettings.panelsAreaHeight);let a=0;for(let e=0;e<n.columns.length;e++){const i=n.columns[e];if(i.panel.setLocationSettings(new N(a),new N(this.settings.clientSize.height-t-s)),i.panel.setParentSizeSettings(this.typedSettings.panelsAreaWidth,this.typedSettings.panelsAreaHeight),await i.panel.createBorders(),this.updateMergedCellsPanel(i),2==i.mergeStatus.status){const t=this.typedSettings.mergedCells[i.mergeStatus.mergedCellsIndex],e=this.rows[t.rowBegin].columns[t.columnBegin];void 0!==e.mergedPanel&&(e.mergedPanel.setParentSizeSettings(this.typedSettings.clientSize.width,this.typedSettings.clientSize.height),await e.mergedPanel.createBorders())}a+=i.panel.settings.sizeInPixels.width+this.typedSettings.columnsSpaceInPixels}t+=s+this.typedSettings.rowsSpaceInPixels}}setDebugMode(t){super.setDebugMode(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e];for(let n=0;n<i.columns.length;n++){const i=this.getPanel(e,n);void 0!==i&&i.setDebugMode(t)}}}forEach(t){super.forEach(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e];for(let n=0;n<i.columns.length;n++){const i=this.getPanel(e,n);void 0!==i&&i.forEach(t)}}}async forEachAsync(t){await super.forEachAsync(t);for(let e=0;e<this.rows.length;e++){const i=this.rows[e];for(let n=0;n<i.columns.length;n++){const i=this.getPanel(e,n);void 0!==i&&await i.forEachAsync(t)}}}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i);for(let s=0;s<this.rows.length;s++){const e=this.rows[s];for(let n=0;n<e.columns.length;n++){const e=this.getPanel(s,n);void 0!==e&&e.recursiveExecute(t,...i)}}}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i);for(let s=0;s<this.rows.length;s++){const e=this.rows[s];for(let n=0;n<e.columns.length;n++){const e=this.getPanel(s,n);void 0!==e&&await e.asyncRecursiveExecute(t,...i)}}}static getCellMergeStatus(t,e,i){for(let n=0;n<i.length;++n){const s=i[n];if(t>=s.rowBegin&&t<=s.rowEnd&&e>=s.columnBegin&&e<=s.columnEnd)return t==s.rowBegin&&e==s.columnBegin?{status:1,mergedCellsIndex:n}:t==s.rowEnd&&e==s.columnEnd?{status:2,mergedCellsIndex:n}:{status:3,mergedCellsIndex:n}}return{status:0,mergedCellsIndex:-1}}getPanel(t,e){const i=this.rows[t].columns[e];if(0==i.mergeStatus.status)return i.panel;{const t=this.typedSettings.mergedCells[i.mergeStatus.mergedCellsIndex];return this.rows[t.rowBegin].columns[t.columnBegin].mergedPanel}}updateCellLocation(t,e,i,n){t.panel.setLocation(new N(e),new N(this.settings.clientSize.height-i-n)),this.updateMergedCellsPanel(t)}updateMergedCellsPanel(t){if(2!=t.mergeStatus.status)return;const e=this.typedSettings.mergedCells[t.mergeStatus.mergedCellsIndex],i=this.rows[e.rowBegin].columns[e.columnBegin];if(void 0===i.mergedPanel)return;const n=t.panel.settings.absoluteLocation.x+t.panel.settings.sizeInPixels.width-i.panel.settings.locationInPixels.x,s=i.panel.settings.absoluteLocation.y+i.panel.settings.sizeInPixels.height-t.panel.settings.absoluteLocation.y;i.mergedPanel.setBordersSettings(new G({x:new N(i.panel.settings.absoluteLocation.x),y:new N(t.panel.settings.absoluteLocation.y)}),new J({width:new N(n),height:new N(s)}))}}function Bt(t){const e=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return Dt(e,...n),e}function Dt(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];i.filter(Boolean).forEach((e=>3===e.length?t.setAttributeNS(e[0],e[1],e[2]):t.setAttribute(e[0],e[1])))}function Mt(){const t=document.createElement("div");t.style.height="1in",t.style.width="1in",t.style.top="-100%",t.style.left="-100%",t.style.position="absolute";const e=window.devicePixelRatio||1;document.body.appendChild(t);const i=t.offsetHeight*e;return document.body.removeChild(t),i}class zt{constructor(t){this.measuredValue=t}calculate(t){return this.measuredValue}reset(t){this.measuredValue=t}}class kt extends zt{constructor(t){super(0),this.Kp=t}calculate(t){return this.measuredValue+=this.Kp*(t-this.measuredValue),this.measuredValue}}class At extends St{constructor(t){var e,i,n;super(void 0===t?{}:{boxFillColor:t.boxFillColor,boxStrokeColor:t.boxStrokeColor}),this.strokeHtmlElements=null!==(e=null==t?void 0:t.strokeHtmlElements)&&void 0!==e&&e,this.fillHtmlElements=null!==(i=null==t?void 0:t.fillHtmlElements)&&void 0!==i&&i,this.boxOutline=null!==(n=null==t?void 0:t.boxOutline)&&void 0!==n?n:"2px solid brown"}}class Ft extends st{constructor(t){super({ref:null==t?void 0:t.ref,location:null==t?void 0:t.location,size:null==t?void 0:t.size,padding:null==t?void 0:t.padding}),this.jagmHtml=null==t?void 0:t.jagmHtml}}class Vt extends it{constructor(t){super({ref:null==t?void 0:t.ref}),this.jagmHtml=null==t?void 0:t.jagmHtml}}class _t{constructor(t,e,i,n){this.settings=t,this.findJagmHtml=e,this.getHtmlSettings=i,this.findParentHtml=n}update(t){this.updateParentRef(t),this.updateParentInfo(),this.calculateBorders()}updateParentRef(t){if(void 0===this.htmlParent){if(this.settings.parent instanceof Vt){const t=this.settings.parent;void 0===t.jagmHtml&&void 0!==this.settings.parent.ref&&this.settings.parent.ref instanceof ot&&void 0!==this.findJagmHtml&&(t.jagmHtml=this.findJagmHtml(this.settings.parent.ref)),this.htmlParent=t.jagmHtml}else if(this.settings.parent instanceof Ft){const t=this.settings.parent;void 0===t.jagmHtml&&void 0!==this.settings.parent.ref&&this.settings.parent.ref instanceof ot&&void 0!==this.findJagmHtml&&(t.jagmHtml=this.findJagmHtml(this.settings.parent.ref)),this.htmlParent=t.jagmHtml}void 0!==this.htmlParent&&void 0!==this.getHtmlSettings&&(this.parentHtmlSettings=this.getHtmlSettings(this.htmlParent))}if(void 0===this.settings.html.parent.ref)if(void 0!==this.settings.html.ref&&null!=this.settings.html.ref.parentElement)this.settings.html.parent.ref=this.settings.html.ref.parentElement;else if(void 0!==this.parentHtmlSettings)this.settings.html.parent.ref=this.parentHtmlSettings.ref;else if(void 0!==this.findParentHtml){const e=this.findParentHtml(t);if(void 0!==e){this.settings.html.parent.ref=e;const t=e.getBoundingClientRect(),i=Math.floor(t.width),n=Math.floor(t.height);this.settings.html.parent.size=new K({width:i,height:n})}}}updateParentInfo(){if(void 0!==this.htmlParent)this.settings.html.parent.absoluteLocation=this.htmlParent.settings.absoluteLocation.copy(),this.settings.html.parent.size=this.htmlParent.settings.clientSize.copy();else if(void 0===this.settings.html.parent.absoluteLocation&&(this.settings.html.parent.absoluteLocation=new H),void 0===this.settings.html.parent.size&&void 0!==this.settings.parent.ref&&this.settings.parent.ref instanceof ot){const t=this.settings.parent.ref;this.settings.html.parent.size=t.settings.clientSize.copy()}}calculateBorders(){if(void 0===this.settings.html.parent.size)return;const t=this.calculateX(),e=this.calculateY();this.settings.html.location=new G({x:new N(t),y:new N(e)}),this.settings.html.locationInPixels=new H({x:t,y:e})}calculateX(){return void 0===this.settings.html.parent.absoluteLocation?-1:this.settings.absoluteLocation.x-this.settings.html.parent.absoluteLocation.x-this.settings.marginInPixels.left}calculateY(){return void 0===this.settings.html.parent.size||void 0===this.settings.html.parent.absoluteLocation?-1:this.settings.html.parent.size.height-(this.settings.absoluteLocation.y-this.settings.html.parent.absoluteLocation.y+this.settings.sizeInPixels.height)}}const Rt=Symbol();class Lt extends ot{get[ut](){return!0}get[Rt](){return!0}get[gt](){return!0}constructor(t){super(t),this.typedSettings=this.settings}static findJagmHtmlObject(t){var e;return void 0===t?void 0:t instanceof Lt?t:void 0!==(null===(e=t.settings.parent)||void 0===e?void 0:e.ref)&&t.settings.parent.ref instanceof ot?Lt.findJagmHtmlObject(t.settings.parent.ref):void 0}static findParentHtml(t){var e,i;return void 0===t?void 0:void 0!==(null===(e=t.settings.parent)||void 0===e?void 0:e.ref)&&t.settings.parent.ref instanceof ot?(i=t.settings.parent.ref,gt in i?t.settings.parent.ref.getHtmlElement():Lt.findParentHtml(t.settings.parent.ref)):void 0}static getHtmlSettings(t){if(t instanceof Lt)return t.typedSettings.html}static setHtmlObject(t,e){var i;t.html.ref=e,void 0!==(null===(i=t.html.parent)||void 0===i?void 0:i.ref)&&t.html.parent.ref.appendChild(e)}init(){if(super.init(),this.typedSettings.html.autoUpdate.enabled&&(void 0===this.typedSettings.html.autoUpdate.updater&&(this.typedSettings.html.autoUpdate.updater=new _t(this.typedSettings,Lt.findJagmHtmlObject,Lt.getHtmlSettings,Lt.findParentHtml)),this.typedSettings.html.autoUpdate.updater.update(this)),void 0===this.settings.debug)this.settings.debug=new At({boxFillColor:[1,1,0,1],boxOutline:"2px solid brown"});else if(this.settings.debug instanceof At){const t=this.settings.debug;t.boxFillColor=[1,1,0,1],t.boxOutline="2px solid brown"}this.addEventListener("AddStyle",Lt.onAddStyle),this.addEventListener("AddClass",(async t=>{var e;null===(e=this.typedSettings.html.ref)||void 0===e||e.classList.add(t)})),this.addEventListener("RemoveClass",(async t=>{var e;null===(e=this.typedSettings.html.ref)||void 0===e||e.classList.remove(t)}))}getHtmlElement(){return this.typedSettings.html.ref}getDeviceScale(){return this.typedSettings.deviceScale}setDeviceScale(t){this.typedSettings.deviceScale=t}setPpi(t){this.typedSettings.ppi!=t&&this.typedSettings.setPpi(t)}getPpi(){return this.typedSettings.ppi}async addClass(t){this.typedSettings.classes.includes(t)||(this.typedSettings.classes.push(t),await this.handleEvent("AddClass",t))}async removeClass(t){for(let e=0;e<this.typedSettings.classes.length;++e)if(this.typedSettings.classes[e]==t)return this.typedSettings.classes.splice(e,1),void await this.handleEvent("RemoveClass",t)}async addStyle(t){this.typedSettings.styles.push(t),await this.handleEvent("AddStyle",t)}static async onAddStyle(t){const e=t,i=new CSSStyleSheet;i.insertRule(e),document.adoptedStyleSheets=[i]}setVisibility(t){super.setVisibility(t),void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.style.visibility=t?"visible":"collapse")}addHtmlEventListener(t,e){var i;null===(i=this.typedSettings.html.ref)||void 0===i||i.addEventListener(t,e)}removeHtmlEventListener(t,e){var i;null===(i=this.typedSettings.html.ref)||void 0===i||i.removeEventListener(t,e)}setDebugMode(t){super.setDebugMode(t),t instanceof At&&t.strokeHtmlElements&&void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.style.outline=t.boxOutline)}setHtmlLocationSettings(t,e){this.typedSettings.html.location=new G({x:t,y:e})}setHtmlParentSizeSettings(t,e){this.typedSettings.html.parent.size=new K({width:t,height:e})}setLocationSettings(t,e){super.setLocationSettings(t,e),this.setHtmlLocationSettings(t,e)}setSizeSettings(t,e){super.setSizeSettings(t,e)}setBordersSettings(t,e){super.setBordersSettings(t,e),this.typedSettings.html.location=t}setParentSizeSettings(t,e){super.setParentSizeSettings(t,e),this.setHtmlParentSizeSettings(t,e)}async setHtmlLocation(t,e){return(void 0===this.typedSettings.html.location||!this.typedSettings.html.location.x.isEquals(t)||!this.typedSettings.html.location.y.isEquals(e))&&(this.setHtmlLocationSettings(t,e),await this.createHtmlBorders(),!0)}async setHtmlBorders(t){return(void 0===this.typedSettings.html.location||!this.typedSettings.html.location.x.isEquals(t.x)||!this.typedSettings.html.location.y.isEquals(t.y))&&(await this.createHtmlBorders(),!0)}async setHtmlParentSize(t,e){return(void 0===this.typedSettings.html.parent.size||this.typedSettings.html.parent.size.width!=t||this.typedSettings.html.parent.size.height!=e)&&(this.setHtmlParentSizeSettings(t,e),await this.createHtmlBorders(),!0)}getHtmlObjectRealBorders(){var t;return null===(t=this.typedSettings.html.ref)||void 0===t?void 0:t.getBoundingClientRect()}update(t,e){void 0!==this.typedSettings.html.ref&&Dt(this.typedSettings.html.ref,[t,e])}removeObjectFromDom(){var t;null===(t=this.typedSettings.html.ref)||void 0===t||t.remove()}async createBorders(){await super.createBorders(),await this.createHtmlBorders()}async createHtmlBorders(){var t;this.typedSettings.html.autoUpdate.enabled&&(null===(t=this.typedSettings.html.autoUpdate.updater)||void 0===t||t.update(this))}static isJagmHtmlObject(t){return t instanceof Lt}}class Et{constructor(t){let e=!0;if(void 0!==t){const i=function(t){if("undefined"==typeof navigator)return;let e=null!=t?t:navigator.userAgent;if(e=e.toLowerCase(),void 0===e)return;const i=e.match(/android\s([0-9\.]*)/i);return i?i[1]:void 0}(t);e=void 0===i||6!==parseInt(i,10)}this.precision=e?"precision highp float;":"precision mediump float;"}getFragmentShader(){return`\n  ${this.precision}\n  uniform vec4 u_color;\n\n  void main() \n  {\n    // gl_FragColor - \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u0430\u044f \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u043d\u043e\u0433\u043e \u0448\u0435\u0439\u0434\u0435\u0440\u0430, \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 \u0446\u0432\u0435\u0442\u0430.\n    gl_FragColor = u_color;\n  }\n`}getVertexShader(){return`\n  ${this.precision}\n  attribute vec2 a_position; // \u043f\u043e\u0437\u0438\u0446\u0438\u044f \u0442\u043e\u0447\u043a\u0438 (\u0432 px)\n\n  uniform vec2 u_shift; // \u0441\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e x \u0438 y\n  uniform float u_rollIndex;  // \u0438\u043d\u0434\u0435\u043a\u0441 \u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f roll \u0440\u0435\u0436\u0438\u043c\u0430\n  uniform vec2 u_scale; // \u041c\u0430\u0441\u0448\u0442\u0430\u0431 (x - width, y - height)\n  uniform vec2 u_windowSize; // \u0420\u0430\u0437\u043c\u0435\u0440\u044b \u043e\u043a\u043d\u0430 \u0434\u043b\u044f \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u043a\u0438\n\n  float mod2(float a, float b)\n  {\n    float res;\n    if(a == b) {\n      res = a;\n    }\n    else {\n      res = mod(a,b);\n    }\n\n    return res;\n  }\n\n  void main() \n  {\n    // \u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u043c roll \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u044e\n    vec2 position = a_position;\n    if (u_rollIndex != 0.0) {\n      position.x = mod2(position.x, u_rollIndex);\n    }\n    // \u041c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u043c\n    vec2 scaledPosition = position * u_scale;\n    // \u0421\u043c\u0435\u0449\u0430\u0435\u043c\n    vec2 shiftedPosition = scaledPosition + u_shift;\n    // \u041f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u043c \u0432 \u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0430\u0442\u044b WebGL\n    vec2 webglPosition  = (shiftedPosition / u_windowSize) * 2.0 - 1.0;\n    gl_Position = vec4(webglPosition, 0, 1); \n  }`}}var jt,Yt;!function(t){t[t.Color=0]="Color",t[t.Shift=1]="Shift",t[t.Scale=2]="Scale",t[t.WindowSize=3]="WindowSize",t[t.RollIndex=4]="RollIndex"}(jt||(jt={}));class Ot{constructor(t){this.color=t.color,this.shift=void 0===t.shift?new Float32Array([0,0]):t.shift,this.scale=void 0===t.scale?new Float32Array([1,1]):t.scale,this.windowSize=t.windowSize,this.rollIndex=void 0===t.rollIndex?0:t.rollIndex,this.uniformNames=new Map([[jt.Color,"u_color"],[jt.Shift,"u_shift"],[jt.Scale,"u_scale"],[jt.WindowSize,"u_windowSize"],[jt.RollIndex,"u_rollIndex"]]),this.locations=new Map}setValues(t){var e,i,n;this.color=t.color,this.shift=null!==(e=t.shift)&&void 0!==e?e:new Float32Array([0,0]),this.scale=null!==(i=t.scale)&&void 0!==i?i:new Float32Array([1,1]),this.windowSize=t.windowSize,this.rollIndex=null!==(n=t.rollIndex)&&void 0!==n?n:0}getLocations(t,e){this.uniformNames.forEach(((i,n)=>{const s=t.getUniformLocation(e,i);null!=s&&this.locations.set(n,s)}))}setToContext(t){const e=this.locations.get(jt.Color);void 0!==e&&t.uniform4fv(e,this.color);const i=this.locations.get(jt.Shift);void 0!==i&&t.uniform2f(i,this.shift[0],this.shift[1]);const n=this.locations.get(jt.Scale);void 0!==n&&t.uniform2f(n,this.scale[0],this.scale[1]);const s=this.locations.get(jt.WindowSize);void 0!==s&&t.uniform2f(s,this.windowSize[0],this.windowSize[1]);const a=this.locations.get(jt.RollIndex);void 0!==a&&t.uniform1f(a,this.rollIndex)}}!function(t){t[t.Position=0]="Position"}(Yt||(Yt={}));class Ut{constructor(){this.attributeNames=new Map([[Yt.Position,"a_position"]]),this.locations=new Map}getLocations(t,e){this.attributeNames.forEach(((i,n)=>{this.locations.set(n,t.getAttribLocation(e,i))}))}bindAttributes(t){const e=this.locations.get(Yt.Position);if(void 0===e)return;t.enableVertexAttribArray(e);const i=t.createBuffer();null!=i&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0))}enableAttribute(t,e){const i=this.locations.get(t);void 0!==i&&e.enableVertexAttribArray(i)}}class Tt{constructor(t,e){this.context=t,this.shaderList=new Et(e),this.program=this.createProgram(),this.attributes=new Ut,this.uniforms=new Ot({color:new Float32Array([0,0,0,0]),windowSize:new Float32Array([0,0])}),null!=this.program&&(this.attributes.getLocations(this.context,this.program),this.attributes.bindAttributes(this.context),this.uniforms.getLocations(this.context,this.program),this.context.useProgram(this.program))}createProgram(){const t=this.loadShader(this.context,this.shaderList.getFragmentShader(),this.context.FRAGMENT_SHADER);if(null==t)return null;const e=this.loadShader(this.context,this.shaderList.getVertexShader(),this.context.VERTEX_SHADER);return null==e?null:this.createProgramByShaders(this.context,[e,t])}enableAttribute(t){this.attributes.enableAttribute(t,this.context)}enablePositionAttribute(){this.attributes.enableAttribute(Yt.Position,this.context)}getPositionAttribLocation(){return this.attributes.locations.get(Yt.Position)}updateAttributes(){null!=this.program&&(this.attributes.getLocations(this.context,this.program),this.attributes.bindAttributes(this.context))}updateUniforms(){null!=this.program&&this.uniforms.getLocations(this.context,this.program)}setUnformsToContext(){this.uniforms.setToContext(this.context)}setUniforms(t){this.uniforms.setValues(t),this.uniforms.setToContext(this.context)}loadShader(t,e,i){const n=t.createShader(i);if(null==n)return null;t.shaderSource(n,e),t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(n);return null!=e&&console.log("*** Error compiling shader '"+n+"':"+e),t.deleteShader(n),null}return n}createProgramByShaders(t,e){const i=t.createProgram();if(null==i)return null;e.forEach((function(e){t.attachShader(i,e)})),t.linkProgram(i);if(!t.getProgramParameter(i,t.LINK_STATUS)){const e=t.getProgramInfoLog(i);return console.error("Error in program linking:"+e),t.deleteProgram(i),null}return i}}const Wt=Symbol();function Xt(t){return Wt in t}const Ht=Symbol();class Nt extends Lt{get[lt](){return!0}get[Wt](){return!0}get[Ht](){return!0}constructor(t){super(t),this.typedSettings=this.settings,this.items=new ht("webglItems")}init(){if(super.init(),this.items=new ht("webglItems"),this.typedSettings.canvas=this,this.typedSettings.drawEnabled=!0,Lt.setHtmlObject(this.typedSettings,document.createElement("canvas")),void 0===this.typedSettings.html.ref)return;this.typedSettings.html.ref.setAttribute("width",`${this.settings.sizeInPixels.width}px`),this.typedSettings.html.ref.setAttribute("height",`${this.settings.sizeInPixels.height}px`),this.typedSettings.html.ref.setAttribute("style",`left: ${this.typedSettings.html.locationInPixels.x}px; top: ${this.typedSettings.html.locationInPixels.y}px; margin: ${this.settings.marginInPixels.top}px, ${this.settings.marginInPixels.right}px, ${this.settings.marginInPixels.bottom}px, ${this.settings.marginInPixels.left}px; position: absolute; z-index: auto; pointer-events: none;`);const t=this.typedSettings.html.ref.getContext("webgl",{antialias:!1,premultipliedAlpha:!1});null!=t&&(this.typedSettings.contextProvider=new Tt(t))}addItem(t){this.items.add(t)}async createBorders(){await super.createBorders(),await this.items.forEachAsync((async t=>{t instanceof ot&&(t.updateParentSizeSettings(),await t.createBorders())}))}async createHtmlBorders(){await super.createHtmlBorders(),void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.setAttribute("width",`${this.typedSettings.sizeInPixels.width}px`),this.typedSettings.html.ref.setAttribute("height",`${this.typedSettings.sizeInPixels.height}px`),this.typedSettings.html.ref.setAttribute("style",`left: ${this.typedSettings.html.locationInPixels.x}px; top: ${this.typedSettings.html.locationInPixels.y}px; margin: ${this.settings.marginInPixels.top}px, ${this.settings.marginInPixels.right}px, ${this.settings.marginInPixels.bottom}px, ${this.settings.marginInPixels.left}px; position: absolute; z-index: auto; pointer-events: none;`))}setDebugMode(t){if(super.setDebugMode(t),t instanceof At&&t.fillHtmlElements&&void 0!==this.settings.debug){const t=x.convertWebglRgbaToHex(this.settings.debug.boxFillColor);y(t)&&void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.style.backgroundColor=t.data)}this.items.forEach((e=>{e.setDebugMode(t)}))}forEach(t){super.forEach(t),this.items.forEach(t)}async forEachAsync(t){await super.forEachAsync(t),await this.items.forEachAsync(t)}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i),this.items.recursiveExecute(t,...i)}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i),await this.items.asyncRecursiveExecute(t,...i)}getWebglContextProvider(){return this.typedSettings.contextProvider}draw(){if(!this.typedSettings.drawEnabled||void 0===this.typedSettings.contextProvider)return;const t=this.typedSettings.contextProvider.context;t.viewport(0,0,this.settings.sizeInPixels.width,this.settings.sizeInPixels.height),void 0!==this.typedSettings.backgroundColor&&t.clearColor(this.typedSettings.backgroundColor[0],this.typedSettings.backgroundColor[1],this.typedSettings.backgroundColor[2],this.typedSettings.backgroundColor[3]),t.clear(t.COLOR_BUFFER_BIT),this.items.forEach((t=>{dt(t)&&t.draw()}))}refreshGraphics(){requestAnimationFrame(this.draw.bind(this))}static isCanvas(t){return t instanceof Nt}}class Gt{constructor(t){var e,i,n,s,a,o,r,l;this.ref=null==t?void 0:t.ref,this.autoUpdate={enabled:null!==(i=null===(e=null==t?void 0:t.autoUpdate)||void 0===e?void 0:e.enabled)&&void 0!==i&&i,updater:null===(n=null==t?void 0:t.autoUpdate)||void 0===n?void 0:n.updater},this.location=null==t?void 0:t.location,this.parent={ref:null===(s=null==t?void 0:t.parent)||void 0===s?void 0:s.ref,size:null!==(o=null===(a=null==t?void 0:t.parent)||void 0===a?void 0:a.size)&&void 0!==o?o:new K,absoluteLocation:null!==(l=null===(r=null==t?void 0:t.parent)||void 0===r?void 0:r.absoluteLocation)&&void 0!==l?l:new H},this.locationInPixels=new H}}class qt extends nt{constructor(t){var e,i,n,s,a,o,r,l,d,c;super({name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode}),this.classes=[],this.styles=[],this.deviceScale=null!==(e=t.deviceScale)&&void 0!==e?e:1;let h=t.ppi;if(void 0===h&&void 0!==(null===(i=t.parent)||void 0===i?void 0:i.ref)){const e=t.parent.ref.getRoot();if(void 0!==e&&ut in e){const t=e;h=t.getPpi(),this.deviceScale=t.getDeviceScale()}}this.ppi=null!=h?h:0,this.ppcm=this.ppi/2.54,this.html=new Gt(void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:{enabled:null===(a=null===(s=null===(n=t.html)||void 0===n?void 0:n.autoUpdate)||void 0===s?void 0:s.enabled)||void 0===a||a,updater:null===(r=null===(o=t.html)||void 0===o?void 0:o.autoUpdate)||void 0===r?void 0:r.updater},location:t.html.location,parent:{ref:null===(l=t.html.parent)||void 0===l?void 0:l.ref,size:null===(d=t.html.parent)||void 0===d?void 0:d.size,absoluteLocation:null===(c=t.html.parent)||void 0===c?void 0:c.absoluteLocation}})}setPpi(t){this.ppi=t,this.ppcm=this.ppi/2.54}}class $t extends qt{constructor(t){var e,i,n,s,a;super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:{enabled:null===(e=t.html.autoUpdate)||void 0===e?void 0:e.enabled,updater:null===(i=t.html.autoUpdate)||void 0===i?void 0:i.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.id=null==t?void 0:t.id,this.idGenerator=null==t?void 0:t.idGenerator,this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider,this.drawEnabled=null===(n=null==t?void 0:t.drawEnabled)||void 0===n||n,this.backgroundColor=null!==(s=null==t?void 0:t.backgroundColor)&&void 0!==s?s:[1,1,1,1],this.commonData=null==t?void 0:t.commonData,void 0===(null==t?void 0:t.debug)&&(this.debug=new At({boxFillColor:[1,0,1,1],boxOutline:"2px solid #880088"})),this.ppi=null!==(a=null==t?void 0:t.ppi)&&void 0!==a?a:Mt(),this.ppcm=this.ppi/2.54}}class Kt{constructor(t){var e,i,n;this.color=new Float32Array(t.color),this.shift=new Float32Array(null!==(e=t.shift)&&void 0!==e?e:[0,0]),this.scale=new Float32Array(null!==(i=t.scale)&&void 0!==i?i:[1,1]),this.windowSize=new Float32Array(t.windowSize),this.rollIndex=null!==(n=t.rollIndex)&&void 0!==n?n:0}setValues(t){if(void 0!==t.color)for(let e=0;e<4;++e)this.color[e]=t.color[e];void 0!==t.shift&&(this.shift[0]=t.shift[0],this.shift[1]=t.shift[1]),void 0!==t.scale&&(this.scale[0]=t.scale[0],this.scale[1]=t.scale[1]),void 0!==t.windowSize&&(this.windowSize[0]=t.windowSize[0],this.windowSize[1]=t.windowSize[1]),void 0!==t.rollIndex&&(this.rollIndex=t.rollIndex)}setToContext(t){t.setUniforms({color:this.color,shift:this.shift,scale:this.scale,windowSize:this.windowSize,rollIndex:this.rollIndex})}}class Zt extends St{constructor(t){var e,i,n;super(void 0===t?{}:{boxFillColor:t.boxFillColor,boxStrokeColor:t.boxStrokeColor}),this.fillWebglElements=null!==(e=null==t?void 0:t.fillWebglElements)&&void 0!==e&&e,this.strokeWebglElements=null!==(i=null==t?void 0:t.strokeWebglElements)&&void 0!==i&&i,this.isTransparentBackground=null!==(n=null==t?void 0:t.isTransparentBackground)&&void 0!==n&&n}}class Jt{get[lt](){return!0}get[Wt](){return!0}constructor(t,e,i){this.uniforms=t,this.objectSettings=e,this.webglDrawSettings=i}getParentCanvas(){if(void 0===this.webglDrawSettings.canvas){let t,e;for(void 0!==this.objectSettings.parent.ref&&this.objectSettings.parent.ref instanceof ot&&(e=this.objectSettings.parent.ref);void 0!==e;)Xt(e)&&(t=e),e=void 0!==e.settings.parent.ref&&e.settings.parent.ref instanceof ot?e.settings.parent.ref:void 0;void 0!==t&&t instanceof Nt&&(this.webglDrawSettings.canvas=t)}return this.webglDrawSettings.canvas}getWebglContextProvider(){if(void 0===this.webglDrawSettings.contextProvider){let t;for(void 0!==this.objectSettings.parent.ref&&this.objectSettings.parent.ref instanceof ot&&(t=this.objectSettings.parent.ref);void 0!==t;){if(Xt(t)){this.webglDrawSettings.contextProvider=t.getWebglContextProvider();break}t=void 0!==t.settings.parent.ref&&t.settings.parent.ref instanceof ot?t.settings.parent.ref:void 0}}return this.webglDrawSettings.contextProvider}setDebugMode(){var t;if(!(this.objectSettings.debug instanceof Zt))return;const e=this.objectSettings.debug;if(e.fillWebglElements||e.strokeWebglElements){const i=this.getWebglContextProvider();if(void 0===i)return;const n=i.context,s=this.getParentCanvas();if(void 0===s)return;if(this.uniforms.setValues({color:null===(t=this.objectSettings.debug)||void 0===t?void 0:t.boxFillColor,windowSize:[s.settings.sizeInPixels.width,s.settings.sizeInPixels.height]}),e.fillWebglElements){e.boxFillBuffer=Jt.createRectangleFillBuffer(this.objectSettings.absoluteLocation,this.objectSettings.sizeInPixels),e.boxFillIndices=new Uint16Array([3,2,1,3,1,0]);const t=n.createBuffer();if(null==t)return;e.boxFillVerticesBuffer=t,n.bindBuffer(n.ARRAY_BUFFER,e.boxFillVerticesBuffer),n.bufferData(n.ARRAY_BUFFER,e.boxFillBuffer,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null);const i=n.createBuffer();if(null==i)return;e.boxFillIndicesBuffer=i,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.boxFillIndicesBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.boxFillIndices,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}if(e.strokeWebglElements){e.boxStrokeBuffer=Jt.createRectangleStrokeBuffer(this.objectSettings.absoluteLocation,this.objectSettings.sizeInPixels,1);const t=n.createBuffer();if(null==t)return;e.boxStrokeVerticesBuffer=t,n.bindBuffer(n.ARRAY_BUFFER,e.boxStrokeVerticesBuffer),n.bufferData(n.ARRAY_BUFFER,e.boxStrokeBuffer,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null)}}}static createRectangleFillBuffer(t,e){return new Float32Array([t.x,t.y+e.height,t.x,t.y,t.x+e.width,t.y,t.x+e.width,t.y+e.height])}static createRectangleStrokeBuffer(t,e,i){return void 0===i&&(i=0),new Float32Array([t.x+i,t.y+e.height-2*(i+1),t.x+i,t.y+2*i,t.x+i,t.y+2*i,t.x+e.width-2*(i+1),t.y+2*i,t.x+e.width-2*(i+1),t.y+2*i,t.x+e.width-2*(i+1),t.y+e.height-2*(i+1),t.x+e.width-2*(i+1),t.y+e.height-2*(i+1),t.x+i,t.y+e.height-2*(i+1)])}updateVertexBuffers(){if(!this.objectSettings.isDebugMode)return;const t=this.getParentCanvas();if(void 0===t)return;const e=this.getWebglContextProvider();if(void 0===e)return;const i=e.context;if(!(this.objectSettings.debug instanceof Zt))return;const n=this.objectSettings.debug;this.uniforms.setValues({windowSize:[t.settings.sizeInPixels.width,t.settings.sizeInPixels.height]}),n.fillWebglElements&&void 0!==n.boxFillVerticesBuffer&&(n.boxFillBuffer=Jt.createRectangleFillBuffer(this.objectSettings.absoluteLocation,this.objectSettings.sizeInPixels),i.bindBuffer(i.ARRAY_BUFFER,n.boxFillVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,n.boxFillBuffer,i.STATIC_DRAW)),n.strokeWebglElements&&void 0!==n.boxStrokeVerticesBuffer&&(n.boxStrokeBuffer=Jt.createRectangleStrokeBuffer(this.objectSettings.absoluteLocation,this.objectSettings.sizeInPixels,1),i.bindBuffer(i.ARRAY_BUFFER,n.boxStrokeVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,n.boxStrokeBuffer,i.STATIC_DRAW))}draw(){var t,e;if(!(this.objectSettings.isVisible&&this.objectSettings.isDebugMode&&this.objectSettings.debug instanceof Zt))return;const i=this.objectSettings.debug;if(!i.fillWebglElements&&!i.strokeWebglElements)return;const n=this.getWebglContextProvider();if(void 0===n)return;const s=n.context;if(s.viewport(0,0,this.uniforms.windowSize[0],this.uniforms.windowSize[1]),!i.fillWebglElements||void 0===i.boxFillVerticesBuffer||void 0===i.boxFillIndicesBuffer||void 0!==i.isTransparentBackground&&i.isTransparentBackground)i.strokeWebglElements&&n.enablePositionAttribute();else{this.uniforms.setValues({color:null===(t=this.objectSettings.debug)||void 0===t?void 0:t.boxFillColor}),this.uniforms.setToContext(n),n.enablePositionAttribute(),s.bindBuffer(s.ARRAY_BUFFER,i.boxFillVerticesBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.boxFillIndicesBuffer);const e=n.getPositionAttribLocation();if(void 0===e)return;s.vertexAttribPointer(e,2,s.FLOAT,!1,0,0),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}if(i.strokeWebglElements&&void 0!==i.boxStrokeVerticesBuffer&&void 0!==i.boxStrokeBuffer){this.uniforms.setValues({color:null===(e=this.objectSettings.debug)||void 0===e?void 0:e.boxStrokeColor}),this.uniforms.setToContext(n),s.bindBuffer(s.ARRAY_BUFFER,i.boxStrokeVerticesBuffer);const t=n.getPositionAttribLocation();if(void 0===t)return;s.vertexAttribPointer(t,2,s.FLOAT,!1,0,0),s.drawArrays(s.LINES,0,i.boxStrokeBuffer.length/2)}}}class Qt extends ot{get[lt](){return!0}get[Wt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}init(){super.init(),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}getParentCanvas(){return this.drawer.getParentCanvas()}getWebglContextProvider(){return this.drawer.getWebglContextProvider()}setDebugMode(t){this.drawer.setDebugMode(),super.setDebugMode(t)}async createBorders(){this.settings.isDebugMode&&this.drawer.updateVertexBuffers(),await super.createBorders()}draw(){this.drawer.draw()}}class te extends Lt{constructor(t){super(t)}init(){var t;super.init(),Lt.setHtmlObject(this.typedSettings,Bt("svg",["x",`${this.typedSettings.html.locationInPixels.x}px`],["y",`${this.typedSettings.html.locationInPixels.y}px`],["min-width",`${this.typedSettings.sizeInPixels.width}px`],["width",`${this.typedSettings.sizeInPixels.width}px`],["height",`${this.typedSettings.sizeInPixels.height}px`],["style","margin: 0px; position: absolute;"])),this.backgroundRectangle=Bt("rect",["x","0px"],["y","0px"],["width",`${this.typedSettings.sizeInPixels.width}`],["height",`${this.typedSettings.sizeInPixels.height}`],["fill","transparent"],["stroke","transparent"],["style","margin: 0px; position: absolute;"]),null===(t=this.typedSettings.html.ref)||void 0===t||t.appendChild(this.backgroundRectangle)}setDebugMode(t){super.setDebugMode(t),t instanceof At&&t.fillHtmlElements&&this.setBackgroundFillColor(t.boxFillColor)}addOnClickedFunction(t){this.addHtmlEventListener("click",t)}setBackgroundFillColor(t){var e;const i=x.convertWebglRgbaToHex(t);y(i)&&(null===(e=this.backgroundRectangle)||void 0===e||e.setAttribute("fill",i.data))}setBackgroundStrokeColor(t){var e;const i=x.convertWebglRgbaToHex(t);y(i)&&(null===(e=this.backgroundRectangle)||void 0===e||e.setAttribute("stroke",i.data))}async createHtmlBorders(){await super.createHtmlBorders(),void 0!==this.typedSettings.html.ref&&void 0!==this.backgroundRectangle&&(this.backgroundRectangle.setAttribute("width",`${this.typedSettings.sizeInPixels.width}px`),this.backgroundRectangle.setAttribute("height",`${this.typedSettings.sizeInPixels.height}px`),this.typedSettings.html.ref.setAttribute("x",`${this.typedSettings.html.locationInPixels.x}px`),this.typedSettings.html.ref.setAttribute("y",`${this.typedSettings.html.locationInPixels.y}px`),this.typedSettings.html.ref.setAttribute("min-width",`${this.typedSettings.sizeInPixels.width}px`),this.typedSettings.html.ref.setAttribute("width",`${this.typedSettings.sizeInPixels.width}px`),this.typedSettings.html.ref.setAttribute("height",`${this.typedSettings.sizeInPixels.height}px`))}}class ee extends te{constructor(t){super(t),this.items=new ht("items")}init(){super.init(),this.items=new ht("items")}setDebugMode(t){super.setDebugMode(t),this.items.forEach((e=>{e.setDebugMode(t)}))}addItem(t){this.items.add(t)}async createBorders(){await super.createBorders(),await this.items.forEachAsync((async t=>{const e=t;e.updateParentSizeSettings(),await e.createBorders()}))}}class ie extends Lt{constructor(t){super(t),this.typedSettings=this.settings,this.items=new ht("Items")}init(){var t;super.init(),this.wrapper=document.createElement("div"),this.wrapper.setAttribute("id",`wrapper_${this.typedSettings.id}`),this.wrapper.setAttribute("style",`left: ${this.typedSettings.html.locationInPixels.x}px; top: ${this.typedSettings.html.locationInPixels.y}px; width: ${this.typedSettings.sizeInPixels.width}px; height: ${this.typedSettings.sizeInPixels.height}px; margin: 0px; position: absolute; background-color: transparent; overflow: hidden;`),this.typedSettings.html.ref=Bt("svg",["class",`${this.typedSettings.id}`],["x","0px"],["y","0px"],["min-width",`${this.typedSettings.sizeInPixels.width}px`],["width",`${this.typedSettings.sizeInPixels.width}px`],["height",`${this.typedSettings.sizeInPixels.height}px`]),this.typedSettings.html.ref.style.position="absolute",this.wrapper.appendChild(this.typedSettings.html.ref),null===(t=this.typedSettings.html.parent.ref)||void 0===t||t.appendChild(this.wrapper),this.items=new ht("Items")}addItem(t){this.items.add(t)}async createHtmlBorders(){await super.createHtmlBorders();const t=this.typedSettings.html.ref;void 0!==t&&(t.style.minWidth=`${this.typedSettings.sizeInPixels.width}px`,t.style.width=`${this.typedSettings.sizeInPixels.width}px`,t.style.height=`${this.typedSettings.sizeInPixels.height}px`,t.setAttribute("min-width",`${this.typedSettings.sizeInPixels.width}px`),t.setAttribute("width",`${this.typedSettings.sizeInPixels.width}px`),t.setAttribute("height",`${this.typedSettings.sizeInPixels.height}px`)),void 0!==this.wrapper&&(this.wrapper.style.left=`${this.typedSettings.html.locationInPixels.x}px`,this.wrapper.style.top=`${this.typedSettings.html.locationInPixels.y}px`,this.wrapper.style.width=`${this.typedSettings.sizeInPixels.width}px`,this.wrapper.style.height=`${this.typedSettings.sizeInPixels.height}px`)}async createBorders(){await super.createBorders(),await this.items.forEachAsync((async t=>{const e=t;e.setParentSizeSettings(this.settings.sizeInPixels.width,this.settings.sizeInPixels.height),await e.createBorders()}))}setDebugMode(t){super.setDebugMode(t),this.items.forEach((e=>{e.setDebugMode(t)}))}}class ne extends qt{constructor(t){var e;super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:""}}class se extends nt{constructor(t){var e;super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:null!==(e=t.debug)&&void 0!==e?e:new Zt,isVisible:t.isVisible,isDebugMode:t.isDebugMode}),this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider}}class ae extends se{constructor(t){var e,i,n,s;super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,contextProvider:t.contextProvider,canvas:t.canvas}),this.hasFill=null!==(e=null==t?void 0:t.hasFill)&&void 0!==e&&e,this.hasStroke=null!==(i=null==t?void 0:t.hasStroke)&&void 0!==i&&i,this.fillColor=null!==(n=null==t?void 0:t.fillColor)&&void 0!==n?n:[0,0,0,1],this.strokeColor=null!==(s=null==t?void 0:t.strokeColor)&&void 0!==s?s:[0,0,0,1]}}class oe extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.fillBuffer=new Float32Array,this.fillIndices=new Uint16Array,this.strokeBuffer=new Float32Array}init(){if(super.init(),this.settings.debug instanceof Zt&&(this.typedSettings.hasFill||this.typedSettings.hasStroke)){const t=this.getParentCanvas();if(void 0===t)return;const e=this.getWebglContextProvider();if(void 0===e)return;this.uniforms.setValues({color:this.settings.debug.boxFillColor,windowSize:[t.settings.sizeInPixels.width,t.settings.sizeInPixels.height]});const i=e.context;if(this.typedSettings.hasFill){this.fillBuffer=Jt.createRectangleFillBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels),this.fillIndices=new Uint16Array([3,2,1,3,1,0]);const t=i.createBuffer();if(null==t)return;this.fillVerticesBuffer=t,i.bindBuffer(i.ARRAY_BUFFER,this.fillVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,this.fillBuffer,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null);const e=i.createBuffer();if(null==e)return;this.fillIndicesBuffer=e,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.fillIndicesBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.fillIndices,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}if(this.typedSettings.hasStroke){this.strokeBuffer=Jt.createRectangleStrokeBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels);const t=i.createBuffer();if(null==t)return;this.strokeVerticesBuffer=t,i.bindBuffer(i.ARRAY_BUFFER,this.strokeVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,this.strokeBuffer,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)}}}async createBorders(){await super.createBorders(),this.updateDataBuffer()}updateDataBuffer(){const t=this.getParentCanvas();if(void 0===t)return;const e=this.getWebglContextProvider();if(void 0===e)return;this.uniforms.setValues({windowSize:[t.settings.sizeInPixels.width,t.settings.sizeInPixels.height]});const i=e.context;this.typedSettings.hasFill&&void 0!==this.fillVerticesBuffer&&(this.fillBuffer=Jt.createRectangleFillBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels),i.bindBuffer(i.ARRAY_BUFFER,this.fillVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,this.fillBuffer,i.STATIC_DRAW)),this.typedSettings.hasStroke&&void 0!==this.strokeVerticesBuffer&&(this.strokeBuffer=Jt.createRectangleStrokeBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels),i.bindBuffer(i.ARRAY_BUFFER,this.strokeVerticesBuffer),i.bufferData(i.ARRAY_BUFFER,this.strokeBuffer,i.STATIC_DRAW))}draw(){const t=this.getWebglContextProvider();if(void 0!==t&&(this.typedSettings.hasFill||this.typedSettings.hasStroke)){const e=t.context;if(e.viewport(0,0,this.uniforms.windowSize[0],this.uniforms.windowSize[1]),this.typedSettings.hasFill&&void 0!==this.fillVerticesBuffer&&void 0!==this.fillIndicesBuffer){this.uniforms.setValues({color:this.typedSettings.fillColor}),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.fillVerticesBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.fillIndicesBuffer);const i=t.getPositionAttribLocation();if(void 0===i)return;e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}else this.typedSettings.hasStroke&&t.enablePositionAttribute();if(this.typedSettings.hasStroke&&void 0!==this.strokeVerticesBuffer){this.uniforms.setValues({color:this.typedSettings.strokeColor}),this.uniforms.setToContext(t),e.bindBuffer(e.ARRAY_BUFFER,this.strokeVerticesBuffer);const i=t.getPositionAttribLocation();if(void 0===i)return;e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,this.strokeBuffer.length/2)}}}}class re extends Pt{get[lt](){return!0}get[Wt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new Zt({boxFillColor:[0,.8,0,1],boxStrokeColor:[0,.2,0,1]}):(this.settings.debug.boxFillColor=[0,.8,0,1],this.settings.debug.boxStrokeColor=[0,.2,0,1]),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}init(){super.init(),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}getParentCanvas(){return this.drawer.getParentCanvas()}getWebglContextProvider(){return this.drawer.getWebglContextProvider()}setDebugMode(t){this.drawer.setDebugMode(),super.setDebugMode(t)}async createBorders(){this.settings.isDebugMode&&this.drawer.updateVertexBuffers(),await super.createBorders()}draw(){this.drawer.draw();for(let t=0;t<this.rows.length;t++){const e=this.rows[t];for(let i=0;i<e.columns.length;i++){const e=this.getPanel(t,i);void 0!==e&&e.recursiveExecute("draw")}}}}class le extends It{constructor(t){super(void 0===t?{}:{id:t.id,idGenerator:t.idGenerator,name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData,rowsSpace:t.rowsSpace,columnsSpace:t.columnsSpace,rows:t.rows,columns:t.columns,mergedCells:t.mergedCells}),this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider}}class de extends bt{get[lt](){return!0}get[Wt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new Zt({boxFillColor:[0,.8,0,1],boxStrokeColor:[0,.2,0,1]}):(this.settings.debug.boxFillColor=[0,.8,0,1],this.settings.debug.boxStrokeColor=[0,.2,0,1]),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}init(){super.init(),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}getParentCanvas(){return this.drawer.getParentCanvas()}getWebglContextProvider(){return this.drawer.getWebglContextProvider()}setDebugMode(t){this.drawer.setDebugMode(),super.setDebugMode(t)}async createBorders(){this.settings.isDebugMode&&this.drawer.updateVertexBuffers(),await super.createBorders()}draw(){this.drawer.draw();for(let t=0;t<this.rows.length;t++){const e=this.rows[t].columns;for(let t=0;t<e.length;t++)e[t].panel.recursiveExecute("draw")}}}class ce extends Ct{constructor(t){super(void 0===t?{}:{id:t.id,idGenerator:t.idGenerator,name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData,rowsSpace:t.rowsSpace,rows:t.rows}),this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider}}class he extends xt{get[lt](){return!0}get[Wt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new Zt({boxFillColor:[0,.8,0,1],boxStrokeColor:[0,.2,0,1]}):(this.settings.debug.boxFillColor=[0,.8,0,1],this.settings.debug.boxStrokeColor=[0,.2,0,1]),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}init(){super.init(),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}getParentCanvas(){return this.drawer.getParentCanvas()}getWebglContextProvider(){return this.drawer.getWebglContextProvider()}setDebugMode(t){this.drawer.setDebugMode(),super.setDebugMode(t)}async createBorders(){this.settings.isDebugMode&&this.drawer.updateVertexBuffers(),await super.createBorders()}draw(){this.drawer.draw();for(let t=0;t<this.columns.length;t++){const e=this.columns[t].rows;for(let t=0;t<e.length;t++)e[t].panel.recursiveExecute("draw")}}}class ue extends yt{constructor(t){super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData,columnsSpace:t.columnsSpace,columns:t.columns}),this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider}}class ge extends wt{constructor(t){super(void 0===t?{}:{id:t.id,idGenerator:t.idGenerator,name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData}),this.canvas=null==t?void 0:t.canvas,this.contextProvider=null==t?void 0:t.contextProvider}}class fe extends mt{get[lt](){return!0}get[Wt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,void 0===this.settings.debug?this.settings.debug=new Zt({boxFillColor:[0,.5,1,1],boxStrokeColor:[1,0,.5,1]}):(this.settings.debug.boxFillColor=[0,.5,1,1],this.settings.debug.boxStrokeColor=[1,0,.5,1]),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}init(){super.init(),this.uniforms=new Kt({color:[0,0,0,0],windowSize:[0,0]}),this.drawer=new Jt(this.uniforms,this.typedSettings,this.typedSettings)}getParentCanvas(){return this.drawer.getParentCanvas()}getWebglContextProvider(){return this.drawer.getWebglContextProvider()}setDebugMode(t){this.drawer.setDebugMode(),super.setDebugMode(t)}async createBorders(){this.settings.isDebugMode&&this.drawer.updateVertexBuffers(),await super.createBorders()}draw(){this.drawer.draw(),this.items.forEach((t=>{dt(t)&&t.draw()}))}}class pe extends rt{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g,f,p,v,y;super(void 0===t?{type:"dock-box"}:{id:t.id,idGenerator:t.idGenerator,type:null!==(e=t.type)&&void 0!==e?e:"dock-box",name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,commonData:t.commonData});const m=null!==(n=null===(i=null==t?void 0:t.sectorBorders)||void 0===i?void 0:i.topCentralHeight)&&void 0!==n?n:new N(0),S=null!==(a=null===(s=null==t?void 0:t.sectorBorders)||void 0===s?void 0:s.bottomCentralHeight)&&void 0!==a?a:new N(0),w=null!==(r=null===(o=null==t?void 0:t.sectorBorders)||void 0===o?void 0:o.leftCentralWidth)&&void 0!==r?r:new N(0),x=null!==(d=null===(l=null==t?void 0:t.sectorBorders)||void 0===l?void 0:l.rightCentralWidth)&&void 0!==d?d:new N(0);this.sectorBorders={topCentralHeight:m,topHeight:null!==(h=null===(c=null==t?void 0:t.sectorBorders)||void 0===c?void 0:c.topHeight)&&void 0!==h?h:m,bottomCentralHeight:S,bottomHeight:null!==(g=null===(u=null==t?void 0:t.sectorBorders)||void 0===u?void 0:u.bottomHeight)&&void 0!==g?g:S,leftCentralWidth:w,leftWidth:null!==(p=null===(f=null==t?void 0:t.sectorBorders)||void 0===f?void 0:f.leftWidth)&&void 0!==p?p:w,rightCentralWidth:x,rightWidth:null!==(y=null===(v=null==t?void 0:t.sectorBorders)||void 0===v?void 0:v.rightWidth)&&void 0!==y?y:x},this.sectorBordersInPx=pe.calculateSectorBordersInPixels(this.clientSize,this.sectorBorders)}updateSectorBorders(){this.sectorBordersInPx=pe.calculateSectorBordersInPixels(this.clientSize,this.sectorBorders)}static calculateSectorBordersInPixels(t,e){return{topHeight:e.topHeight.calcValue(t.height),bottomHeight:e.bottomHeight.calcValue(t.height),leftWidth:e.leftWidth.calcValue(t.width),rightWidth:e.rightWidth.calcValue(t.width),topCentralHeight:e.topCentralHeight.calcValue(t.height),bottomCentralHeight:e.bottomCentralHeight.calcValue(t.height),leftCentralWidth:e.leftCentralWidth.calcValue(t.width),rightCentralWidth:e.rightCentralWidth.calcValue(t.width)}}}function ve(t,e,i){const n=Object.values(t);return s=e,n.includes(s)?e:i;var s}class ye extends ot{get[lt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,void 0===this.typedSettings.debug?this.typedSettings.debug=new At({boxFillColor:[1,.5,1,1],boxStrokeColor:[1,0,.5,1]}):(this.typedSettings.debug.boxFillColor=[1,.5,1,1],this.typedSettings.debug.boxStrokeColor=[1,0,.5,1]),this.sectorMap=new Map,this.orderDrawList=[],this.sectors={central:new mt(new wt)}}init(){super.init();const t=new mt(this.createPanelSettings("centralPanel",this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.sectorBordersInPx.bottomHeight,this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight-this.typedSettings.sectorBordersInPx.bottomHeight));t.init();const e=0==this.typedSettings.sectorBordersInPx.bottomHeight?void 0:new mt(this.createPanelSettings("bottomPanel",0,0,this.typedSettings.clientSize.width,this.typedSettings.sectorBordersInPx.bottomHeight));void 0!==e&&e.init();const i=0==this.typedSettings.sectorBordersInPx.topHeight?void 0:new mt(this.createPanelSettings("topPanel",0,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight,this.typedSettings.clientSize.width,this.typedSettings.sectorBordersInPx.topHeight));void 0!==i&&i.init();const n=0==this.typedSettings.sectorBordersInPx.leftWidth?void 0:new mt(this.createPanelSettings("leftPanel",0,0,this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.clientSize.height));void 0!==n&&n.init();const s=0==this.typedSettings.sectorBordersInPx.rightWidth?void 0:new mt(this.createPanelSettings("rightPanel",this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.rightWidth,0,this.typedSettings.sectorBordersInPx.rightWidth,this.typedSettings.clientSize.height));let a,o,r,l;if(void 0!==s&&s.init(),this.typedSettings.sectorBordersInPx.bottomHeight>0){let t=this.typedSettings.sectorBordersInPx.bottomHeight;this.typedSettings.sectorBordersInPx.bottomCentralHeight>0&&(t=this.typedSettings.sectorBordersInPx.bottomCentralHeight),a=new mt(this.createPanelSettings("bottomCentralPanel",this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.sectorBordersInPx.bottomHeight-t,this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,t)),a.init()}if(this.typedSettings.sectorBordersInPx.topHeight>0){let t=this.typedSettings.sectorBordersInPx.topHeight;this.typedSettings.sectorBordersInPx.topCentralHeight>0&&(t=this.typedSettings.sectorBordersInPx.topCentralHeight),o=new mt(this.createPanelSettings("topCentralPanel",this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight,this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,t)),o.init()}if(this.typedSettings.sectorBordersInPx.leftWidth>0){let t=this.typedSettings.sectorBordersInPx.leftWidth;this.typedSettings.sectorBordersInPx.leftCentralWidth>0&&(t=this.typedSettings.sectorBordersInPx.leftCentralWidth),r=new mt(this.createPanelSettings("leftCentralPanel",this.typedSettings.sectorBordersInPx.leftWidth-t,this.typedSettings.sectorBordersInPx.bottomHeight,t,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.bottomHeight-this.typedSettings.sectorBordersInPx.topHeight)),r.init()}if(this.typedSettings.sectorBordersInPx.rightWidth>0){let t=this.typedSettings.sectorBordersInPx.rightWidth;this.typedSettings.sectorBordersInPx.rightCentralWidth>0&&(t=this.typedSettings.sectorBordersInPx.rightCentralWidth),l=new mt(this.createPanelSettings("rightCentralPanel",this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.rightWidth,this.typedSettings.sectorBordersInPx.bottomHeight,t,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.bottomHeight-this.typedSettings.sectorBordersInPx.topHeight)),l.init()}this.sectors={central:t,bottom:e,bottomCentral:a,top:i,topCentral:o,left:n,leftCentral:r,right:s,rightCentral:l},this.sectorMap=new Map([[g.Central,t],[g.Bottom,e],[g.BottomCentral,null!=a?a:void 0],[g.Top,i],[g.TopCentral,null!=o?o:void 0],[g.Left,n],[g.LeftCentral,null!=r?r:void 0],[g.Right,s],[g.RightCentral,null!=l?l:void 0]])}addItem(t,e,i){void 0===i&&(i=0);const n=this.getSectorPanel(e);void 0!==n&&n.addItem(t);let s=this.findInserIndexForDraw(i);t instanceof ot?dt(t)&&this.orderDrawList.splice(s,0,{layerZ:i,obj:t}):t instanceof ht&&t.forEach((t=>{dt(t)&&(this.orderDrawList.splice(s,0,{layerZ:i,obj:t}),++s)}))}getSectorPanel(t){const e=function(t,e){const i=Object.values(t);return n=e,i.includes(n)?e:void 0;var n}(g,t);if(void 0!==e)return this.sectorMap.get(e)}calculateCentralPanelBorders(){return{x:this.typedSettings.sectorBordersInPx.leftWidth,y:this.typedSettings.sectorBordersInPx.bottomHeight,width:this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,height:this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight-this.typedSettings.sectorBordersInPx.bottomHeight}}async updateItemBorders(t,e,i,n,s){const a=this.getSectorPanel(t);void 0!==a&&(a.setParentSizeSettings(this.typedSettings.sizeInPixels.width,this.typedSettings.sizeInPixels.height),a.setBorders(new G({x:new N(e),y:new N(i)}),new J({width:new N(n),height:new N(s)})),await a.createBorders())}async updateItemsBorders(){const t=this.calculateCentralPanelBorders();if(await this.updateItemBorders("central",t.x,t.y,t.width,t.height),this.typedSettings.sectorBordersInPx.bottomHeight>0&&await this.updateItemBorders("bottom",0,0,this.typedSettings.clientSize.width,this.typedSettings.sectorBordersInPx.bottomHeight),this.typedSettings.sectorBordersInPx.topHeight>0&&await this.updateItemBorders("top",0,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight,this.typedSettings.clientSize.width,this.typedSettings.sectorBordersInPx.topHeight),this.typedSettings.sectorBordersInPx.leftWidth>0&&await this.updateItemBorders("left",0,0,this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.clientSize.height),this.typedSettings.sectorBordersInPx.rightWidth>0&&await this.updateItemBorders("right",this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.rightWidth,0,this.typedSettings.sectorBordersInPx.rightWidth,this.typedSettings.clientSize.height),this.typedSettings.sectorBordersInPx.bottomHeight>0){let t=this.typedSettings.sectorBordersInPx.bottomHeight;this.typedSettings.sectorBordersInPx.bottomCentralHeight>0&&(t=this.typedSettings.sectorBordersInPx.bottomCentralHeight),await this.updateItemBorders("bottomCentral",this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.sectorBordersInPx.bottomHeight-t,this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,t)}if(this.typedSettings.sectorBordersInPx.topHeight>0){let t=this.typedSettings.sectorBordersInPx.topHeight;this.typedSettings.sectorBordersInPx.topCentralHeight>0&&(t=this.typedSettings.sectorBordersInPx.topCentralHeight),await this.updateItemBorders("topCentral",this.typedSettings.sectorBordersInPx.leftWidth,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.topHeight,this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.leftWidth-this.typedSettings.sectorBordersInPx.rightWidth,t)}if(this.typedSettings.sectorBordersInPx.leftWidth>0){let t=this.typedSettings.sectorBordersInPx.leftWidth;this.typedSettings.sectorBordersInPx.leftCentralWidth>0&&(t=this.typedSettings.sectorBordersInPx.leftCentralWidth),await this.updateItemBorders("leftCentral",this.typedSettings.sectorBordersInPx.leftWidth-t,this.typedSettings.sectorBordersInPx.bottomHeight,t,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.bottomHeight-this.typedSettings.sectorBordersInPx.topHeight)}if(this.typedSettings.sectorBordersInPx.rightWidth>0){let t=this.typedSettings.sectorBordersInPx.rightWidth;this.typedSettings.sectorBordersInPx.rightCentralWidth>0&&(t=this.typedSettings.sectorBordersInPx.rightCentralWidth),await this.updateItemBorders("rightCentral",this.typedSettings.clientSize.width-this.typedSettings.sectorBordersInPx.rightWidth,this.typedSettings.sectorBordersInPx.bottomHeight,t,this.typedSettings.clientSize.height-this.typedSettings.sectorBordersInPx.bottomHeight-this.typedSettings.sectorBordersInPx.topHeight)}}async createBorders(){await super.createBorders(),this.typedSettings.updateSectorBorders(),await this.updateItemsBorders()}setDebugMode(t){super.setDebugMode(t);Object.values(g).forEach((e=>{const i=this.sectorMap.get(e);void 0!==i&&i.setDebugMode(t)}))}forEach(t){super.forEach(t);const e=Object.values(g);for(let i=0;i<e.length;++i){const n=this.sectorMap.get(e[i]);void 0!==n&&n.forEach(t)}}async forEachAsync(t){await super.forEachAsync(t);const e=Object.values(g);for(let i=0;i<e.length;++i){const n=this.sectorMap.get(e[i]);void 0!==n&&await n.forEachAsync(t)}}recursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super.recursiveExecute(t,...i);const s=Object.values(g);for(let a=0;a<s.length;++a){const e=this.sectorMap.get(s[a]);void 0!==e&&e.recursiveExecute(t,...i)}}async asyncRecursiveExecute(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];await super.asyncRecursiveExecute(t,...i);const s=Object.values(g);for(let a=0;a<s.length;++a){const e=this.sectorMap.get(s[a]);void 0!==e&&await e.asyncRecursiveExecute(t,...i)}}draw(){for(let t=0;t<this.orderDrawList.length;++t)this.orderDrawList[t].obj.draw()}createPanelSettings(t,e,i,n,s){return new wt({id:this.typedSettings.id,idGenerator:this.typedSettings.idGenerator,name:t,location:new G({x:new N(e),y:new N(i)}),size:new J({width:new N(n),height:new N(s)}),parent:new it({ref:this})})}findInserIndexForDraw(t){for(let e=0;e<this.orderDrawList.length;++e){if(this.orderDrawList[e].layerZ>t)return e}return this.orderDrawList.length}}class me extends Lt{constructor(t){super(t),this.typedSettings=this.settings}init(){super.init();const t=x.convertWebglRgbaToHex(this.typedSettings.color),e=y(t)?t.data:"#000000";Lt.setHtmlObject(this.typedSettings,Bt("text",["x",`${this.typedSettings.html.locationInPixels.x}px`],["y",`${this.typedSettings.html.locationInPixels.y}px`],["text-anchor","start"],["fill",e],["font-size",this.typedSettings.fontSize],["font-family",this.typedSettings.fontFamily])),void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.innerHTML=this.typedSettings.title),me.updateLabelLocation(this.typedSettings)}static updateLabelLocation(t){const e=t.html.ref;if(void 0===e)return;const i=e.getBoundingClientRect();let n=t.html.locationInPixels.y,s=t.html.locationInPixels.x;t.isCentered&&(s+=t.sizeInPixels.width/2-i.width/2),n+=t.sizeInPixels.height/2+i.height/4,e.setAttribute("x",`${s}px`),e.setAttribute("y",`${n}px`)}getXFromReal(t,e){let i=t;return this.typedSettings.isCentered&&(i-=this.typedSettings.sizeInPixels.width/2-e/2),i}getYFromReal(t,e){return t-this.typedSettings.sizeInPixels.height/2-e/4}setIsBold(t){void 0!==this.typedSettings.html.ref&&(this.typedSettings.isBold=t,this.typedSettings.html.ref.setAttribute("font-weight",this.typedSettings.isBold?"bold":"normal"))}addOnClickedFunction(t){this.addHtmlEventListener("click",t)}setText(t){void 0!==this.typedSettings.html.ref&&(this.typedSettings.title=t,this.typedSettings.html.ref.innerHTML=this.typedSettings.title,me.updateLabelLocation(this.typedSettings))}async createHtmlBorders(){await super.createHtmlBorders(),me.updateLabelLocation(this.typedSettings)}}class Se extends qt{constructor(t){var e,i,n,s,a,o;super(void 0===t?{}:{name:t.name,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.isCentered=null===(e=null==t?void 0:t.isCentered)||void 0===e||e,this.isBold=null!==(i=null==t?void 0:t.isBold)&&void 0!==i&&i,this.color=null!==(n=null==t?void 0:t.color)&&void 0!==n?n:[0,0,0,1],this.fontSize=null!==(s=null==t?void 0:t.fontSize)&&void 0!==s?s:"10",this.fontFamily=null!==(a=null==t?void 0:t.fontFamily)&&void 0!==a?a:"Arial, sans-serif",this.title=null!==(o=null==t?void 0:t.title)&&void 0!==o?o:""}}class we extends Nt{constructor(t){super(t),this.fpsMeterAreaRoot=new ie(new ne),this.fpsMeterArea=new ee(new qt({})),this.fpsMeterLabel=new me(new Se),this.lastFrameTime=0,this.frameCount=0,this.timeSum=0}init(){super.init();const t=this.settings.sizeInPixels.width-100;this.fpsMeterAreaRoot=new ie(new ne({id:"FpsMeterArea_svgRoot",location:new G({x:new N(t),y:new N(this.typedSettings.sizeInPixels.height-2-30)}),size:new J({width:new N(80),height:new N(30)}),parent:{ref:this,jagmHtml:this},html:{parent:{ref:this.typedSettings.html.ref}}})),this.fpsMeterArea=new ee(new qt({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),parent:{ref:this.fpsMeterAreaRoot,jagmHtml:this.fpsMeterAreaRoot},html:{parent:{ref:this.fpsMeterAreaRoot.typedSettings.html.ref}}})),this.fpsMeterArea.setBackgroundFillColor([1,1,0,1]),this.fpsMeterArea.setBackgroundStrokeColor([0,0,0,1]),this.fpsMeterArea.settings.name="Background",this.fpsMeterAreaRoot.addItem(this.fpsMeterArea),this.fpsMeterLabel=new me(new Se({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new N(this.fpsMeterArea.settings.sizeInPixels.width),height:new N(this.fpsMeterArea.settings.sizeInPixels.height)}),parent:{ref:this.fpsMeterArea,jagmHtml:this.fpsMeterArea},html:{parent:{ref:this.fpsMeterArea.typedSettings.html.ref}},title:"Fps: 0",fontSize:"16",fontFamily:"Roboto",color:[0,0,0,1],isCentered:!0})),this.fpsMeterLabel.settings.name="FpsMeterLabel",this.fpsMeterArea.addItem(this.fpsMeterLabel),this.lastFrameTime=0,this.frameCount=0,this.timeSum=0}async createBorders(){await super.createBorders();const t=this.settings.sizeInPixels.width-100;this.fpsMeterAreaRoot.settings.location.x=new N(t),this.fpsMeterAreaRoot.settings.location.y=new N(this.typedSettings.sizeInPixels.height-2-this.fpsMeterAreaRoot.settings.sizeInPixels.height),this.fpsMeterAreaRoot.setParentSizeSettings(this.settings.sizeInPixels.width,this.settings.sizeInPixels.height),await this.fpsMeterAreaRoot.createBorders()}draw(){if(!this.typedSettings.drawEnabled)return;let t=!1;if(0===this.lastFrameTime)this.lastFrameTime=performance.now();else{const e=performance.now()-this.lastFrameTime;this.timeSum+=e,this.frameCount++,t=this.timeSum>1e3,t&&(this.fpsMeterLabel.setText(`Fps: ${this.frameCount}`),this.frameCount=0,this.timeSum-=1e3),this.lastFrameTime=performance.now()}const e=this.getWebglContextProvider();if(void 0===e)return;const i=e.context;i.viewport(0,0,this.settings.sizeInPixels.width,this.settings.sizeInPixels.height),void 0!==this.typedSettings.backgroundColor&&i.clearColor(this.typedSettings.backgroundColor[0],this.typedSettings.backgroundColor[1],this.typedSettings.backgroundColor[2],this.typedSettings.backgroundColor[3]),i.clear(i.COLOR_BUFFER_BIT),this.items.forEach((t=>{dt(t)&&t.draw()}))}}class xe extends Se{constructor(t){var e,i;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}},isCentered:t.isCentered,isBold:t.isBold,color:t.color,fontSize:t.fontSize,fontFamily:t.fontFamily,title:t.title}),this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:0,this.pointIndex=null!==(i=null==t?void 0:t.pointIndex)&&void 0!==i?i:0}}class Ce{constructor(t){this.settings=t,this.lastPosX=void 0}create(t,e){return new m("not implemented")}tryRemoveMarks(t,e){let i=!0;const n=this.settings.panel,s=n.items.items;for(;s.length>0&&i;){const a=s[0];if(!(a instanceof me&&a.settings instanceof xe))return;const o=a.settings.pointIndex;i=o>=e||t>o,i&&(a.removeObjectFromDom(),n.items.remove(0))}}correctLabelPosition(t,e,i){if(void 0===this.settings.marks)return!1;const n=t.getHtmlObjectRealBorders();if(void 0===n)return!1;let s=!1,a=e;const o=i,r=Math.max(t.settings.sizeInPixels.width,n.width);if(n.x<0?(a=r/2,s=!0):n.x+n.width>this.settings.panel.settings.sizeInPixels.width&&(a=this.settings.panel.settings.sizeInPixels.width-r,s=!0),void 0!==this.settings.marks.item.minXSpace)if(void 0===this.lastPosX)this.lastPosX=a;else{if(Math.abs(this.lastPosX-a)<this.settings.marks.item.minXSpace)return!1;this.lastPosX=a}return s&&(t.setLocationSettings(new N(a),new N(o)),t.createBorders()),!0}}class be extends qt{constructor(t){super({location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.markCreator=t.markCreator}}class Ie extends be{constructor(t){super({location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}},markCreator:t.markCreator}),this.marks=t.marks}}class Pe{constructor(t){this.panel=t.panel,this.marks=t.marks}}class Be{constructor(t){this.settings=t,this.idGenerator=new b,this.storedMarks=new ht("StoredMarks")}addMark(t){if(void 0===this.settings.markCreator)return;const e=this.settings.markCreator.create("",t);if(y(e)){const t=e.data;void 0!==t&&this.addMarkToContainer(t)}}clear(){this.settings.itemsContainer.clear()}storeMarks(){this.settings.itemsContainer.forEachChild((t=>{this.storedMarks.add(t)}))}restoreMarks(){this.storedMarks.forEachChild((t=>{this.settings.itemsContainer.add(t)})),this.storedMarks.clear()}tryRemoveMarks(t,e,i){if(void 0===this.settings.markCreator)return;const n=t+e,s=n-i;this.settings.markCreator.tryRemoveMarks(s,n)}addMarkToContainer(t){const e=this.idGenerator.generateNextId();t.settings.id=e,t.settings.name=e.toString(),this.settings.itemsContainer.add(t)}}class De extends Be{constructor(t){super(t)}addMark(t){if(void 0===this.settings.markCreator)return;const e=this.settings.markCreator.create("",t);if(y(e)){const t=e.data;void 0!==t&&this.addMarkToContainer(t)}}clear(){this.settings.itemsContainer.forEachChild((t=>{const e=t.getName();void 0!==e&&t instanceof Lt&&this.storedMarks.findIndex(e)<0&&t.removeObjectFromDom()})),this.settings.itemsContainer.clear()}}class Me{constructor(t){var e;this.itemsContainer=null!==(e=t.itemsContainer)&&void 0!==e?e:new ht("Marks"),this.markCreator=t.markCreator}}class ze extends ee{constructor(t){super(t),this.typedSettings=this.settings,this.marksContainer=new De(new Me({}))}init(){this.marksContainer=new De({markCreator:this.typedSettings.markCreator,itemsContainer:this.items}),super.init()}addMark(t){this.marksContainer.addMark(t)}clear(){this.marksContainer.clear()}storeMarks(){this.marksContainer.storeMarks()}restoreMarks(){this.marksContainer.restoreMarks()}tryRemoveMarks(t,e,i){this.marksContainer.tryRemoveMarks(t,e,i)}}class ke extends ze{constructor(t){super(t),this.typedSettings=this.settings}init(){this.marksContainer.settings.markCreator=new Ce(new Pe({panel:this,marks:this.typedSettings.marks})),super.init()}}class Ae extends qt{constructor(t){var e,i,n,s,a,o,r;super(void 0===t?{}:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.style={color:null!==(i=null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.color)&&void 0!==i?i:[0,0,0,1],lineWidth:null!==(s=null===(n=null==t?void 0:t.style)||void 0===n?void 0:n.lineWidth)&&void 0!==s?s:1},this.widthTop=null!==(a=null==t?void 0:t.widthTop)&&void 0!==a?a:0,this.title=null!==(o=null==t?void 0:t.title)&&void 0!==o?o:"",this.windowName=null!==(r=null==t?void 0:t.windowName)&&void 0!==r?r:""}}class Fe extends Lt{constructor(t){super(t),this.typedSettings=this.settings}init(){var t;super.init(),Lt.setHtmlObject(this.typedSettings,Bt("g",["class",`meander-${this.typedSettings.windowName}`]));const e=x.convertWebglRgbaToHex(this.typedSettings.style.color),i=y(e)?e.data:"#000000";this.polylineMeander=Bt("polyline",["points",this.createPoints()],["stroke",i],["stroke-linecap","round"],["stroke-linejoin","round"],["fill","none"],["stroke-width",`${this.typedSettings.style.lineWidth}px`]),null===(t=this.typedSettings.html.ref)||void 0===t||t.append(this.polylineMeander)}async setHeight(t){await this.setSize(this.settings.size.width,t)}updateMeanderPoints(){var t;null===(t=this.polylineMeander)||void 0===t||t.setAttribute("points",this.createPoints())}async createHtmlBorders(){await super.createHtmlBorders(),this.updateMeanderPoints()}createPoints(){return function(t,e,i,n,s){const a=t+(i-n)/2,o=a+n,r=e-s;return`\n    ${t},${e}\n    ${a},${e}\n    ${a},${r}\n    ${o},${r}\n    ${o},${e}\n    ${t+i},${e}`.trim()}(this.typedSettings.html.locationInPixels.x,this.typedSettings.html.locationInPixels.y,this.typedSettings.sizeInPixels.width,this.typedSettings.widthTop,this.typedSettings.sizeInPixels.height)}}class Ve extends vt{constructor(t){var e,i,n;super(),this.units=null!==(e=null==t?void 0:t.units)&&void 0!==e?e:[],this.sources=null!==(i=null==t?void 0:t.sources)&&void 0!==i?i:[],this.variantGroups=null!==(n=null==t?void 0:t.variantGroups)&&void 0!==n?n:[]}}class _e extends ne{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}},id:t.id}),this.content=null!==(e=null==t?void 0:t.content)&&void 0!==e?e:[],this.sectorBorders=void 0===(null==t?void 0:t.sectorBorders)?void 0:{topCentralHeight:null===(i=null==t?void 0:t.sectorBorders)||void 0===i?void 0:i.topCentralHeight,topHeight:null===(n=null==t?void 0:t.sectorBorders)||void 0===n?void 0:n.topHeight,bottomCentralHeight:null===(s=null==t?void 0:t.sectorBorders)||void 0===s?void 0:s.bottomCentralHeight,bottomHeight:null===(a=null==t?void 0:t.sectorBorders)||void 0===a?void 0:a.bottomHeight,leftCentralWidth:null===(o=null==t?void 0:t.sectorBorders)||void 0===o?void 0:o.leftCentralWidth,leftWidth:null===(r=null==t?void 0:t.sectorBorders)||void 0===r?void 0:r.leftWidth,rightCentralWidth:null===(l=null==t?void 0:t.sectorBorders)||void 0===l?void 0:l.rightCentralWidth,rightWidth:null===(d=null==t?void 0:t.sectorBorders)||void 0===d?void 0:d.rightWidth},this.isAutoMarkRestore=null!==(c=null==t?void 0:t.isAutoMarkRestore)&&void 0!==c&&c,this.filterProviderCreator=null==t?void 0:t.filterProviderCreator,this.title=null!==(h=null==t?void 0:t.title)&&void 0!==h?h:"",this.dataSources=null!==(u=null==t?void 0:t.dataSources)&&void 0!==u?u:[],this.contentCreatorsMap=null==t?void 0:t.contentCreatorsMap,this.dataSectionSettings=null!==(g=null==t?void 0:t.dataSectionSettings)&&void 0!==g?g:new Ve}findContent(t){const e=C("name",t,this.content);if(void 0!==e)return{obj:e.settings,sector:e.sector}}findPlacedContent(t,e){const i=C("name",t,this.content);if(void 0!==i&&e.includes(i.sector))return{obj:i.settings,sector:i.sector}}}class Re extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.buffer=new Float32Array}init(){super.init();const t=this.getWebglContextProvider();if(void 0===t)return;const e=t.context;this.buffer=Re.createDataBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels);const i=this.getParentCanvas();if(void 0===i)return;const n=i.settings.sizeInPixels;this.uniforms=new Kt({color:this.typedSettings.color,windowSize:[n.width,n.height]});const s=e.createBuffer();null!=s&&(this.glBuffer=s,e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,this.buffer,e.STATIC_DRAW))}async createBorders(){await super.createBorders(),this.updateDataBuffer()}updateDataBuffer(){const t=this.getWebglContextProvider();if(void 0===t)return;const e=t.context,i=this.getParentCanvas();if(void 0===i||void 0===this.glBuffer)return;const n=i.settings.sizeInPixels;this.uniforms.setValues({windowSize:[n.width,n.height]}),this.buffer=Re.createDataBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,this.buffer,e.STATIC_DRAW)}draw(){const t=this.getWebglContextProvider();if(void 0===t||void 0===this.glBuffer)return;const e=t.context;e.viewport(0,0,this.uniforms.windowSize[0],this.uniforms.windowSize[1]),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer);const i=t.getPositionAttribLocation();void 0!==i&&(e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,this.buffer.length/2))}static createDataBuffer(t,e){return new Float32Array([t.x,t.y,t.x+e.width,t.y])}}class Le{constructor(t){this.panel=t.panel,this.marks=t.marks,this.dataConvertors=new Map}}class Ee extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.buffer=new Float32Array}init(){super.init();const t=this.getWebglContextProvider();if(void 0===t)return;const e=t.context;this.buffer=Ee.createDataBuffer(this.typedSettings.absoluteLocation,this.typedSettings.sizeInPixels);let i=new K;void 0!==this.typedSettings.canvas&&this.typedSettings.canvas instanceof ot&&(i=this.typedSettings.canvas.settings.sizeInPixels),this.uniforms=new Kt({color:this.typedSettings.color,windowSize:[i.width,i.height]});const n=e.createBuffer();null!=n&&(this.glBuffer=n,e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,this.buffer,e.STATIC_DRAW))}async createBorders(){await super.createBorders(),this.updateDataBuffer()}updateDataBuffer(){const t=this.getWebglContextProvider();if(void 0===t||void 0===this.glBuffer)return;const e=t.context;let i=new K;void 0!==this.typedSettings.canvas&&this.typedSettings.canvas instanceof ot&&(i=this.typedSettings.canvas.settings.sizeInPixels),this.uniforms.setValues({windowSize:[i.width,i.height]}),this.buffer=Ee.createDataBuffer(this.settings.absoluteLocation,this.settings.sizeInPixels),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,this.buffer,e.STATIC_DRAW)}draw(){if(!this.settings.isVisible||void 0===this.glBuffer)return;const t=this.getWebglContextProvider();if(void 0===t||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context,i=this.settings.parent.ref.settings;e.viewport(0,0,this.uniforms.windowSize[0],this.uniforms.windowSize[1]),e.enable(e.SCISSOR_TEST),e.scissor(i.absoluteLocation.x,i.absoluteLocation.y,i.clientSize.width,i.clientSize.height),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer);const n=t.getPositionAttribLocation();void 0!==n&&(e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,this.buffer.length/2))}static createDataBuffer(t,e){return new Float32Array([t.x,t.y,t.x,t.y+e.height])}}class je extends Ee{constructor(t){super(t)}setPosX(t){if(void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=this.settings.parent.ref.settings.sizeInPixels.width;this.uniforms.setValues({shift:[t%e,0]})}}class Ye extends se{constructor(t){var e,i;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1],this.pointIndex=null!==(i=null==t?void 0:t.pointIndex)&&void 0!==i?i:0}}var Oe,Ue,Te,We,Xe,He,Ne,Ge,qe;!function(t){t[t.FromLeftToRight=0]="FromLeftToRight",t[t.FromRightToLeft=1]="FromRightToLeft"}(Oe||(Oe={})),function(t){t[t.FromBottomToTop=0]="FromBottomToTop",t[t.FromTopToBottom=1]="FromTopToBottom"}(Ue||(Ue={})),function(t){t[t.None=0]="None",t[t.SignalPoint=1]="SignalPoint"}(Te||(Te={})),function(t){t[t.None=0]="None",t[t.SignalPoint=1]="SignalPoint",t[t.Isoline=2]="Isoline"}(We||(We={}));class $e{constructor(t){var e,i,n,s,a,o,r,l,d,c,h;this.axisX=null!==(e=null==t?void 0:t.axisX)&&void 0!==e?e:Oe.FromLeftToRight,this.axisY=null!==(i=null==t?void 0:t.axisY)&&void 0!==i?i:Ue.FromBottomToTop,this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:new N(0),this.y=null!==(s=null==t?void 0:t.y)&&void 0!==s?s:new N(0),this.width=null==t?void 0:t.width,this.height=null==t?void 0:t.height,this.minXSpace=null!==(a=null==t?void 0:t.minXSpace)&&void 0!==a?a:0,this.minYSpace=null!==(o=null==t?void 0:t.minYSpace)&&void 0!==o?o:0,this.signal=null==t?void 0:t.signal,this.signalDependency={x:null!==(l=null===(r=null==t?void 0:t.signalDependency)||void 0===r?void 0:r.x)&&void 0!==l?l:Te.None,y:null!==(c=null===(d=null==t?void 0:t.signalDependency)||void 0===d?void 0:d.y)&&void 0!==c?c:We.None},this.dataHandler=null!==(h=null==t?void 0:t.dataHandler)&&void 0!==h?h:""}copy(){var t,e;return new $e({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y}})}}class Ke extends $e{constructor(t){var e;super(void 0===t?void 0:{axisX:t.axisX,axisY:t.axisY,x:t.x,y:t.y,width:t.width,height:t.height,minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:t.signal,signalDependency:t.signalDependency,dataHandler:t.dataHandler}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1]}copy(){var t,e;return new Ke({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y},color:this.color})}}class Ze{constructor(t){this.settings=t}create(t,e){var i,n,s,a,o,r;const l=this.settings.dataConvertors.get(t);if(void 0===l)return new m("Mark data converter was not found");const d=l.convert(e);if(void 0===d)return new m("Can't convert input data to mark");this.tryRemoveMarks(d.beginVisPointIndex,d.endVisPointIndex);const c=null!==(n=null!==(i=d.height)&&void 0!==i?i:this.settings.marks.item.height)&&void 0!==n?n:new Z(1),h=this.settings.panel,u=c.calcValue(h.settings.sizeInPixels.height),g=void 0===this.settings.marks.item.x?0:this.settings.marks.item.x.calcValue(h.settings.sizeInPixels.width),f=void 0===this.settings.marks.item.y?0:this.settings.marks.item.y.calcValue(h.settings.sizeInPixels.height),p=this.settings.marks.item.axisX,y=this.settings.marks.item.axisY;let S=(null!==(s=d.x)&&void 0!==s?s:0)+g;p==Oe.FromRightToLeft&&(S=(null!==(a=d.x)&&void 0!==a?a:0)-g-1);let w=(null!==(o=d.y)&&void 0!==o?o:0)+f;if(y==Ue.FromTopToBottom&&(w=(null!==(r=d.y)&&void 0!==r?r:0)-f-u),!(this.settings.marks.item instanceof Ke))return new m("Mark has wrong type");const x=new Ee(new Ye({location:new G({x:new N(S),y:new N(w)}),size:new J({width:new N(1),height:c}),parent:new it({ref:h}),color:this.settings.marks.item.color,pointIndex:d.pointIndex}));return new v(x)}tryRemoveMarks(t,e){let i=!0;const n=this.settings.panel,s=n.items.items;for(;s.length>0&&i;){const a=s[0];if(!(a instanceof Ee))return;const o=a.typedSettings.pointIndex;i=o>=e||t>o,i&&n.items.remove(0)}}}class Je extends Ze{constructor(t){super(t)}create(t,e){var i,n;const s=this.settings.dataConvertors.get(t);if(void 0===s)return new m("Mark data converter was not found");const a=s.convert(e);if(void 0===a)return new m("Can't convert input data to mark");this.tryRemoveMarks(a.beginVisPointIndex,a.endVisPointIndex);const o=this.settings.panel,r=void 0===this.settings.marks.item.x?0:this.settings.marks.item.x.calcValue(o.settings.sizeInPixels.width),l=this.settings.marks.item.axisX;let d=(null!==(i=a.x)&&void 0!==i?i:0)+r;if(l==Oe.FromRightToLeft&&(d=(null!==(n=a.x)&&void 0!==n?n:0)-r-1),!(this.settings.marks.item instanceof Ke))return new m("Mark has wrong type");const c=new je(new Ye({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new N(1),height:new Z(1)}),parent:new it({ref:o}),color:this.settings.marks.item.color,pointIndex:a.pointIndex}));return c.setPosX(d),new v(c)}}class Qe extends fe{constructor(t){super(t),this.typedSettings=this.settings,this.marksContainer=new Be(new Me({}))}init(){this.marksContainer=new Be(new Me({markCreator:this.typedSettings.markCreator,itemsContainer:this.items})),super.init()}addMark(t){this.marksContainer.addMark(t)}clear(){this.marksContainer.clear()}storeMarks(){this.marksContainer.storeMarks()}restoreMarks(){this.marksContainer.restoreMarks()}tryRemoveMarks(t,e,i){this.marksContainer.tryRemoveMarks(t,e,i)}}class ti extends Qe{constructor(t){super(t),this.typedSettings=this.settings}init(){this.marksContainer.settings.markCreator=new Je(new Le({panel:this,marks:this.typedSettings.marks})),super.init()}}class ei extends Qe{constructor(t){super(t),this.typedSettings=this.settings}init(){this.marksContainer.settings.markCreator=new Ze(new Le({panel:this,marks:this.typedSettings.marks})),super.init()}}class ii extends nt{constructor(t){var e,i;super(void 0===t?{}:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode}),this.dataSourcesContainer=null!==(e=null==t?void 0:t.dataSourcesContainer)&&void 0!==e?e:new ht("dataSources"),this.dataSourcesSettings=null!==(i=null==t?void 0:t.dataSourcesSettings)&&void 0!==i?i:[]}}class ni{constructor(t){this.name=t}}class si extends ni{constructor(t){var e;super(t.name),this.isolines=t.isolines,this.signals=t.signals,this.content=null!==(e=t.content)&&void 0!==e?e:[]}copy(){return new si({name:this.name,isolines:this.isolines.map((t=>t.copy())),signals:this.signals.map((t=>t.copy()))})}findContent(t){const e=C("name",t,this.content);if(void 0!==e)return{obj:e.settings,sector:e.sector}}findPlacedContent(t,e){const i=C("name",t,this.content);if(void 0!==i&&e.includes(i.sector))return{obj:i.settings,sector:i.sector}}}class ai extends ht{constructor(t){super(t),this.variant=""}}class oi extends Qt{constructor(t){super(t),this.typedSettings=this.settings}async createBorders(){await super.createBorders(),await this.updateSignalsPositions()}async updateSignalsPositions(){await this.typedSettings.dataSourcesContainer.forEachChildAsync((async t=>{const e=t.getName();if(void 0===e||!(t instanceof ht))return;const i=C("id",parseInt(e,10),this.typedSettings.dataSourcesSettings);if(void 0===i)return;const n=t.findItem("channels");void 0!==n&&n instanceof ht&&await n.forEachChildAsync((async t=>{if(!(t instanceof ai))return;const e=C("id",parseInt(t.name,10),i.channels);if(void 0===e)return;const n=e.y.calcValue(this.settings.clientSize.height),s=e.height.calcValue(this.settings.clientSize.height),a=e.getCurrSignalsVariant();if(void 0===a||!(a instanceof si))return;if(e.showIsolines){const e=t.findItem("isolines");void 0!==e&&e instanceof ht&&await e.forEachChildAsync((async t=>{const e=t.getName();if(void 0===e||!(t instanceof Re))return;const i=C("id",parseInt(e,10),a.isolines);if(void 0===i)return;const o=n+i.y.calcValue(s);t.setParentSizeSettings(this.settings.clientSize.width,this.settings.clientSize.height),t.setLocationSettings(new N(0),new N(o)),await t.createBorders()}))}const o=t.findItem("signals");void 0!==o&&o instanceof ht&&await o.forEachChildAsync((async t=>{const e=t.getName();if(void 0===e||!(t instanceof ot))return;const i=C("id",parseInt(e,10),a.signals);if(void 0===i)return;const o=C("id",i.id_isoline,a.isolines);if(void 0===o)return;const r=n+o.y.calcValue(s);t.setParentSizeSettings(this.settings.clientSize.width,this.settings.clientSize.height),t.setLocationSettings(new N(0),new N(r)),await t.createBorders()}))}))}))}draw(){super.draw(),this.typedSettings.dataSourcesContainer.recursiveExecute("draw")}}function ri(t,e,i){var n,s;if(void 0!==(null===(n=t.unit)||void 0===n?void 0:n[i]))return t.unit[i];let a=null===(s=t.unit)||void 0===s?void 0:s.id_unit;if(void 0!==a){const t=C("id",a,e.units);if(void 0===t)return;return t[i]}const o=C("id",t.id_dataSource,e.sources);if(void 0===o)return;const r=C("id",t.id,o.channels);if(void 0===(null==r?void 0:r.unit))return;if(void 0!==r.unit[i])return r.unit[i];a=r.unit.id_unit;const l=C("id",a,e.units);return void 0!==l?l[i]:void 0}function li(t,e){return ri(t,e,"text")}function di(t,e){return ri(t,e,"scale")}class ci{constructor(t){var e,i,n;this.defaultValues=null!==(e=null==t?void 0:t.defaultValues)&&void 0!==e?e:[],this.defaultIndex=null!==(i=null==t?void 0:t.defaultIndex)&&void 0!==i?i:0==this.defaultValues.length?-1:0,this.distanceUnit=null!==(n=null==t?void 0:t.distanceUnit)&&void 0!==n?n:-1,this.hasDynamicDefaultValue=null==t?void 0:t.hasDynamicDefaultValue,this.values=[...this.defaultValues],this.currIndex=this.defaultIndex,this.currValue=this.currIndex<0||this.currIndex>=this.values.length?void 0:this.values[this.currIndex]}setCurrIndex(t){t<0||this.currIndex>=this.values.length?(this.currIndex=-1,this.currValue=void 0):(this.currIndex=t,this.currValue=this.values[this.currIndex])}}class hi extends ci{constructor(t){var e;super({defaultValues:null==t?void 0:t.defaultValues,defaultIndex:null==t?void 0:t.defaultIndex,distanceUnit:null==t?void 0:t.distanceUnit,hasDynamicDefaultValue:null==t?void 0:t.hasDynamicDefaultValue}),this.timeUnit=null!==(e=null==t?void 0:t.timeUnit)&&void 0!==e?e:-1}}class ui extends ci{constructor(t){var e;super({defaultValues:null==t?void 0:t.defaultValues,defaultIndex:null==t?void 0:t.defaultIndex,distanceUnit:null==t?void 0:t.distanceUnit,hasDynamicDefaultValue:null==t?void 0:t.hasDynamicDefaultValue}),this.valueUnit=null!==(e=null==t?void 0:t.valueUnit)&&void 0!==e?e:-1}}class gi{}class fi extends gi{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g,f,p,v;super(),this.unitsXtoMmConvertKoef=null!==(e=null==t?void 0:t.unitsXtoMmConvertKoef)&&void 0!==e?e:10,this.unitsYtoMmConvertKoef=null!==(i=null==t?void 0:t.unitsYtoMmConvertKoef)&&void 0!==i?i:10,this.filters=null!==(n=null==t?void 0:t.filters)&&void 0!==n?n:[],this.defaultFilters=null!==(s=null==t?void 0:t.defaultFilters)&&void 0!==s?s:[],this.scaleX=null!==(a=null==t?void 0:t.scaleX)&&void 0!==a?a:new hi,this.scaleY=null!==(o=null==t?void 0:t.scaleY)&&void 0!==o?o:new ui,this.viewScale={x:null!==(l=null===(r=null==t?void 0:t.viewScale)||void 0===r?void 0:r.x)&&void 0!==l?l:1,y:null!==(c=null===(d=null==t?void 0:t.viewScale)||void 0===d?void 0:d.y)&&void 0!==c?c:1},this.labels={color:null!==(u=null===(h=null==t?void 0:t.labels)||void 0===h?void 0:h.color)&&void 0!==u?u:[0,0,0,1],fontFamily:null!==(f=null===(g=null==t?void 0:t.labels)||void 0===g?void 0:g.fontFamily)&&void 0!==f?f:"",fontSize:null!==(v=null===(p=null==t?void 0:t.labels)||void 0===p?void 0:p.fontSize)&&void 0!==v?v:0},this.defaultValueRange=null==t?void 0:t.defaultValueRange,this.selectedFilters=[...this.defaultFilters]}}class pi extends pe{constructor(t){var e,i,n,s,a,o;super(void 0===t?void 0:{id:t.id,idGenerator:t.idGenerator,location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,sectorBorders:void 0===t.sectorBorders?void 0:{topHeight:t.sectorBorders.topHeight,bottomHeight:t.sectorBorders.bottomHeight,leftWidth:t.sectorBorders.leftWidth,rightWidth:t.sectorBorders.rightWidth,topCentralHeight:t.sectorBorders.topCentralHeight,bottomCentralHeight:t.sectorBorders.bottomCentralHeight,leftCentralWidth:t.sectorBorders.leftCentralWidth,rightCentralWidth:t.sectorBorders.rightCentralWidth}}),this.filters=null!==(e=null==t?void 0:t.filters)&&void 0!==e?e:[],this.filterProviderCreator=null==t?void 0:t.filterProviderCreator,this.selectedFiltersNames=null!==(i=null==t?void 0:t.selectedFiltersNames)&&void 0!==i?i:[],this.scaleX=null!==(n=null==t?void 0:t.scaleX)&&void 0!==n?n:new ci,this.scaleY=null!==(s=null==t?void 0:t.scaleY)&&void 0!==s?s:new ci,this.unitsXtoMmConvertKoef=null!==(a=null==t?void 0:t.unitsXtoMmConvertKoef)&&void 0!==a?a:10,this.unitsYtoMmConvertKoef=null!==(o=null==t?void 0:t.unitsYtoMmConvertKoef)&&void 0!==o?o:10}}class vi extends $e{constructor(t){var e;super(void 0===t?void 0:{axisX:t.axisX,axisY:t.axisY,x:t.x,y:t.y,width:t.width,height:t.height,minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:t.signal,signalDependency:t.signalDependency,dataHandler:t.dataHandler}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1]}copy(){var t,e;return new vi({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y},color:this.color})}}class yi{constructor(t){var e,i,n,s,a,o,r;this.place=null!==(e=null==t?void 0:t.place)&&void 0!==e?e:g.Central,this.axisX=null!==(i=null==t?void 0:t.axisX)&&void 0!==i?i:Oe.FromLeftToRight,this.axisY=null!==(n=null==t?void 0:t.axisY)&&void 0!==n?n:Ue.FromBottomToTop,this.x=null!==(s=null==t?void 0:t.x)&&void 0!==s?s:new N(0),this.y=null!==(a=null==t?void 0:t.y)&&void 0!==a?a:new N(0),this.width=null!==(o=null==t?void 0:t.width)&&void 0!==o?o:new Z(1),this.height=null!==(r=null==t?void 0:t.height)&&void 0!==r?r:new Z(1)}copy(){return new yi({place:this.place,axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:this.width.copy(),height:this.height.copy()})}}class mi{constructor(t){var e,i;this.id=t.id,this.type=t.type,this.area=null!==(e=t.area)&&void 0!==e?e:new yi,this.item=null!==(i=t.item)&&void 0!==i?i:new $e}copy(){var t,e;return new mi({id:this.id,type:this.type,area:null===(t=this.area)||void 0===t?void 0:t.copy(),item:null===(e=this.item)||void 0===e?void 0:e.copy()})}}class Si extends mi{constructor(t){var e;super({id:t.id,type:t.type,area:t.area,item:null!==(e=t.item)&&void 0!==e?e:new vi})}copy(){var t;let e;return void 0!==this.item&&(e=this.item.copy()),new Si({id:this.id,type:this.type,area:null===(t=this.area)||void 0===t?void 0:t.copy(),item:e})}}class wi extends ge{constructor(t){super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.markCreator=null==t?void 0:t.markCreator}}class xi extends wi{constructor(t){super({location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider,markCreator:t.markCreator}),this.marks=t.marks}}class Ci extends se{constructor(t){var e;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1]}}class bi{}class Ii extends bi{constructor(t){super(),this.isolineY=t.isolineY,this.channelSettings=t.channelSettings,this.signalSettings=t.signalSettings,this.isolineSettings=t.isolineSettings,this.rootSettings=t.rootSettings,this.plotSettings=t.plotSettings,this.signalsBoxSettings=t.signalsBoxSettings,this.plot=t.plot,this.parent=t.parent,this.ppcm=t.ppcm}}class Pi{constructor(t){var e;this.values=t.values,this.index=null!==(e=t.index)&&void 0!==e?e:0==this.values.length?-1:0,this.distanceUnit=t.distanceUnit}}class Bi extends Pi{constructor(t){super({index:t.index,values:t.values,distanceUnit:t.distanceUnit}),this.timeUnit=t.timeUnit}}class Di extends Pi{constructor(t){super({index:t.index,values:t.values,distanceUnit:t.distanceUnit}),this.valueUnit=t.valueUnit}}class Mi extends ie{get[lt](){return!0}constructor(t){super(t),this.typedSettings=this.settings,this.signalsBox=new ye(new pi({id:1234})),this.typedSignalsBoxSettings=this.signalsBox.settings,this.dataSourcesContainer=new ht(""),this.signalsList=[],this.isolinesList=[],this.signalsMap=new Map,this.signalLinkedObjects=[],this.deviceScale=0}async initAsync(){this.initIdMaps(),this.initSignalBoxSettings(),this.initDataSourcesContainer(),await this.createChannels()}getUnitSettings(t){if(void 0!==this.typedSettings.rootSettings)return C("id",t,this.typedSettings.rootSettings.data.units)}addObjectToPanel(t,e){var i;null===(i=this.signalsBox.sectors[t])||void 0===i||i.addItem(e)}draw(){this.items.forEach((t=>{dt(t)&&t.draw()}))}getSignal(t,e,i){const n=this.signalsMap.get(t);if(void 0===n)return;const s=n.get(e);return null==s?void 0:s.get(i)}linkObjectWithSignal(t,e,i,n,s){const a=this.getSignal(e,i,n);void 0!==a&&this.signalLinkedObjects.push({sourceId:e,channelId:i,signalId:n,signalObject:a,object:t,updateLocationFunc:s})}addSignalLinkedObject(t,e,i,n,s,a){const o=this.signalsBox.sectors[e];if(void 0===o||!(t instanceof ot))return;const r=this.getSignal(i,n,s);void 0!==r&&(this.signalLinkedObjects.push({sourceId:i,channelId:n,signalId:s,signalObject:r,object:t,updateLocationFunc:a}),o.addItem(t))}async updateLinkedObjectsLocation(){for(let t=0;t<this.signalLinkedObjects.length;t++){const e=this.signalLinkedObjects[t],i=e.signalObject.settings.locationInPixels.y;e.object.setLocationSettings(e.object.settings.location.x,new N(e.updateLocationFunc(i))),await e.object.createBorders()}}async createChannels(){this.signalsMap.clear();for(let t=0;t<this.typedSettings.dataSources.length;t++){const e=this.typedSettings.dataSources[t],i=new Map;this.signalsMap.set(e.id,i);const n={containerIndex:this.dataSourcesContainer.items.length,channelsIndices:new Map},s=new ht(e.id.toString());this.dataSourcesContainer.add(s);const a=new ht("channels");s.add(a);for(let t=0;t<e.channels.length;t++){const o=e.channels[t].id,r=new Map;i.set(o,r),n.channelsIndices.set(o,s.items.length);const l=new ht(o.toString());a.add(l),await this.createSignals(e.id,o,l,r)}this.createMarks(e,s)}}createMarks(t,e){const i=new ht("marks");for(let n=0;n<t.marks.length;n++){const e=t.marks[n],s=e.copy();if(!(s instanceof Si))continue;const a=this.signalsBox.sectors[e.area.place];if(void 0===a)continue;const o=a.settings.clientSize.width,r=a.settings.clientSize.height;let l=0,d=0;l=void 0===s.area.width?o:s.area.width.calcValue(o),d=void 0===s.area.height?r:s.area.height.calcValue(r);let c=s.area.x.calcValue(o),h=s.area.y.calcValue(r);switch(s.area.axisX==Oe.FromRightToLeft&&(c=o-c),s.area.axisY==Ue.FromTopToBottom&&(h=r-h),l=Math.min(o,l+c)-c,d=Math.min(r,d+h)-h,e.type){case"text":{const t=new ke(new Ie({location:new G({x:new N(c),y:new N(h)}),size:new J({width:new N(l),height:new N(d)}),parent:new Vt({ref:a,jagmHtml:this}),html:{parent:{ref:this.typedSettings.html.ref}},marks:s}));t.init(),t.settings.name=e.id.toString(),i.add(t)}break;case"line":{const t=new ei(new xi({location:new G({x:new N(c),y:new N(h)}),size:new J({width:new N(l),height:new N(d)}),parent:new it({ref:a}),marks:s}));t.init(),t.settings.name=e.id.toString(),i.add(t)}break;case"plot-line":{const t=new ti(new xi({location:new G({x:new N(c),y:new N(h)}),size:new J({width:new N(l),height:new N(d)}),parent:new it({ref:a}),marks:s}));t.init(),t.settings.name=e.id.toString(),i.add(t)}}}e.add(i)}getSignalsAreaSize(){return this.signalsBox.sectors.central.settings.clientSize}async createSignals(t,e,i,n){var s,a,o;if(void 0===this.typedSettings.contentCreatorsMap||!this.typedSettings.contentCreatorsMap.has("signals"))return;const r=this.typedSettings.contentCreatorsMap.get("signals");if(void 0===r)return;const l=new ht("isolines"),d=new ht("signals");i.add(l),i.add(d);const c=this.getChannelSettings(t,e);if(void 0===c)return;const h=this.getSignalsAreaSize(),u=c.y.calcValue(h.height),g=c.height.calcValue(h.height),f=c.getCurrSignalsVariant();if(void 0!==f&&f instanceof si){if(null===(s=this.beforeSignalObjectsCreate)||void 0===s||s.call(this,c,i),c.showIsolines)for(let t=0;t<f.isolines.length;++t){const e=f.isolines[t],i=u+e.y.calcValue(g),n=new Ci({location:new G({x:new N(0),y:new N(i)}),size:new J({width:new Z(1),height:new N(1)}),parent:new it({ref:this.signalsBox.sectors.central}),color:e.color});n.canvas=this.parentCanvas,n.contextProvider=void 0,void 0!==this.parentCanvas&&this.parentCanvas.settings instanceof $t&&(n.contextProvider=this.parentCanvas.settings.contextProvider);const s=new Re(n);s.init(),s.settings.name=e.id.toString(),l.add(s)}for(let i=0;i<f.signals.length;++i){const s=f.signals[i],o=C("id",s.id_isoline,f.isolines);if(void 0===o)continue;const l=u+o.y.calcValue(g),h=await r.create(new Ii({isolineY:l,channelSettings:c,signalSettings:s,isolineSettings:o,rootSettings:this.typedSettings.rootSettings,plotSettings:this.typedSettings,signalsBoxSettings:this.typedSignalsBoxSettings,plot:this,parent:this.signalsBox.sectors.central,ppcm:this.typedSettings.ppcm}));void 0!==h&&(null===(a=this.afterSignalObjectCreate)||void 0===a||a.call(this,h,t,e,s.id),h.settings.name=s.id.toString(),d.add(h),n.set(s.id,h))}null===(o=this.afterSignalsCreate)||void 0===o||o.call(this,t,e)}}getSignalsWidthInMm(){return this.getSignalsAreaSize().width/(this.typedSettings.ppcm/10)}getPlotPointCount(t){if(void 0===this.typedSignalsBoxSettings.scaleX.currValue||0==this.typedSettings.ppcm)return 0;const e=this.getSignalsAreaSize().width/(this.typedSettings.ppcm/10)/this.typedSignalsBoxSettings.scaleX.currValue;return Math.ceil(t*e)}getSignalsPointCount(t,e){const i=this.getChannelSettings(t,e);if(void 0===i)return 0;if(void 0===this.typedSignalsBoxSettings.scaleX.currValue||0==this.typedSettings.ppcm||void 0===i.frequency)return 0;const n=i.isSynchronizedScaleX||void 0===i.scaleX||i.scaleX.index<0?this.typedSignalsBoxSettings.scaleX.currValue:i.scaleX.values[i.scaleX.index],s=this.getSignalsAreaSize().width/(this.typedSettings.ppcm/10);return Math.ceil(i.frequency*s/n)}async setFilters(t){await this.forEachChannelAsync((async(e,i,n,s)=>{this.forEachChannelContainerSignal(e,i,s,(e=>{this.isFilteredSignal(e)&&e.setFilters(t)})),await this.handleEvent("ChannelFiltersChanged",{dataSourceId:e,channelId:i,filters:t})}))}async createBorders(){Lt.prototype.createBorders.call(this),this.updateIsolines(),await this.items.forEachAsync((async t=>{t instanceof ot&&(t.setParentSizeSettings(this.settings.sizeInPixels.width,this.settings.sizeInPixels.height),await t.createBorders())})),await this.updateLinkedObjectsLocation(),await this.handleEvent("BufferSizeChanged")}updateIsolines(){const t=this.getSignalsAreaSize();this.dataSourcesContainer.forEachChild((e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const n=parseInt(i),s=e.findItem("channels");void 0!==s&&s instanceof ht&&s.forEachChild((e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const s=parseInt(i),a=this.getChannelSettings(n,s);if(void 0===a)return;const o=a.height.calcValue(t.height),r=a.y.calcValue(t.height),l=a.getCurrSignalsVariant();if(void 0===l||!(l instanceof si))return;const d=e.findItem("isolines");void 0!==d&&d instanceof ht&&d.forEachChild((t=>{const e=t.getName();if(void 0===e||!(t instanceof ot))return;const i=parseInt(e),n=l.isolines.findIndex((t=>t.id==i));if(n<0)return;const s=l.isolines[n],a=r+s.y.calcValue(o);t.setLocationSettings(new N(0),new N(a))}));const c=e.findItem("signals");void 0!==c&&c instanceof ht&&c.forEachChild((t=>{const e=t.getName();if(void 0===e||!(t instanceof ot))return;const i=parseInt(e),n=l.signals.findIndex((t=>t.id==i));if(n<0)return;const s=C("id",l.signals[n].id_isoline,l.isolines);if(void 0===s)return;const a=r+s.y.calcValue(o);t.setLocationSettings(new N(0),new N(a))}))}))}))}async setScaleX(t){var e;this.typedSignalsBoxSettings.scaleX.currValue=t,this.forEachSignal((e=>{e.setScaleX(t)})),null===(e=this.afterChannelsDataClear)||void 0===e||e.call(this),await this.handleEvent("BufferSizeChanged"),await this.forEachChannelAsync((async(e,i)=>{await this.handleEvent("ChannelScaleXChanged",{dataSourceId:e,channelId:i,scaleX:t})}))}async setScaleY(t){this.typedSignalsBoxSettings.scaleY.currValue=t,await this.forEachChannelAsync((async(e,i,n,s)=>{this.forEachChannelContainerSignal(e,i,s,((e,i,n)=>{const s=this.getChannelSettings(i,n);if(void 0===s)return;const a=this.getChannelUnitScale(s);void 0!==a&&e.setScaleY(t*a/this.typedSignalsBoxSettings.unitsYtoMmConvertKoef)})),await this.handleEvent("ChannelScaleYChanged",{dataSourceId:e,channelId:i,scaleY:t})}))}getChannelUnitText(t){if(void 0!==this.typedSettings.rootSettings)return li(t,this.typedSettings.rootSettings.data)}getChannelUnitScale(t){if(void 0!==this.typedSettings.rootSettings)return di(t,this.typedSettings.rootSettings.data)}initChannelScaleXSettings(t,e){const i=this.getChannelSettings(t,e);if(void 0===(null==i?void 0:i.scaleX))return;const n=[...this.typedSignalsBoxSettings.scaleX.values],s=i.scaleX.values.findIndex((t=>t==this.typedSignalsBoxSettings.scaleX.currValue));i.scaleX=new Bi({index:s,values:n})}initChannelScaleYSettings(t,e){const i=this.getChannelSettings(t,e);if(void 0===(null==i?void 0:i.scaleY))return;const n=[...this.typedSignalsBoxSettings.scaleY.values],s=i.scaleY.values.findIndex((t=>t==this.typedSignalsBoxSettings.scaleY.currValue));i.scaleY=new Di({index:s,values:n})}initChannelFilterSettings(t,e){const i=this.getChannelSettings(t,e);void 0!==i&&void 0===i.filters&&(i.filters=this.typedSignalsBoxSettings.filters,i.selectedFiltersNames=this.typedSignalsBoxSettings.selectedFiltersNames)}setChannelScaleXSettings(t,e,i){const n=this.getChannelSettings(t,e);void 0!==n&&(void 0===n.scaleX&&this.initChannelScaleXSettings(t,e),void 0!==n.scaleX&&(n.scaleX.index=n.scaleX.values.findIndex((t=>t==i))))}async setChannelScaleX(t,e,i){this.setChannelScaleXSettings(t,e,i),this.forEachChannelSignal(t,e,(t=>{t.setScaleX(i)})),await this.handleEvent("BufferSizeChanged"),await this.handleEvent("ChannelScaleXChanged",{dataSourceId:t,channelId:e,scaleX:i})}async setChannelScaleY(t,e,i){const n=this.getChannelSettings(t,e);if(void 0===n)return;void 0===n.scaleY&&this.initChannelScaleYSettings(t,e),void 0!==n.scaleY&&(n.scaleY.index=n.scaleY.values.findIndex((t=>t==i)));const s=this.getChannelUnitScale(n);void 0!==s&&(this.forEachChannelSignal(t,e,(t=>{t.setScaleY(i*s/this.typedSignalsBoxSettings.unitsYtoMmConvertKoef)})),await this.handleEvent("ChannelScaleYChanged",{dataSourceId:t,channelId:e,scaleY:i}))}getChannelScaleY(t,e){const i=this.getChannelSettings(t,e);if(!(void 0===(null==i?void 0:i.scaleY)||i.scaleY.index<0))return i.scaleY.values[i.scaleY.index]}async setChannelFilters(t,e,i){const n=this.getChannelSettings(t,e);void 0!==n&&(n.selectedFiltersNames=[...i],this.forEachChannelSignal(t,e,(t=>{this.isFilteredSignal(t)&&t.setFilters(i)})),await this.handleEvent("ChannelFiltersChanged",{dataSourceId:t,channelId:e,filters:i}))}async setFrequency(t,e,i){const n=this.getChannelSettings(t,e);void 0!==n&&(n.frequency=i,this.forEachChannelSignal(t,e,(t=>{this.isFreqDependentSignal(t)&&t.setFrequency(i)})),await this.handleEvent("BufferSizeChanged"),await this.handleEvent("ChannelFrequencyChanged",{dataSourceId:t,channelId:e,frequency:i}))}getFirstSignalDataBufferSize(){const t=this.getFirstSignalObject();if(void 0!==t)return t.getPointsCount()}getDataBufferSize(t,e,i){const n=this.getSignalObject(t,e,i);if(void 0!==n)return n.getPointsCount()}getMarkObjectGroup(t,e){const i=null!=t?t:0,n=this.dataSourcesContainer.findItem(i.toString());if(void 0===n||!(n instanceof ht))return;const s=n.findItem("marks");return void 0!==s&&s instanceof ht?s.findItem(`${e}`):void 0}getSignalObject(t,e,i){const n=this.getChannelContainer(t,e);if(void 0===n)return;const s=n.findItem("signals");if(void 0===s||!(s instanceof ht))return;const a=s.findItem(`${i}`);return void 0!==a&&a instanceof ot?a:void 0}getFirstChannelSignalObject(t,e){const i=this.getChannelSettings(t,e);if(void 0===i)return;const n=i.getCurrSignalsVariant();if(void 0===n||!(n instanceof si))return;if(0==n.signals.length)return;const s=n.signals[0];return this.getSignalObject(t,e,s.id)}getFirstSignalObject(){if(0==this.typedSettings.dataSources.length)return;const t=this.typedSettings.dataSources[0];if(0==t.channels.length)return;const e=t.channels[0],i=e.getCurrSignalsVariant();if(void 0===i||!(i instanceof si)||0==i.signals.length)return;const n=i.signals[0];return this.getSignalObject(t.id,e.id,n.id)}addMark(t,e,i){const n=this.getMarkObjectGroup(t,e);void 0!==n&&n instanceof ot&&n.addMark(i)}storeMarks(){this.dataSourcesContainer.forEachChild((t=>{if(!(t instanceof ht))return;const e=t.findItem("marks");void 0!==e&&e instanceof ht&&e.forEachChild((t=>{t.storeMarks()}))}))}restoreMarks(){this.dataSourcesContainer.forEachChild((t=>{if(!(t instanceof ht))return;const e=t.findItem("marks");void 0!==e&&e instanceof ht&&e.forEachChild((t=>{t.restoreMarks()}))}))}clearAllMarks(){this.dataSourcesContainer.forEachChild((t=>{if(!(t instanceof ht))return;const e=t.findItem("marks");void 0!==e&&e instanceof ht&&e.forEachChild((t=>{t.clear()}))}))}clearMarks(t,e){const i=this.getMarkObjectGroup(t,e);void 0!==i&&i.clear()}async updateMarksBorders(){await this.dataSourcesContainer.forEachChildAsync((async t=>{if(!(t instanceof ht))return;const e=t.findItem("marks");void 0!==e&&e instanceof ht&&await e.forEachChildAsync((async t=>{if(!(t instanceof ot))return;const e=t.settings.marks;if(void 0===e)return;const i=this.signalsBox.sectors[e.area.place];if(void 0===i)return;const n=i.settings.clientSize.width,s=i.settings.clientSize.height;let a=e.area.width.calcValue(n),o=e.area.height.calcValue(s),r=e.area.x.calcValue(n),l=e.area.y.calcValue(s);e.area.axisX==Oe.FromRightToLeft&&(r=n-r),e.area.axisY==Ue.FromTopToBottom&&(l=s-l),a=Math.min(n,a+r)-r,o=Math.min(s,o+l)-l,await t.setBorders(new G({x:new N(r),y:new N(l)}),new J({width:new N(a),height:new N(o)}))}))}))}clearSignalDependentMarks(){this.dataSourcesContainer.forEachChild((t=>{if(!(t instanceof ht))return;const e=t.findItem("marks");void 0!==e&&e instanceof ht&&e.forEachChild((t=>{if(!(t instanceof ot))return;const e=t.settings.marks;if(void 0===e)return;const i=e.item;i.signalDependency.x==Te.None&&i.signalDependency.y==We.None||t.clear()}))}))}getMarkGroupId(t,e){return this.typedSettings.rootSettings,-1}tryRemoveMarks(t,e,i){this.dataSourcesContainer.forEachChild((n=>{if(!(n instanceof ht))return;const s=n.findItem("marks");void 0!==s&&s instanceof ht&&s.forEachChild((n=>{n.tryRemoveMarks(t,e,i)}))}))}addSignalData(t,e,i,n){var s;const a=this.getSignalObject(t,e,i);void 0!==a&&(a.addData(n),null===(s=this.afterAddDataToSignal)||void 0===s||s.call(this,t,e,i))}getFirstSignalCurrPointX(){const t=this.getFirstSignalObject();return void 0===t?null:t.getCurrPointX()}getSignalCurrPointX(t,e,i){const n=this.getSignalObject(t,e,i);return void 0===n?null:n.getCurrPointX()}clearChannel(t,e){var i;this.forEachChannelSignal(t,e,(t=>{t.resetBuffer()})),null===(i=this.afterChannelClear)||void 0===i||i.call(this,t,e)}clearChannelData(t,e){var i;this.forEachChannelSignal(t,e,(t=>{t.resetBuffer()})),null===(i=this.afterChannelDataClear)||void 0===i||i.call(this,t,e)}async updateCurrChannelVariant(t,e,i){const n=this.clearChannelContainer(t,e);if(void 0===n)return;const s=this.getChannelSettings(t,e);if(void 0===s)return;const a=C("name","signals",s.variantGroups);if(void 0!==a){for(let t=0;t<a.variants.length;++t){const e=a.variants[t];if(e instanceof si&&e.name==a.currVariant){a.variants[t]=i.copy();break}}await this.afterChannelSettingsChanged(t,e,n)}}async setDefaultChannelVariant(t,e){const i=this.getChannelSettings(t,e);if(void 0===i)return;const n=C("name","signals",i.variantGroups);void 0!==n&&await this.setChannelVariant(t,e,n.defaultVariant)}async setChannelVariant(t,e,i){const n=this.clearChannelContainer(t,e);if(void 0===n)return;const s=this.getChannelSettings(t,e);if(void 0===s)return;const a=C("name","signals",s.variantGroups);void 0!==a&&(a.currVariant=i,await this.afterChannelSettingsChanged(t,e,n))}getChannelSettings(t,e){const i=C("id",t,this.typedSettings.dataSources);if(void 0!==i)return C("id",e,i.channels)}async forEachChannelAsync(t){await this.dataSourcesContainer.forEachChildAsync((async e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const n=parseInt(i),s=e.findItem("channels");void 0!==s&&s instanceof ht&&await s.forEachChildAsync((async i=>{const s=i.getName();if(void 0===s||!(i instanceof ht))return;const a=parseInt(s);await t(n,a,e,i)}))}))}forEachChannelContainerSignal(t,e,i,n){const s=i.findItem("signals");void 0!==s&&s instanceof ht&&s.forEachChild((i=>{const s=i.getName();if(void 0===s||!(i instanceof ot))return;const a=parseInt(s);n(i,t,e,a)}))}async forEachChannelContainerSignalAsync(t,e,i,n){const s=i.findItem("signals");void 0!==s&&s instanceof ht&&await s.forEachChildAsync((async i=>{const s=i.getName();if(void 0===s||!(i instanceof ot))return;const a=parseInt(s);await n(i,t,e,a)}))}forEachSignal(t){this.dataSourcesContainer.forEachChild((e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const n=parseInt(i),s=e.findItem("channels");void 0!==s&&s instanceof ht&&s.forEachChild((e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const s=parseInt(i),a=e.findItem("signals");void 0!==a&&a instanceof ht&&a.forEachChild((e=>{const i=e.getName();if(void 0===i||!(e instanceof ot))return;const a=parseInt(i);t(e,n,s,a)}))}))}))}async forEachSignalAsync(t){await this.dataSourcesContainer.forEachChildAsync((async e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const n=parseInt(i),s=e.findItem("channels");void 0!==s&&s instanceof ht&&await s.forEachChildAsync((async e=>{const i=e.getName();if(void 0===i||!(e instanceof ht))return;const s=parseInt(i),a=e.findItem("signals");void 0!==a&&a instanceof ht&&await a.forEachChildAsync((async e=>{const i=e.getName();if(void 0===i||!(e instanceof ot))return;const a=parseInt(i);await t(e,n,s,a)}))}))}))}forEachChannelSignal(t,e,i){const n=this.getChannelContainer(t,e);if(void 0===n)return;const s=n.findItem("signals");void 0!==s&&s instanceof ht&&s.forEach(i)}getChannelContainer(t,e){const i=this.dataSourcesContainer.findItem(t.toString());if(void 0===i||!(i instanceof ht))return;const n=i.findItem("channels");if(void 0===n||!(n instanceof ht))return;const s=n.findItem(e.toString());return void 0!==s&&s instanceof ht?s:void 0}getParentCanvas(){return void 0===this.parentCanvas&&(this.parentCanvas=function(t,e){let i=t;for(;void 0!==i.settings.parent.ref;){if(!(i.settings.parent.ref instanceof ot))return;if(i=i.settings.parent.ref,e(i))return i}}(this,Nt.isCanvas)),this.parentCanvas}setPpi(t){super.setPpi(t),this.items.recursiveExecute("setPpi",t)}setDeviceScale(t){super.setDeviceScale(t),this.items.recursiveExecute("setDeviceScale",t)}initIdMaps(){this.typedSettings.id=`Plot_${this.typedSettings.title}_svgRoot`,this.init(),this.signalsList=[],this.isolinesList=[],this.signalsMap=new Map,this.signalLinkedObjects=[]}initSignalBoxSettings(){var t,e;const i=this.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===i||!(i.obj instanceof fi))return;const n=i.obj,s=new pi({id:1235,scaleX:n.scaleX,scaleY:n.scaleY,unitsXtoMmConvertKoef:n.unitsXtoMmConvertKoef,unitsYtoMmConvertKoef:n.unitsYtoMmConvertKoef,filters:null!==(t=n.filters)&&void 0!==t?t:[],filterProviderCreator:this.typedSettings.filterProviderCreator,selectedFiltersNames:null!==(e=n.defaultFilters)&&void 0!==e?e:[],location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),sectorBorders:this.typedSettings.sectorBorders,parent:new it({ref:this})});this.typedSignalsBoxSettings=s,this.signalsBox=new ye(s),this.signalsBox.init(),this.signalsBox.settings.name="SignalsBox",this.items.add(this.signalsBox)}initDataSourcesContainer(){this.dataSourcesContainer=new ht("DataSources");const t=new oi(new ii({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new it({ref:this.signalsBox.sectors.central}),dataSourcesContainer:this.dataSourcesContainer,dataSourcesSettings:this.typedSettings.dataSources}));t.init(),t.settings.name="DataSourcesPanel",this.signalsBox.sectors.central.addItem(t),this.items.add(this.dataSourcesContainer)}isFilteredSignal(t){return"setFilters"in t}isFreqDependentSignal(t){return"setFrequency"in t}clearChannelContainer(t,e){var i;const n=this.getChannelContainer(t,e);if(void 0!==n)return n.forEach((t=>{t instanceof Lt&&t.removeObjectFromDom()})),n.clear(),null===(i=this.afterChannelClear)||void 0===i||i.call(this,t,e),n}async afterChannelSettingsChanged(t,e,i){void 0!==this.afterChannelDataUpdated&&this.afterChannelDataUpdated(t,e);const n=this.signalsMap.get(t);if(void 0===n)return;const s=n.get(e);void 0!==s&&(s.clear(),await this.createSignals(t,e,i,s))}}class zi extends _e{constructor(t){var e,i,n,s,a;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}},id:t.id,content:t.content,sectorBorders:void 0===t.sectorBorders?void 0:{topHeight:t.sectorBorders.topHeight,bottomHeight:t.sectorBorders.bottomHeight,leftWidth:t.sectorBorders.leftWidth,rightWidth:t.sectorBorders.rightWidth,topCentralHeight:t.sectorBorders.topCentralHeight,bottomCentralHeight:t.sectorBorders.bottomCentralHeight,leftCentralWidth:t.sectorBorders.leftCentralWidth,rightCentralWidth:t.sectorBorders.rightCentralWidth},isAutoMarkRestore:t.isAutoMarkRestore,filterProviderCreator:t.filterProviderCreator,title:t.title,dataSources:t.dataSources,contentCreatorsMap:t.contentCreatorsMap,dataSectionSettings:t.dataSectionSettings}),this.synchronizedScaleX=null!==(e=null==t?void 0:t.synchronizedScaleX)&&void 0!==e&&e,this.linkedChannel={id:null!==(n=null===(i=null==t?void 0:t.linkedChannel)||void 0===i?void 0:i.id)&&void 0!==n?n:-1,id_dataSource:null!==(a=null===(s=null==t?void 0:t.linkedChannel)||void 0===s?void 0:s.id_dataSource)&&void 0!==a?a:-1}}}class ki extends gi{constructor(t){var e,i,n,s,a,o;super(),this.location=t.location,this.size=t.size,this.title=t.title,this.style=t.style,this.isVisible=t.isVisible,this.channelUnit=t.channelUnit,this.unit=t.unit,this.label={fontSize:null!==(i=null===(e=null==t?void 0:t.label)||void 0===e?void 0:e.fontSize)&&void 0!==i?i:"",fontFamily:null!==(s=null===(n=null==t?void 0:t.label)||void 0===n?void 0:n.fontFamily)&&void 0!==s?s:"",color:null!==(o=null===(a=null==t?void 0:t.label)||void 0===a?void 0:a.color)&&void 0!==o?o:[0,0,0,1]}}}class Ai extends gi{constructor(t){super(),this.view=t.view}getMajorCellSizeInMm(){return new K}}class Fi extends Ai{constructor(t){var e,i,n;super({view:t.view}),this.majorCell={size_mm:t.majorCell.size_mm,lineWidth_mm:null!==(e=t.majorCell.lineWidth_mm)&&void 0!==e?e:1},this.minorCell={size_mm:t.minorCell.size_mm,lineWidth_mm:null!==(i=t.minorCell.lineWidth_mm)&&void 0!==i?i:1},this.color=null!==(n=t.color)&&void 0!==n?n:[0,0,0,1]}getMajorCellSizeInMm(){return this.majorCell.size_mm}}class Vi extends bi{constructor(t){var e,i,n,s,a,o;super(),this.view=t.view,this.viewScale={x:null!==(i=null===(e=t.viewScale)||void 0===e?void 0:e.x)&&void 0!==i?i:1,y:null!==(s=null===(n=t.viewScale)||void 0===n?void 0:n.y)&&void 0!==s?s:1},this.parentObj=t.parentObj,this.parentHtmlObj=t.parentHtmlObj,this.graphicHtmlParentObj=t.graphicHtmlParentObj,this.color=t.color,this.deviceScale=null!==(a=t.deviceScale)&&void 0!==a?a:1,this.ppi=null!==(o=t.ppi)&&void 0!==o?o:0}}class _i extends Vi{constructor(t){super({view:t.view,viewScale:t.viewScale,parentObj:t.parentObj,parentHtmlObj:t.parentHtmlObj,graphicHtmlParentObj:t.graphicHtmlParentObj,color:t.color,deviceScale:t.deviceScale,ppi:t.ppi}),this.majorCell={size_mm:t.majorCell.size_mm,lineWidth_mm:t.majorCell.lineWidth_mm},this.minorCell={size_mm:t.minorCell.size_mm,lineWidth_mm:t.minorCell.lineWidth_mm}}}class Ri extends Ai{constructor(t){var e;super({view:t.view}),this.cellSize_mm=t.cellSize_mm,this.color=null!==(e=t.color)&&void 0!==e?e:[0,0,0,1]}getMajorCellSizeInMm(){return this.cellSize_mm}}class Li extends Vi{constructor(t){super({view:t.view,viewScale:t.viewScale,parentObj:t.parentObj,parentHtmlObj:t.parentHtmlObj,graphicHtmlParentObj:t.graphicHtmlParentObj,color:t.color,deviceScale:t.deviceScale,ppi:t.ppi}),this.cellSize_mm=t.cellSize_mm}}class Ei extends gi{constructor(t){super(),this.view=t.view,this.color=t.color}}class ji extends bi{constructor(t){super(),this.view=t.view,this.parentObj=t.parentObj,this.parentHtmlObj=t.parentHtmlObj,this.graphicHtmlParentObj=t.graphicHtmlParentObj,this.hasStroke=t.hasStroke,this.strokeColor=t.strokeColor}}class Yi extends gi{constructor(t){var e;super(),this.labels=null!==(e=null==t?void 0:t.labels)&&void 0!==e?e:[]}}class Oi extends gi{constructor(t){var e;super(),this.labels=null!==(e=null==t?void 0:t.labels)&&void 0!==e?e:[]}}class Ui extends Mi{constructor(t){super(t),this.typedSettings=this.settings,this.sectorDataSourceMap=new Map,this.contentMap=new Map,this.objectContainerMap=new Map,this.objectSettingsMap=new Map}async initAsync(){this.afterSignalsCreate=this.afterSignalsCreateFunc,this.afterChannelClear=this.afterChannelClearFunc,this.sectorDataSourceMap=new Map,this.objectContainerMap=new Map,this.objectSettingsMap=new Map,this.contentMap=new Map,this.initIdMaps(),this.initSignalBoxSettings(),this.initDataSourcesContainer(),this.initMeander(),await this.initGrid(),await this.initBorder(),await this.createChannels()}initDataSourcesContainer(){super.initDataSourcesContainer(),this.typedSettings.dataSources.length>0&&this.typedSettings.dataSources[0].channels.length>0&&(this.selectedChannel={id_dataSource:this.typedSettings.dataSources[0].id,id_channel:this.typedSettings.dataSources[0].channels[0].id})}async setScaleY(t){var e;await super.setScaleY(t);const i=this.objectSettingsMap.get("Meander");void 0!==i&&i instanceof ki&&(null===(e=i.isVisible)||void 0===e||e)&&void 0!==this.meanderLabel&&(await this.setMeanderHeight(t),this.meanderLabel.setText(`${t.toString()} ${i.unit}/${i.channelUnit}`))}async setChannelScaleY(t,e,i){var n;await super.setChannelScaleY(t,e,i);const s=this.objectSettingsMap.get("Meander");void 0!==s&&s instanceof ki&&(null===(n=s.isVisible)||void 0===n||n)&&void 0!==this.meanderLabel&&(await this.setMeanderHeight(i),this.meanderLabel.setText(`${i.toString()} ${s.unit}/${s.channelUnit}`))}async setMeanderHeight(t){if(!this.objectContainerMap.has("Meander"))return;const e=this.getSignalsSettings();if(void 0===e||!(e.obj instanceof fi))return;const i=this.getGridSettings();if(void 0===i||!(i.obj instanceof Ai))return;const n=i.obj.getMajorCellSizeInMm(),s=t*e.obj.viewScale.y/this.typedSignalsBoxSettings.unitsYtoMmConvertKoef,a=this.objectContainerMap.get("Meander");if(void 0===a)return;const o=a.findItem("Meander");void 0!==o&&o instanceof Fe&&await o.setHeight(new N(n.height*s-1))}setMeanderUnit(t){if(!this.objectSettingsMap.has("Meander"))return;const e=this.objectSettingsMap.get("Meander");if(void 0===e||!(e instanceof ki))return;if(e.channelUnit=t,void 0===this.selectedChannel)return;const i=this.getChannelScaleY(this.selectedChannel.id_dataSource,this.selectedChannel.id_channel);void 0!==i&&void 0!==this.meanderLabel&&this.meanderLabel.setText(`${i} ${e.unit}/${e.channelUnit}`)}setChannelUnit(t,e,i){const n=this.getChannelSettings(t,e);if(void 0===(null==n?void 0:n.unit))return;n.unit.text=i;const s=n.getCurrSignalsVariant();if(void 0===s||!(s instanceof si))return;const a=this.getMeanValueLabelsSettings(s);if(void 0===a)return;const o=this.getSectorChannelContainer(t,e,a.sector).findItem("mean-value-labels");void 0!==o&&o instanceof ht&&(s.signals.forEach((t=>{const e=o.findItem(`${t.id}`);if(void 0===e||!(e instanceof me))return;const i=e.typedSettings.title.split(" ");2==i.length&&void 0!==n.unit&&e.setText(`${i[0]} ${n.unit.text}`)})),void 0!==this.selectedChannel&&this.selectedChannel.id_dataSource==t&&this.selectedChannel.id_channel==e&&this.setMeanderUnit(n.unit.text))}async updateMeanValueText(t,e,i,n,s,a){void 0===s&&(s="plot"),void 0===a&&(a=!1);const o=this.getChannelSettings(t,e);if(void 0===o)return;const r=o.getCurrSignalsVariant();if(void 0===r||!(r instanceof si))return;const l=this.getMeanValueLabelsSettings(r);if(void 0===l)return;const d=this.getSectorChannelContainer(t,e,l.sector).findItem("mean-value-labels");if(void 0===d||!(d instanceof ht))return;const c=d.findItem(`${i}`);if(void 0===c||!(c instanceof me))return;const h=this.getChannelUnitScale(o);if(void 0===h)return;const u=B((null!=n?n:0)*h,2),g=this.getChannelUnitText(o);void 0!==g&&(c.setText(`${u} ${g}`),await this.handleEvent("MeanValueUpdated",{dataSourceId:t,channelId:e,signalId:i,text:a?g:u,value:n,source:s}))}tryUpdateMeanSignalsValue(){this.forEachSignal((t=>{t.tryUpdateMeanSignalValue()}))}getSectorChannelContainer(t,e,i){let n=this.sectorDataSourceMap.get(i);void 0===n&&(n=new ht("data-sources"),this.sectorDataSourceMap.set(i,n));const s=n.findItem(`${t}`);let a;void 0!==s&&s instanceof ht&&(a=s),void 0===a&&(a=new ht(`${t}`),n.add(a));const o=a.findItem(`${e}`);if(void 0!==o&&o instanceof ht)return o;const r=new ht(e.toString());return a.add(r),r}getDataIndex(t,e,i,n){const s=this.getSignalObject(t,e,i);return void 0===s?-1:s.getDataIndex(n)}async onSignalLabelClicked(t,e){this.selectedChannel={id_dataSource:t,id_channel:e},this.selectChannelLabels(t,e),await this.handleEvent("SelectChannel",{dataSourceId:t,channelId:e})}selectChannelLabels(t,e){this.typedSettings.dataSources.forEach((i=>{i.channels.forEach((n=>{const s=t==i.id&&e==n.id,a=n.getCurrSignalsVariant();if(void 0===a||!(a instanceof si))return;const o=this.getMeanValueLabelsSettings(a);if(void 0!==o){const i=this.getSectorChannelContainer(t,e,o.sector).findItem("mean-value-labels");void 0!==i&&i instanceof ht&&i.forEach((t=>{t instanceof me&&t.setIsBold(s)}))}const r=this.getSignalLabelsSettings(a);if(void 0!==r){const i=this.getSectorChannelContainer(t,e,r.sector).findItem("signal-labels");void 0!==i&&i instanceof ht&&i.forEach((t=>{t instanceof me&&t.setIsBold(s)}))}}))}))}afterSignalsCreateFunc(t,e){var i,n;const s=this.getChannelSettings(t,e);if(void 0===s)return;const a=this.signalsBox.sectors.central.settings.sizeInPixels.height,o=s.y.calcValue(a),r=s.height.calcValue(a),l=s.getCurrSignalsVariant();if(void 0===l||!(l instanceof si))return;const d=this.getSignalLabelsSettings(l);if(void 0===d||!(d.obj instanceof Oi))return;let c=this.getOrCreateSvgSectorPanel(d.sector);if(void 0===c)return;const h=this.getSignalsSettings();if(void 0===h||!(h.obj instanceof fi))return;const u=h.obj,g=d.obj;let f=this.getSectorChannelContainer(t,e,d.sector);const p=this.getCreatedChildContainer("signal-labels",f),v=new Map;for(let I=0;I<g.labels.length;I++){const s=g.labels[I];let a=0;const d=C("id",s.id_signal,l.signals);if(void 0===d)continue;const h=C("id",d.id_isoline,l.isolines);if(void 0===h)continue;s.linkedPosition&&(a=o+h.y.calcValue(r));const f=a+(null!==(n=null===(i=s.y)||void 0===i?void 0:i.calcValue(r))&&void 0!==n?n:0);v.set(s.id_signal,a);const y=new me(new Se({location:new G({x:new N(0),y:new N(f)}),size:new J({width:new Z(1),height:new N(20)}),parent:new Vt({ref:c,jagmHtml:c}),html:{parent:{ref:c.typedSettings.html.ref}},title:s.text,fontSize:`${u.labels.fontSize}px`,fontFamily:u.labels.fontFamily,color:s.color}));y.init();const m=y.typedSettings.html.ref;void 0!==m&&(m.style.userSelect="none"),y.addOnClickedFunction((async()=>{await this.onSignalLabelClicked(t,e)})),this.linkObjectWithSignal(y,t,e,s.id_signal,(t=>{var e,i;let n=0;return s.linkedPosition&&(n=t),n+=null!==(i=null===(e=s.y)||void 0===e?void 0:e.calcValue(r))&&void 0!==i?i:0,n})),y.settings.name=`${s.id_signal}`,p.add(y)}const y=this.getMeanValueLabelsSettings(l);if(void 0===y||!(y.obj instanceof Yi))return;const m=this.getMeanderSettings();if(void 0===m||!(m.obj instanceof ki))return;if(c=this.getOrCreateSvgSectorPanel(y.sector),void 0===c)return;const S=y.obj,w=m.obj;f=this.getSectorChannelContainer(t,e,y.sector);const x=this.getCreatedChildContainer("mean-value-labels",f),b=this.getChannelUnitText(s);if(void 0!==b)for(let I=0;I<S.labels.length;I++){const i=S.labels[I],n=C("id_signal",i.id_signal,g.labels);if(void 0===n)continue;const s=v.get(n.id_signal);if(void 0===s)continue;let a=n.linkedPosition?s:0;a+=n.y.calcValue(r),a+=i.y.calcValue(r);const o=new me(new Se({location:new G({x:new N(0),y:new N(a)}),size:new J({width:new Z(1),height:new N(20)}),parent:new Vt({ref:c,jagmHtml:c}),html:{parent:{ref:c.typedSettings.html.ref}},title:`0 ${b}`,fontSize:w.label.fontSize,fontFamily:w.label.fontFamily,color:i.color}));o.init();const l=o.typedSettings.html.ref;void 0!==l&&(l.style.userSelect="none"),o.addOnClickedFunction((async()=>{await this.onSignalLabelClicked(t,e)})),this.linkObjectWithSignal(o,t,e,n.id_signal,(t=>{let e=0;return n.linkedPosition&&(e=t),e+=n.y.calcValue(r),e+(void 0===i.y?0:i.y.calcValue(r))})),o.settings.name=`${n.id_signal}`,x.add(o)}}afterChannelClearFunc(t,e){const i=this.getChannelSettings(t,e);if(void 0===i)return;const n=i.getCurrSignalsVariant();if(void 0===n||!(n instanceof si))return;const s=this.getMeanValueLabelsSettings(n);if(void 0!==s){const i=this.getSectorChannelContainer(t,e,s.sector).findItem("mean-value-labels");void 0!==i&&i instanceof ht&&(i.forEach((t=>{t instanceof me&&t.removeObjectFromDom()})),i.clear())}const a=this.getSignalLabelsSettings(n);if(void 0!==a){const i=this.getSectorChannelContainer(t,e,a.sector).findItem("signal-labels");void 0!==i&&i instanceof ht&&(i.forEach((t=>{t instanceof me&&t.removeObjectFromDom()})),i.clear())}}getCreatedChildContainer(t,e){const i=e.findItem(t);if(void 0!==i&&i instanceof ht)return i;const n=new ht(t);return e.add(n),n}getSignalsSettings(){return this.typedSettings.findPlacedContent("signals",[g.Central])}getGridSettings(){return this.typedSettings.findPlacedContent("grid",[g.Central])}getBorderSettings(){return this.typedSettings.findPlacedContent("border",[g.Central])}getMeanderSettings(){return this.typedSettings.findContent("meander")}getSignalLabelsSettings(t){return t.findContent("signalLabels")}getMeanValueLabelsSettings(t){return t.findContent("meanValueLabels")}async initGrid(){var t;const e=this.getSignalsSettings();if(void 0===e||!(e.obj instanceof fi))return;const i=this.getGridSettings();if(void 0===i||!(i.obj instanceof Ai))return;const n=this.signalsBox.sectors[i.sector];if(void 0===n)return;const s=e.obj,a=i.obj,o=null===(t=this.typedSettings.contentCreatorsMap)||void 0===t?void 0:t.get("grid");if(void 0===this.typedSettings.html.parent.ref||void 0===o)return;let r;if(a instanceof Fi)r=new _i({view:a.view,viewScale:{x:s.viewScale.x,y:s.viewScale.y},parentObj:n,parentHtmlObj:this.typedSettings.html.parent.ref,graphicHtmlParentObj:this,color:a.color,deviceScale:this.typedSettings.deviceScale,ppi:this.typedSettings.ppi,majorCell:{size_mm:new K({width:a.majorCell.size_mm.width,height:a.majorCell.size_mm.height}),lineWidth_mm:a.majorCell.lineWidth_mm},minorCell:{size_mm:new K({width:a.minorCell.size_mm.width,height:a.minorCell.size_mm.height}),lineWidth_mm:a.minorCell.lineWidth_mm}});else{if(!(a instanceof Ri))return;r=new Li({view:a.view,viewScale:{x:s.viewScale.x,y:s.viewScale.y},parentObj:n,parentHtmlObj:this.typedSettings.html.parent.ref,graphicHtmlParentObj:this,color:a.color,deviceScale:this.typedSettings.deviceScale,ppi:this.typedSettings.ppi,cellSize_mm:new K({width:a.cellSize_mm.width,height:a.cellSize_mm.height})})}if(void 0===r)return;const l=await o.create(r);void 0!==l&&(l.settings.name="Grid",n.addItem(l))}async initBorder(){var t;const e=this.getBorderSettings();if(void 0===e||!(e.obj instanceof Ei))return;const i=this.signalsBox.sectors[e.sector];if(void 0===i)return;const n=e.obj,s=null===(t=this.typedSettings.contentCreatorsMap)||void 0===t?void 0:t.get("border");if(void 0===s||void 0===this.typedSettings.html.ref)return;const a=await s.create(new ji({view:n.view,parentObj:i,parentHtmlObj:this.typedSettings.html.ref,graphicHtmlParentObj:this,hasStroke:!0,strokeColor:n.color}));void 0!==a&&(a.settings.name="Border",i.addItem(a))}initMeander(){var t,e;const i=this.getMeanderSettings();if(void 0===i||!(i.obj instanceof ki))return;const n=this.getSignalsSettings();if(void 0===n||!(n.obj instanceof fi))return;const s=this.getGridSettings();if(void 0===s||!(s.obj instanceof Ai))return;const a=this.getOrCreateSvgSectorPanel(i.sector);if(void 0===a)return;const o=i.obj,r=n.obj,l=s.obj,d=a.settings.sizeInPixels.width-o.location.x-o.size.width,c=l.getMajorCellSizeInMm();if(void 0===this.typedSignalsBoxSettings.scaleY.currValue)return;const h=this.typedSignalsBoxSettings.scaleY.currValue*r.viewScale.y/this.typedSignalsBoxSettings.unitsYtoMmConvertKoef;this.objectSettingsMap.set("Meander",o);const u=new Ae({location:new G({x:new N(d),y:new N(0)}),size:new J({width:new N(o.size.width),height:new N(c.height*h-1)}),parent:new Vt({ref:a,jagmHtml:a}),html:{parent:{ref:a.typedSettings.html.ref}},widthTop:o.size.widthTop,title:o.title,style:o.style}),g=new Fe(u);g.init(),this.contentMap.set("meander",g),void 0!==u.html.ref&&(u.html.ref.style.position="absolute"),g.setVisibility(null===(t=o.isVisible)||void 0===t||t),void 0===o.channelUnit&&this.typedSettings.dataSources.length>0&&this.typedSettings.dataSources[0].channels.length>0&&(o.channelUnit=li(this.typedSettings.dataSources[0].channels[0],this.typedSettings.dataSectionSettings));const f=`${o.unit}/${o.channelUnit}`,p=new fe(new ge({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new N(20)}),padding:new $({right:new N(20)}),parent:new it({ref:a})}));p.init(),this.contentMap.set("meanderLabelPanel",p),this.meanderLabel=new me(new Se({location:new G({x:new Z(1),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),margin:new $({right:new N(10)}),parent:new Vt({ref:p,jagmHtml:a}),html:{parent:{ref:a.typedSettings.html.ref}},title:`${this.typedSignalsBoxSettings.scaleY.currValue} ${f}`,fontSize:o.label.fontSize,fontFamily:o.label.fontFamily,color:o.label.color,isCentered:!1})),this.meanderLabel.init(),this.contentMap.set("meanderLabel",this.meanderLabel);const v=this.meanderLabel.typedSettings;let y;void 0!==v.html.ref&&(v.html.ref.style.userSelect="none",v.html.ref.style.position="absolute",v.html.ref.setAttribute("text-anchor","end")),this.meanderLabel.settings.name="MeanderLabel",p.items.add(this.meanderLabel),g.settings.name="Meander",a.items.add(g),p.settings.name="MeanderLabelPanel",a.items.add(p),this.meanderLabel.setVisibility(null===(e=o.isVisible)||void 0===e||e),this.objectContainerMap.set("Meander",a.items),this.sectorDataSourceMap.has(i.sector)?y=this.sectorDataSourceMap.get(i.sector):(y=new ht("data-sources"),this.sectorDataSourceMap.set(i.sector,y)),void 0!==y&&a.items.add(y)}getOrCreateSvgSectorPanel(t){const e=this.signalsBox.sectors[t];if(void 0===e)return;const i=e.items.findItem("SvgArea");if(void 0===i){const t=new ee(new qt({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new Vt({ref:e,jagmHtml:this}),html:{parent:{ref:this.typedSettings.html.ref}}}));return t.init(),t.settings.name="SvgArea",e.addItem(t),t}return i instanceof ee?i:void 0}}class Ti extends qt{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g;super(void 0===t?{}:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,deviceScale:t.deviceScale,ppi:t.ppi,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,absoluteLocation:t.html.parent.absoluteLocation}}}),this.viewScale={x:null!==(i=null===(e=null==t?void 0:t.viewScale)||void 0===e?void 0:e.x)&&void 0!==i?i:1,y:null!==(s=null===(n=null==t?void 0:t.viewScale)||void 0===n?void 0:n.y)&&void 0!==s?s:1},this.color=null!==(a=null==t?void 0:t.color)&&void 0!==a?a:[0,0,0,1],this.majorCell={size_mm:null!==(r=null===(o=null==t?void 0:t.majorCell)||void 0===o?void 0:o.size_mm)&&void 0!==r?r:new K,lineWidth_mm:null!==(d=null===(l=null==t?void 0:t.majorCell)||void 0===l?void 0:l.lineWidth_mm)&&void 0!==d?d:1,size_px:new K,lineWidth_px:1},this.minorCell={size_mm:null!==(h=null===(c=null==t?void 0:t.minorCell)||void 0===c?void 0:c.size_mm)&&void 0!==h?h:new K,lineWidth_mm:null!==(g=null===(u=null==t?void 0:t.minorCell)||void 0===u?void 0:u.lineWidth_mm)&&void 0!==g?g:1,size_px:new K,lineWidth_px:1},this.updateCellSize()}setPpi(t){const e=this.ppi==t;super.setPpi(t),e||this.updateCellSize()}updateCellSize(){const t=this.ppcm/10,e=t*this.viewScale.x,i=t*this.viewScale.y;this.majorCell.size_px.width=this.majorCell.size_mm.width*e,this.majorCell.size_px.height=this.majorCell.size_mm.height*i,this.majorCell.lineWidth_px=this.majorCell.lineWidth_mm*t,this.minorCell.size_px.width=this.minorCell.size_mm.width*e,this.minorCell.size_px.height=this.minorCell.size_mm.height*i,this.minorCell.lineWidth_px=this.minorCell.lineWidth_mm*t}}class Wi extends Lt{constructor(t){super(t),this.typedSettings=this.settings}init(){super.init();const t=x.convertWebglRgbaToHex(this.typedSettings.color),e=y(t)?t.data:"#000000",i=Bt("svg",["min-width",`${this.typedSettings.html.locationInPixels.x+this.typedSettings.sizeInPixels.width}`],["width",`${this.typedSettings.html.locationInPixels.x+this.typedSettings.sizeInPixels.width}`],["height",`${this.typedSettings.html.locationInPixels.y+this.typedSettings.sizeInPixels.height}`],["style","margin: 0px; position: absolute;"]);this.typedSettings.html.ref=i;const n=this.typedSettings.html.parent.ref;if(void 0!==n){const t=n.getElementsByTagName("canvas");t.length>0&&n.insertBefore(i,t[0])}const s=this.typedSettings.html.locationInPixels.x,a=this.typedSettings.html.locationInPixels.y,o=Wi.createPathString({shiftX:this.typedSettings.majorCell.size_px.width,shiftY:this.typedSettings.majorCell.size_px.height,widthLine:this.typedSettings.majorCell.lineWidth_px,width:this.typedSettings.sizeInPixels.width,height:this.typedSettings.sizeInPixels.height,startX:s,startY:a}),r=Wi.createPathString({shiftX:this.typedSettings.minorCell.size_px.width,shiftY:this.typedSettings.minorCell.size_px.height,widthLine:this.typedSettings.minorCell.lineWidth_px,width:this.typedSettings.sizeInPixels.width,height:this.typedSettings.sizeInPixels.height,startX:s,startY:a});this.pathMajorGrid=Bt("path",["d",o],["stroke",e],["stroke-width",`${this.typedSettings.majorCell.lineWidth_px}`]),this.pathMinorGrid=Bt("path",["d",r],["stroke",e],["stroke-width",`${this.typedSettings.minorCell.lineWidth_px}`]),this.backgroundRectangle=Bt("rect",["x","0px"],["y","0px"],["width",`${this.typedSettings.sizeInPixels.width}`],["height",`${this.typedSettings.sizeInPixels.height}`],["fill","transparent"],["stroke","transparent"],["style","margin: 0px; position: absolute;"]),i.appendChild(this.backgroundRectangle),i.appendChild(this.pathMajorGrid),i.appendChild(this.pathMinorGrid)}setDebugMode(t){super.setDebugMode(t),t instanceof At&&t.fillHtmlElements&&this.setBackgroundFillColor(t.boxFillColor)}async setDeviceScale(t){this.typedSettings.deviceScale!=t&&(this.typedSettings.deviceScale=t)}async setPpi(t){this.typedSettings.ppi!=t&&(super.setPpi(t),await this.createHtmlBorders())}setBackgroundFillColor(t){if(void 0===this.backgroundRectangle)return;const e=x.convertWebglRgbaToHex(t);y(e)&&this.backgroundRectangle.setAttribute("fill",e.data)}async createHtmlBorders(){await super.createHtmlBorders();const t=this.typedSettings.html.locationInPixels.x,e=this.typedSettings.html.locationInPixels.y,i={shiftX:this.typedSettings.majorCell.size_px.width,shiftY:this.typedSettings.majorCell.size_px.height,widthLine:this.typedSettings.majorCell.lineWidth_px,width:this.typedSettings.sizeInPixels.width,height:this.typedSettings.sizeInPixels.height,startX:t,startY:e},n={shiftX:this.typedSettings.minorCell.size_px.width,shiftY:this.typedSettings.minorCell.size_px.height,widthLine:this.typedSettings.minorCell.lineWidth_px,width:this.typedSettings.sizeInPixels.width,height:this.typedSettings.sizeInPixels.height,startX:t,startY:e},s=Wi.createPathString(i),a=Wi.createPathString(n);void 0!==this.typedSettings.html.ref&&(this.typedSettings.html.ref.setAttribute("min-width",`${this.typedSettings.html.locationInPixels.x+this.typedSettings.sizeInPixels.width}`),this.typedSettings.html.ref.setAttribute("width",`${this.typedSettings.html.locationInPixels.x+this.typedSettings.sizeInPixels.width}`),this.typedSettings.html.ref.setAttribute("height",`${this.typedSettings.html.locationInPixels.y+this.typedSettings.sizeInPixels.height}`)),void 0!==this.pathMajorGrid&&void 0!==this.pathMinorGrid&&(this.pathMajorGrid.setAttribute("d",s),this.pathMajorGrid.setAttribute("stroke-width",`${this.typedSettings.majorCell.lineWidth_px}`),this.pathMinorGrid.setAttribute("d",a),this.pathMinorGrid.setAttribute("stroke-width",`${this.typedSettings.minorCell.lineWidth_px}`))}static createPathString(t){var e;const i=t.shiftX,n=t.shiftY,s=i*Math.ceil(t.width/i),a=n*Math.ceil(t.height/n);let o=null!==(e=t.startPosX)&&void 0!==e?e:0,r=0,l=`M ${t.startX} ${t.startY} v ${t.height} M ${t.startX+t.width-t.widthLine/2} ${t.startY-t.widthLine/2} v ${t.height} M ${t.startX-t.widthLine/2} ${t.startY} h ${t.width} M ${t.startX} ${t.startY+t.height-t.widthLine/2} h ${t.width} `;for(;r<a;)r<t.height-1&&(l+=` M ${t.startX} ${t.startY+t.height-r} h ${t.width} `),r+=n;for(;o<s;)o<t.width&&(l+=` M ${t.startX+o} ${t.startY} v ${t.height} `),o+=i;return l}}class Xi{constructor(t){this.type=t.type}}class Hi{constructor(t){this.id_unit=t.id_unit,this.scale=t.scale,this.text=t.text}}class Ni{constructor(t){this.variantGroups=t.variantGroups}}class Gi extends Ni{constructor(t){var e,i;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.name=t.name,this.unit=t.unit,this.original=null===(i=t.original)||void 0===i||i,this.maxSignalCount=t.maxSignalCount,this.hasVariableIsoline=t.hasVariableIsoline,this.frequency=t.frequency,this.conversionSettings=t.conversionSettings}getCurrSignalsVariant(){const t=C("name","signals",this.variantGroups);if(void 0!==t)return C("name",t.currVariant,t.variants)}forEachSignalsVariant(t){const e=C("name","signals",this.variantGroups);if(void 0!==e)for(let i=0;i<e.variants.length;++i){t(e.variants[i])}}}class qi extends ni{constructor(t){super(t.name),this.signals=t.signals}}class $i extends Ni{constructor(t){var e,i,n;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.channels=null!==(i=t.channels)&&void 0!==i?i:[],this.marks=null!==(n=t.marks)&&void 0!==n?n:[]}}class Ki{constructor(t){this.id=t.id,this.name=t.name}}class Zi{constructor(t){var e,i,n;this.id=t.id,this.name=null!==(e=t.name)&&void 0!==e?e:null!==(i=t.title)&&void 0!==i?i:"",this.title=null!==(n=t.title)&&void 0!==n?n:this.name}}class Ji extends Ni{constructor(t){var e;super({variantGroups:null!==(e=t.variantGroups)&&void 0!==e?e:[]}),this.id=t.id,this.text=t.text,this.scale=t.scale}}class Qi extends Xi{constructor(t){super({type:"rhythm"}),this.id_sourceChannel=t.id_sourceChannel}}class tn{constructor(t){this.id=t.id,this.text=t.text,this.linkedPosition=t.linkedPosition,this.y=t.y,this.color=t.color,this.id_signal=t.id_signal}}class en{constructor(t){this.id=t.id,this.text=t.text,this.linkedPosition=t.linkedPosition,this.y=t.y,this.color=t.color,this.id_signal=t.id_signal}}class nn{constructor(t){this.id=t.id,this.type=t.type,this.fillType=t.fillType,this.color=t.color,this.id_isoline=t.id_isoline,this.pointCount=t.pointCount,this.title=t.title}copy(){return new nn({id:this.id,type:this.type,fillType:this.fillType,color:[...this.color],id_isoline:this.id_isoline,pointCount:this.pointCount,title:this.title})}}class sn{constructor(t){var e,i,n,s,a,o,r;this.id_dataSource=null!==(e=null==t?void 0:t.id_dataSource)&&void 0!==e?e:0,this.id=null!==(i=null==t?void 0:t.id)&&void 0!==i?i:0,this.y=null!==(n=null==t?void 0:t.y)&&void 0!==n?n:new N(0),this.height=null!==(s=null==t?void 0:t.height)&&void 0!==s?s:new Z(1),this.variantGroups=null!==(a=null==t?void 0:t.variantGroups)&&void 0!==a?a:[],this.showIsolines=null!==(o=null==t?void 0:t.showIsolines)&&void 0!==o&&o,this.unit=null==t?void 0:t.unit,this.scaleX=null==t?void 0:t.scaleX,this.scaleY=null==t?void 0:t.scaleY,this.isSynchronizedScaleX=null!==(r=null==t?void 0:t.isSynchronizedScaleX)&&void 0!==r&&r,this.frequency=null==t?void 0:t.frequency,this.filters=null==t?void 0:t.filters,this.selectedFiltersNames=null==t?void 0:t.selectedFiltersNames,this.defaultFilters=null==t?void 0:t.defaultFilters}getCurrSignalsVariant(){const t=C("name","signals",this.variantGroups);if(void 0!==t)return C("name",t.currVariant,t.variants)}forEachSignalsVariant(t){const e=C("name","signals",this.variantGroups);if(void 0!==e)for(let i=0;i<e.variants.length;++i){t(e.variants[i])}}}class an{constructor(t){var e,i,n;this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:0,this.channels=null!==(i=null==t?void 0:t.channels)&&void 0!==i?i:[],this.marks=null!==(n=null==t?void 0:t.marks)&&void 0!==n?n:[]}}class on{constructor(t){this.name=t.name,this.type=t.type,this.order=t.order,this.filterClass=t.filterClass,this.freq=t.freq,this.priority=t.priority}copy(){return new on({name:this.name,type:this.type,order:this.order,filterClass:this.filterClass,freq:this.freq,priority:this.priority})}}class rn{constructor(t){var e,i;this.id=t.id,this.y=t.y,this.color=null!==(e=t.color)&&void 0!==e?e:[0,0,0,1],this.updateBorder=null!==(i=t.updateBorder)&&void 0!==i?i:0}copy(){return new rn({id:this.id,y:this.y.copy(),color:[...this.color],updateBorder:this.updateBorder})}}class ln{constructor(t){var e;this.name=t.name,this.sector=ve(g,t.sector,g.Central),this.layerZ=null!==(e=t.layerZ)&&void 0!==e?e:0,this.settings=t.settings}}class dn{constructor(t){var e,i,n;this.name=t.name,this.currVariant=null!==(e=t.currVariant)&&void 0!==e?e:null!==(i=t.defaultVariant)&&void 0!==i?i:"",this.defaultVariant=null!==(n=t.defaultVariant)&&void 0!==n?n:this.currVariant,this.variants=t.variants}getCurrVariantInfo(){return C("name",this.currVariant,this.variants)}}class cn{constructor(t,e){this.begin=null!=t?t:0,this.end=null!=e?e:this.begin}}class hn{constructor(){this.sectors=[],this.isNeedNewSector=!0}clear(){this.sectors=[],this.sectorIndex=void 0,this.isNeedNewSector=!0}closeCurrSector(){0!=this.sectors.length&&(this.isNeedNewSector=!0)}add(t){if(!(t<0)){if(0==this.sectors.length)return this.sectors.push(new cn(t,t)),this.sectorIndex=0,void(this.isNeedNewSector=!1);if(this.isNeedNewSector||void 0===this.sectorIndex)if(this.isNeedNewSector=!1,this.sectors[this.sectors.length-1].end<t)this.sectors[this.sectors.length-1].end+1==t?(this.sectors[this.sectors.length-1].end=t,this.sectorIndex=this.sectors.length-1):(this.sectors.push(new cn(t,t)),this.sectorIndex=this.sectors.length-1);else{let e=this.sectors.length;for(let i=0;i<e;++i){if(this.sectors[i].begin>t){let n=!1;if(this.sectors[i-1].end+1==t&&(this.sectors[i-1].end=t,this.sectorIndex=i-1,n=!0),this.sectors[i].begin-1==t&&(this.sectors[i].begin=t,this.sectorIndex=i,n=!0),this.sectors[i-1].end==this.sectors[i].begin&&(this.sectorIndex=i-1,this.sectors[i-1].end=this.sectors[i].end,this.sectors.splice(i,1)),!n){this.sectors.push(new cn);for(let t=e;t>i;--t)this.sectors[t]=this.sectors[t-1];this.sectors[i]=new cn(t,t),this.sectorIndex=i,e++}break}if(this.sectors[i].begin<=t&&this.sectors[i].end>=t){this.sectorIndex=i;break}}}else this.sectors[this.sectorIndex].end=t}}}class un{constructor(t){this.settings=t,this.columns=new X(1),this.pointBuffer=new Float32Array,this.notNullSectors=new hn}init(){this.notNullSectors=new hn;const t=this.settings.plotSize.width,e=Math.ceil(t),i=this.settings.dataCount/e;this.columns=new X(e);let n=0,s=0;const a=4*e;this.pointBuffer=new Float32Array(a);let o=0;for(let r=0;r<e;++r){const t=i+s;let a=Math.floor(t);s=t-a,r==e-1&&(a=this.settings.dataCount-n),this.pointBuffer[o]=r,this.pointBuffer[o+2]=r,this.columns.addData({minY:null,maxY:null,x:r,allowedDataCount:a,dataCount:0,dataIndices:[{begin:-1,end:-1}]},f.Right),n+=a,o+=4}this.columns.reset()}putData(t,e){const i=this.columns.lastIndex,n=this.settings.isLastNull;if(this.settings.isLastNull=null==t,i<0){const i=this.columns.buffer[0];return i.minY=t,i.maxY=t,i.dataCount=1,i.dataIndices=[{begin:e,end:e+1}],this.notNullSectors.clear(),void this.columns.goToNext(f.Right)}const s=this.columns.buffer[i];if(0==i&&this.notNullSectors.closeCurrSector(),s.dataCount==s.allowedDataCount){this.columns.goToNext(f.Right);const i=this.columns.lastIndex,a=this.columns.buffer[i];let o=t,r=t;return null==t?n||this.notNullSectors.closeCurrSector():(null!=s.minY&&s.minY>t&&(r=s.minY),null!=s.maxY&&s.maxY<t&&(o=s.maxY)),null!=o&&null!=r&&(r-o<1&&(r=o+1),this.pointBuffer[4*i+1]=o,this.pointBuffer[4*i+3]=r,this.notNullSectors.add(i)),a.minY=o,a.maxY=r,a.dataCount=1,void(a.dataIndices=[{begin:e,end:e+1}])}let a=null,o=null;null==t?n||this.notNullSectors.closeCurrSector():(a=s.minY,o=s.maxY,(null==a||a>t)&&(a=t),(null==o||o<t)&&(o=t),null!=a&&null!=o&&(o-a<1&&(o=a+1),this.pointBuffer[4*i+1]=a,this.pointBuffer[4*i+3]=o,this.notNullSectors.add(i)),s.minY=a,s.maxY=o);const r=s.dataIndices[s.dataIndices.length-1];r.end==e?r.end=e+1:s.dataIndices.push({begin:e,end:e+1}),s.dataCount++}isNextPointGraphicBegin(){const t=this.columns.getNextIndex(f.Right);return t.bufferIndex==t.firstIndex}getCurrColumnIndex(){return this.columns.lastIndex}getCurrColumnDataIndex(){if(this.columns.lastIndex<0)return-1;const t=this.columns.buffer[this.columns.lastIndex];if(void 0===t||0==t.dataIndices.length)return-1;const e=t.dataIndices[t.dataIndices.length-1];return e.end<0?-1:e.end-1}getColumnIndex(t){const e=Math.floor(t);return e<0||e>=this.columns.actualLength?-1:e}getFirstNotNullColumnIndex(){const t=this.columns.buffer;for(let e=0;e<this.columns.actualLength;++e)if(null!=t[e].minY)return e;return-1}getLastNotNullColumnIndex(){const t=this.columns.buffer;for(let e=this.columns.actualLength-1;e>=0;--e)if(null!=t[e].minY)return e;return-1}getColumn(t){if(!(t<0||t>=this.columns.actualLength))return this.columns.buffer[t]}getColumnIndexByDataIndex(t){const e=this.columns.buffer;for(let i=0;i<this.columns.actualLength;++i){const n=e[i].dataIndices;for(let e=0;e<n.length;++e)if(n[e].begin<=t&&n[e].end>t)return i}return-1}getNextColumnIndex(){return this.columns.getNextIndex(f.Right).bufferIndex}}!function(t){t[t.Period=0]="Period",t[t.Custom=1]="Custom"}(Xe||(Xe={}));class gn{constructor(t){var e,i,n,s,a;this.dataCount=null==t?void 0:t.dataCount,this.frequency=null==t?void 0:t.frequency,this.plotSize=null!==(e=null==t?void 0:t.plotSize)&&void 0!==e?e:new K,this.isDataSync=null===(i=null==t?void 0:t.isDataSync)||void 0===i||i,this.dataBufferSize=null==t?void 0:t.dataBufferSize,this.dataContainer=null==t?void 0:t.dataContainer,this.fillType=null!==(n=null==t?void 0:t.fillType)&&void 0!==n?n:Xe.Period,this.ppmm=null!==(s=null==t?void 0:t.ppmm)&&void 0!==s?s:0,this.scaleX=null!==(a=null==t?void 0:t.scaleX)&&void 0!==a?a:0,this.isCustomX=this.fillType==Xe.Custom}}class fn{constructor(t){this.settings=t,this.pixelsPerPoint=0,this.points=new X(1),this.pointBuffer=new Float32Array,this.notNullSectors=new hn,this.isStartLine=!1,this.lastPoint=null,this.isStartWithLast=!1}init(){this.notNullSectors=new hn;const t=this.settings.dataCount<0?1:this.settings.dataCount;this.points=new X(t);const e=this.settings.plotSize.width;this.pixelsPerPoint=e/(this.settings.dataCount-1),this.pointBuffer=new Float32Array(4*(this.points.length-1));let i=0,n=0;if(this.settings.isCustomX)for(let s=0;s<this.points.length;++s,n+=4)this.pointBuffer[n]=i,i+=this.pixelsPerPoint,i>e&&(i=e-1),this.pointBuffer[n+2]=i,this.points.addData({x:i,y:0,dataIndex:-1},f.Right);else for(let s=0;s<this.points.length;++s,n+=4)this.pointBuffer[n]=0,this.pointBuffer[n+2]=0,this.points.addData({x:0,y:0,dataIndex:-1},f.Right);this.points.reset(),this.isStartLine=!1,this.lastPoint=null}putData(t,e,i){var n,s;const a=this.points.lastIndex,o=this.points.getNextIndex(f.Right).bufferIndex;if(this.settings.isCustomX&&void 0!==i&&(this.points.buffer[o].x=i),this.points.buffer[o].y=null!=t?t:0,this.points.buffer[o].dataIndex=e,this.points.goToNext(f.Right),a<0)this.notNullSectors.clear(),null!=t&&(this.isStartLine=!0),this.isStartWithLast=!1;else if(0==a)this.notNullSectors.closeCurrSector(),null!=t?null==this.lastPoint?(this.isStartLine=!0,this.isStartWithLast=!1):(this.pointBuffer[1]=null!==(n=this.lastPoint.y)&&void 0!==n?n:0,this.pointBuffer[3]=t,this.settings.isCustomX&&(this.pointBuffer[0]=this.lastPoint.x,this.pointBuffer[2]=null!=i?i:this.lastPoint.x),this.notNullSectors.add(0),this.isStartWithLast=!this.isStartLine,this.isStartLine=!1):this.isStartLine=!1;else if(null!=t){let e=o;if(this.isStartWithLast||e--,this.notNullSectors.add(e),null==this.lastPoint)this.isStartLine=!0;else{const n=4*e;this.pointBuffer[n+1]=null!==(s=this.lastPoint.y)&&void 0!==s?s:0,this.pointBuffer[n+3]=t,this.settings.isCustomX&&(this.pointBuffer[n]=this.lastPoint.x,this.pointBuffer[n+2]=null!=i?i:this.lastPoint.x),this.isStartLine=!1}}else null!=this.lastPoint&&this.notNullSectors.closeCurrSector(),this.isStartLine=!1;this.lastPoint=null==t?null:this.points.buffer[o]}isNextPointGraphicBegin(){const t=this.points.getNextIndex(f.Right);return t.bufferIndex==t.firstIndex}getCurrPointIndex(){return this.points.lastIndex}getPointIndex(t){const e=this.pointBuffer.length/4;let i=0,n=e-1,s=0;for(;i<=n;){if(s=i+Math.floor((n-i)/2),this.pointBuffer[4*s]<=t&&this.pointBuffer[4*s+2]>=t){return t>=this.pointBuffer[4*s]+.5*(this.pointBuffer[4*s+2]-this.pointBuffer[4*s])&&s<e-1?s+1:s}this.pointBuffer[4*s+2]<t?i=s+1:n=s-1}return-1}getFirstNotNullPointIndex(){const t=this.points.buffer;for(let e=0;e<t.length;++e)if(null!=t[e].y)return e;return-1}getLastNotNullPointIndex(){const t=this.points.buffer;for(let e=t.length-1;e>=0;--e)if(null!=t[e].y)return e;return-1}getPoint(t){if(!(t<0||t>=this.points.buffer.length))return this.points.buffer[t]}getPointIndexByDataIndex(t){const e=this.points.buffer;for(let i=0;i<e.length;++i)if(e[i].dataIndex==t)return i;return-1}}class pn{constructor(t){var e,i;this.frequency=null!==(e=null==t?void 0:t.frequency)&&void 0!==e?e:0,this.width=null!==(i=null==t?void 0:t.width)&&void 0!==i?i:0}calculate(t){return Math.ceil(this.frequency*this.width/t)}}class vn{constructor(t){var e;this.dataCount=null!==(e=null==t?void 0:t.dataCount)&&void 0!==e?e:0}calculate(t){return Math.ceil(this.dataCount/t)}}class yn{constructor(t){this.settings=t,this.dataCounter=new vn({dataCount:0}),this.isColumnMode=!1}init(){var t;this.settings.isDataSync||void 0===this.settings.dataContainer||this.settings.dataContainer.reset(null!==(t=this.settings.dataBufferSize)&&void 0!==t?t:0,null),this.createBuffers()}isNextPointGraphicBegin(){return this.isColumnMode?void 0!==this.columnContainer&&this.columnContainer.isNextPointGraphicBegin():void 0!==this.pointContainer&&this.pointContainer.isNextPointGraphicBegin()}getNotNullSectors(){return this.isColumnMode?void 0===this.columnContainer?new hn:this.columnContainer.notNullSectors:void 0===this.pointContainer?new hn:this.pointContainer.notNullSectors}getPointX(t){if(this.isColumnMode){if(void 0===this.columnContainer)return null;const e=this.columnContainer.getColumnIndexByDataIndex(t);if(e<0)return null;const i=this.columnContainer.getColumn(e);return void 0===i?null:i.x}{if(void 0===this.pointContainer)return null;const e=this.pointContainer.getPointIndexByDataIndex(t);if(e<0)return null;const i=this.pointContainer.getPoint(e);return void 0===i?null:i.x}}getCurrPointX(){if(this.isColumnMode){if(void 0===this.columnContainer)return null;const t=this.columnContainer.getCurrColumnIndex();if(t<0)return null;const e=this.columnContainer.getColumn(t);return void 0===e?null:e.x}{if(void 0===this.pointContainer)return null;const t=this.pointContainer.getCurrPointIndex();if(t<0)return null;const e=this.pointContainer.getPoint(t);return void 0===e?null:e.x}}getVertextBuffer(){return this.isColumnMode?void 0===this.columnContainer?new Float32Array([]):this.columnContainer.pointBuffer:void 0===this.pointContainer?new Float32Array([]):this.pointContainer.pointBuffer}getCurrDataIndex(){if(this.isColumnMode)return void 0===this.columnContainer?-1:this.columnContainer.getCurrColumnDataIndex();{if(void 0===this.pointContainer)return-1;const t=this.pointContainer.getCurrPointIndex();if(t<0)return-1;const e=this.pointContainer.getPoint(t);return void 0===e?-1:e.dataIndex}}getDataIndex(t){if(this.isColumnMode){if(void 0===this.columnContainer)return-1;const e=this.columnContainer.getColumnIndex(t);if(e<0)return-1;const i=this.columnContainer.getColumn(e);return void 0===i||0==i.dataIndices.length?-1:i.dataIndices[0].begin}{if(void 0===this.pointContainer)return-1;const e=this.pointContainer.getPointIndex(t);if(e<0)return-1;const i=this.pointContainer.getPoint(e);return void 0===i?-1:i.dataIndex}}getLastDataIndex(t){if(this.isColumnMode){if(void 0===this.columnContainer)return-1;const e=this.columnContainer.getColumnIndex(t);if(e<0)return-1;const i=this.columnContainer.getColumn(e);return void 0===i||0==i.dataIndices.length?-1:i.dataIndices[0].end-1}{if(void 0===this.pointContainer)return-1;const e=this.pointContainer.getPointIndex(t);if(e<0)return-1;const i=this.pointContainer.getPoint(e);return void 0===i?-1:i.dataIndex}}getLastValidGraphicDataIndex(){if(this.isColumnMode){if(void 0===this.columnContainer)return-1;const t=this.columnContainer.getLastNotNullColumnIndex();if(t<0)return-1;const e=this.columnContainer.getColumn(t);return void 0===e||0==e.dataIndices.length?-1:e.dataIndices[e.dataIndices.length-1].end-1}{if(void 0===this.pointContainer)return-1;const t=this.pointContainer.getLastNotNullPointIndex();if(t<0)return-1;const e=this.pointContainer.getPoint(t);return void 0===e?-1:e.dataIndex}}pushLocatedDataArray(t){if(0==t.length||void 0===this.settings.dataContainer)return[];if(this.isColumnMode){if(void 0===this.columnContainer)return[];if(this.columnContainer.settings.dataCount<=t.length){for(let e=0;e<t.length;++e){this.settings.dataContainer.add(t[e].y);const i=this.settings.dataContainer.getCurrDataIndex(),n=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(n,i)}return[{begin:0,end:this.columnContainer.columns.length}]}{this.settings.dataContainer.add(t[0].y);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(i,e);const n=this.columnContainer.getCurrColumnIndex();for(let a=1;a<t.length;++a){this.settings.dataContainer.add(t[a].y);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(i,e)}const s=this.columnContainer.getCurrColumnIndex()+1;return n>=s?[{begin:0,end:s},{begin:n,end:this.columnContainer.columns.length}]:[{begin:n,end:s}]}}if(void 0===this.pointContainer)return[];if(this.pointContainer.settings.dataCount<=t.length){for(let e=0;e<t.length;++e){this.settings.dataContainer.add(t[e].y);const i=this.settings.dataContainer.getCurrDataIndex(),n=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(n,i,t[e].x)}return[{begin:0,end:this.pointContainer.points.length}]}{this.settings.dataContainer.add(t[0].y);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(i,e,t[0].x);let n=this.pointContainer.getCurrPointIndex()-1;n<0&&(n=0);for(let a=1;a<t.length;++a){this.settings.dataContainer.add(t[a].y);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(i,e,t[a].x)}const s=this.pointContainer.getCurrPointIndex()+1;return n>=s?[{begin:0,end:s},{begin:n,end:this.pointContainer.points.length}]:[{begin:n,end:s}]}}pushDataArray(t){if(0==t.length||void 0===this.settings.dataContainer)return[];if(this.isColumnMode){if(void 0===this.columnContainer)return[];if(this.columnContainer.settings.dataCount<t.length){for(let e=t.length-this.columnContainer.settings.dataCount-1;e<t.length;++e){this.settings.dataContainer.add(t[e]);const i=this.settings.dataContainer.getCurrDataIndex(),n=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(n,i)}return[{begin:0,end:this.columnContainer.columns.length}]}{this.settings.dataContainer.add(t[0]);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(i,e);const n=this.columnContainer.getCurrColumnIndex();for(let a=1;a<t.length;++a){this.settings.dataContainer.add(t[a]);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.columnContainer.putData(i,e)}const s=this.columnContainer.getCurrColumnIndex()+1;return n>=s?[{begin:0,end:s},{begin:n,end:this.columnContainer.columns.length}]:[{begin:n,end:s}]}}if(void 0===this.pointContainer)return[];if(this.pointContainer.settings.dataCount<=t.length){for(let e=0;e<t.length;++e){this.settings.dataContainer.add(t[e]);const i=this.settings.dataContainer.getCurrDataIndex(),n=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(n,i)}return[{begin:0,end:this.pointContainer.points.length}]}{this.settings.dataContainer.add(t[0]);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(i,e);let n=this.pointContainer.getCurrPointIndex()-1;n<0&&(n=0);for(let a=1;a<t.length;++a){this.settings.dataContainer.add(t[a]);const e=this.settings.dataContainer.getCurrDataIndex(),i=this.settings.dataContainer.getCurrDataInPx();this.pointContainer.putData(i,e)}const s=this.pointContainer.getCurrPointIndex()+1;return n>=s?[{begin:0,end:s},{begin:n,end:this.pointContainer.points.length}]:[{begin:n,end:s}]}}pushData(t,e){var i,n;if(void 0===this.settings.dataContainer)return;this.settings.dataContainer.add(t);const s=this.settings.dataContainer.getCurrDataIndex(),a=this.settings.dataContainer.getCurrDataInPx();this.isColumnMode?null===(i=this.columnContainer)||void 0===i||i.putData(a,s):null===(n=this.pointContainer)||void 0===n||n.putData(a,s,e)}updatePixelsValues(){this.isColumnMode?this.updatePixelsColumnsValues():this.updatePixelsPointsValues()}createBuffers(){var t;if(void 0===this.settings.dataContainer)return;this.settings.fillType==Xe.Period?this.dataCounter=new pn({frequency:this.settings.frequency,width:this.settings.plotSize.width}):this.dataCounter=new vn({dataCount:this.settings.dataCount});const e=Math.ceil(this.settings.plotSize.width),i=this.dataCounter.calculate(this.settings.ppmm*this.settings.scaleX);if(this.isColumnMode=i>=e,this.settings.isDataSync&&this.settings.dataContainer.reset(i),this.isColumnMode){const t=this.settings.dataContainer.getCurrData();this.columnContainer=new un({dataCount:i,plotSize:this.settings.plotSize,isDataSync:this.settings.isDataSync,isLastNull:null==t}),this.columnContainer.init()}else this.pointContainer=new fn({dataCount:i,plotSize:this.settings.plotSize,isDataSync:this.settings.isDataSync,isCustomX:null!==(t=this.settings.isCustomX)&&void 0!==t&&t}),this.pointContainer.init()}updatePixelsColumnsValues(){if(void 0===this.settings.dataContainer||void 0===this.pointContainer||void 0===this.columnContainer)return;const t=this.settings.dataContainer;if(0==t.length)return;const e=this.columnContainer.columns.buffer.length;let i=t.getDataInPx(0);for(let n=0;n<e;++n){const e=this.columnContainer.columns.buffer[n];let s=!0;for(let a=0;a<e.dataIndices.length;++a){const o=e.dataIndices[a];for(let a=o.begin;a<o.end;++a){if(i=t.getDataInPx(a),s){if(e.minY=i,e.maxY=i,n>0){const t=this.columnContainer.columns.buffer[n-1];null!=t.minY&&null!=i&&t.minY>i?e.maxY=t.minY:e.maxY=i,null!=t.maxY&&null!=i&&t.maxY<i?e.minY=t.maxY:e.minY=i}s=!1}else(null==e.minY||null!=i&&e.minY>i)&&(e.minY=i),(null==e.maxY||null!=i&&e.maxY<i)&&(e.maxY=i);null!=e.minY&&null!=e.maxY&&(e.maxY-e.minY<1&&(e.maxY=e.minY+1),this.pointContainer.pointBuffer[4*n+1]=e.minY,this.pointContainer.pointBuffer[4*n+3]=e.maxY)}}}}updatePixelsPointsValues(){if(void 0===this.settings.dataContainer||void 0===this.pointContainer)return;const t=this.settings.dataContainer;if(0==t.length)return;const e=t.getCurrDataIndex();let i=null;if(e<0)this.pointContainer.lastPoint={x:0,y:null,dataIndex:-1};else{i=t.getCurrDataInPx();let n=0;const s=this.pointContainer.getPointIndexByDataIndex(e);if(s>=0){const t=this.pointContainer.getPoint(s);void 0!==t&&(n=t.x)}this.pointContainer.lastPoint={x:n,y:i,dataIndex:e}}let n=t.getDataInPx(0);this.pointContainer.isStartWithLast&&(this.pointContainer.pointBuffer[1]=null!=i?i:0,this.pointContainer.pointBuffer[3]=null!=n?n:0),i=n;for(let s=1;s<t.length;++s){if(n=t.getDataInPx(s),null!=n){let t=s;if(this.pointContainer.isStartWithLast||t--,null!=i){const e=4*t;this.pointContainer.pointBuffer[e+1]=i,this.pointContainer.pointBuffer[e+3]=n}}i=n}}}class mn extends yn{constructor(t){super(t),this.typedSettings=this.settings,void 0!==this.settings.dataContainer&&(this.typedDataContainer=this.settings.dataContainer),this.isoline=null,this.newIsoline=null}pushLocatedDataArray(t){if(0==t.length||void 0===this.typedDataContainer)return[];const e=this.typedDataContainer;if(this.isColumnMode){if(void 0===this.columnContainer)return[];if(this.columnContainer.settings.dataCount<=t.length){for(let i=0;i<t.length;++i){e.add(t[i].y);const n=e.getCurrDataIndex();e.addFilteredData(t[i].y);const s=e.getCurrFilteredDataInPx();this.columnContainer.putData(s,n)}return[{begin:0,end:this.columnContainer.columns.length}]}{e.add(t[0].y);let i=e.getCurrDataIndex();e.addFilteredData(t[0].y);let n=e.getCurrFilteredDataInPx();this.columnContainer.putData(n,i);const s=this.columnContainer.getCurrColumnIndex();for(let o=1;o<t.length;++o)e.add(t[o].y),i=e.getCurrDataIndex(),e.addFilteredData(t[o].y),n=e.getCurrFilteredDataInPx(),this.columnContainer.putData(n,i);const a=this.columnContainer.getCurrColumnIndex()+1;return s>=a?[{begin:0,end:a},{begin:s,end:this.columnContainer.columns.length}]:[{begin:s,end:a}]}}if(void 0===this.pointContainer)return[];if(this.pointContainer.settings.dataCount<=t.length){for(let i=0;i<t.length;++i){e.add(t[i].y);const n=e.getCurrDataIndex();e.addFilteredData(t[i].y);const s=e.getCurrFilteredDataInPx();this.pointContainer.putData(s,n,t[i].x)}return[{begin:0,end:this.pointContainer.points.length}]}{e.add(t[0].y);let i=e.getCurrDataIndex();e.addFilteredData(t[0].y);let n=e.getCurrFilteredDataInPx();this.pointContainer.putData(n,i,t[0].x);let s=this.pointContainer.getCurrPointIndex()-1;s<0&&(s=0);for(let o=1;o<t.length;++o)e.add(t[o].y),i=e.getCurrDataIndex(),e.addFilteredData(t[o].y),n=e.getCurrFilteredDataInPx(),this.pointContainer.putData(n,i,t[o].x);const a=this.pointContainer.getCurrPointIndex()+1;return s>=a?[{begin:0,end:a},{begin:s,end:this.pointContainer.points.length}]:[{begin:s,end:a}]}}pushDataArray(t){if(0==t.length||void 0===this.typedDataContainer)return[];const e=this.typedDataContainer;if(this.isColumnMode){if(void 0===this.columnContainer)return[];if(this.columnContainer.settings.dataCount<t.length){for(let i=0;i<t.length;++i){e.add(t[i]);const n=e.getCurrDataIndex();e.addFilteredData(t[i]);const s=e.getCurrFilteredDataInPx();this.columnContainer.putData(s,n)}return[{begin:0,end:this.columnContainer.columns.length}]}{e.add(t[0]);const i=e.getCurrDataIndex();e.addFilteredData(t[0]);const n=e.getCurrFilteredDataInPx();this.columnContainer.putData(n,i);const s=this.columnContainer.getCurrColumnIndex();for(let o=1;o<t.length;++o){e.add(t[o]);const i=e.getCurrDataIndex();e.addFilteredData(t[o]);const n=e.getCurrFilteredDataInPx();this.columnContainer.putData(n,i)}const a=this.columnContainer.getCurrColumnIndex()+1;return s>=a?[{begin:0,end:a},{begin:s,end:this.columnContainer.columns.length}]:[{begin:s,end:a}]}}if(void 0===this.pointContainer)return[];if(this.pointContainer.settings.dataCount<=t.length){for(let i=0;i<t.length;++i){e.add(t[i]);const n=e.getCurrDataIndex();e.addFilteredData(t[i]);const s=e.getCurrFilteredDataInPx();this.pointContainer.putData(s,n)}return[{begin:0,end:this.pointContainer.points.length}]}{e.add(t[0]);const i=e.getCurrDataIndex();e.addFilteredData(t[0]);const n=e.getCurrFilteredDataInPx();this.pointContainer.putData(n,i);let s=this.pointContainer.getCurrPointIndex()-1;s<0&&(s=0);for(let o=1;o<t.length;++o){e.add(t[o],!1);const i=e.getCurrDataIndex();e.addFilteredData(t[o]);const n=e.getCurrFilteredDataInPx();this.pointContainer.putData(n,i)}const a=this.pointContainer.getCurrPointIndex()+1;return s>=a?[{begin:0,end:a},{begin:s,end:this.pointContainer.points.length}]:[{begin:s,end:a}]}}pushData(t,e){var i,n;if(void 0===this.typedDataContainer)return;const s=this.typedDataContainer;s.add(t,!1);const a=s.getCurrDataIndex();s.addFilteredData(t);const o=s.getCurrFilteredDataInPx();this.isColumnMode?null===(i=this.columnContainer)||void 0===i||i.putData(o,a):null===(n=this.pointContainer)||void 0===n||n.putData(o,a,e)}async updatePixelsValues(){this.isColumnMode?await this.updatePixelsColumnsValues():await this.updatePixelsPointsValues()}async updateFilteredValues(){this.isColumnMode?await this.updateFilteredColumnsValues():await this.updateFilteredPointsValues()}async updatePixelsColumnsValues(){var t,e;const i=this.typedDataContainer;if(void 0===i||void 0===this.columnContainer||0==i.length)return;const n=this.columnContainer.columns.buffer.length;let s=!1;this.isoline=null;for(let a=0;a<n;++a){const n=this.columnContainer.columns.buffer[a];let o=!0;for(let r=0;r<n.dataIndices.length;++r){const l=n.dataIndices[r];for(let r=l.begin;r<l.end;++r){const l=i.getFilteredDataInPx(r),d=i.getFilteredData(r);if(o){if(n.minY=l,n.maxY=l,a>0){const t=this.columnContainer.columns.buffer[a-1];null!=t.minY&&null!=l&&t.minY>l?n.maxY=t.minY:n.maxY=l,null!=t.maxY&&null!=l&&t.maxY<l?n.minY=t.maxY:n.minY=l}o=!1}else null!=l&&((null==n.minY||n.minY>l)&&(n.minY=l),(null==n.maxY||n.maxY<l)&&(n.maxY=l));null!=d&&void 0!==this.typedSettings.isolineCalculator&&(s?(this.typedSettings.isolineCalculator.reset(d),this.newIsoline=d,s=!0):this.newIsoline=this.typedSettings.isolineCalculator.calculate(d)),null!=n.maxY&&null!=n.minY&&n.maxY-n.minY<1&&(n.maxY=n.minY+1),this.columnContainer.pointBuffer[4*a+1]=null!==(t=n.minY)&&void 0!==t?t:0,this.columnContainer.pointBuffer[4*a+3]=null!==(e=n.maxY)&&void 0!==e?e:0}}}s&&(this.isoline=this.newIsoline,void 0!==this.typedSettings.onIsolineChanged&&await this.typedSettings.onIsolineChanged(this.isoline))}async updatePixelsPointsValues(){const t=this.typedDataContainer;if(void 0===t||void 0===this.pointContainer||0==t.length)return;let e=!1;this.isoline=null;const i=t.getCurrFilteredDataIndex();let n=null;if(i<0)this.pointContainer.lastPoint={x:0,y:null,dataIndex:-1};else{n=t.getCurrFilteredDataInPx();let e=0;const s=this.pointContainer.getPointIndexByDataIndex(i);if(s>=0){const t=this.pointContainer.getPoint(s);void 0!==t&&(e=t.x)}this.pointContainer.lastPoint={x:e,y:n,dataIndex:i}}let s=t.getFilteredDataInPx(0),a=t.getFilteredData(0);this.pointContainer.isStartWithLast&&(this.pointContainer.pointBuffer[1]=null!=n?n:0,this.pointContainer.pointBuffer[3]=null!=s?s:0),null!=a&&void 0!==this.typedSettings.isolineCalculator&&(this.typedSettings.isolineCalculator.reset(a),this.newIsoline=a,e=!0),n=s;for(let o=1;o<t.length;++o){if(s=t.getFilteredDataInPx(o),a=t.getFilteredData(o),null!=s){let t=o;if(this.pointContainer.isStartWithLast||t--,null!=n){const e=4*t;this.pointContainer.pointBuffer[e+1]=n,this.pointContainer.pointBuffer[e+3]=s}}null!=a&&void 0!==this.typedSettings.isolineCalculator&&(e?(this.typedSettings.isolineCalculator.reset(a),this.newIsoline=a,e=!0):this.newIsoline=this.typedSettings.isolineCalculator.calculate(a)),n=s}e&&(this.isoline=this.newIsoline,void 0!==this.typedSettings.onIsolineChanged&&await this.typedSettings.onIsolineChanged(this.isoline))}async updateFilteredColumnsValues(){const t=this.typedDataContainer;if(void 0===t||void 0===this.columnContainer||0==t.length)return;let e=!1;this.isoline=null,this.columnContainer.notNullSectors.clear(),t.resetFilteredData();for(let i=0;i<t.dataBuffer.actualLength;++i){const n=t.dataBuffer.beginIndex+i,s=t.getData(t.dataBuffer.beginIndex+n);t.addFilteredData(s);const a=this.columnContainer.getColumnIndexByDataIndex(n),o=t.getCurrFilteredDataInPx();null!=s?(this.columnContainer.notNullSectors.add(a),null!=this.typedSettings.isolineCalculator&&(e?(this.typedSettings.isolineCalculator.reset(s),this.newIsoline=s,e=!0,this.columnContainer.notNullSectors.add(0)):this.newIsoline=this.typedSettings.isolineCalculator.calculate(s))):this.columnContainer.notNullSectors.closeCurrSector(),this.columnContainer.putData(o,n)}e&&(this.isoline=this.newIsoline,void 0!==this.typedSettings.onIsolineChanged&&await this.typedSettings.onIsolineChanged(this.isoline))}async updateFilteredPointsValues(){var t,e;const i=this.typedDataContainer;if(void 0===i||void 0===this.pointContainer||0==i.length)return;let n=!1;this.isoline=null,this.pointContainer.notNullSectors.clear(),i.resetFilteredData();for(let s=0;s<i.dataBuffer.actualLength;++s){const a=i.dataBuffer.beginIndex+s,o=i.getData(i.dataBuffer.beginIndex+a);i.addFilteredData(o);const r=i.getCurrFilteredDataInPx(),l=this.pointContainer.getPointIndexByDataIndex(a),d=null!==(e=null===(t=this.pointContainer.getPoint(l))||void 0===t?void 0:t.x)&&void 0!==e?e:void 0;null!=o?(this.pointContainer.notNullSectors.add(l),void 0!==this.typedSettings.isolineCalculator&&(n?(this.typedSettings.isolineCalculator.reset(o),this.newIsoline=o,n=!0,this.pointContainer.notNullSectors.add(0)):this.newIsoline=this.typedSettings.isolineCalculator.calculate(o))):this.pointContainer.notNullSectors.closeCurrSector(),this.pointContainer.putData(r,a,d)}n&&(this.isoline=this.newIsoline,void 0!==this.typedSettings.onIsolineChanged&&await this.typedSettings.onIsolineChanged(this.isoline))}}class Sn{constructor(t){var e;this.plotSize=null!==(e=null==t?void 0:t.plotSize)&&void 0!==e?e:new K}}class wn{constructor(t){var e,i,n;this.plotSize=null!==(e=null==t?void 0:t.plotSize)&&void 0!==e?e:new K,this.dataContainer=null==t?void 0:t.dataContainer,this.ppmm=null!==(i=null==t?void 0:t.ppmm)&&void 0!==i?i:0,this.scaleX=null!==(n=null==t?void 0:t.scaleX)&&void 0!==n?n:0}}class xn{constructor(t){this.settings=t,this.columnMaxLength=0,this.columns=[],this.vertexBufferLength=0,this.indexBufferLength=0,this.vertexBuffer=new Float32Array,this.indexBuffer=new Uint16Array,this.currColumnIndex=-1}init(){const t=this.settings.plotSize.width;this.columnMaxLength=Math.floor(t),this.columns=[],this.currColumnIndex=-1;const e=[];e.length=8*this.columnMaxLength,e.fill(0);const i=[];i.length=4*this.columnMaxLength,i.fill(0),this.vertexBufferLength=e.length,this.indexBufferLength=i.length,this.vertexBuffer=new Float32Array(e),this.indexBuffer=new Uint16Array(i)}get isFullLength(){if(0==this.columns.length)return!1;const t=this.columns[this.columns.length-1];return t.x+t.width>=this.columnMaxLength}clear(){this.columns=[]}forEachColumn(t){for(let e=0;e<this.columns.length;++e)t(this.columns[e])}addMultipleData(t,e,i,n){if(t<0||t>this.columnMaxLength||e<=0)return[];if(t+e>this.columnMaxLength&&(e=this.columnMaxLength-t),null==i)return this.remove(t,e);const s=[],a=Math.floor(t),o=Math.ceil(t+e);if(0==this.columns.length)return this.currColumnIndex=0,this.columns.push({vertexIndexBegin:a,vertexIndexEnd:o,x:t,width:e,height:i,dataCount:1,dataIndices:[{begin:n.begin,end:n.end}]}),this.setRectDataToBuffers(a,t,e,i),this.pushToUpdateRanges(a,s),s;const r=this.getColumnIndex(a);if(void 0===r){let r;for(let t=0;t<this.columns.length&&this.columns[t].vertexIndexBegin<a;++t)r=t;let l=0;if(void 0!==r){l=r+1;const e=this.columns[r];e.x+e.width>t&&(e.width=t-e.x,e.vertexIndexEnd=Math.ceil(e.x+e.width))}for(let i=this.columns.length-1;i>=0;--i){const n=this.columns[i];if(n.x<t+e&&n.x>=t)if(n.x+n.width>t+e){const i=n.x+n.width,s=i-t-e;n.width=s,n.x=i-s,n.vertexIndexBegin=Math.floor(n.x),n.vertexIndexEnd=Math.ceil(n.x+n.width)}else this.columns.splice(i,1)}return this.currColumnIndex=l,this.insertColumn(l,{vertexIndexBegin:a,vertexIndexEnd:o,x:t,width:e,height:i,dataCount:1,dataIndices:[{begin:n.begin,end:n.end}]}),this.pushToUpdateRanges(a,s),s}const l=this.columns[r];if(l.x+l.width>t+e){const i=l.x+l.width,n=i-t-e,a=Math.floor(i-n);this.currColumnIndex=r+1,this.insertColumn(r+1,{vertexIndexBegin:a,vertexIndexEnd:Math.ceil(i),x:i-n,width:n,height:l.height,dataCount:1,dataIndices:[...l.dataIndices]}),this.pushToUpdateRanges(a,s)}for(let c=this.columns.length-1;c>r;--c){const i=this.columns[c];if(i.x<t+e&&i.x>=t)if(i.x+i.width>t+e){const n=i.x+i.width,s=n-t-e;i.width=s,i.x=n-s,i.vertexIndexBegin=Math.floor(this.columns[c].x),i.vertexIndexEnd=Math.ceil(this.columns[c].x+this.columns[c].width)}else this.currColumnIndex==c&&this.currColumnIndex--,this.columns.splice(c,1)}l.x=t,l.width=e,l.vertexIndexEnd=Math.ceil(t+e),l.height=i;const d=l.dataIndices[l.dataIndices.length-1];return d.begin<0&&(d.begin=n.begin),d.end=n.end,this.setRectDataToBuffers(l.vertexIndexBegin,l.x,l.width,l.height),this.pushToUpdateRanges(l.vertexIndexBegin,s),s}add(t,e,i,n){if(t<0||t>this.columnMaxLength||e<=0)return[];if(t+e>this.columnMaxLength&&(e=this.columnMaxLength-t),null==i)return this.remove(t,e);const s=[],a=Math.floor(t),o=Math.ceil(t+e);if(0==this.columns.length)return this.currColumnIndex=0,this.columns.push({vertexIndexBegin:a,vertexIndexEnd:o,x:t,width:e,height:i,dataCount:1,dataIndices:[{begin:n,end:n+1}]}),this.setRectDataToBuffers(a,t,e,i),this.pushToUpdateRanges(a,s),s;const r=this.getColumnIndex(a);if(void 0===r){let r;for(let t=0;t<this.columns.length&&this.columns[t].vertexIndexBegin<a;++t)r=t;let l=0;if(void 0!==r){l=r+1;const e=this.columns[r];e.x+e.width>t&&(e.width=t-e.x,e.vertexIndexEnd=Math.ceil(e.x+e.width))}for(let i=this.columns.length-1;i>=0;--i){const n=this.columns[i];if(n.x<t+e&&n.x>=t)if(n.x+n.width>t+e){const i=n.x+n.width,s=i-t-e;n.width=s,n.x=i-s,n.vertexIndexBegin=Math.floor(n.x),n.vertexIndexEnd=Math.ceil(n.x+n.width)}else this.columns.splice(i,1)}return this.currColumnIndex=l,this.insertColumn(l,{vertexIndexBegin:a,vertexIndexEnd:o,x:t,width:e,height:i,dataCount:1,dataIndices:[{begin:n,end:n+1}]}),this.pushToUpdateRanges(a,s),s}const l=this.columns[r];if(l.x+l.width>t+e){const i=l.x+l.width,n=i-t-e,a=Math.floor(i-n);this.currColumnIndex=r+1,this.insertColumn(r+1,{vertexIndexBegin:a,vertexIndexEnd:Math.ceil(i),x:i-n,width:n,height:l.height,dataCount:1,dataIndices:[...l.dataIndices]}),this.pushToUpdateRanges(a,s)}for(let c=this.columns.length-1;c>r;--c){const i=this.columns[c];if(i.x<t+e&&i.x>=t)if(i.x+i.width>t+e){const n=i.x+i.width,s=n-t-e;i.width=s,i.x=n-s,i.vertexIndexBegin=Math.floor(this.columns[c].x),i.vertexIndexEnd=Math.ceil(this.columns[c].x+this.columns[c].width)}else this.currColumnIndex==c&&this.currColumnIndex--,this.columns.splice(c,1)}l.x=t,l.width=e,l.vertexIndexEnd=Math.ceil(t+e),l.height=i;const d=l.dataIndices[l.dataIndices.length-1];return d.begin<0&&(d.begin=n),d.end=n+1,this.setRectDataToBuffers(l.vertexIndexBegin,l.x,l.width,l.height),this.pushToUpdateRanges(l.vertexIndexBegin,s),s}remove(t,e){if(t>=this.columnMaxLength||t<0||e<0)return[];const i=[];t+e>this.columnMaxLength&&(e=this.columnMaxLength-t);const n=Math.floor(t),s=Math.ceil(t+e);for(let a=n;a<s;++a){const n=this.getColumnIndex(a);if(void 0!==n){const s=this.columns[n];if(t+e<s.x)return i;if(t+e<s.vertexIndexEnd){let a=t,o=e;if(t<s.x&&(a=s.x,o=t+e-s.x),a<=s.x)if(a+o>s.x+s.width)this.currColumnIndex==n&&this.currColumnIndex--,this.columns.splice(n,1);else{const t=a+o;s.width=s.width-t+s.x,s.x=t}else{if(a>s.x+s.width)return i;let t=!0;if(a+o<s.x+s.width){const e=s.x+s.width-a-o,r=s.x+s.width-e,l=this.getVertexIndex(r),d=this.getColumnIndex(l);void 0===d?(this.insertColumn(n+1,{vertexIndexBegin:l,vertexIndexEnd:Math.ceil(r+e),x:r,width:e,height:this.columns[n].height,dataCount:this.columns[n].dataCount,dataIndices:[...this.columns[n].dataIndices]}),this.pushToUpdateRanges(l,i)):d==n?t=!1:(r<this.columns[d].x&&(this.columns[d].x=r),r+e>this.columns[d].x+this.columns[d].width&&(this.columns[d].width=r+e-this.columns[d].x))}t&&(s.width=a-s.x)}}else t<s.x+s.width&&t>s.vertexIndexBegin?t<=s.x&&t+e>=s.x+s.width?(this.currColumnIndex==n&&this.currColumnIndex--,this.columns.splice(n,1)):s.x<t?(s.width=s.width-t+s.x,s.x=t):(s.width=s.width-t-e+s.x,s.x=t+e):(this.currColumnIndex==n&&this.currColumnIndex--,this.columns.splice(n,1))}}return i}mergeRanges(t,e,i){for(let n=i.length-1;n>=0;--n)if(n!=e)if(t.begin<=i[n].begin){if(t.end>=i[n].begin){t.end=Math.max(t.end,i[n].end),i.splice(n,1);break}}else if(i[n].end>=t.begin){i[n].end=Math.max(t.end,i[n].end),i.splice(e,1);break}}getCurrColumnIndex(){return this.currColumnIndex}getCurrColumnDataIndex(){if(this.currColumnIndex<0)return-1;const t=this.columns[this.currColumnIndex],e=t.dataIndices[t.dataIndices.length-1];return e.end<0?-1:e.end-1}getVertexIndex(t){const e=Math.floor(t);return e<0||e>=this.vertexBufferLength?-1:e}getColumnIndexByX(t){let e=this.columns.length;if(0==e)return-1;const i=Math.floor(t);let n=0;for(;n<e;){const t=Math.floor((n+e)/2),s=this.columns[t].vertexIndexBegin;if(s==i)return t;s<i?n=t+1:e=t}return this.columns.length<=n?-1:this.isColumn\u0421ontains(n,t)?n:0==n?-1:this.isColumn\u0421ontains(n-1,t)?n-1:-1}getColumnIndex(t){let e=this.columns.length;if(0==e)return-1;let i=0;for(;i<e;){const n=Math.floor((i+e)/2),s=this.columns[n].vertexIndexBegin;if(s==t)return n;s<t?i=n+1:e=n}return-1}getFirstNotNullColumnIndex(){for(let t=0;t<this.columns.length;++t)if(null!=this.columns[t].height)return t;return-1}getLastNotNullColumnIndex(){for(let t=this.columns.length-1;t>=0;--t)if(null!=this.columns[t].height)return t;return-1}getColumn(t){return t<0||t>=this.columns.length?null:this.columns[t]}getColumnIndexByDataIndex(t){for(let e=0;e<this.columns.length;++e){const i=this.columns[e].dataIndices;for(let n=0;n<i.length;++n)if(i[n].begin<=t&&i[n].end>t)return e}return-1}"isColumn\u0421ontains"(t,e){return this.columns[t].x<=e&&this.columns[t].x+this.columns[t].width>=e}updateColumn(t,e,i,n){if(t<0||t>=this.columns.length)return;const s=this.columns[t];s.x=e,s.width=i,s.height=n,null!=s.height&&this.setRectDataToBuffers(s.vertexIndexBegin,s.x,s.width,s.height)}insertColumn(t,e){this.columns.push({vertexIndexBegin:-1,vertexIndexEnd:-1,x:0,width:0,height:null,dataCount:0,dataIndices:[{begin:-1,end:-1}]});for(let i=this.columns.length-1;i>t;--i)this.columns[i]={...this.columns[i-1]};this.columns[t]=e,null!=e.height&&this.setRectDataToBuffers(e.vertexIndexBegin,e.x,e.width,e.height)}setRectDataToBuffers(t,e,i,n){this.setRectToVertexBuffer(t,e,0,i,n),this.setRectToIndexBuffer(t)}setRectToVertexBuffer(t,e,i,n,s){const a=e,o=i,r=n<1?1:n,l=s<1?1:s,d=8*t;this.vertexBuffer[d]=a,this.vertexBuffer[d+1]=o+l,this.vertexBuffer[d+2]=a,this.vertexBuffer[d+3]=o,this.vertexBuffer[d+4]=a+r,this.vertexBuffer[d+5]=o+l,this.vertexBuffer[d+6]=a+r,this.vertexBuffer[d+7]=o}setRectToIndexBuffer(t){const e=4*t;this.indexBuffer[e]=e,this.indexBuffer[e+1]=e+1,this.indexBuffer[e+2]=e+2,this.indexBuffer[e+3]=e+3}pushToUpdateRanges(t,e){let i,n=0;for(let s=e.length-1;s>=0;--s)t==e[s].end+1&&(i=e[s],i.end=t,n=s);void 0===i&&(i={begin:t,end:t},e.push(i),n=e.length-1),this.mergeRanges(i,n,e)}}class Cn{constructor(t){this.settings=t}init(){this.createBuffers()}get isFullColumnLength(){var t,e;return null!==(e=null===(t=this.columnContainer)||void 0===t?void 0:t.isFullLength)&&void 0!==e&&e}forEachColumn(t){var e;null===(e=this.columnContainer)||void 0===e||e.forEachColumn(t)}getVertextBuffer(){return void 0===this.columnContainer?new Float32Array([]):this.columnContainer.vertexBuffer}getPointX(t){var e;if(void 0===this.columnContainer)return null;const i=this.columnContainer.getColumnIndexByDataIndex(t);if(i<0)return null;const n=this.columnContainer.getColumn(i);return null!==(e=null==n?void 0:n.x)&&void 0!==e?e:null}getCurrPointX(){var t;if(void 0===this.columnContainer)return null;const e=this.columnContainer.getCurrColumnIndex();if(e<0)return null;const i=this.columnContainer.getColumn(e);return null!==(t=null==i?void 0:i.x)&&void 0!==t?t:null}getVertexBuffer(){return void 0===this.columnContainer?new Float32Array([]):this.columnContainer.vertexBuffer}getIndexBuffer(){return void 0===this.columnContainer?new Uint16Array([]):this.columnContainer.indexBuffer}getCurrDataIndex(){return void 0===this.columnContainer?-1:this.columnContainer.getCurrColumnDataIndex()}getDataIndex(t){if(void 0===this.columnContainer)return-1;const e=this.columnContainer.getColumnIndex(t);if(e<0)return-1;const i=this.columnContainer.getColumn(e);return null==i||0==i.dataIndices.length?-1:i.dataIndices[0].begin}getLastDataIndex(t){if(void 0===this.columnContainer)return-1;const e=this.columnContainer.getColumnIndex(t);if(e<0)return-1;const i=this.columnContainer.getColumn(e);return null==i||0==i.dataIndices.length?-1:i.dataIndices[0].end-1}getLastValidGraphicDataIndex(){if(void 0===this.columnContainer)return-1;const t=this.columnContainer.getLastNotNullColumnIndex();if(t<0)return-1;const e=this.columnContainer.getColumn(t);return null==e||0==e.dataIndices.length?-1:e.dataIndices[e.dataIndices.length-1].end-1}pushColumns(t){if(void 0===this.columnContainer)return[];const e=[];for(let i=0;i<t.length;i++){const n=t[i],s=this.pushDataArray(n.x,n.width,n.data);for(let t=0;t<s.length;++t){const i=s[t];e.push(i),this.columnContainer.mergeRanges(i,e.length-1,e)}}return e}pushDataArray(t,e,i){if(0==i.length||void 0===this.settings.dataContainer||void 0===this.columnContainer)return[];let n=-1,s=-1,a=null;for(let o=0;o<i.length;++o){this.settings.dataContainer.add(i[o]);const t=this.settings.dataContainer.getCurrDataInPx();null!=t&&(null==a||t>a)&&(a=t),s=this.settings.dataContainer.getCurrDataIndex(),0==o&&(n=s)}return this.columnContainer.addMultipleData(t,e,a,{begin:n,end:s+1})}pushData(t,e,i){if(void 0===this.settings.dataContainer||void 0===this.columnContainer)return[];this.settings.dataContainer.add(i);const n=this.settings.dataContainer.getCurrDataIndex(),s=this.settings.dataContainer.getCurrDataInPx();return this.columnContainer.add(t,e,s,n)}setData(t,e,i,n){return void 0===this.columnContainer?[]:this.columnContainer.add(t,e,i,n)}updatePixelsValues(){if(void 0!==this.settings.dataContainer&&void 0!==this.columnContainer)for(let t=0;t<this.columnContainer.columns.length;++t){const e=this.columnContainer.columns[t];for(let i=0;i<e.dataIndices.length;++i){const n=e.dataIndices[i];let s=null;for(let t=n.begin;t<n.end;++t){const e=this.settings.dataContainer.getDataInPx(t);null!=e&&(null==s||e>s)&&(s=e)}this.columnContainer.updateColumn(t,e.x,e.width,s)}}}createBuffers(){void 0!==this.settings.dataContainer&&(this.columnContainer=new xn(new Sn({plotSize:this.settings.plotSize})),this.columnContainer.init())}}class bn{constructor(t){var e;this.isoline=null,this.dataLength=null!==(e=null==t?void 0:t.dataLength)&&void 0!==e?e:0,this.dataLength<0&&(this.dataLength=0),this.dataBuffer=new X(this.dataLength),this.convertDataToPixels=null==t?void 0:t.convertDataToPixels,this.checkNullData=null==t?void 0:t.checkNullData,this.isolineCalculator=null==t?void 0:t.isolineCalculator}get capacity(){return this.dataLength}get length(){return this.dataBuffer.actualLength}reset(t,e){this.dataLength=t,this.dataLength<0&&(this.dataLength=0),this.dataBuffer=new X(this.dataLength),void 0!==e&&this.dataBuffer.buffer.fill(e)}add(t,e){var i,n;void 0===e&&(e=!0),(null==t||null!==(n=null===(i=this.checkNullData)||void 0===i?void 0:i.call(this,t))&&void 0!==n&&n)&&(t=null),this.dataBuffer.addData(t,f.Right),e&&this.updateIsoline(t)}getCurrData(){return this.getData(this.dataBuffer.lastIndex)}getCurrDataIndex(){return this.dataBuffer.lastIndex}getData(t){return t<0||t>=this.dataBuffer.actualLength?null:this.dataBuffer.buffer[t]}getCurrDataInPx(){return this.getDataInPx(this.dataBuffer.lastIndex)}getDataInPx(t){return t<0||void 0===this.convertDataToPixels||null==this.dataBuffer.buffer[t]?null:this.convertDataToPixels(this.dataBuffer.buffer[t])}getIsoline(){return this.isoline}getIsolineInPx(){return null==this.isoline||void 0===this.convertDataToPixels?null:this.convertDataToPixels(this.isoline)}updateIsoline(t){null!=t&&void 0!==this.isolineCalculator&&(null==this.isoline?(this.isoline=t,this.isolineCalculator.reset(t)):this.isoline=this.isolineCalculator.calculate(t))}}class In extends bn{constructor(t){super(void 0===t?void 0:{dataLength:t.dataLength,convertDataToPixels:t.convertDataToPixels,checkNullData:t.checkNullData,isolineCalculator:t.isolineCalculator}),this.filteredDataBuffer=new X(this.dataLength),this.filtersProvider=null==t?void 0:t.filtersProvider}reset(t,e){super.reset(t,e),this.filteredDataBuffer=new X(this.dataLength)}resetFilteredData(){this.filteredDataBuffer=new X(this.dataLength)}addFilteredData(t,e){var i,n;void 0===e&&(e=!0),(null==t||null!==(n=null===(i=this.checkNullData)||void 0===i?void 0:i.call(this,t))&&void 0!==n&&n)&&(t=null),null!=t&&void 0!==this.filtersProvider&&(t=this.filtersProvider.applyFilters(t)),this.filteredDataBuffer.addData(t,f.Right),e&&this.updateIsoline(t)}getCurrFilteredData(){return this.getFilteredData(this.filteredDataBuffer.lastIndex)}getCurrFilteredDataIndex(){return this.filteredDataBuffer.lastIndex}getFilteredData(t){return t<0||t>=this.filteredDataBuffer.buffer.length?null:this.filteredDataBuffer.buffer[t]}getCurrFilteredDataInPx(){return this.getFilteredDataInPx(this.filteredDataBuffer.lastIndex)}getFilteredDataInPx(t){return t<0||void 0===this.convertDataToPixels||null==this.filteredDataBuffer.buffer[t]?null:this.convertDataToPixels(this.filteredDataBuffer.buffer[t])}}class Pn extends se{constructor(t){var e,i,n,s,a,o,r,l;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.ppmm=null!==(e=null==t?void 0:t.ppmm)&&void 0!==e?e:0,this.color=null!==(i=null==t?void 0:t.color)&&void 0!==i?i:[0,0,0,1],this.viewScale=null!==(n=null==t?void 0:t.viewScale)&&void 0!==n?n:new H({x:1,y:1}),this.isDataSync=null===(s=null==t?void 0:t.isDataSync)||void 0===s||s,this.dataBufferSize=null==t?void 0:t.dataBufferSize,this.frequency=null==t?void 0:t.frequency,this.scaleX=null!==(a=null==t?void 0:t.scaleX)&&void 0!==a?a:0,this.scaleY=null!==(o=null==t?void 0:t.scaleY)&&void 0!==o?o:0,this.valuePixelConvertKoef=null!==(r=null==t?void 0:t.valuePixelConvertKoef)&&void 0!==r?r:0,this.dataCounter=null==t?void 0:t.dataCounter,this.fillType=null!==(l=null==t?void 0:t.fillType)&&void 0!==l?l:Xe.Period}}function Bn(t){return isNaN(t)}class Dn{constructor(t){this.parentSize=t.parentSize}}class Mn{constructor(t){this.settings=t,this.eventsListeners=new Map}addEventListener(t,e,i){let n;this.eventsListeners.has(t)?n=this.eventsListeners.get(t):(n=new tt,this.eventsListeners.set(t,n)),void 0!==n&&n.listeners.push(new Q(e,i))}async handleEvent(t,e){const i=this.eventsListeners.get(t);if(void 0!==i&&i.handled)for(let n=0;n<i.listeners.length;++n){const t=i.listeners[n];await t.callback(e,t.info)}}}class zn extends Mn{constructor(t){super(t),this.typedSettings=this.settings,this.dataContainer=new bn,this.columnLineStorage=new yn(new gn)}init(){let t;t=this.typedSettings.fillType==Xe.Period?new pn({frequency:this.typedSettings.frequency,width:this.typedSettings.plotSize.width}):new vn({dataCount:this.typedSettings.dataBufferSize});const e=t.calculate(this.typedSettings.ppmm*this.typedSettings.scaleX);this.dataContainer=new bn({dataLength:e,convertDataToPixels:t=>t*this.typedSettings.valuePixelConvertKoef*this.typedSettings.scaleY,checkNullData:Bn}),this.columnLineStorage=new yn({dataCount:e,frequency:this.typedSettings.frequency,plotSize:this.typedSettings.plotSize,isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,dataContainer:this.dataContainer,fillType:this.typedSettings.fillType,ppmm:this.typedSettings.ppmm,scaleX:this.typedSettings.scaleX}),this.columnLineStorage.init()}getIsoline(){return this.dataContainer.getIsoline()}getIsolineInPx(){return this.dataContainer.getIsolineInPx()}getNotNullSectors(){return this.columnLineStorage.getNotNullSectors()}getVertextBuffer(){return this.columnLineStorage.getVertextBuffer()}get pointCount(){return this.dataContainer.length}get isColumnMode(){return this.columnLineStorage.isColumnMode}isNextPointGraphicBegin(){return this.columnLineStorage.isNextPointGraphicBegin()}setFrequency(t){this.typedSettings.frequency=t,this.init()}setScaleX(t){this.typedSettings.scaleX=t,this.init()}setScaleY(t){this.typedSettings.scaleY=t,this.columnLineStorage.updatePixelsValues()}updateWindowSize(t,e){this.typedSettings.plotSize=t,this.typedSettings.windowSize=e,this.init()}reset(){this.init()}getDataIndex(t){return this.columnLineStorage.getDataIndex(t)}getDataByX(t){const e=this.columnLineStorage.getDataIndex(t);return e<0?null:this.dataContainer.getData(e)}getData(t){return this.dataContainer.getData(t)}getCurrData(){return this.dataContainer.getCurrData()}getMinMax(t,e){if(t<0||e<t||e>this.dataContainer.length)return;let i=this.dataContainer.getData(t),n=i;for(let s=t+1;s<e;s++){const t=this.dataContainer.getData(s);null!=t&&((null==i||t<i)&&(i=t),(null==n||t>n)&&(n=t))}return{min:i,max:n}}addLocatedPoints(t){return this.columnLineStorage.pushLocatedDataArray(t)}addPoints(t){return this.columnLineStorage.pushDataArray(t)}pushData(t,e){this.columnLineStorage.pushData(t,e)}getPointX(t){return this.columnLineStorage.getPointX(t)}getCurrPointX(){return this.columnLineStorage.getCurrPointX()}getCurrDataIndex(){return this.columnLineStorage.getCurrDataIndex()}getLastDataIndex(t){return this.columnLineStorage.getLastDataIndex(t)}getLastValidGraphicDataIndex(){return this.columnLineStorage.getLastValidGraphicDataIndex()}}class kn extends Dn{constructor(t){var e,i,n,s,a,o,r,l,d;super({parentSize:null!==(e=null==t?void 0:t.parentSize)&&void 0!==e?e:new K}),this.isDataSync=null===(i=null==t?void 0:t.isDataSync)||void 0===i||i,this.dataBufferSize=null==t?void 0:t.dataBufferSize,this.frequency=null==t?void 0:t.frequency,this.scaleX=null!==(n=null==t?void 0:t.scaleX)&&void 0!==n?n:0,this.scaleY=null!==(s=null==t?void 0:t.scaleY)&&void 0!==s?s:0,this.valuePixelConvertKoef=null!==(a=null==t?void 0:t.valuePixelConvertKoef)&&void 0!==a?a:0,this.ppmm=null!==(o=null==t?void 0:t.ppmm)&&void 0!==o?o:0,this.plotSize=null!==(r=null==t?void 0:t.plotSize)&&void 0!==r?r:new K,this.windowSize=null!==(l=null==t?void 0:t.windowSize)&&void 0!==l?l:new K,this.fillType=null!==(d=null==t?void 0:t.fillType)&&void 0!==d?d:Xe.Period}}class An{}class Fn extends An{constructor(t){super(),this.points=t}}class Vn extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.signalBuffer=new zn(new kn)}init(){if(super.init(),void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const t=this.settings.parent.ref.settings.clientSize;this.signalBuffer=new zn(new kn({parentSize:this.settings.sizeInPixels.copy(),isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,frequency:this.typedSettings.frequency,scaleX:this.typedSettings.scaleX*this.typedSettings.viewScale.x,scaleY:this.typedSettings.scaleY*this.typedSettings.viewScale.y,valuePixelConvertKoef:this.typedSettings.valuePixelConvertKoef,ppmm:this.typedSettings.ppmm,plotSize:t,windowSize:t,fillType:this.typedSettings.fillType})),this.uniforms=new Kt({color:this.typedSettings.color,shift:[0,this.settings.relatedLocation.y],windowSize:[t.width,t.height]});const e=this.getWebglContextProvider();if(void 0===e)return;const i=e.context,n=i.createBuffer();if(null==n)return;this.glBuffer=n;const s=this.signalBuffer.getVertextBuffer();i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer),i.bufferData(i.ARRAY_BUFFER,s,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)}updatePointsBuffer(t){if(0==t.length)return;const e=this.getWebglContextProvider();if(void 0===e||void 0===this.glBuffer)return;const i=e.context,n=this.signalBuffer.getVertextBuffer();i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer);for(let s=0;s<t.length;++s){const e=t[s],a=n.subarray(4*e.begin,4*e.end);i.bufferSubData(i.ARRAY_BUFFER,4*e.begin*4,a)}}addOnIsolineChangedAction(t,e){this.signalBuffer.addEventListener("IsolineChanged",t,e)}async tryUpdateMeanSignalValue(){}getData(t){return this.signalBuffer.getData(t)}getDataByX(t){return this.signalBuffer.getDataByX(t)}getCurrData(){return this.signalBuffer.getCurrData()}getIsoline(){return this.signalBuffer.getIsoline()}getIsolineInPx(){return this.signalBuffer.getIsolineInPx()}getMinMax(t,e){return this.signalBuffer.getMinMax(t,e)}addLocatedPoints(t){const e=this.signalBuffer.addLocatedPoints(t);this.updatePointsBuffer(e)}addData(t){t instanceof Fn&&this.addPoints(t.points)}addPoints(t){const e=this.signalBuffer.addPoints(t);this.updatePointsBuffer(e)}getIsolineY(){return this.settings.absoluteLocation.y}getPointX(t){return this.signalBuffer.getPointX(t)}getCurrPointX(){return this.signalBuffer.getCurrPointX()}getCurrDataIndex(){return this.signalBuffer.getCurrDataIndex()}getDataIndex(t){return this.signalBuffer.getDataIndex(t)}getPointsCount(){return this.signalBuffer.pointCount}setPointCount(t){this.signalBuffer.typedSettings.dataBufferSize=t,this.signalBuffer.reset()}getLastDataIndex(t){return this.signalBuffer.getLastDataIndex(t)}getLastValidGraphicDataIndex(){return this.signalBuffer.getLastValidGraphicDataIndex()}setScaleX(t){const e=this.getWebglContextProvider();if(void 0===e||void 0===this.glBuffer)return;const i=e.context,n=this.signalBuffer.getVertextBuffer();this.signalBuffer.setScaleX(t*this.typedSettings.viewScale.x),i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer),i.bufferData(i.ARRAY_BUFFER,n,i.DYNAMIC_DRAW)}setScaleY(t){const e=this.getWebglContextProvider();if(void 0===e||void 0===this.glBuffer)return;const i=e.context,n=this.signalBuffer.getVertextBuffer();this.signalBuffer.setScaleY(t*this.typedSettings.viewScale.y),i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,n)}setFrequency(t){const e=this.getWebglContextProvider();if(void 0===e||void 0===this.glBuffer)return;const i=e.context,n=this.signalBuffer.getVertextBuffer();this.signalBuffer.setFrequency(t),i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,n)}isNextPointGraphicBegin(){return this.signalBuffer.isNextPointGraphicBegin()}async createBorders(){await super.createBorders(),this.signalBuffer.settings.parentSize.width==this.settings.sizeInPixels.width&&this.signalBuffer.settings.parentSize.height==this.settings.sizeInPixels.height||(this.signalBuffer.settings.parentSize.width=this.settings.sizeInPixels.width,this.signalBuffer.settings.parentSize.height=this.settings.sizeInPixels.height),this.updateDataBuffer()}updateDataBuffer(){this.signalBuffer.reset();const t=this.getWebglContextProvider();if(void 0===t||void 0===this.glBuffer||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context,i=this.signalBuffer.getVertextBuffer(),n=this.settings.parent.ref.settings;this.uniforms.setValues({shift:[0,this.settings.relatedLocation.y],windowSize:[n.clientSize.width,n.clientSize.height]}),this.signalBuffer.updateWindowSize(n.clientSize,n.clientSize),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.DYNAMIC_DRAW)}resetBuffer(){const t=this.getWebglContextProvider();if(void 0===t||void 0===this.glBuffer)return;const e=t.context,i=this.signalBuffer.getVertextBuffer();this.signalBuffer.reset(),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.DYNAMIC_DRAW)}draw(){if(0==this.signalBuffer.pointCount||void 0===this.glBuffer)return;const t=this.getWebglContextProvider();if(void 0===t||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context,i=this.settings.parent.ref.settings;e.viewport(i.absoluteLocation.x,i.absoluteLocation.y,i.clientSize.width,i.clientSize.height),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer);const n=t.getPositionAttribLocation();void 0!==n&&(e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.signalBuffer.isColumnMode?e.drawArrays(e.LINES,0,2*this.signalBuffer.pointCount):e.drawArrays(e.LINE_STRIP,0,2*this.signalBuffer.pointCount))}}class _n extends zn{constructor(t){super(t)}async tryUpdateMeanSignalValue(){this.pointCount>0&&await this.handleEvent("IsolineChanged",this.getCurrData())}}class Rn extends Vn{constructor(t){super(t)}draw(){if(0==this.signalBuffer.pointCount||void 0===this.glBuffer)return;const t=this.getWebglContextProvider();if(void 0===t||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context,i=this.settings.parent.ref.settings;e.viewport(i.absoluteLocation.x,i.absoluteLocation.y,i.clientSize.width,i.clientSize.height),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer);const n=t.getPositionAttribLocation();if(void 0===n)return;e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);const s=this.signalBuffer.getNotNullSectors().sectors;if(this.signalBuffer.isColumnMode)for(let a=0;a<s.length;++a){const t=s[a];e.drawArrays(e.LINES,2*t.begin,2*(t.end-t.begin+1))}else for(let a=0;a<s.length;++a){const t=s[a];e.drawArrays(e.LINE_STRIP,2*t.begin,2*(t.end-t.begin+1))}}}class Ln extends Rn{constructor(t){super(t)}async tryUpdateMeanSignalValue(){void 0!==this.typedSignalBuffer&&await this.typedSignalBuffer.tryUpdateMeanSignalValue()}init(){if(Qt.prototype.init.call(this),void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const t=this.settings.parent.ref.settings.clientSize;this.typedSignalBuffer=new _n(new kn({parentSize:this.settings.sizeInPixels.copy(),isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,frequency:this.typedSettings.frequency,scaleX:this.typedSettings.scaleX*this.typedSettings.viewScale.x,scaleY:this.typedSettings.scaleY*this.typedSettings.viewScale.y,valuePixelConvertKoef:this.typedSettings.valuePixelConvertKoef,ppmm:this.typedSettings.ppmm,plotSize:t,windowSize:t,fillType:this.typedSettings.fillType})),this.signalBuffer=this.typedSignalBuffer,this.signalBuffer.init(),this.uniforms=new Kt({color:this.typedSettings.color,shift:[0,this.settings.relatedLocation.y],windowSize:[t.width,t.height]});const e=this.getWebglContextProvider();if(void 0===e)return;const i=e.context,n=i.createBuffer();if(null==n)return;this.glBuffer=n;const s=this.signalBuffer.getVertextBuffer();i.bindBuffer(i.ARRAY_BUFFER,this.glBuffer),i.bufferData(i.ARRAY_BUFFER,s,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)}}class En extends kn{constructor(t){super(void 0===t?void 0:{parentSize:t.parentSize,isDataSync:t.isDataSync,dataBufferSize:t.dataBufferSize,frequency:t.frequency,scaleX:t.scaleX,scaleY:t.scaleY,valuePixelConvertKoef:t.valuePixelConvertKoef,ppmm:t.ppmm,plotSize:t.plotSize,windowSize:t.windowSize,fillType:t.fillType}),this.filterProvider=null==t?void 0:t.filterProvider}}class jn extends zn{constructor(t){super(t),this.typedSettings=this.settings}init(){var t,e;let i;i=this.typedSettings.fillType==Xe.Period?new pn({frequency:this.typedSettings.frequency,width:this.typedSettings.plotSize.width}):new vn({dataCount:null!==(t=this.typedSettings.dataBufferSize)&&void 0!==t?t:0});const n=i.calculate(this.typedSettings.ppmm*this.typedSettings.scaleX),s=this.typedSettings.isDataSync?n:null!==(e=this.typedSettings.dataBufferSize)&&void 0!==e?e:0;this.typedDataContainer=new In({dataLength:s,convertDataToPixels:t=>t*this.typedSettings.valuePixelConvertKoef*this.typedSettings.scaleY,checkNullData:Bn,filtersProvider:this.typedSettings.filterProvider,isolineCalculator:new kt(.03)}),this.dataContainer=this.typedDataContainer,this.typedColumnLineStorage=new mn({dataCount:n,frequency:this.typedSettings.frequency,plotSize:this.typedSettings.plotSize,isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,dataContainer:this.dataContainer,isolineCalculator:new kt(.03),fillType:this.typedSettings.fillType,ppmm:this.typedSettings.ppmm,scaleX:this.typedSettings.scaleX}),this.columnLineStorage=this.typedColumnLineStorage,this.columnLineStorage.init()}setFrequency(t){var e;this.typedSettings.frequency=t,null===(e=this.typedSettings.filterProvider)||void 0===e||e.setFreq(t),this.createBuffers()}setFilters(t){var e;if(void 0!==this.typedSettings.filterProvider){this.typedSettings.filterProvider.clearFilters();for(let e=0;e<t.length;++e){const i=t[e];void 0!==this.typedSettings.frequency&&(i.freq=this.typedSettings.frequency),this.typedSettings.filterProvider.addFilter(i)}null===(e=this.typedColumnLineStorage)||void 0===e||e.updateFilteredValues()}}getAmpl(t){var e,i;return null!==(i=null===(e=this.typedDataContainer)||void 0===e?void 0:e.getFilteredData(t))&&void 0!==i?i:null}getMinMax(t,e){if(void 0===this.typedDataContainer||t<0||e<t||e>this.dataContainer.length)return;let i=this.typedDataContainer.getFilteredData(t),n=i;for(let s=t+1;s<e;s++){const t=this.typedDataContainer.getFilteredData(s);null!=t&&((null==i||t<i)&&(i=t),(null==n||t>n)&&(n=t))}return null!=i&&null!=n?{min:i,max:n}:void 0}createBuffers(){var t,e;let i;i=this.typedSettings.fillType==Xe.Period?new pn({frequency:this.typedSettings.frequency,width:this.typedSettings.plotSize.width}):new vn({dataCount:null!==(t=this.typedSettings.dataBufferSize)&&void 0!==t?t:0});const n=i.calculate(this.typedSettings.ppmm*this.typedSettings.scaleX),s=this.typedSettings.isDataSync?n:null!==(e=this.typedSettings.dataBufferSize)&&void 0!==e?e:0;this.typedDataContainer=new In({dataLength:s,convertDataToPixels:t=>t*this.typedSettings.valuePixelConvertKoef*this.typedSettings.scaleY,checkNullData:Bn,filtersProvider:this.typedSettings.filterProvider}),this.dataContainer=this.typedDataContainer,this.typedColumnLineStorage=new mn({dataCount:n,frequency:this.typedSettings.frequency,plotSize:this.typedSettings.plotSize,isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,dataContainer:this.dataContainer,fillType:this.typedSettings.fillType,ppmm:this.typedSettings.ppmm,scaleX:this.typedSettings.scaleX}),this.columnLineStorage=this.typedColumnLineStorage,this.columnLineStorage.init()}pushData(t,e){this.columnLineStorage.pushData(t,e)}}class Yn extends Dn{constructor(t){var e,i,n,s,a,o,r;super({parentSize:null!==(e=null==t?void 0:t.parentSize)&&void 0!==e?e:new K}),this.dataBufferSize=null==t?void 0:t.dataBufferSize,this.scaleX=null!==(i=null==t?void 0:t.scaleX)&&void 0!==i?i:0,this.scaleY=null!==(n=null==t?void 0:t.scaleY)&&void 0!==n?n:0,this.valuePixelConvertKoef=null!==(s=null==t?void 0:t.valuePixelConvertKoef)&&void 0!==s?s:0,this.ppmm=null!==(a=null==t?void 0:t.ppmm)&&void 0!==a?a:0,this.plotSize=null!==(o=null==t?void 0:t.plotSize)&&void 0!==o?o:new K,this.windowSize=null!==(r=null==t?void 0:t.windowSize)&&void 0!==r?r:new K}}class On extends Mn{constructor(t){super(t),this.typedSettings=this.settings,this.dataContainer=new bn,this.columnStorage=new Cn(new wn)}init(){var t;const e=null!==(t=this.typedSettings.dataBufferSize)&&void 0!==t?t:1e4;this.dataContainer=new bn({dataLength:e,convertDataToPixels:t=>t*this.typedSettings.valuePixelConvertKoef*this.typedSettings.scaleY,checkNullData:Bn}),this.columnStorage=new Cn(new wn({plotSize:this.typedSettings.plotSize,dataContainer:this.dataContainer,ppmm:this.typedSettings.ppmm,scaleX:this.typedSettings.scaleX})),this.columnStorage.init()}get isFullColumnLength(){return this.columnStorage.isFullColumnLength}forEachColumn(t){this.columnStorage.forEachColumn(t)}getIsoline(){return this.dataContainer.getIsoline()}getIsolineInPx(){return this.dataContainer.getIsolineInPx()}getVertexBuffer(){return this.columnStorage.getVertextBuffer()}getIndexBuffer(){return this.columnStorage.getIndexBuffer()}get pointCount(){return this.dataContainer.length}setScaleX(t){this.typedSettings.scaleX=t,this.init()}setScaleY(t){this.typedSettings.scaleY=t,this.columnStorage.updatePixelsValues()}updateWindowSize(t,e){this.typedSettings.plotSize=t,this.typedSettings.windowSize=e,this.init()}reset(){this.init()}pushData(t,e,i){return this.columnStorage.pushDataArray(t,e,i)}pushDataArray(t){return this.columnStorage.pushColumns(t)}getPointX(t){return this.columnStorage.getPointX(t)}getCurrPointX(){return this.columnStorage.getCurrPointX()}getCurrDataIndex(){return this.columnStorage.getCurrDataIndex()}getDataIndex(t){return this.columnStorage.getDataIndex(t)}getData(t){return this.dataContainer.getData(t)}getLastDataIndex(t){return this.columnStorage.getLastDataIndex(t)}getLastValidGraphicDataIndex(){return this.columnStorage.getLastValidGraphicDataIndex()}}class Un extends An{constructor(t){super(),this.columns=t.columns}}class Tn extends se{constructor(t){var e,i,n,s,a,o,r,l;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.ppmm=null!==(e=null==t?void 0:t.ppmm)&&void 0!==e?e:0,this.color=null!==(i=null==t?void 0:t.color)&&void 0!==i?i:[0,0,0,1],this.viewScale=null!==(n=null==t?void 0:t.viewScale)&&void 0!==n?n:new H({x:1,y:1}),this.dataBufferSize=null==t?void 0:t.dataBufferSize,this.valuePixelConvertKoef=null!==(s=null==t?void 0:t.valuePixelConvertKoef)&&void 0!==s?s:0,this.plotSize=null!==(a=null==t?void 0:t.plotSize)&&void 0!==a?a:new K,this.windowSize=null!==(o=null==t?void 0:t.windowSize)&&void 0!==o?o:new K,this.scaleX=null!==(r=null==t?void 0:t.scaleX)&&void 0!==r?r:0,this.scaleY=null!==(l=null==t?void 0:t.scaleY)&&void 0!==l?l:0}}class Wn extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.isBufferInitMap=new Map,this.signalBuffer=new On(new Yn)}init(){super.init();const t=this.getWebglContextProvider();if(void 0===t||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context;this.isBufferInitMap=new Map,this.isBufferInitMap.set(e.ARRAY_BUFFER,!1),this.isBufferInitMap.set(e.ELEMENT_ARRAY_BUFFER,!1);const i=this.settings.parent.ref.settings.clientSize;this.signalBuffer=new On(new Yn({parentSize:this.settings.sizeInPixels.copy(),dataBufferSize:this.typedSettings.dataBufferSize,scaleX:this.typedSettings.scaleX*this.typedSettings.viewScale.x,scaleY:this.typedSettings.scaleY*this.typedSettings.viewScale.y,valuePixelConvertKoef:this.typedSettings.valuePixelConvertKoef,ppmm:this.typedSettings.ppmm,plotSize:i,windowSize:i})),this.signalBuffer.init(),this.uniforms=new Kt({color:this.typedSettings.color,shift:[0,this.settings.relatedLocation.y],windowSize:[i.width,i.height]});const n=e.createBuffer(),s=e.createBuffer();if(null==n||null==s)return;this.vertexGlBuffer=n,this.indexGlBuffer=s;const a=this.signalBuffer.getVertexBuffer(),o=this.signalBuffer.getIndexBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.vertexGlBuffer),e.bufferData(e.ARRAY_BUFFER,a,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexGlBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}getIsoline(){return this.signalBuffer.getIsoline()}getIsolineInPx(){return this.signalBuffer.getIsolineInPx()}getData(t){return this.signalBuffer.getData(t)}getDataIndex(t){return this.signalBuffer.getDataIndex(t)}async tryUpdateMeanSignalValue(){}isDefaultDataBufferLength(){return void 0===this.typedSettings.dataBufferSize}setDataBufferLength(t){this.typedSettings.dataBufferSize=t,this.signalBuffer.typedSettings.dataBufferSize=t,this.signalBuffer.init()}addData(t){t instanceof Un&&this.addColumns(t.columns)}addColumns(t){this.signalBuffer.pushDataArray(t),this.resetWebglBuffers()}updateDataBuffer(){if(void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const t=this.settings.parent.ref.settings.clientSize;this.uniforms.setValues({shift:[0,this.settings.relatedLocation.y],windowSize:[t.width,t.height]}),this.signalBuffer.updateWindowSize(t,t),this.resetWebglBuffers()}async createBorders(){await super.createBorders(),this.updateDataBuffer()}resetWebglBuffers(){const t=this.getWebglContextProvider();if(void 0===t||void 0===this.vertexGlBuffer||void 0===this.indexGlBuffer)return;const e=t.context,i=this.signalBuffer.getVertexBuffer(),n=this.signalBuffer.getIndexBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.vertexGlBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexGlBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}updateWebglBuffers(t,e){const i=this.getWebglContextProvider();if(void 0===i||void 0===this.vertexGlBuffer)return;const n=i.context,s=this.signalBuffer.getVertexBuffer();n.bindBuffer(n.ARRAY_BUFFER,this.vertexGlBuffer);const a=s.subarray(8*t,8*e);n.bufferSubData(n.ARRAY_BUFFER,8*t*4,a),n.bindBuffer(n.ARRAY_BUFFER,null)}setDataToGraphicBuffer(t,e,i){const n=this.getWebglContextProvider();if(void 0===n)return;const s=n.context;this.signalBuffer.isFullColumnLength?this.isBufferInitMap.get(t)?s.bufferSubData(t,e,i):(s.bufferData(t,i.length*i.BYTES_PER_ELEMENT,s.DYNAMIC_DRAW),this.isBufferInitMap.set(t,!0)):s.bufferData(t,i.length*i.BYTES_PER_ELEMENT,s.DYNAMIC_DRAW)}resetBuffer(){this.signalBuffer.reset(),this.resetWebglBuffers()}getIsolineY(){return this.settings.absoluteLocation.y}getPointX(t){return this.signalBuffer.getPointX(t)}getCurrPointX(){return this.signalBuffer.getCurrPointX()}getCurrDataIndex(){return this.signalBuffer.getCurrDataIndex()}getPointsCount(){return this.signalBuffer.pointCount}setPointCount(t){this.signalBuffer.typedSettings.dataBufferSize=t,this.signalBuffer.reset()}getLastDataIndex(t){return this.signalBuffer.getLastDataIndex(t)}getMinMax(t,e){}getLastValidGraphicDataIndex(){return this.signalBuffer.getLastValidGraphicDataIndex()}setScaleX(t){this.signalBuffer.setScaleX(t*this.typedSettings.viewScale.x),this.resetWebglBuffers()}setScaleY(t){this.signalBuffer.setScaleY(t*this.typedSettings.viewScale.y),this.resetWebglBuffers()}draw(){if(0==this.signalBuffer.pointCount||void 0===this.vertexGlBuffer||void 0===this.indexGlBuffer)return;const t=this.getWebglContextProvider();if(void 0===t||void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const e=t.context,i=this.settings.parent.ref.settings;e.viewport(i.absoluteLocation.x,i.absoluteLocation.y,i.clientSize.width,i.clientSize.height),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexGlBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexGlBuffer);const n=t.getPositionAttribLocation();void 0!==n&&(e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.signalBuffer.forEachColumn((t=>{e.drawElements(e.TRIANGLE_STRIP,4,e.UNSIGNED_SHORT,4*t.vertexIndexBegin*2)})))}}class Xn extends En{constructor(t){var e;super(void 0===t?void 0:{parentSize:t.parentSize,isDataSync:t.isDataSync,dataBufferSize:t.dataBufferSize,frequency:t.frequency,scaleX:t.scaleX,scaleY:t.scaleY,valuePixelConvertKoef:t.valuePixelConvertKoef,ppmm:t.ppmm,plotSize:t.plotSize,windowSize:t.windowSize,fillType:t.fillType,filterProvider:t.filterProvider}),this.isolineChangeBound=null!==(e=null==t?void 0:t.isolineChangeBound)&&void 0!==e?e:0}}class Hn extends jn{constructor(t){super(t),this.typedSettings=this.settings,this.fixedIsoline=null}init(){super.init(),this.fixedIsoline=null}async tryUpdateMeanSignalValue(){const t=this.dataContainer.getIsoline();null!=t&&(null==this.fixedIsoline||Math.abs(t-this.fixedIsoline)>this.typedSettings.isolineChangeBound)&&(this.fixedIsoline=t,await this.handleEvent("IsolineChanged",this.fixedIsoline))}}class Nn extends Pn{constructor(t){var e;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider,ppmm:t.ppmm,color:t.color,viewScale:t.viewScale,isDataSync:t.isDataSync,dataBufferSize:t.dataBufferSize,frequency:t.frequency,scaleX:t.scaleX,scaleY:t.scaleY,valuePixelConvertKoef:t.valuePixelConvertKoef,dataCounter:t.dataCounter,fillType:t.fillType}),this.filterProvider=null==t?void 0:t.filterProvider,this.isolineChangeBound=null!==(e=null==t?void 0:t.isolineChangeBound)&&void 0!==e?e:0}}class Gn extends Rn{constructor(t){super(t),this.typedSettings=this.settings,this.filters=[]}init(){if(Qt.prototype.init.call(this),void 0===this.settings.parent.ref||!(this.settings.parent.ref instanceof ot))return;const t=this.settings.parent.ref.settings.clientSize;if(this.typedSignalBuffer=new Hn(new Xn({parentSize:this.settings.sizeInPixels.copy(),isDataSync:this.typedSettings.isDataSync,dataBufferSize:this.typedSettings.dataBufferSize,frequency:this.typedSettings.frequency,filterProvider:this.typedSettings.filterProvider,scaleX:this.typedSettings.scaleX*this.typedSettings.viewScale.x,scaleY:this.typedSettings.scaleY*this.typedSettings.viewScale.y,valuePixelConvertKoef:this.typedSettings.valuePixelConvertKoef,ppmm:this.typedSettings.ppmm,plotSize:t,windowSize:t,fillType:this.typedSettings.fillType,isolineChangeBound:this.typedSettings.isolineChangeBound})),this.signalBuffer=this.typedSignalBuffer,this.signalBuffer.init(),this.uniforms=new Kt({color:this.typedSettings.color,shift:[0,this.settings.relatedLocation.y],windowSize:[t.width,t.height]}),void 0===this.typedSettings.contextProvider)return;const e=this.typedSettings.contextProvider.context,i=e.createBuffer();if(null==i)return;this.glBuffer=i;const n=this.signalBuffer.getVertextBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.glBuffer),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.signalBuffer.addEventListener("IsolineChanged",(async t=>{if("number"!=typeof t)return;const e=this.signalBuffer.getIsolineInPx();null!=e&&this.uniforms.setValues({shift:[0,this.settings.relatedLocation.y-e]})}))}addFilter(t){this.filters.push(t)}async tryUpdateMeanSignalValue(){void 0!==this.typedSignalBuffer&&await this.typedSignalBuffer.tryUpdateMeanSignalValue()}setFilters(t){if(void 0===this.typedSignalBuffer)return;const e=this.filters.filter((e=>t.includes(e.name)));this.typedSignalBuffer.setFilters(e)}}class qn extends mi{constructor(t){var e;super({id:t.id,type:t.type,area:t.area,item:null!==(e=t.item)&&void 0!==e?e:new Ke})}copy(){var t;let e;return void 0!==this.item&&(e=this.item.copy()),new qn({id:this.id,type:this.type,area:null===(t=this.area)||void 0===t?void 0:t.copy(),item:e})}}class $n extends se{constructor(t){var e,i,n,s,a,o,r,l;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,canvas:t.canvas,contextProvider:t.contextProvider}),this.viewScale={x:null!==(i=null===(e=null==t?void 0:t.viewScale)||void 0===e?void 0:e.x)&&void 0!==i?i:1,y:null!==(s=null===(n=null==t?void 0:t.viewScale)||void 0===n?void 0:n.y)&&void 0!==s?s:1},this.deviceScale=null!==(a=null==t?void 0:t.deviceScale)&&void 0!==a?a:1;let d=null==t?void 0:t.ppi;if(void 0===d&&void 0!==(null===(o=null==t?void 0:t.parent)||void 0===o?void 0:o.ref)){const e=t.parent.ref.getRoot();if(void 0!==e){const t=e;d=t.getPpi(),this.deviceScale=t.getDeviceScale()}}this.ppi=null!=d?d:0,this.ppcm=this.ppi/2.54,this.color=null!==(r=null==t?void 0:t.color)&&void 0!==r?r:[0,0,0,1],this.cellSize_mm=null!==(l=null==t?void 0:t.cellSize_mm)&&void 0!==l?l:new K,this.cellSize_px=new K,this.updateCellSize()}setPpi(t){this.ppi=t,this.ppcm=this.ppi/2.54,this.updateCellSize()}updateCellSize(){const t=this.ppcm/10,e=t*this.viewScale.x,i=t*this.viewScale.y;this.cellSize_px.width=this.cellSize_mm.width*e,this.cellSize_px.height=this.cellSize_mm.height*i}}class Kn extends Qt{constructor(t){super(t),this.typedSettings=this.settings,this.dataBufferX=new Float32Array,this.dataBufferY=new Float32Array}init(){super.init();const t=this.getWebglContextProvider();if(void 0===t)return;const e=t.context,i=Kn.createGridBuffer(this.typedSettings);let n=new K;void 0!==this.typedSettings.canvas&&this.typedSettings.canvas instanceof ot&&(n=this.typedSettings.canvas.settings.sizeInPixels),this.uniforms=new Kt({color:this.typedSettings.color,windowSize:[n.width,n.height]}),this.dataBufferX=new Float32Array(i.x);const s=e.createBuffer();if(null==s)return;this.glBufferX=s,e.bindBuffer(e.ARRAY_BUFFER,this.glBufferX),e.bufferData(e.ARRAY_BUFFER,this.dataBufferX,e.STATIC_DRAW),this.dataBufferY=new Float32Array(i.y);const a=e.createBuffer();null!=a&&(this.glBufferY=a,e.bindBuffer(e.ARRAY_BUFFER,this.glBufferY),e.bufferData(e.ARRAY_BUFFER,this.dataBufferY,e.STATIC_DRAW))}async createBorders(){await super.createBorders(),this.updateDataBuffer()}updateDataBuffer(){const t=this.getWebglContextProvider();if(void 0===t)return;const e=t.context;let i=new K;void 0!==this.typedSettings.canvas&&this.typedSettings.canvas instanceof ot&&(i=this.typedSettings.canvas.settings.sizeInPixels),this.uniforms.setValues({windowSize:[i.width,i.height]});const n=Kn.createGridBuffer(this.typedSettings);this.dataBufferX=new Float32Array(n.x);const s=e.createBuffer();if(null==s)return;this.glBufferX=s,e.bindBuffer(e.ARRAY_BUFFER,this.glBufferX),e.bufferData(e.ARRAY_BUFFER,this.dataBufferX,e.STATIC_DRAW),this.dataBufferY=new Float32Array(n.y);const a=e.createBuffer();null!=a&&(this.glBufferY=a,e.bindBuffer(e.ARRAY_BUFFER,this.glBufferY),e.bufferData(e.ARRAY_BUFFER,this.dataBufferY,e.STATIC_DRAW))}draw(){const t=this.getWebglContextProvider();if(void 0===t||void 0===this.glBufferX||void 0===this.glBufferY)return;const e=t.context;e.viewport(0,0,this.uniforms.windowSize[0],this.uniforms.windowSize[1]),this.uniforms.setToContext(t),t.enablePositionAttribute(),e.bindBuffer(e.ARRAY_BUFFER,this.glBufferX);let i=t.getPositionAttribLocation();void 0!==i&&(e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,this.dataBufferX.length/2),e.bindBuffer(e.ARRAY_BUFFER,this.glBufferY),i=t.getPositionAttribLocation(),void 0!==i&&(e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,this.dataBufferY.length/2)))}static createGridBuffer(t){const e=t.absoluteLocation.x,i=t.absoluteLocation.y,n=[],s=[];let a=e,o=i;const r=e+t.sizeInPixels.width,l=i+t.sizeInPixels.height;for(;a<r;)a+t.cellSize_px.width>r?a=r:a+=t.cellSize_px.width,n.push(a),n.push(i),n.push(a),n.push(i+t.sizeInPixels.height);for(;o<l;)o+t.cellSize_px.height>l?o=l:o+=t.cellSize_px.height,s.push(e),s.push(o),s.push(e+t.sizeInPixels.width),s.push(o);return{x:n,y:s}}}!function(t){t[t.Cursor=0]="Cursor",t[t.Measurer=1]="Measurer"}(He||(He={}));class Zn extends gi{constructor(t){var e,i;super(),this.synchronized=null===(e=null==t?void 0:t.synchronized)||void 0===e||e,this.color=null!==(i=null==t?void 0:t.color)&&void 0!==i?i:[0,0,0,1]}}class Jn extends sn{constructor(t){var e;super(void 0===t?void 0:{id_dataSource:t.id_dataSource,id:t.id,y:t.y,height:t.height,variantGroups:t.variantGroups,showIsolines:t.showIsolines,unit:t.unit,scaleX:t.scaleX,scaleY:t.scaleY,isSynchronizedScaleX:t.isSynchronizedScaleX,frequency:t.frequency,filters:t.filters,selectedFiltersNames:t.selectedFiltersNames}),this.expectedPointCounter=null==t?void 0:t.expectedPointCounter,this.canCheckPossibleMax=null===(e=null==t?void 0:t.canCheckPossibleMax)||void 0===e||e}}class Qn extends zi{constructor(t){var e;super(void 0===t?void 0:{location:t.location,size:t.size,margin:t.margin,padding:t.padding,parent:t.parent,debug:t.debug,isVisible:t.isVisible,isDebugMode:t.isDebugMode,html:void 0===t.html?void 0:{ref:t.html.ref,autoUpdate:void 0===t.html.autoUpdate?void 0:{enabled:t.html.autoUpdate.enabled,updater:t.html.autoUpdate.updater},size:t.html.size,location:t.html.location,parent:void 0===t.html.parent?void 0:{ref:t.html.parent.ref,size:t.html.parent.size,location:t.html.parent.location,absoluteLocation:t.html.parent.absoluteLocation},margin:t.html.margin,padding:t.html.padding},id:t.id,content:t.content,sectorBorders:void 0===t.sectorBorders?void 0:{topHeight:t.sectorBorders.topHeight,bottomHeight:t.sectorBorders.bottomHeight,leftWidth:t.sectorBorders.leftWidth,rightWidth:t.sectorBorders.rightWidth,topCentralHeight:t.sectorBorders.topCentralHeight,bottomCentralHeight:t.sectorBorders.bottomCentralHeight,leftCentralWidth:t.sectorBorders.leftCentralWidth,rightCentralWidth:t.sectorBorders.rightCentralWidth},isAutoMarkRestore:t.isAutoMarkRestore,filterProviderCreator:t.filterProviderCreator,title:t.title,dataSources:t.dataSources,contentCreatorsMap:t.contentCreatorsMap,dataSectionSettings:t.dataSectionSettings,linkedChannel:t.linkedChannel}),this.isNeedChannelLeadRay=null===(e=null==t?void 0:t.isNeedChannelLeadRay)||void 0===e||e}}class ts{constructor(t){this.plotObject=t,this.plotSettings=this.plotObject.settings,this.possibleMaxFramePointCounter=65536}init(){if(this.plotSettings.isNeedChannelLeadRay)return;const t=this.getLeadRaySettings();if(void 0===t)return;const e=this.plotObject.signalsBox.sectors[t.sector];if(void 0===e||!(t.obj instanceof Zn))return;const i=t.obj;this.leadLine=new je(new Ye({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new N(1),height:new Z(1)}),parent:new it({ref:e}),color:i.color,pointIndex:0})),this.leadLine.init(),this.leadLine.settings.name="LeadLine",e.addItem(this.leadLine)}getLeadRaySettings(){return this.plotSettings.findPlacedContent("leadRay",[g.Central])}startUpdateMeanValues(){setInterval(this.plotObject.tryUpdateMeanSignalsValue.bind(this.plotObject),2e3)}initUpdateMeanValueFunctions(t,e,i,n){c(t,"addOnIsolineChangedAction")&&t.addOnIsolineChangedAction((async t=>{"number"==typeof t&&this.plotObject.updateMeanValueText(e,i,n,t)}))}clearEventObjects(){this.plotObject.clearAllMarks()}setLeadRaysToZero(){var t;this.plotSettings.isNeedChannelLeadRay?this.plotSettings.dataSources.forEach((t=>{t.channels.forEach((e=>{const i=this.getChannelLead(t.id,e.id);void 0!==i&&i instanceof je&&i.setPosX(0)}))})):null===(t=this.leadLine)||void 0===t||t.setPosX(0)}showLeadRays(){if(this.plotSettings.isNeedChannelLeadRay)this.plotSettings.dataSources.forEach((t=>{t.channels.forEach((e=>{const i=this.getChannelLead(t.id,e.id);void 0!==i&&i instanceof je&&(i.setPosX(0),i.setVisibility(!0))}))}));else{if(void 0===this.leadLine)return;this.leadLine.setPosX(0),this.leadLine.setVisibility(!0)}}hideLeadRays(){if(this.plotSettings.isNeedChannelLeadRay)this.plotSettings.dataSources.forEach((t=>{t.channels.forEach((e=>{const i=this.getChannelLead(t.id,e.id);void 0!==i&&i instanceof je&&(i.setPosX(0),i.setVisibility(!1))}))}));else{if(void 0===this.leadLine)return;this.leadLine.setPosX(0),this.leadLine.setVisibility(!1)}}createSignalsClickableAreas(t,e){if(!t.showIsolines)return;const i=Lt.findJagmHtmlObject(this.plotObject);if(void 0===i)return;const n=new ht("clickable-areas");e.add(n);const s=this.plotObject.getSignalsAreaSize(),a=t.y.calcValue(s.height),o=t.height.calcValue(s.height);t.variantGroups;const r=t.getCurrSignalsVariant();if(void 0===r||!(r instanceof si))return;for(let l=0;l<r.isolines.length;l++){const e=r.isolines[l],s=a+e.y.calcValue(o),d=new ee(new qt({location:new G({x:new N(0),y:new N(s-5)}),size:new J({width:new Z(1),height:new N(10)}),parent:new Vt({ref:this.plotObject.signalsBox.sectors.central,jagmHtml:i}),html:{parent:{ref:i.typedSettings.html.ref}}}));d.setBackgroundFillColor([0,0,1,.07]),d.addOnClickedFunction((async()=>{await this.plotObject.onSignalLabelClicked(t.id_dataSource,t.id)})),d.settings.name=e.id.toString(),n.add(d)}}async createSignalsClickableAreaBorders(){await this.plotObject.dataSourcesContainer.forEachChildAsync((async t=>{if(!(t instanceof ht))return;const e=t.findItem("channels");void 0!==e&&e instanceof ht&&await e.forEachChildAsync((async t=>{if(!(t instanceof ht))return;const e=t.findItem("clickable-areas");void 0!==e&&await e.forEachAsync((async t=>{t instanceof ot&&await t.createBorders()}))}))}))}createChannelLeadRay(t,e){const i=this.getLeadRaySettings();if(void 0===i||!(i.obj instanceof Zn))return;const n=this.plotObject.signalsBox.sectors[i.sector];if(void 0!==n&&this.plotSettings.isNeedChannelLeadRay){const s=this.plotObject.getCreatedChildContainer("data-sources",n.items),a=this.plotObject.getCreatedChildContainer(t.toString(),s),o=this.plotObject.getCreatedChildContainer(e.toString(),a);let r=o.findItem("lead-ray");if(void 0===r){const s=this.plotObject.getChannelSettings(t,e);if(void 0===s)return;const a=this.plotObject.signalsBox.sectors.central.settings.sizeInPixels.height,l=s.y.calcValue(a),d=s.height.calcValue(a),c=i.obj,h=new je(new Ye({location:new G({x:new N(0),y:new N(l)}),size:new J({width:new N(1),height:new N(d)}),parent:new it({ref:n}),color:c.color,pointIndex:0}));h.settings.name="lead-ray",r=h,o.add(r)}}}updateEventObjects(t,e,i,n){if(this.plotSettings.linkedChannel.id_dataSource!=t||this.plotSettings.linkedChannel.id!=e)return;const s=this.plotObject.getFirstChannelSignalObject(t,e);if(void 0===s)return;const a=s.getCurrDataIndex(),o=s.getPointsCount();this.plotObject.tryRemoveMarks(a,i,o),this.checkCounterError(t,e,s,a,i,n,o)}checkCounterError(t,e,i,n,s,a,o){const r=this.plotObject.getChannelSettings(t,e);if(void 0===r||!(r instanceof Jn))return;void 0===r.expectedPointCounter&&(r.canCheckPossibleMax=!0,r.expectedPointCounter=a);let l=!1;if(r.canCheckPossibleMax&&r.expectedPointCounter>=this.possibleMaxFramePointCounter)r.canCheckPossibleMax=a<this.possibleMaxFramePointCounter;else if(r.expectedPointCounter!=a){l=!0;const e=i,a=this.plotObject.getMarkGroupId(t,"frameCounterError"),r=e.getCurrPointX(),d={beginVisPointIndex:n+s-o,endVisPointIndex:n+1,pointIndex:n,x:null==r?void 0:r};this.plotObject.addMark(t,a,d)}r.expectedPointCounter=l?void 0:a+s}addMarkToLinkedChannel(t,e){void 0!==this.plotSettings.linkedChannel.id_dataSource&&void 0!==this.plotSettings.linkedChannel.id&&this.plotObject.addMark(this.plotSettings.linkedChannel.id_dataSource,t,e)}updateLeadRaysPosition(t,e){var i,n,s;if(this.plotSettings.isNeedChannelLeadRay){const n=C("id",t,this.plotSettings.dataSources);if(void 0===n)return;const s=C("id",e,n.channels);if(void 0===s)return;const a=this.getChannelLead(n.id,s.id);if(void 0===a||!(a instanceof je))return;const o=null!==(i=this.plotObject.getSignalCurrPointX(n.id,s.id,0))&&void 0!==i?i:0;a.setPosX(o)}else{if(this.plotSettings.linkedChannel.id_dataSource!=t||this.plotSettings.linkedChannel.id!=e)return;const i=this.plotObject.getFirstChannelSignalObject(t,e);if(void 0===i)return;const a=null!==(n=i.getCurrPointX())&&void 0!==n?n:0;null===(s=this.leadLine)||void 0===s||s.setPosX(a)}}getChannelLead(t,e){const i=this.plotObject.signalsBox.sectors.central.items.findItem("data-sources");if(void 0===i||!(i instanceof ht))return;const n=i.findItem(t.toString());if(void 0===n||!(n instanceof ht))return;const s=n.findItem(e.toString());if(void 0===s||!(s instanceof ht))return;const a=s.findItem("lead-ray");return void 0!==a&&a instanceof ot?a:void 0}}class es extends Ui{constructor(t){super(t),this.onlinePlotObjects=new ts(this)}async initAsync(){this.beforeSignalObjectsCreate=this.beforeSignalObjectsCreateFunc,this.afterSignalObjectCreate=this.afterSignalObjectCreateFunc,this.afterSignalsCreate=this.afterSignalsCreateFunc,this.afterChannelsDataClear=this.afterChannelsDataClearFunc,this.afterAddDataToSignal=this.afterAddDataToSignalFunc,this.afterAddDataToChannels=this.afterAddDataToChannelsFunc,this.addEventListener("BufferSizeChanged",(async()=>{await this.onSignalBoxBufferSizeChanged()})),this.onlinePlotObjects=new ts(this),await super.initAsync(),this.onlinePlotObjects.init(),this.onlinePlotObjects.startUpdateMeanValues()}beforeSignalObjectsCreateFunc(t,e){this.onlinePlotObjects.createSignalsClickableAreas(t,e)}afterSignalObjectCreateFunc(t,e,i,n){this.onlinePlotObjects.initUpdateMeanValueFunctions(t,e,i,n)}afterSignalsCreateFunc(t,e){super.afterSignalsCreateFunc(t,e),this.onlinePlotObjects.createChannelLeadRay(t,e)}async createBorders(){await super.createBorders(),await this.onlinePlotObjects.createSignalsClickableAreaBorders()}async onSignalBoxBufferSizeChanged(){this.onlinePlotObjects.clearEventObjects(),this.clearSignalDependentMarks(),await this.updateMarksBorders()}getChannelLead(t,e){return this.onlinePlotObjects.getChannelLead(t,e)}afterAddDataToSignalFunc(t,e,i){this.onlinePlotObjects.updateLeadRaysPosition(t,e)}afterChannelsDataClearFunc(){this.onlinePlotObjects.setLeadRaysToZero(),this.onlinePlotObjects.clearEventObjects()}afterAddDataToChannelsFunc(t,e,i){void 0!==i&&null!=i&&"object"==typeof i&&"blockSize"in i&&"number"==typeof i.blockSize&&"frameCounter"in i&&"number"==typeof i.frameCounter&&this.onlinePlotObjects.updateEventObjects(t,e,i.blockSize,i.frameCounter)}}!function(t){t[t.Online=0]="Online",t[t.Offline=1]="Offline"}(Ne||(Ne={}));class is{create(t){return new Xi({type:t.type})}}class ns{create(t){return new Hi({id_unit:t.id_unit,scale:t.scale,text:t.text})}}class ss extends bi{constructor(t){super(),this.variantGroupConfig=t}}class as{constructor(t,e,i){this.variantGroupSettingsCreatorMap=t,this.unitSettingsCreator=e,this.channelConversionSettingsCreator=i}create(t){const e=[];return t.variantGroups.forEach((t=>{const i=this.variantGroupSettingsCreatorMap.get(t.name);if(void 0!==i){const n=new ss(t);e.push(i.create(n))}})),new Gi({id:t.id,name:t.name,variantGroups:e,unit:void 0===t.unit?void 0:this.unitSettingsCreator.create(t.unit),original:t.original,maxSignalCount:t.maxSignalCount,hasVariableIsoline:t.hasVariableIsoline,frequency:t.frequency,conversionSettings:void 0===t.conversionSettings?void 0:this.channelConversionSettingsCreator.create(t.conversionSettings)})}}class os{create(t){return new ni(t.variantConfig.name)}}class rs extends os{constructor(t){super(),this.signalSettingsCreator=t}create(t){if(!(t.variantConfig instanceof Y))return new qi({name:"",signals:[]});const e=t.variantConfig,i=[];return e.signals.forEach((t=>{i.push(this.signalSettingsCreator.create(t))})),new qi({name:e.name,signals:i})}}class ls{constructor(t,e,i){this.variantGroupSettingsCreatorMap=t,this.channelSettingsCreator=e,this.markGroupSettingsCreator=i}create(t){const e=[];t.variantGroups.forEach((t=>{const i=this.variantGroupSettingsCreatorMap.get(t.name);if(void 0!==i){const n=new ss(t);e.push(i.create(n))}}));const i=[];t.channels.forEach((t=>{i.push(this.channelSettingsCreator.create(t))}));const n=[];return t.marks.forEach((t=>{n.push(this.markGroupSettingsCreator.create(t))})),new $i({variantGroups:e,id:t.id,channels:i,marks:n})}}class ds{create(t){return new Ki({id:t.id,name:t.name})}}class cs{create(t){return new Zi({id:t.id,name:t.name,title:t.title})}}class hs{constructor(t){this.variantGroupSettingsCreatorMap=t}create(t){const e=[];return t.variantGroups.forEach((t=>{const i=this.variantGroupSettingsCreatorMap.get(t.name);if(void 0!==i){const n=new ss(t);e.push(i.create(n))}})),new Ji({variantGroups:e,id:t.id,text:t.text,scale:t.scale})}}class us extends l{constructor(){super()}}class gs extends us{constructor(t){super(),this.view=t.view,this.color=t.color}}class fs{create(t){if(!(t.sectorConfig.settings instanceof gs))return;const e=t.sectorConfig.settings;let i=[0,0,0,1];const n=x.convertToWebglRgba(e.color);return y(n)&&(i=n.data),new Ei({view:e.view,color:i})}}class ps extends us{constructor(t){super(),this.view=t.view}getMajorCellSizeInMm(){return new K}}class vs extends ps{constructor(t){var e;super({view:t.view}),this.cellSize_mm=t.cellSize_mm,this.color=null!==(e=t.color)&&void 0!==e?e:[0,0,0,1]}getMajorCellSizeInMm(){return this.cellSize_mm}}class ys extends ps{constructor(t){var e,i,n;super({view:t.view}),this.majorCell={size_mm:t.majorCell.size_mm,lineWidth_mm:null!==(e=t.majorCell.lineWidth_mm)&&void 0!==e?e:1},this.minorCell={size_mm:t.minorCell.size_mm,lineWidth_mm:null!==(i=t.minorCell.lineWidth_mm)&&void 0!==i?i:1},this.color=null!==(n=t.color)&&void 0!==n?n:[0,0,0,1]}getMajorCellSizeInMm(){return this.majorCell.size_mm}}class ms{create(t){if(!(t.sectorConfig.settings instanceof ps))return;const e=t.sectorConfig.settings;switch(e.view){case"webgl-single":if(e instanceof vs){let t;const i=x.convertToWebglRgba(e.color);return y(i)&&(t=i.data),new Ri({view:e.view,cellSize_mm:e.cellSize_mm.copy(),color:t})}break;case"webgl-double":case"svg-single":break;case"svg-double":if(e instanceof ys){let t;const i=x.convertToWebglRgba(e.color);return y(i)&&(t=i.data),new Fi({view:e.view,majorCell:{size_mm:e.majorCell.size_mm.copy(),lineWidth_mm:e.majorCell.lineWidth_mm},minorCell:{size_mm:e.minorCell.size_mm.copy(),lineWidth_mm:e.minorCell.lineWidth_mm},color:t})}}}}class Ss extends us{constructor(t){var e;super(),this.labels=null!==(e=null==t?void 0:t.labels)&&void 0!==e?e:[]}}class ws{create(t){if(!(t.sectorConfig.settings instanceof Ss))return;const e=t.sectorConfig.settings,i=[];return e.labels.forEach((t=>{let e=[0,0,0,1];const n=x.convertToWebglRgba(t.color);y(n)&&(e=n.data),i.push(new tn({id:t.id,text:t.text,linkedPosition:t.linkedPosition,y:t.y,color:e,id_signal:t.id_signal}))})),new Yi({labels:i})}}class xs extends us{constructor(t){var e,i,n,s,a,o;super(),this.location=t.location,this.size=t.size,this.title=t.title,this.style=t.style,this.isVisible=t.isVisible,this.channelUnit=t.channelUnit,this.unit=t.unit,this.label={fontSize:null!==(i=null===(e=null==t?void 0:t.label)||void 0===e?void 0:e.fontSize)&&void 0!==i?i:"",fontFamily:null!==(s=null===(n=null==t?void 0:t.label)||void 0===n?void 0:n.fontFamily)&&void 0!==s?s:"",color:null!==(o=null===(a=null==t?void 0:t.label)||void 0===a?void 0:a.color)&&void 0!==o?o:[0,0,0,1]}}}class Cs{create(t){if(!(t.sectorConfig.settings instanceof xs))return;const e=t.sectorConfig.settings;let i,n=[0,0,0,1],s=x.convertToWebglRgba(e.style.color);return y(s)&&(n=s.data),s=x.convertToWebglRgba(e.style.color),y(s)&&(i=s.data),new ki({location:e.location.copy(),size:{width:e.size.width,widthTop:e.size.widthTop},title:e.title,style:{color:n,lineWidth:e.style.lineWidth},isVisible:e.isVisible,channelUnit:e.channelUnit,unit:e.unit,label:{fontSize:e.label.fontSize,fontFamily:e.label.fontFamily,color:i}})}}class bs extends us{constructor(t){var e;super(),this.labels=null!==(e=null==t?void 0:t.labels)&&void 0!==e?e:[]}}class Is{create(t){if(!(t.sectorConfig.settings instanceof bs))return;const e=t.sectorConfig.settings,i=[];return e.labels.forEach((t=>{let e;const n=x.convertToWebglRgba(t.color);y(n)&&(e=n.data),i.push(new en({id:t.id,text:t.text,linkedPosition:t.linkedPosition,y:t.y,color:null!=e?e:[0,0,0,1],id_signal:t.id_signal}))})),new Oi({labels:i})}}class Ps extends l{constructor(t){var e,i,n;super(),this.defaultValues=null!==(e=null==t?void 0:t.defaultValues)&&void 0!==e?e:[],this.defaultIndex=null!==(i=null==t?void 0:t.defaultIndex)&&void 0!==i?i:0==this.defaultValues.length?-1:0,this.distanceUnit=null!==(n=null==t?void 0:t.distanceUnit)&&void 0!==n?n:-1,this.hasDynamicDefaultValue=null==t?void 0:t.hasDynamicDefaultValue,this.values=[...this.defaultValues],this.currIndex=this.defaultIndex,this.currValue=this.currIndex<0||this.currIndex>=this.values.length?void 0:this.values[this.currIndex]}setCurrIndex(t){t<0||this.currIndex>=this.values.length?(this.currIndex=-1,this.currValue=void 0):(this.currIndex=t,this.currValue=this.values[this.currIndex])}}class Bs extends Ps{constructor(t){var e;super({defaultValues:null==t?void 0:t.defaultValues,defaultIndex:null==t?void 0:t.defaultIndex,distanceUnit:null==t?void 0:t.distanceUnit,hasDynamicDefaultValue:null==t?void 0:t.hasDynamicDefaultValue}),this.timeUnit=null!==(e=null==t?void 0:t.timeUnit)&&void 0!==e?e:-1}}class Ds extends Ps{constructor(t){var e;super({defaultValues:null==t?void 0:t.defaultValues,defaultIndex:null==t?void 0:t.defaultIndex,distanceUnit:null==t?void 0:t.distanceUnit,hasDynamicDefaultValue:null==t?void 0:t.hasDynamicDefaultValue}),this.valueUnit=null!==(e=null==t?void 0:t.valueUnit)&&void 0!==e?e:-1}}class Ms extends us{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g,f,p,v;super(),this.unitsXtoMmConvertKoef=null!==(e=null==t?void 0:t.unitsXtoMmConvertKoef)&&void 0!==e?e:10,this.unitsYtoMmConvertKoef=null!==(i=null==t?void 0:t.unitsYtoMmConvertKoef)&&void 0!==i?i:10,this.filters=null!==(n=null==t?void 0:t.filters)&&void 0!==n?n:[],this.defaultFilters=null!==(s=null==t?void 0:t.defaultFilters)&&void 0!==s?s:[],this.scaleX=null!==(a=null==t?void 0:t.scaleX)&&void 0!==a?a:new Bs,this.scaleY=null!==(o=null==t?void 0:t.scaleY)&&void 0!==o?o:new Ds,this.viewScale={x:null!==(l=null===(r=null==t?void 0:t.viewScale)||void 0===r?void 0:r.x)&&void 0!==l?l:1,y:null!==(c=null===(d=null==t?void 0:t.viewScale)||void 0===d?void 0:d.y)&&void 0!==c?c:1},this.labels={color:null!==(u=null===(h=null==t?void 0:t.labels)||void 0===h?void 0:h.color)&&void 0!==u?u:[0,0,0,1],fontFamily:null!==(f=null===(g=null==t?void 0:t.labels)||void 0===g?void 0:g.fontFamily)&&void 0!==f?f:"",fontSize:null!==(v=null===(p=null==t?void 0:t.labels)||void 0===p?void 0:p.fontSize)&&void 0!==v?v:0},this.defaultValueRange=null==t?void 0:t.defaultValueRange,this.selectedFilters=[...this.defaultFilters]}}class zs{create(t){if(!(t.sectorConfig.settings instanceof Ms))return;const e=t.sectorConfig.settings;return new fi({unitsXtoMmConvertKoef:e.unitsXtoMmConvertKoef,unitsYtoMmConvertKoef:e.unitsYtoMmConvertKoef,filters:e.filters,defaultFilters:e.defaultFilters,scaleX:e.scaleX,scaleY:e.scaleY,viewScale:{x:e.viewScale.x,y:e.viewScale.y},labels:{color:e.labels.color,fontFamily:e.labels.fontFamily,fontSize:e.labels.fontSize},defaultValueRange:e.defaultValueRange})}}class ks{create(t){let e;const i=x.convertToWebglRgba(t.color);return y(i)&&(e=i.data),new rn({id:t.id,y:t.y.copy(),color:e,updateBorder:t.updateBorder})}}class As extends j{constructor(t){var e;super(t.name),this.isolines=t.isolines,this.signals=t.signals,this.content=null!==(e=t.content)&&void 0!==e?e:[]}copy(){return new As({name:this.name,isolines:this.isolines.map((t=>t.copy())),signals:this.signals.map((t=>t.copy()))})}findContent(t){const e=C("name",t,this.content);if(void 0!==e)return{obj:e.settings,sector:e.sector}}findPlacedContent(t,e){const i=C("name",t,this.content);if(void 0!==i&&e.includes(i.sector))return{obj:i.settings,sector:i.sector}}}class Fs extends bi{constructor(t){super(),this.sectorConfig=t.sectorConfig,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject}}class Vs extends bi{constructor(t){super(),this.variantConfig=t}}class _s extends Vs{constructor(t){super(t.variantConfig),this.parentObject=t.parentObject,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject,this.dataSection=t.dataSection}}class Rs extends os{constructor(t,e,i){super(),this.contentSettingsCreators=t,this.isolineSettingsCreator=e,this.signalSettingsCreator=i}create(t){if(!(t instanceof _s&&t.variantConfig instanceof As))return new si({name:"",isolines:[],signals:[]});const e=t.variantConfig,i=[];e.content.forEach((e=>{const n=this.contentSettingsCreators.get(e.name);if(void 0===n)return;const s=new Fs({sectorConfig:e,rootConfig:t.rootConfig,rootObject:t.rootObject}),a=n.create(s);if(void 0===a)return;const o=new ln({name:e.name,sector:e.sector,layerZ:e.layerZ,settings:a});i.push(o)}));const n=[];e.signals.forEach((t=>{n.push(this.signalSettingsCreator.create(t))}));const s=[];return e.isolines.forEach((t=>{s.push(this.isolineSettingsCreator.create(t))})),new si({name:e.name,isolines:s,signals:n,content:i})}}class Ls{create(t){let e=[0,0,0,1];const i=x.convertToWebglRgba(t.color);return y(i)&&(e=i.data),new nn({id:t.id,type:t.type,fillType:t.fillType,color:e,id_isoline:t.id_isoline,pointCount:t.pointCount,title:t.title})}}class Es{create(t){return new Bi({index:t.index,values:[...t.values],distanceUnit:t.distanceUnit,timeUnit:t.timeUnit})}}class js{create(t){return new Di({index:t.index,values:[...t.values],distanceUnit:t.distanceUnit,valueUnit:t.valueUnit})}}class Ys extends bi{constructor(t){super(),this.channelConfig=t.channelConfig,this.id_dataSource=t.id_dataSource,this.dataSection=t.dataSection,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject}}class Os extends ss{constructor(t){super(t.variantGroupConfig),this.parentObject=t.parentObject,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject,this.dataSection=t.dataSection}}class Us{constructor(t,e,i,n,s){this.variantGroupSettingsCreatorMap=t,this.unitSettingsCreator=e,this.channelConversionSettingsCreator=i,this.channelScaleXSettingsCreator=n,this.channelScaleYSettingsCreator=s}create(t){const e=[];return t.channelConfig.variantGroups.forEach((i=>{const n=this.variantGroupSettingsCreatorMap.get(i.name);if(void 0!==n){const s=new Os({variantGroupConfig:i,rootConfig:t.rootConfig,rootObject:t.rootObject,dataSection:t.dataSection});e.push(n.create(s))}})),new sn({id_dataSource:t.id_dataSource,id:t.channelConfig.id,y:t.channelConfig.y.copy(),height:t.channelConfig.height.copy(),variantGroups:e,showIsolines:t.channelConfig.showIsolines,unit:void 0===t.channelConfig.unit?void 0:this.unitSettingsCreator.create(t.channelConfig.unit),scaleX:void 0===t.channelConfig.scaleX?void 0:this.channelScaleXSettingsCreator.create(t.channelConfig.scaleX),scaleY:void 0===t.channelConfig.scaleY?void 0:this.channelScaleYSettingsCreator.create(t.channelConfig.scaleY),isSynchronizedScaleX:t.channelConfig.isSynchronizedScaleX,frequency:t.channelConfig.frequency,filters:void 0===t.channelConfig.filters?void 0:t.channelConfig.filters.map((t=>t.copy())),selectedFiltersNames:void 0===t.channelConfig.selectedFiltersNames?void 0:[...t.channelConfig.selectedFiltersNames],defaultFilters:void 0===t.channelConfig.defaultFilters?void 0:[...t.channelConfig.defaultFilters]})}}class Ts{constructor(t){var e,i,n,s,a,o,r,l,d,c;this.axisX=null!==(e=null==t?void 0:t.axisX)&&void 0!==e?e:Oe.FromLeftToRight,this.axisY=null!==(i=null==t?void 0:t.axisY)&&void 0!==i?i:Ue.FromBottomToTop,this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:new N(0),this.y=null!==(s=null==t?void 0:t.y)&&void 0!==s?s:new N(0),this.width=null==t?void 0:t.width,this.height=null==t?void 0:t.height,this.minXSpace=null!==(a=null==t?void 0:t.minXSpace)&&void 0!==a?a:0,this.minYSpace=null!==(o=null==t?void 0:t.minYSpace)&&void 0!==o?o:0,this.signal=null==t?void 0:t.signal,this.signalDependency={x:null!==(l=null===(r=null==t?void 0:t.signalDependency)||void 0===r?void 0:r.x)&&void 0!==l?l:Te.None,y:null!==(c=null===(d=null==t?void 0:t.signalDependency)||void 0===d?void 0:d.y)&&void 0!==c?c:We.None}}copy(){var t,e;return new Ts({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y}})}}class Ws extends Ts{constructor(t){var e;super(void 0===t?void 0:{axisX:t.axisX,axisY:t.axisY,x:t.x,y:t.y,width:t.width,height:t.height,minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:t.signal,signalDependency:t.signalDependency}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1]}copy(){var t,e;return new Ws({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y},color:this.color})}}class Xs{constructor(t){var e,i,n,s,a,o,r;this.place=null!==(e=null==t?void 0:t.place)&&void 0!==e?e:g.Central,this.axisX=null!==(i=null==t?void 0:t.axisX)&&void 0!==i?i:Oe.FromLeftToRight,this.axisY=null!==(n=null==t?void 0:t.axisY)&&void 0!==n?n:Ue.FromBottomToTop,this.x=null!==(s=null==t?void 0:t.x)&&void 0!==s?s:new N(0),this.y=null!==(a=null==t?void 0:t.y)&&void 0!==a?a:new N(0),this.width=null!==(o=null==t?void 0:t.width)&&void 0!==o?o:new Z(1),this.height=null!==(r=null==t?void 0:t.height)&&void 0!==r?r:new Z(1)}copy(){return new Xs({place:this.place,axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:this.width.copy(),height:this.height.copy()})}}class Hs{constructor(t){var e,i;this.id=t.id,this.type=t.type,this.area=null!==(e=t.area)&&void 0!==e?e:new Xs,this.item=null!==(i=t.item)&&void 0!==i?i:new Ts}copy(){var t,e;return new Hs({id:this.id,type:this.type,area:null===(t=this.area)||void 0===t?void 0:t.copy(),item:null===(e=this.item)||void 0===e?void 0:e.copy()})}}class Ns extends Hs{constructor(t){var e;super({id:t.id,type:t.type,area:t.area,item:null!==(e=t.item)&&void 0!==e?e:new Ws})}}class Gs{create(t){return new yi({place:t.place,axisX:t.axisX,axisY:t.axisY,x:t.x.copy(),y:t.y.copy(),width:t.width.copy(),height:t.height.copy()})}}class qs{create(t){var e,i;let n;return void 0!==t.signal&&(n={id_signal:t.signal.id_signal,id_channel:t.signal.id_channel}),new vi({axisX:t.axisX,axisY:t.axisY,x:t.x.copy(),y:t.y.copy(),width:null===(e=t.width)||void 0===e?void 0:e.copy(),height:null===(i=t.height)||void 0===i?void 0:i.copy(),minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:n,signalDependency:{x:t.signalDependency.x,y:t.signalDependency.y},color:[...t.color]})}}class $s{constructor(){this.areaCreator=new Gs,this.itemCreator=new qs}create(t){if(!(t instanceof Ns&&t.item instanceof Ws))return;t.item;const e=this.areaCreator.create(t.area),i=this.itemCreator.create(t.item);return new Si({id:t.id,type:t.type,area:e,item:i})}}class Ks extends Ts{constructor(t){var e;super(void 0===t?void 0:{axisX:t.axisX,axisY:t.axisY,x:t.x,y:t.y,width:t.width,height:t.height,minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:t.signal,signalDependency:t.signalDependency}),this.color=null!==(e=null==t?void 0:t.color)&&void 0!==e?e:[0,0,0,1]}copy(){var t,e;return new Ks({axisX:this.axisX,axisY:this.axisY,x:this.x.copy(),y:this.y.copy(),width:null===(t=this.width)||void 0===t?void 0:t.copy(),height:null===(e=this.height)||void 0===e?void 0:e.copy(),minXSpace:this.minXSpace,minYSpace:this.minYSpace,signal:void 0===this.signal?void 0:{id_signal:this.signal.id_signal,id_channel:this.signal.id_signal},signalDependency:{x:this.signalDependency.x,y:this.signalDependency.y},color:this.color})}}class Zs extends Hs{constructor(t){var e;super({id:t.id,type:t.type,area:t.area,item:null!==(e=t.item)&&void 0!==e?e:new Ks})}}class Js{create(t){var e,i;let n;return void 0!==t.signal&&(n={id_signal:t.signal.id_signal,id_channel:t.signal.id_channel}),new Ke({axisX:t.axisX,axisY:t.axisY,x:t.x.copy(),y:t.y.copy(),width:null===(e=t.width)||void 0===e?void 0:e.copy(),height:null===(i=t.height)||void 0===i?void 0:i.copy(),minXSpace:t.minXSpace,minYSpace:t.minYSpace,signal:n,signalDependency:{x:t.signalDependency.x,y:t.signalDependency.y},color:[...t.color]})}}class Qs{constructor(){this.areaCreator=new Gs,this.itemCreator=new Js}create(t){if(!(t instanceof Zs&&t.item instanceof Ks))return;const e=this.areaCreator.create(t.area),i=this.itemCreator.create(t.item);return new qn({id:t.id,type:t.type,area:e,item:i})}}class ta extends bi{constructor(t){super(),this.dataSourceConfig=t.dataSourceConfig,this.dataSection=t.dataSection,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject}}class ea{constructor(t,e){this.channelSettingsCreator=t,this.markGroupSettingsCreator=e}create(t){const e=[];t.dataSourceConfig.channels.forEach((i=>{const n=new Ys({channelConfig:i,id_dataSource:t.dataSourceConfig.id,rootConfig:t.rootConfig,rootObject:t.rootObject,dataSection:t.dataSection});e.push(this.channelSettingsCreator.create(n))}));const i=[];return t.dataSourceConfig.marks.forEach((t=>{const e=this.markGroupSettingsCreator.create(t);void 0!==e&&i.push(e)})),new an({id:t.dataSourceConfig.id,channels:e,marks:i})}}class ia{constructor(){this.callbackPlaces=["beforeCreate","afterCreate"],this.callbacks=new Map,this.callbackPlaces.forEach((t=>this.callbacks.set(t,[])))}addCallback(t,e){const i=this.callbacks.get(t);void 0!==i&&i.push(e)}async applyCallbacks(t,e){const i=this.callbacks.get(t);if(void 0!==i)for(let n=0;n<i.length;++n){const t=i[n];await t(e)}}}class na extends ia{constructor(){super()}async create(t){if(void 0===t||!(t instanceof ji))return;let e;switch(await this.applyCallbacks("beforeCreate",{settings:t,creator:this}),t.view){case"webgl":e=new oe(new ae({location:new G({x:new N(1),y:new N(1)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new it({ref:t.parentObj}),hasStroke:t.hasStroke,strokeColor:t.strokeColor}));break;case"svg":e=new ee(new qt({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new Vt({ref:t.parentObj,jagmHtml:t.graphicHtmlParentObj}),html:{parent:{ref:t.parentHtmlObj}}}))}return void 0!==e?(await e.initAsync(),"svg"==t.view&&e instanceof ee&&t.hasStroke&&e.setBackgroundStrokeColor(t.strokeColor),await this.applyCallbacks("afterCreate",{graphicObject:e,settings:t,creator:this}),e):void 0}}class sa extends ia{constructor(){super()}async create(t){if(void 0===t||!(t instanceof Vi))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const e=void 0===t.parentObj?void 0:ct(t.parentObj,Nt.isCanvas);let i,n;switch(void 0!==e&&(i=e.typedSettings.contextProvider),t.view){case"webgl-single":t instanceof Li&&(n=new Kn(new $n({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),margin:new $({right:new N(1),top:new N(1)}),parent:new it({ref:t.parentObj}),isVisible:!0,isDebugMode:!1,contextProvider:i,canvas:e,color:t.color,cellSize_mm:t.cellSize_mm})));break;case"webgl-double":case"svg-single":break;case"svg-double":t instanceof _i&&(n=new Wi(new Ti({location:new G({x:new N(0),y:new N(0)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new Vt({ref:t.parentObj,jagmHtml:t.graphicHtmlParentObj}),isVisible:!0,isDebugMode:!1,deviceScale:t.deviceScale,ppi:t.ppi,html:{location:new G({x:new N(t.graphicHtmlParentObj.settings.absoluteLocation.x),y:new N(t.graphicHtmlParentObj.settings.absoluteLocation.y)}),parent:{ref:t.parentHtmlObj}},majorCell:{size_mm:t.majorCell.size_mm.copy(),lineWidth_mm:t.majorCell.lineWidth_mm},minorCell:{size_mm:t.minorCell.size_mm.copy(),lineWidth_mm:t.minorCell.lineWidth_mm},color:[...t.color]})))}return void 0!==n?(await n.initAsync(),await this.applyCallbacks("afterCreate",{graphicObject:n,settings:t,creator:this}),n):void 0}}class aa{}class oa{constructor(t){this.settings=t.copy(),this.settings.needRestart=!0}reset(){this.settings.reset()}apply(t){if(0==t.length)return[];const e=new Array(t.length);for(let i=0;i<t.length;++i)e[i]=this._singleStep(t[i]);return e}singleApply(t){return this._singleStep(t)}_singleStep(t){if(this.settings.isFirstPoint&&(this.firstPoint=t,this.settings.isFirstPoint=!1),null==this.firstPoint)return 0;this.settings.valueStack.add(t-this.firstPoint);let e=this.settings.valueStack.get(0)*this.settings.b[0],i=1;for(let n=1;n<this.settings.a.length;++n)e-=this.settings.a[n]*this.settings.valueStack.get(i),i++,e+=this.settings.b[n]*this.settings.valueStack.get(i),i++;return this.settings.valueStack.add(e),e+this.firstPoint}}class ra{static get filterTypes(){return["low","high","bandpass","bandstop","reject"]}static get longMin(){return-2147483648}static get maxOrder(){return 500}static get defFreq(){return.5}static get eps(){return 1e-6}static get machineEpsilon(){return 5e-16}}class la{create(t){if("butterworth"===t.filterClass){if(!ra.filterTypes.includes(t.type))return;return void 0!==t.limits&&(null!=t.freq?t.normalizedLimits=[2*t.limits[0]/t.freq,2*(t.limits.length>1?t.limits[1]:0)/t.freq]:t.normalizedLimits=[t.limits[0],t.limits.length>1?t.limits[1]:0]),this._createButterworth(t)}}_createButterworth(t){var e,i,n,s,a;const o=t.type;let r=null!==(e=t.order)&&void 0!==e?e:1;const l=null!==(n=null===(i=t.normalizedLimits)||void 0===i?void 0:i[0])&&void 0!==n?n:0,d=null!==(a=null===(s=t.normalizedLimits)||void 0===s?void 0:s[1])&&void 0!==a?a:0,c=[0,0];let h=0,u=0;if(r>ra.maxOrder&&(r=ra.maxOrder),c[0]=l>0&&l<1?l:ra.defFreq,"low"!=o&&"high"!=o&&(c[1]=d>0&&d<1?d:ra.defFreq),"low"==o||"high"==o)h=4*Math.tan(Math.PI*c[0]/2);else{const t=new Array(2);for(let e=0;e<2;++e)t[e]=4*Math.tan(Math.PI*c[e]/2);h=Math.sqrt(t[0]*t[1]),u=t[1]-t[0]}const g=[],f=this._buttap(r,g),p=this._zp2ss(g,f),v=p.a,y=p.b,m=p.c;let S=p.d;switch(o){case"low":this._lp2lp(v,y,h);break;case"bandpass":this._lp2bp(v,y,m,h,u);break;case"high":S=this._lp2hp(v,y,m,S,h);break;case"bandstop":S=this._lp2bs(v,y,m,S,h,u)}this._bilinear(v,y,m,S,2);const w=this._poly(v),x=this._buttnum(o,r,h,u,w);t.a=new Array(w.length),t.b=new Array(x.length);for(let C=0;C<w.length;++C)t.a[C]=w[C];for(let C=0;C<x.length;++C)t.b[C]=x[C];return new oa(t)}_buttap(t,e){if(1==t)return _.resize(e,1,new F(-1)),1;const i=t;_.resize(e,i,new F(0));let n=new F(0,Math.PI/2+Math.PI/(2*t));e[0]=F.exp(n),e[1]=F.conj(e[0]),n=F.mul(e[0],e[1]);for(let s=3;s<=t-1;s+=2){let i=new F(0,Math.PI/2+Math.PI*s/(2*t));i=F.exp(i),e[s-1]=i,e[s]=F.conj(i),n=F.mul(n,F.mul(e[s],e[s-1]))}return 1&t&&(e[i-1]=new F(-1),n=new F(-n.re,n.im)),n.re}_zp2ss(t,e){let i=t.length;for(let r=i-1;r>=0;--r)(isNaN(t[r].re)||isNaN(t[r].im)||t[r].re===1/0||t[r].im===1/0)&&t.splice(r,1);const n=[],s=[],a=[];let o=1;1&i&&(n.length=1,n[0]=[],_.resize(n[0],1,t[i-1].re),s.push(1),a.push(0),o=0,--i);for(let r=0;r<i;++r)for(let e=i-1;e>r;--e)if(t[e-1].re>t[e].re||Math.abs(t[e-1].re-t[e].re)<ra.eps&&t[e-1].im>t[e].im){const i=t[e-1];t[e-1]=t[e],t[e]=i}for(let r=0;r<i;r+=2){const e=_.subarray(t,r,r+2);if(void 0===e)continue;const i=this._polyComplex(e);let l=Math.sqrt(F.abs(e[0])*F.abs(e[1]));0==l&&(l=1);const d=0==n.length?2:n[0].length+2,c=n.length+2,h=new Array(d);h.fill(0),_.resize(n,c,h);for(let t=0;t<c-2;++t)_.resize(n[t],d,0);n[c-2][d-2]=-i[1],n[c-2][d-1]=-i[2],n[c-1][d-2]=l,d>=3&&(n[c-2][d-3]=1),s.push(o),s.push(0);for(let t=0;t<a.length;++t)a[t]=0;a.push(0),a.push(1/l),o=0}return 1==a.length?a[0]=1:a[a.length-1]*=e,o*=e,{a:n,b:s,c:a,d:o}}_norm(t,e){let i=0;for(let n=0;n<t.length;++n)i+=Math.pow(F.abs(t[n]),e);return i=Math.pow(i,1/e),i}_poly(t){const e=[],i=t.length;e.length=i;for(let r=0;r<i;++r)e[r]=new Array(i);for(let r=1;r<=i;++r)for(let n=1;n<=i;++n)e[r-1][n-1]=t[r-1][n-1];const{result:n,wr:s,wi:a}=this._hessenbergqrieigenvalues(e,i);if(!n)return[];const o=[];o.length=i;for(let r=0;r<i;++r)o[r]=new F(s[r],a[r]);return this._polyComplex(o)}_polyComplex(t){const e=t.length,i=new Array(e+1);for(let s=0;s<i.length;++s)i[s]=new F(0,0);i[0]=new F(1,0);for(let s=1;s<=e;++s){const e=new Array(s);for(let n=0;n<s;++n)e[n]=F.mul(t[s-1],i[n]);for(let t=2,n=0;t<=s+1;++t,++n)i[t-1]=F.sub(i[t-1],e[n])}const n=[];n.length=i.length;for(let s=0;s<i.length;++s)n[s]=i[s].re;return n}_lp2lp(t,e,i){const n=t.length,s=t[0].length;for(let o=0;o<n;++o)for(let e=0;e<s;++e)t[o][e]*=i;const a=e.length;for(let o=0;o<a;++o)e[o]*=i}_lp2bp(t,e,i,n,s){const a=n/s;let o=t.length,r=t[0].length;for(let c=0;c<o;++c){for(let e=0;e<r;++e)t[c][e]/=a;_.resize(t[c],2*r,0)}r*=2;const l=new Array(r);l.fill(0),o*=2,_.resize(t,o,l);for(let c=r/2,h=0;c<r;++c,++h)t[h][c]=1;for(let c=o/2,h=0;c<o;++c,++h)t[c][h]=-1;for(let c=0;c<o;++c)for(let e=0;e<r;++e)t[c][e]*=n;const d=e.length;for(let c=0;c<d;++c)e[c]=n*e[c]/a;_.resize(e,2*d,0),_.resize(i,2*i.length,0)}_lp2hp(t,e,i,n,s){const a=this._invar(t),o=a.length;for(let c=0;c<o;++c)for(let e=0;e<o;++e)t[c][e]=a[c][e]*s;const r=new Array(o);r.fill(0);for(let c=0;c<o;++c)for(let t=0;t<o;++t)r[c]+=a[c][t]*e[t];const l=new Array(o);l.fill(0);for(let c=0;c<o;++c)for(let t=0;t<o;++t)l[c]+=i[t]*a[t][c];for(let c=0;c<o;++c)i[c]=l[c];let d=0;for(let c=0;c<o;++c)d+=i[c]*e[c];n-=d;for(let c=0;c<o;++c)e[c]=-r[c]*s;return n}_lp2bs(t,e,i,n,s,a){const o=s/a,r=this._invar(t);let l=t.length,d=t[0].length;for(let y=0;y<l;++y){for(let e=0;e<d;++e)t[y][e]=r[y][e]*s/o;_.resize(t[y],2*d,0)}d*=2;const c=new Array(d);let h,u;for(c.fill(0),l*=2,_.resize(t,l,c),u=d/2,h=0;u<d;++u,++h)t[h][u]=s;for(u=l/2,h=0;u<l;++u,++h)t[u][h]=-s;const g=e.length,f=new Array(g);for(f.fill(0),u=0;u<g;++u)for(let t=0;t<g;++t)f[u]+=r[u][t]*e[t];const p=new Array(g);for(p.fill(0),h=0;h<g;++h)for(u=0;u<g;++u)p[h]+=i[u]*r[u][h];for(u=0;u<g;++u)i[u]=p[u];_.resize(i,2*g,0);let v=0;for(u=0;u<g;++u)v+=i[u]*e[u];for(n-=v,u=0;u<g;++u)e[u]=-s*f[u]/o;return _.resize(e,2*g,0),n}_invar(t){const e=t.length;let i;for(i=0;i<e;++i)if(t[i].length!=e)return[];const n=new Array(e);for(i=0;i<e;++i)n[i]=[],_.resize(n[i],e,0),n[i][i]=1;for(i=0;i<e;++i){const s=t[i][i];for(let n=i;n<e;++n)t[i][n]/=s;for(let t=0;t<e;++t)n[i][t]/=s;for(let a=i+1;a<e;++a){const s=t[a][i];for(let t=0;t<e;++t)n[a][t]-=s*n[i][t];for(let n=i;n<e;++n)t[a][n]-=s*t[i][n]}}for(let s=e-1;s>=0;--s)for(i=s-1;i>=0;--i)for(let a=0;a<e;++a)n[i][a]-=t[i][s]*n[s][a];return n}_bilinear(t,e,i,n,s){const a=1/s,o=Math.sqrt(a),r=t.length,l=new Array(r),d=new Array(r);let c;for(c=0;c<r;++c){l[c]=new Array(r),l[c].fill(0),d[c]=new Array(r),d[c].fill(0);for(let e=0;e<r;++e){const i=t[c][e]*a/2;c==e?(l[c][e]=1+i,d[c][e]=1-i):(l[c][e]=i,d[c][e]=-i)}}const h=this._invar(d);for(c=0;c<r;++c)for(let e=0;e<r;++e){let i=0;for(let t=0;t<r;++t)i+=h[c][t]*l[t][e];t[c][e]=i}const u=new Array(r);for(u.fill(0),c=0;c<r;++c)for(let t=0;t<r;++t)u[c]+=h[c][t]*e[t];const g=new Array(r);g.fill(0);for(let p=0;p<r;++p)for(c=0;c<r;++c)g[p]+=i[c]*h[c][p];for(c=0;c<r;++c)i[c]=o*g[c];let f=0;for(c=0;c<r;++c)f+=g[c]*e[c]*a/2;for(n+=f,c=0;c<r;++c)e[c]=a/o*u[c];return n}_buttnum(t,e,i,n,s){i=2*Math.atan2(i,4);let a=0;const o=[],r=new F(1,0),l=new F(-1,0),d=new F(0,i),c=new F(0,-i);switch(t){case"low":_.resize(o,e,l),a=0;break;case"bandpass":_.resize(o,e,r),_.resize(o,2*e,l),a=i;break;case"high":_.resize(o,e,r),a=Math.PI;break;case"bandstop":_.resize(o,2*e,new F(0));for(let t=0;t<2*e;t+=2)o[t]=F.exp(d);for(let t=1;t<2*e;t+=2)o[t]=F.exp(c);a=0}const h=this._polyComplex(o),u=h.length,g=new Array(u);for(let m=0;m<u;++m){const t=new F(0,-a*m);g[m]=F.exp(t)}let f=new F(0),p=new F(0);for(let m=0;m<u;++m)f=F.add(f,F.mulReal(g[m],s[m])),p=F.add(p,F.mulReal(g[m],h[m]));const v=F.div(f,p),y=new Array(u);for(let m=0;m<u;++m){const t=F.mulReal(v,h[m]);y[m]=t.re}return y}_hessenbergqrieigenvalues(t,e){let i,n,s,a,o,r,l,d,c,h,u,g,f,p,v,y,m,S=!0,w=0,x=0,C=0,b=0;const I=new Array(e),P=new Array(e);if(e>2)for(n=2;n<=e-1;++n){for(h=0,r=n,o=n;o<=e;++o)Math.abs(t[o-1][n-2])>Math.abs(h)&&(h=t[o-1][n-2],r=o);if(r!=n){for(o=n-1;o<=e;++o)c=t[r-1][o-1],t[r-1][o-1]=t[n-1][o-1],t[n-1][o-1]=c;for(o=1;o<=e;++o)c=t[o-1][r-1],t[o-1][r-1]=t[o-1][n-1],t[o-1][n-1]=c}if(0!=h)for(r=n+1;r<=e;++r)if(c=t[r-1][n-2],0!=c){for(c/=h,t[r-1][n-2]=c,o=n;o<=e;++o)t[r-1][o-1]=t[r-1][o-1]-c*t[n-1][o-1];for(o=1;o<=e;++o)t[o-1][n-1]=t[o-1][n-1]+c*t[o-1][r-1]}}for(y=Math.abs(t[0][0]),r=2;r<=e;++r)for(o=r-1;o<=e;++o)y+=Math.abs(t[r-1][o-1]);for(i=e,p=0,m=!0;i>=1;){for(m&&(w=0),m=!0,s=i;s>=2&&(v=Math.abs(t[s-2][s-2])+Math.abs(t[s-1][s-1]),0==v&&(v=y),!(Math.abs(100*v*ra.machineEpsilon)>=Math.abs(t[s-1][s-2])));--s);if(h=t[i-1][i-1],s==i)I[i-1]=h+p,P[i-1]=0,--i;else{if(c=t[i-2][i-2],u=t[i-1][i-2]*t[i-2][i-1],s!=i-1){if(30==w)return S=!1,{result:S,wr:[],wi:[]};if(10==w||20==w){for(p+=h,r=1;r<=i;++r)t[r-1][r-1]-=h;v=Math.abs(t[i-1][i-2])+Math.abs(t[i-2][i-3]),h=.75*v,c=h,u=-.4375*v*v}for(++w,n=i-2;n>=s&&(d=t[n-1][n-1],x=h-d,v=c-d,b=(x*v-u)/t[n][n-1]+t[n-1][n],C=t[n][n]-d-x-v,x=t[n+1][n],v=Math.abs(b)+Math.abs(C)+Math.abs(x),b/=v,C/=v,x/=v,n!=s)&&(f=Math.abs(t[n-1][n-2])*(Math.abs(C)+Math.abs(x)),g=Math.abs(b)*(Math.abs(t[n-2][n-2])+Math.abs(d)+Math.abs(t[n][n])),!(Math.abs(100*g*ra.machineEpsilon)>=Math.abs(f)));--n);for(r=n+2;r<=i;++r)t[r-1][r-3]=0,r!=n+2&&(t[r-1][r-4]=0);for(a=n;a<=i-1;++a)if(a!=n&&(b=t[a-1][a-2],C=t[a][a-2],x=0,a!=i-1&&(x=t[a+1][a-2]),h=Math.abs(b)+Math.abs(C)+Math.abs(x),0!=h&&(b/=h,C/=h,x/=h)),v=Math.abs(Math.sqrt(b*b+C*C+x*x)),b<0&&(v=-v),0!=v){for(a==n?s!=n&&(t[a-1][a-2]=-t[a-1][a-2]):t[a-1][a-2]=-v*h,b+=v,h=b/v,c=C/v,d=x/v,C/=b,x/=b,o=a;o<=i;++o)b=t[a-1][o-1]+C*t[a][o-1],a!=i-1&&(b+=x*t[a+1][o-1],t[a+1][o-1]=t[a+1][o-1]-b*d),t[a][o-1]=t[a][o-1]-b*c,t[a-1][o-1]=t[a-1][o-1]-b*h;for(l=i<a+3?i:a+3,r=s;r<=l;++r)b=h*t[r-1][a-1]+c*t[r-1][a],a!=i-1&&(b+=d*t[r-1][a+1],t[r-1][a+1]=t[r-1][a+1]-b*x),t[r-1][a]=t[r-1][a]-b*C,t[r-1][a-1]=t[r-1][a-1]-b}m=!1;continue}b=.5*(c-h),C=b*b+u,d=Math.sqrt(Math.abs(C)),h+=p,C>=0?(d=b<0?b-Math.abs(d):b+Math.abs(d),I[i-1]=h+d,I[i-2]=I[i-1],0!=d&&(I[i-1]=h-u/d),P[i-1]=0,P[i-2]=0):(I[i-1]=h+b,I[i-2]=I[i-1],P[i-1]=d,P[i-2]=-d),i-=2}}return{result:S,wr:I,wi:P}}}class da{constructor(t){this.values=new Array(t),this.values.fill(0),this.insertIndex=0}add(t){this.values[this.insertIndex]=t,this.insertIndex++,this.insertIndex==this.values.length&&(this.insertIndex=0)}get(t){let e=this.insertIndex-t-1;return e<0&&(e+=this.values.length),this.values[e]}copy(){const t=new da(this.values.length);for(let e=0;e<this.values.length;++e)t.values[e]=this.values[e];return t.insertIndex=this.insertIndex,t}}class ca{constructor(t){this.name=null==t.name?t.type:t.name,this.type=t.type,this.filterClass=t.filterClass,this.order=t.order,this.priority=t.priority,this.a=null==t.a?[]:[...t.a],this.b=null==t.b?[]:[...t.b],this.freq=t.freq,this.normalizedLimits=t.normalizedLimits,this.limits=t.limits,this.needRestart=!0,this.isFirstPoint=!0,this.valueStack=new da(2*this.a.length)}reset(){this.isFirstPoint=!0,this.valueStack=new da(2*this.a.length),this.needRestart=!0}copy(){const t=new ca({type:this.type,filterClass:this.filterClass,order:this.order,priority:this.priority,a:this.a,b:this.b,freq:this.freq,normalizedLimits:this.normalizedLimits,limits:this.limits});return t.needRestart=this.needRestart,t.isFirstPoint=this.isFirstPoint,t.valueStack=this.valueStack.copy(),t}}class ha{constructor(t){var e;this.name=null!==(e=t.name)&&void 0!==e?e:"",this.type=t.type,this.freq=t.freq,this.filterClass=t.filterClass,this.a=void 0!==t.a?[...t.a]:[],this.b=void 0!==t.b?[...t.b]:[],this.order=t.order,this.priority=t.priority,this.normalizedLimits=t.normalizedLimits?[...t.normalizedLimits]:[],this.limits=t.limits?[...t.limits]:[]}createJsSettings(){return new ca({name:this.name,type:this.type,filterClass:this.filterClass,a:this.a,b:this.b,order:this.order,priority:this.priority,freq:this.freq,normalizedLimits:this.normalizedLimits,limits:this.limits})}copy(){return new ha({name:this.name,type:this.type,filterClass:this.filterClass,a:this.a,b:this.b,order:this.order,priority:this.priority,freq:this.freq,normalizedLimits:this.normalizedLimits,limits:this.limits})}}class ua{constructor(t){this.settings=t,this.idGenerator=new b,this.filters=[],this.filterFactory=new la}addFilter(t){if(!(t instanceof ha))return;const e=this.idGenerator.generateNextId(),i=this.filterFactory.create(t.createJsSettings());void 0!==i&&this.filters.push({id:e,type:t.type,settings:t,filter:i})}removeFilter(t){for(let e=0;e<this.filters.length;++e)if(this.filters[e].id==t)return void this.filters.splice(e,1)}clearFilters(){this.filters=[]}applyFilters(t){let e=t;for(let i=0;i<this.filters.length;++i)e=this.filters[i].filter.singleApply(e);return e}recreateFilters(){for(let t=0;t<this.filters.length;++t){const e=this.filters[t].settings;if(!(e instanceof ha))continue;const i=e.createJsSettings(),n=this.filterFactory.create(i);void 0!==n&&(this.filters[t].filter=n)}}resetFilters(){for(let t=0;t<this.filters.length;++t)this.filters[t].filter.reset()}setFreq(t){for(let e=0;e<this.filters.length;++e){const i=this.filters[e];if(i.settings.freq=t,!(i.settings instanceof ha))continue;const n=i.settings.createJsSettings(),s=this.filterFactory.create(n);void 0!==s&&(i.filter=s)}}}class ga extends ia{constructor(){super()}async create(t){var e;if(void 0===t||!(t instanceof Ii))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const i=null!==(e=t.signalSettings.type)&&void 0!==e?e:"line",n=t.plotSettings.findPlacedContent("signals",[g.Central]);if(void 0===n||!(n.obj instanceof fi))return;const s=n.obj,a=this.getCommonChannelSettins(t);if(void 0===a)return;let o;switch(i){case"line":{let e="";a.hasVariableIsoline?e+="variable-isoline-":e+="const-isoline-",e+="line",o=this.createLine(e,t,s);break}case"histogram":{const e=t.plotSettings.ppcm/10,i=this.calculateScales(t),n=ct(t.plot,Nt.isCanvas);let a;void 0!==n&&(a=n.typedSettings.contextProvider),o=new Wn(new Tn({location:new G({x:new N(0),y:new N(t.isolineY)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new it({ref:t.parent}),isVisible:!0,isDebugMode:!1,contextProvider:a,canvas:n,ppmm:e,color:t.signalSettings.color,viewScale:new H({x:s.viewScale.x,y:s.viewScale.y}),valuePixelConvertKoef:t.signalsBoxSettings.unitsYtoMmConvertKoef*e,plotSize:t.signalsBoxSettings.sizeInPixels.copy(),windowSize:t.signalsBoxSettings.sizeInPixels.copy(),scaleX:i.scaleX,scaleY:i.scaleY}))}}return void 0!==o?(o.init(),await this.applyCallbacks("afterCreate",{graphicObject:o,settings:t,creator:this}),o):void 0}getCommonChannelSettins(t){const e=t.plotSettings.dataSectionSettings,i=C("id",t.channelSettings.id_dataSource,e.sources);if(void 0!==i)return C("id",t.channelSettings.id,i.channels)}createLine(t,e,i){const n=ct(e.plot,Nt.isCanvas);let s;void 0!==n&&(s=n.typedSettings.contextProvider);const a=e.plotSettings.ppcm/10,o=this.calculateScales(e);let r=e.channelSettings.frequency;const l=e.plotSettings.dataSectionSettings;if(void 0===r){const t=C("id",e.channelSettings.id_dataSource,l.sources);if(void 0!==t){const i=C("id",e.channelSettings.id,t.channels);void 0!==i&&(r=i.frequency)}}switch(t){case"variable-isoline-line":return new Gn(new Nn({location:new G({x:new N(0),y:new N(e.isolineY)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new it({ref:e.parent}),isVisible:!0,isDebugMode:!1,contextProvider:s,canvas:n,ppmm:a,color:e.signalSettings.color,viewScale:new H({x:i.viewScale.x,y:i.viewScale.y}),isDataSync:!0,frequency:r,scaleX:o.scaleX,scaleY:o.scaleY,valuePixelConvertKoef:e.signalsBoxSettings.unitsYtoMmConvertKoef*a,fillType:"period"==e.signalSettings.fillType?Xe.Period:Xe.Custom,filterProvider:new ua(new aa),isolineChangeBound:e.isolineSettings.updateBorder}));case"const-isoline-line":return new Ln(new Pn({location:new G({x:new N(0),y:new N(e.isolineY)}),size:new J({width:new Z(1),height:new Z(1)}),parent:new it({ref:e.parent}),isVisible:!0,isDebugMode:!1,contextProvider:s,canvas:n,ppmm:a,color:e.signalSettings.color,viewScale:new H({x:i.viewScale.x,y:i.viewScale.y}),isDataSync:!0,frequency:r,scaleX:o.scaleX,scaleY:o.scaleY,valuePixelConvertKoef:e.signalsBoxSettings.unitsYtoMmConvertKoef*a,fillType:"period"==e.signalSettings.fillType?Xe.Period:Xe.Custom}))}}calculateScales(t){var e,i;const n=t.plotSettings.dataSectionSettings;let s=di(t.channelSettings,n);void 0===s&&(s=1);return{scaleX:t.channelSettings.isSynchronizedScaleX||void 0===t.channelSettings.scaleX||void 0===t.channelSettings.scaleX.index||t.channelSettings.scaleX.index<0||void 0===t.channelSettings.scaleX.values||0==t.channelSettings.scaleX.values.length?null!==(e=t.signalsBoxSettings.scaleX.currValue)&&void 0!==e?e:0:t.channelSettings.scaleX.values[t.channelSettings.scaleX.index],scaleY:(void 0!==t.channelSettings.scaleY&&void 0!==t.channelSettings.scaleY.index&&t.channelSettings.scaleY.index>=0&&void 0!==t.channelSettings.scaleY.values&&t.channelSettings.scaleY.values.length>0?t.channelSettings.scaleY.values[t.channelSettings.scaleY.index]:null!==(i=t.signalsBoxSettings.scaleY.currValue)&&void 0!==i?i:0)*s/t.signalsBoxSettings.unitsYtoMmConvertKoef}}}class fa extends bi{constructor(t){super(),this.idGenerator=t.idGenerator,this.visualSettings=t.visualSettings,this.viewObjectCreators=t.viewObjectCreators,this.parentObject=t.parentObject,this.rootConfig=t.rootConfig,this.rootObject=t.rootObject,this.dataSection=t.dataSection}}class pa extends ia{constructor(){super()}async create(t){}}class va extends pa{constructor(){super(),this.callbackPlaces.push("beforeAddItems"),this.callbacks.set("beforeAddItems",[])}async createItem(t,e){if(!t.viewObjectCreators.has(t.visualSettings.type))return;const i=t.viewObjectCreators.get(t.visualSettings.type);if(void 0===i)return;void 0===t.visualSettings.id&&(t.visualSettings.id=t.idGenerator.generateNextId());const n=await i.create(t);void 0!==n&&(n.settings.name=`${t.visualSettings.id}`,e(n))}}class ya extends l{constructor(t){var e,i,n,s;super(),this.id=t.id,this.type=t.type,this.x=null!==(e=t.x)&&void 0!==e?e:new N(0),this.y=null!==(i=t.y)&&void 0!==i?i:new N(0),this.width=null!==(n=t.width)&&void 0!==n?n:new Z(1),this.height=null!==(s=t.height)&&void 0!==s?s:new Z(1),this.margin=t.margin,this.padding=t.padding}}class ma{}class Sa extends ma{constructor(t){super(),this.items=t.items}}class wa extends ya{constructor(t){var e;super({id:null==t?void 0:t.id,type:"canvas",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.items=null!==(e=null==t?void 0:t.items)&&void 0!==e?e:[],this.parentWidth=null==t?void 0:t.parentWidth,this.parentHeight=null==t?void 0:t.parentHeight,this.parentHtmlObject=null==t?void 0:t.parentHtmlObject}createSaveableSettings(){const t=[];for(let e=0;e<this.items.length;++e){const i=this.items[e];c(i,"createSaveableSettings")&&t.push(i.createSaveableSettings())}return new Sa({items:t})}applySaveableSettings(t){if(t instanceof Sa)for(let e=0;e<this.items.length;++e){const i=this.items[e],n=t.items[e];c(i,"createSaveableSettings")&&i.applySaveableSettings(n)}}}class xa extends ma{constructor(t){super(),this.columns=t.columns}}class Ca extends ya{constructor(t){var e,i,n,s;if(super({id:null==t?void 0:t.id,type:"column-grid",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.columnsSpace=null!==(e=null==t?void 0:t.columnsSpace)&&void 0!==e?e:new N(0),this.columns=[],void 0!==(null==t?void 0:t.columns))for(let a=0;a<t.columns.length;++a){const e=t.columns[a],o=null!==(i=e.width)&&void 0!==i?i:new Z(1),r=null!==(n=e.rowsSpace)&&void 0!==n?n:new N(0),l=[];if(void 0!==e.rows)for(let t=0;t<e.rows.length;++t){const i=e.rows[t];l.push({height:null!==(s=i.height)&&void 0!==s?s:new Z(1),item:i.item})}this.columns.push({width:o,rowsSpace:r,rows:l})}}createSaveableSettings(){const t=[];for(let e=0;e<this.columns.length;++e){const i=this.columns[e],n=[];for(let t=0;t<i.rows.length;++t){const e=i.rows[t];void 0!==e.item&&c(e.item,"createSaveableSettings")&&n.push({item:e.item.createSaveableSettings()})}t.push({rows:n})}return new xa({columns:t})}applySaveableSettings(t){if(t instanceof xa)for(let e=0;e<t.columns.length;++e){const i=t.columns[e],n=this.columns[e];let s=0;for(let t=0;t<n.rows.length;++t){const e=n.rows[t];void 0!==e.item&&c(e.item,"createSaveableSettings")&&(e.item.applySaveableSettings(i.rows[s].item),++s)}}}}class ba extends va{constructor(){super()}async create(t){var e,i,n,s,a;if(!(void 0!==t&&t instanceof fa&&t.visualSettings instanceof Ca))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const o=t.visualSettings,r=void 0===t.parentObject?void 0:ct(t.parentObject,Nt.isCanvas);let l;if(void 0!==r){l=r.typedSettings.contextProvider}const d=[];for(let g=0;g<o.columns.length;++g){const t=o.columns[g],e=[];for(let i=0;i<t.rows.length;++i){const n=t.rows[i];e.push({height:n.height.copy()})}d.push({width:t.width.copy(),rowsSpace:t.rowsSpace.copy(),rows:e})}const c=new ue({id:o.id,idGenerator:t.idGenerator,location:new G({x:o.x.copy(),y:o.y.copy()}),size:new J({width:o.width.copy(),height:o.height.copy()}),margin:null!==(i=null===(e=o.margin)||void 0===e?void 0:e.copy())&&void 0!==i?i:void 0,padding:null!==(s=null===(n=o.padding)||void 0===n?void 0:n.copy())&&void 0!==s?s:void 0,parent:void 0===t.parentObject?void 0:new it({ref:t.parentObject}),isVisible:!0,isDebugMode:!1,contextProvider:l,canvas:r,columnsSpace:o.columnsSpace.copy(),columns:d}),h=new he(c);h.init();const u=null!==(a=t.rootObject)&&void 0!==a?a:h;await this.applyCallbacks("beforeAddItems",{graphicObject:h,graphicObjectSettings:t,creator:this});for(let g=0;g<o.columns.length;++g){const e=o.columns[g];for(let i=0;i<e.rows.length;++i){const n=e.rows[i].item;if(void 0===n)continue;const s=t.viewObjectCreators.get(n.type);if(void 0===s)continue;void 0===n.id&&(n.id=t.idGenerator.generateNextId());const a=h.getCell(g,i);if(void 0===a)continue;const o=await s.create(new fa({idGenerator:t.idGenerator,visualSettings:n,viewObjectCreators:t.viewObjectCreators,parentObject:a,rootConfig:t.rootConfig,rootObject:u,dataSection:t.dataSection}));void 0!==o&&(o.settings.name=`${n.id}`,h.addItem(g,i,o))}}return await this.applyCallbacks("afterCreate",{graphicObject:h,settings:t,creator:this}),h}}class Ia extends wa{constructor(t){var e;super(void 0===t?void 0:{id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,items:t.items,parentWidth:t.parentWidth,parentHeight:t.parentHeight,parentHtmlObject:t.parentHtmlObject}),this.withFpsMeter=null!==(e=null==t?void 0:t.withFpsMeter)&&void 0!==e&&e}}class Pa extends va{constructor(){super()}async create(t){var e,i,n,s,a,o,r;if(!(void 0!==t&&t instanceof fa&&t.visualSettings instanceof Ia))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const l=void 0===t.parentObject?void 0:ct(t.parentObject,Lt.isJagmHtmlObject),d=t.visualSettings,c=new $t({id:d.id,idGenerator:t.idGenerator,location:new G({x:d.x.copy(),y:d.y.copy()}),size:new J({width:d.width.copy(),height:d.height.copy()}),margin:null===(e=d.margin)||void 0===e?void 0:e.copy(),padding:null===(i=d.padding)||void 0===i?void 0:i.copy(),isVisible:!0,isDebugMode:!1,parent:void 0===t.parentObject?new Ft({jagmHtml:l,size:new K({width:null!==(n=d.parentWidth)&&void 0!==n?n:0,height:null!==(s=d.parentHeight)&&void 0!==s?s:0})}):new Vt({ref:t.parentObject,jagmHtml:l}),html:{location:new G({x:d.x.copy(),y:d.y.copy()}),parent:{ref:d.parentHtmlObject,size:new K({width:null!==(a=d.parentWidth)&&void 0!==a?a:0,height:null!==(o=d.parentHeight)&&void 0!==o?o:0})}},drawEnabled:!0,backgroundColor:[0,0,0,0]}),h=d.withFpsMeter?new we(c):new Nt(c);await h.initAsync();const u=null!==(r=t.rootObject)&&void 0!==r?r:h;await this.applyCallbacks("beforeAddItems",{graphicObject:h,graphicObjectSettings:t,creator:this});for(let g=0;g<d.items.length;++g){const e=d.items[g],i=t.viewObjectCreators.get(e.type);if(void 0===i)continue;void 0===e.id&&(e.id=t.idGenerator.generateNextId());const n=await i.create(new fa({idGenerator:t.idGenerator,visualSettings:e,viewObjectCreators:t.viewObjectCreators,parentObject:h,rootConfig:t.rootConfig,rootObject:u,dataSection:t.dataSection}));void 0!==n&&(n.settings.name=`${e.id}`,h.addItem(n))}return await this.applyCallbacks("afterCreate",{graphicObject:h,settings:t,creator:this}),h}}class Ba extends ma{constructor(t){super(),this.rows=t.rows}}class Da extends ya{constructor(t){var e,i,n,s;if(super({id:null==t?void 0:t.id,type:"grid",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.rowsSpace=null!==(e=null==t?void 0:t.rowsSpace)&&void 0!==e?e:new N(0),this.rows=[],void 0!==(null==t?void 0:t.rows))for(let a=0;a<t.rows.length;++a){const e=t.rows[a],o=null!==(i=e.height)&&void 0!==i?i:new Z(1),r=null!==(n=e.columnsSpace)&&void 0!==n?n:new N(0),l=[];if(void 0!==e.columns)for(let t=0;t<e.columns.length;++t){const i=e.columns[t];l.push({width:null!==(s=i.width)&&void 0!==s?s:new Z(1),item:i.item})}this.rows.push({height:o,columnsSpace:r,columns:l})}}createSaveableSettings(){const t=[];for(let e=0;e<this.rows.length;++e){const i=this.rows[e],n=[];for(let t=0;t<i.columns.length;++t){const e=i.columns[t];void 0!==e.item&&c(e.item,"createSaveableSettings")&&n.push({item:e.item.createSaveableSettings()})}t.push({columns:n})}return new Ba({rows:t})}applySaveableSettings(t){if(t instanceof Ba)for(let e=0;e<t.rows.length;++e){const i=t.rows[e],n=this.rows[e];let s=0;for(let t=0;t<n.columns.length;++t){const e=n.columns[t];void 0!==e.item&&c(e.item,"createSaveableSettings")&&(e.item.applySaveableSettings(i.columns[s].item),++s)}}}}class Ma extends va{constructor(){super()}async create(t){var e,i,n,s,a;if(!(void 0!==t&&t instanceof fa&&t.visualSettings instanceof Da))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const o=t.visualSettings,r=void 0===t.parentObject?void 0:ct(t.parentObject,Nt.isCanvas);let l;void 0===r||r.settings instanceof $t||(l=r.typedSettings.contextProvider);const d=[];for(let g=0;g<o.rows.length;++g){const t=o.rows[g],e=[];for(let i=0;i<t.columns.length;++i){const n=t.columns[i];e.push({width:n.width.copy()})}d.push({height:t.height.copy(),columnsSpace:t.columnsSpace.copy(),columns:e})}const c=new ce({id:o.id,idGenerator:t.idGenerator,location:new G({x:o.x.copy(),y:o.y.copy()}),size:new J({width:o.width.copy(),height:o.height.copy()}),margin:null!==(i=null===(e=o.margin)||void 0===e?void 0:e.copy())&&void 0!==i?i:void 0,padding:null!==(s=null===(n=o.padding)||void 0===n?void 0:n.copy())&&void 0!==s?s:void 0,parent:void 0===t.parentObject?void 0:new it({ref:t.parentObject}),isVisible:!0,isDebugMode:!1,contextProvider:l,canvas:r,rowsSpace:o.rowsSpace.copy(),rows:d}),h=new de(c);h.init();const u=null!==(a=t.rootObject)&&void 0!==a?a:h;await this.applyCallbacks("beforeAddItems",{graphicObject:h,graphicObjectSettings:t,creator:this});for(let g=0;g<o.rows.length;++g){const e=o.rows[g];for(let i=0;i<e.columns.length;++i){const n=e.columns[i].item;if(void 0===n)continue;const s=t.viewObjectCreators.get(n.type);if(void 0===s)continue;void 0===n.id&&(n.id=t.idGenerator.generateNextId());const a=h.getCell(g,i);if(void 0===a)continue;const o=await s.create(new fa({idGenerator:t.idGenerator,visualSettings:n,viewObjectCreators:t.viewObjectCreators,parentObject:a,rootConfig:t.rootConfig,rootObject:u,dataSection:t.dataSection}));void 0!==o&&(o.settings.name=`${n.id}`,h.addItem(g,i,o))}}return await this.applyCallbacks("afterCreate",{graphicObject:h,settings:t,creator:this}),h}}class za extends ma{constructor(t){super(),this.items=t.items}}class ka extends ya{constructor(t){var e;super({id:null==t?void 0:t.id,type:"panel",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.items=null!==(e=null==t?void 0:t.items)&&void 0!==e?e:[]}createSaveableSettings(){const t=[];for(let e=0;e<this.items.length;++e){const i=this.items[e];c(i,"createSaveableSettings")&&t.push(i.createSaveableSettings())}return new za({items:t})}applySaveableSettings(t){if(t instanceof za)for(let e=0;e<this.items.length;++e){const i=this.items[e],n=t.items[e];c(i,"createSaveableSettings")&&i.applySaveableSettings(n)}}}class Aa extends va{constructor(){super()}async create(t){var e,i,n,s,a;if(!(void 0!==t&&t instanceof fa&&t.visualSettings instanceof ka))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const o=t.visualSettings,r=void 0===t.parentObject?void 0:ct(t.parentObject,Nt.isCanvas);let l;void 0!==r&&(l=r.typedSettings.contextProvider);const d=new fe(new ge({id:o.id,idGenerator:t.idGenerator,location:new G({x:o.x.copy(),y:o.y.copy()}),size:new J({width:o.width.copy(),height:o.height.copy()}),margin:null!==(i=null===(e=o.margin)||void 0===e?void 0:e.copy())&&void 0!==i?i:void 0,padding:null!==(s=null===(n=o.padding)||void 0===n?void 0:n.copy())&&void 0!==s?s:void 0,parent:void 0===t.parentObject?void 0:new it({ref:t.parentObject}),isVisible:!0,isDebugMode:!1,contextProvider:l,canvas:r}));d.init();const c=null!==(a=t.rootObject)&&void 0!==a?a:d;await this.applyCallbacks("beforeAddItems",{graphicObject:d,graphicObjectSettings:t,creator:this});for(let h=0;h<o.items.length;++h){const e=o.items[h];if(!t.viewObjectCreators.has(e.type))continue;const i=t.viewObjectCreators.get(e.type);if(void 0===i)continue;void 0===e.id&&(e.id=t.idGenerator.generateNextId());const n=await i.create(new fa({idGenerator:t.idGenerator,visualSettings:e,viewObjectCreators:t.viewObjectCreators,parentObject:d,rootConfig:t.rootConfig,rootObject:c,dataSection:t.dataSection}));void 0!==n&&(n.settings.name=`${e.id}`,d.addItem(n))}return await this.applyCallbacks("afterCreate",{graphicObject:d,settings:t,creator:this}),d}}class Fa extends va{constructor(t){super(),this.contentSettingsCreators=t}async create(t){if(void 0===t||!(t instanceof fa))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const e=this.createPlotObject(t);return void 0!==e?(await e.initAsync(),await this.applyCallbacks("afterCreate",{graphicObject:e,settings:t,creator:this}),e):void 0}}class Va extends ya{constructor(t){var e,i,n,s;if(super({id:null==t?void 0:t.id,type:"table",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.rowsSpace=null!==(e=null==t?void 0:t.rowsSpace)&&void 0!==e?e:new N(0),this.columnsSpace=null!==(i=null==t?void 0:t.columnsSpace)&&void 0!==i?i:new N(0),this.rows=[],void 0!==(null==t?void 0:t.rows))for(let a=0;a<t.rows.length;++a)this.rows.push({height:null!==(n=t.rows[a].height)&&void 0!==n?n:new Z(1)});if(this.columns=[],void 0!==(null==t?void 0:t.columns))for(let a=0;a<t.columns.length;++a)this.columns.push({width:null!==(s=t.columns[a].width)&&void 0!==s?s:new Z(1)});if(this.mergedCells=[],void 0!==(null==t?void 0:t.mergedCells))for(let a=0;a<t.mergedCells.length;++a){const e=t.mergedCells[a];this.mergedCells.push({rowBegin:e.rowBegin,rowEnd:e.rowEnd,columnBegin:e.columnBegin,columnEnd:e.columnEnd})}if(this.items=[],void 0!==(null==t?void 0:t.items)){this.items.length=t.items.length;for(let e=0;e<t.items.length;++e){const i=t.items[e],n=[];n.length=i.length;for(let t=0;t<i.length;++t)n[t]=i[t];this.items[e]=n}}}}class _a extends va{constructor(){super()}async create(t){var e,i,n,s,a;if(!(void 0!==t&&t instanceof fa&&t.visualSettings instanceof Va))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const o=t.visualSettings,r=void 0===t.parentObject?void 0:ct(t.parentObject,Nt.isCanvas);let l;void 0!==r&&r.settings instanceof $t&&(l=r.settings.contextProvider);const d=new re(new le({id:o.id,idGenerator:t.idGenerator,location:new G({x:o.x.copy(),y:o.y.copy()}),size:new J({width:o.width.copy(),height:o.height.copy()}),margin:null!==(i=null===(e=o.margin)||void 0===e?void 0:e.copy())&&void 0!==i?i:void 0,padding:null!==(s=null===(n=o.padding)||void 0===n?void 0:n.copy())&&void 0!==s?s:void 0,parent:void 0===t.parentObject?void 0:new it({ref:t.parentObject}),isVisible:!0,isDebugMode:!1,contextProvider:l,canvas:r,rowsSpace:o.rowsSpace.copy(),columnsSpace:o.columnsSpace.copy(),rows:o.rows.map((t=>({height:t.height.copy()}))),columns:o.columns.map((t=>({width:t.width.copy()}))),mergedCells:o.mergedCells.map((t=>({rowBegin:t.rowBegin,rowEnd:t.rowEnd,columnBegin:t.columnBegin,columnEnd:t.columnEnd})))}));d.init();const c=null!==(a=t.rootObject)&&void 0!==a?a:d;await this.applyCallbacks("beforeAddItems",{graphicObject:d,graphicObjectSettings:t,creator:this});for(let h=0;h<o.items.length;++h){const e=o.items[h];for(let i=0;i<e.length;++i){const n=e[i],s=t.viewObjectCreators.get(n.type);if(void 0===s)continue;void 0===n.id&&(n.id=t.idGenerator.generateNextId());const a=d.getCell(h,i);if(void 0===a)continue;const o=await s.create(new fa({idGenerator:t.idGenerator,visualSettings:n,viewObjectCreators:t.viewObjectCreators,parentObject:a,rootConfig:t.rootConfig,rootObject:c,dataSection:t.dataSection}));void 0!==o&&(o.settings.name=`${n.id}`,d.addItem(h,i,o))}}return await this.applyCallbacks("afterCreate",{graphicObject:d,settings:t,creator:this}),d}}class Ra{constructor(t,e){void 0===e&&(e=void 0),this.variantSettingsCreatorMap=t,this.defaultVariantSettingsCreator=e}create(t){if(!(t instanceof Os))return new dn({name:t.variantGroupConfig.name,variants:[]});const e=[];return t.variantGroupConfig.variants.forEach((i=>{const n=this.variantSettingsCreatorMap.get(i.name),s=new _s({variantConfig:i,parentObject:t.parentObject,rootConfig:t.rootConfig,rootObject:t.rootObject,dataSection:t.dataSection});void 0!==n?e.push(n.create(s)):void 0!==this.defaultVariantSettingsCreator&&e.push(this.defaultVariantSettingsCreator.create(s))})),new dn({name:t.variantGroupConfig.name,currVariant:t.variantGroupConfig.currVariant,defaultVariant:t.variantGroupConfig.defaultVariant,variants:e})}}class La{constructor(t,e,i){this.variantGroupSettingsCreatorMap=t,this.dataUnitSettingsCreator=e,this.dataSourceSettingsCreator=i}create(t){const e=[];t.variantGroups.forEach((t=>{const i=this.variantGroupSettingsCreatorMap.get(t.name);if(void 0!==i){const n=new ss(t);e.push(i.create(n))}}));const i=[];t.units.forEach((t=>{i.push(this.dataUnitSettingsCreator.create(t))}));const n=[];return t.sources.forEach((t=>{n.push(this.dataSourceSettingsCreator.create(t))})),new Ve({variantGroups:e,units:i,sources:n})}}class Ea{constructor(t,e){void 0===e&&(e=void 0),this.variantSettingsCreatorMap=t,this.defaultVariantSettingsCreator=e}create(t){const e=[];return t.variantGroupConfig.variants.forEach((t=>{const i=this.variantSettingsCreatorMap.get(t.name);if(void 0!==i){const n=new Vs(t);e.push(i.create(n))}else if(void 0!==this.defaultVariantSettingsCreator){const i=new Vs(t);e.push(this.defaultVariantSettingsCreator.create(i))}})),new dn({name:t.variantGroupConfig.name,currVariant:t.variantGroupConfig.currVariant,defaultVariant:t.variantGroupConfig.defaultVariant,variants:e})}}class ja extends bi{constructor(t){super(),this.visualSettings=t.visualSettings,this.viewObjectCreators=t.viewObjectCreators,this.rootDataSettingsCreator=t.rootDataSettingsCreator}}class Ya extends pa{constructor(){super(),this.callbackPlaces.push("beforeAddItems"),this.callbacks.set("beforeAddItems",[])}async create(t){if(void 0===t||!(t instanceof ja))return;await this.applyCallbacks("beforeCreate",{settings:t,creator:this});const e=new b,i=t.visualSettings.view,n=new ft(new pt({location:new G({x:new N(0),y:new N(0)}),size:new J({width:i.width.copy(),height:i.height.copy()}),parent:void 0,isVisible:!0,isDebugMode:!1}));n.init(),await this.applyCallbacks("beforeAddItems",{graphicObject:n,settings:t,creator:this});const s=t.rootDataSettingsCreator.create(t.visualSettings.data),a=t.visualSettings.view.items;for(let o=0;o<a.length;++o){const i=a[o];if(!t.viewObjectCreators.has(i.type))continue;const r=t.viewObjectCreators.get(i.type);if(void 0===r)continue;void 0===i.id&&(i.id=e.generateNextId());const l=await r.create(new fa({idGenerator:e,visualSettings:i,viewObjectCreators:t.viewObjectCreators,parentObject:n,rootConfig:t.visualSettings,rootObject:n,dataSection:s}));void 0!==l&&(l.settings.name=`${i.id}`,n.addItem(l))}return await this.applyCallbacks("afterCreate",{graphicObject:n,settings:t,creator:this}),n}}class Oa{static unpack(t,e,i,n,s){let a;if(void 0===n&&(n=void 0),void 0===s&&(s="#000000ff"),void 0!==t&&i in t){const e=t[i];("string"==typeof e||k(e))&&(a=e)}if(void 0===a&&void 0!==e&&(n=null!=n?n:i)in e){const t=e[n];("string"==typeof t||k(t))&&(a=t)}void 0===a&&(a=s);const o=x.convertToRgba(a);if(!y(o))return;return o.data}}class Ua{unpack(t){if(!I(t.entity))return;let e;void 0!==t.entityDefault&&I(t.entityDefault)&&(e=t.entityDefault);const i=Oa.unpack(t.entity,e,"color");if(void 0===i)return;let n;return"view"in t.entity&&"string"==typeof t.entity.view&&(n=t.entity.view),void 0===n&&void 0!==t.entityDefault&&"view"in t.entityDefault&&"string"==typeof t.entityDefault.view&&(n=t.entityDefault.view),void 0===n&&(n="webgl"),new gs({view:n,color:i})}}function Ta(t,e){return 0==e?new N(t):new Z(e)}function Wa(t,e,i){if(void 0===t)return Ta(e,i);let n=Ge.Unknown,s=t.length-1;R.endsWith(t,"%")?(n=Ge.Percent,s--):R.endsWith(t,"px")&&(n=Ge.Pixels,s-=2);const a=R.getFirstNotWhiteSpaceSymbol(t,0,s);if(a<0)return Ta(e,i);if(s=R.getLastNotWhiteSpaceSymbol(t,a,s),s<0)return Ta(e,i);const o=t.substring(a,s+1);if(R.isNumber(o)){if(n==Ge.Unknown||n==Ge.Pixels)return new N(parseFloat(o));if(n==Ge.Percent)return new Z(parseFloat(o)/100)}return Ta(e,i)}!function(t){t[t.Unknown=0]="Unknown",t[t.PlainNumber=1]="PlainNumber",t[t.Percent=2]="Percent",t[t.Pixels=3]="Pixels"}(Ge||(Ge={}));class Xa{static tryParseBoolean(t,e,i,n){return Xa.tryParseType(t,e,i,null!=n?n:e,"boolean")}static tryParseNumber(t,e,i,n){return Xa.tryParseType(t,e,i,null!=n?n:e,"number")}static tryParseString(t,e,i,n){return Xa.tryParseType(t,e,i,null!=n?n:e,"string")}static tryParseType(t,e,i,n,s){if(void 0!==t&&I(t)&&e in t){const i=t[e];if(typeof i===s)return i}if(void 0!==i&&I(i)&&n in i){const t=i[n];if(typeof t===s)return t}}}class Ha{unpack(t){var e,i,n,s;if(!I(t.entity)||!("view"in t.entity)||"string"!=typeof t.entity.view)return;let a;void 0!==t.entityDefault&&I(t.entityDefault)&&(a=t.entityDefault);const o=Oa.unpack(t.entity,a,"color");if(void 0===o)return;let r,l,d,c,h,u,g,f;return"majorCell"in t.entity&&I(t.entity.majorCell)&&(r=t.entity.majorCell),"minorCell"in t.entity&&I(t.entity.minorCell)&&(l=t.entity.minorCell),void 0!==t.entityDefault&&("majorCell"in t.entityDefault&&I(t.entityDefault.majorCell)&&(d=t.entityDefault.majorCell),"minorCell"in t.entityDefault&&I(t.entityDefault.minorCell)&&(c=t.entityDefault.minorCell)),void 0!==r&&"size_mm"in r&&I(r.size_mm)&&(h=r.size_mm),void 0!==l&&"size_mm"in l&&I(l.size_mm)&&(g=l.size_mm),void 0!==d&&"size_mm"in d&&I(d.size_mm)&&(u=d.size_mm),void 0!==c&&"size_mm"in c&&I(c.size_mm)&&(f=c.size_mm),new ys({view:t.entity.view,majorCell:{size_mm:new K({width:null!==(e=Xa.tryParseNumber(h,"width",u))&&void 0!==e?e:0,height:null!==(i=Xa.tryParseNumber(h,"height",u))&&void 0!==i?i:0}),lineWidth_mm:Xa.tryParseNumber(r,"lineWidth_mm",d)},minorCell:{size_mm:new K({width:null!==(n=Xa.tryParseNumber(g,"width",f))&&void 0!==n?n:0,height:null!==(s=Xa.tryParseNumber(g,"height",f))&&void 0!==s?s:0}),lineWidth_mm:Xa.tryParseNumber(l,"lineWidth_mm",c)},color:o})}}class Na{parse(t){}}class Ga extends Na{constructor(){super()}parse(t){if(null==t||!I(t)||!("name"in t)||"string"!=typeof t.name||!("type"in t)||"string"!=typeof t.type)return;let e=0;"order"in t&&"number"==typeof t.order&&(e=t.order);let i="";"filterClass"in t&&"string"==typeof t.filterClass&&(i=t.filterClass);let n=0;"freq"in t&&"number"==typeof t.freq&&(n=t.freq);let s=0;return"priority"in t&&"number"==typeof t.priority&&(s=t.priority),new on({name:t.name,type:t.type,order:e,filterClass:i,freq:n,priority:s})}}class qa{static convert(t){if(null==t||"function"==typeof t)return[];if(A(t)){const e=[];for(let i=0;i<t.length;++i){const n=t[i];if("loop"in n){const t=qa.convertLoopSettings(n);for(let i=0;i<t.length;++i)e.push(t[i])}else e.push(n)}return e}return I(t)?qa.convertLoopSettings(t):[]}static convertLoopSettings(t){if(!("loop"in t)||!I(t.loop))return[t];const e={from:0,to:0,incrementFields:[]},i=[];"from"in t.loop&&"number"==typeof t.loop.from&&(e.from=t.loop.from),"to"in t.loop&&"number"==typeof t.loop.to?e.to=t.loop.to:e.to=e.from,"incrementFields"in t.loop&&z(t.loop.incrementFields)&&(e.incrementFields=[...t.loop.incrementFields]);for(let n=e.from;n<=e.to;++n){const s={};for(const i of Object.getOwnPropertyNames(t)){const a=t[i];e.incrementFields.includes(i)?Array.isArray(a)?s[i]=a[n]:s[i]="number"==typeof a?a+n:a:s[i]=a}i.push(s)}return i}}class $a extends us{constructor(t){super(),this.id=t.id,this.text=t.text,this.linkedPosition=t.linkedPosition,this.y=t.y,this.color=t.color,this.id_signal=t.id_signal}}function Ka(t){return"dataSection"in t}function Za(t,e,i,n){const s=C("id",t,n.sources);if(void 0===s)return;const a=C("id",e,s.channels);if(void 0===a)return;const o=C("name","signals",a.variantGroups);if(void 0===o)return;const r=C("name",i,o.variants);return r instanceof Y?r.signals:void 0}class Ja{unpack(t){if(!(Ka(t)&&"labels"in t.entity&&null!=t.entity.labels&&"object"==typeof t.entity.labels&&"id_dataSource"in t.entity&&"number"==typeof t.entity.id_dataSource&&"id_channel"in t.entity&&"number"==typeof t.entity.id_channel&&"variantName"in t.entity&&"string"==typeof t.entity.variantName))return;const e=[],i=qa.convert(t.entity.labels);let n;void 0!==t.entityDefault&&I(t.entityDefault)&&(n=t.entityDefault);const s=Za(t.entity.id_dataSource,t.entity.id_channel,t.entity.variantName,t.dataSection);for(let a=0;a<i.length;++a){const o=i[a];let r,l,d,c=a;if("id"in o&&"number"==typeof o.id&&(c=o.id),"id_signal"in o&&"number"==typeof o.id_signal?r=o.id_signal:void 0!==s&&a<s.length&&(r=s[a].id),void 0===r)continue;"text"in o&&"string"==typeof o.text&&(l=o.text),"linkedPosition"in o&&"boolean"==typeof o.linkedPosition&&(d=o.linkedPosition);const h=Oa.unpack(o,n,"color");let u;"y"in o&&"string"==typeof o.y&&(u=o.y),void 0!==t.entityDefault&&(void 0===l&&"text"in t.entityDefault&&"string"==typeof t.entityDefault.text&&(l=t.entityDefault.text),void 0===d&&"linkedPosition"in t.entityDefault&&"boolean"==typeof t.entityDefault.linkedPosition&&(d=t.entityDefault.linkedPosition),void 0===u&&"y"in t.entityDefault&&"string"==typeof t.entityDefault.y&&(u=t.entityDefault.y));const g=new $a({id:c,text:null!=l?l:"",linkedPosition:null==d||d,y:Wa(u,0,0),color:null!=h?h:[0,0,0,255],id_signal:r});e.push(g)}return new Ss({labels:e})}}class Qa{unpack(t){var e,i,n,s,a;let o,r,l,d,c;if("label"in t.entity&&I(t.entity.label)&&(r=t.entity.label),void 0!==t.entityDefault&&"label"in t.entityDefault&&I(t.entityDefault.label)&&(l=t.entityDefault.label),void 0!==r||void 0!==l){o={fontSize:Xa.tryParseString(r,"fontSize",l),fontFamily:Xa.tryParseString(r,"fontFamily",l),color:Oa.unpack(r,l,"color")}}"style"in t.entity&&I(t.entity.style)&&(d=t.entity.style),void 0!==t.entityDefault&&"style"in t.entityDefault&&I(t.entityDefault.style)&&(c=t.entityDefault.style);const h=Oa.unpack(d,c,"color");let u,g,f,p,v;return"location"in t.entity&&I(t.entity.location)&&(u=t.entity.location),void 0!==t.entityDefault&&"location"in t.entityDefault&&I(t.entityDefault.location)&&(g=t.entityDefault.location),"style"in t.entity&&I(t.entity.style)&&"lineWidth"in t.entity.style&&"number"==typeof t.entity.style.lineWidth&&(f=t.entity.style.lineWidth),void 0!==t.entityDefault&&"style"in t.entityDefault&&I(t.entityDefault.style)&&void 0===f&&"lineWidth"in t.entityDefault.style&&"number"==typeof t.entityDefault.style.lineWidth&&(f=t.entityDefault.style.lineWidth),"size"in t.entity&&I(t.entity.size)&&(p=t.entity.size),void 0!==t.entityDefault&&"size"in t.entityDefault&&I(t.entityDefault.size)&&(v=t.entityDefault.size),new xs({location:new H({x:null!==(e=Xa.tryParseNumber(u,"x",g))&&void 0!==e?e:0,y:null!==(i=Xa.tryParseNumber(u,"y",g))&&void 0!==i?i:0}),size:{width:null!==(n=Xa.tryParseNumber(p,"width",v))&&void 0!==n?n:0,widthTop:null!==(s=Xa.tryParseNumber(p,"widthTop",v))&&void 0!==s?s:0},title:null!==(a=Xa.tryParseString(t.entity,"title",t.entityDefault))&&void 0!==a?a:"",style:{color:null!=h?h:[0,0,0,255],lineWidth:null!=f?f:1},isVisible:Xa.tryParseBoolean(t.entity,"isVisible",t.entityDefault),channelUnit:Xa.tryParseString(t.entity,"channelUnit",t.entityDefault),unit:Xa.tryParseString(t.entity,"unit",t.entityDefault),label:o})}}class to{constructor(t){var e;this.name=t.name,this.sector=ve(g,t.sector,g.Central),this.layerZ=null!==(e=t.layerZ)&&void 0!==e?e:0,this.settings=t.settings}}class eo{constructor(t){this.settingsParser=t,this.plotSectorNames=["central","bottom","bottomCentral","top","topCentral","left","leftCentral","right","rightCentral"]}unpack(t){var e;if(!("name"in t.entity)||"string"!=typeof t.entity.name||!Ka(t))return;const i=this.parseSectorName(t.entity,t.entityDefault);if(void 0===i)return;let n,s;if(void 0!==t.entityDefault&&("settings"in t.entityDefault&&I(t.entityDefault.settings)&&(n=t.entityDefault.settings),"variants"in t.entityDefault&&A(t.entityDefault.variants)&&"variantKeyField"in t.entityDefault&&"string"==typeof t.entityDefault.variantKeyField)){const e=t.entityDefault.variantKeyField;let i;if("settings"in t.entity&&I(t.entity.settings)&&e in t.entity.settings){const n=t.entity.settings[e];"string"==typeof n&&(i=n)}if(void 0===i&&"defaultVariant"in t.entityDefault&&"string"==typeof t.entityDefault.defaultVariant&&(i=t.entityDefault.defaultVariant),void 0===i)return;const s=C("key",i,t.entityDefault.variants);void 0!==s&&"settings"in s&&I(s.settings)&&(n=s.settings,n[e]=i)}if("settings"in t.entity&&I(t.entity.settings)){const e={entity:t.entity.settings,entityDefault:n,root:t.root,dataSection:t.dataSection};s=this.settingsParser.unpack(e)}else{if(void 0===n)return;const e={entity:n,root:t.root,dataSection:t.dataSection};s=this.settingsParser.unpack(e)}return void 0!==s?new to({name:t.entity.name,sector:i,layerZ:null!==(e=Xa.tryParseNumber(t.entity,"layerZ",t.entityDefault))&&void 0!==e?e:0,settings:s}):void 0}parseSectorName(t,e){let i;"sector"in t&&"string"==typeof t.sector&&(i=t.sector);let n=[];if(void 0===i&&void 0!==e&&"sector"in e&&"string"==typeof e.sector&&("defaultSector"in e&&"string"==typeof e.defaultSector&&(i=e.defaultSector),n=e.sector.split("|")),n.length>0)if("*"==n[0])n=[...this.plotSectorNames];else for(let s=0;s<n.length;++s)if(!this.plotSectorNames.includes(n[s]))return;if(void 0===i){if(n.length>1)return;i=n[0]}else if(n.length>0&&!n.includes(i))return;return i}}class io extends us{constructor(t){super(),this.id=t.id,this.text=t.text,this.linkedPosition=t.linkedPosition,this.y=t.y,this.color=t.color,this.id_signal=t.id_signal}}class no{unpack(t){if(!(Ka(t)&&"labels"in t.entity&&null!=t.entity.labels&&"object"==typeof t.entity.labels&&"id_dataSource"in t.entity&&"number"==typeof t.entity.id_dataSource&&"id_channel"in t.entity&&"number"==typeof t.entity.id_channel&&"variantName"in t.entity&&"string"==typeof t.entity.variantName))return;const e=[],i=qa.convert(t.entity.labels);let n;void 0!==t.entityDefault&&I(t.entityDefault)&&(n=t.entityDefault);const s=Za(t.entity.id_dataSource,t.entity.id_channel,t.entity.variantName,t.dataSection);for(let a=0;a<i.length;++a){const o=i[a];let r,l,d,c=a;if("id"in o&&"number"==typeof o.id&&(c=o.id),"id_signal"in o&&"number"==typeof o.id_signal?r=o.id_signal:void 0!==s&&a<s.length&&(r=s[a].id),void 0===r)continue;"text"in o&&"string"==typeof o.text&&(l=o.text),"linkedPosition"in o&&"boolean"==typeof o.linkedPosition&&(d=o.linkedPosition);const h=Oa.unpack(o,n,"color");let u;"y"in o&&"string"==typeof o.y&&(u=o.y),void 0!==t.entityDefault&&(void 0===l&&"text"in t.entityDefault&&"string"==typeof t.entityDefault.text&&(l=t.entityDefault.text),void 0===d&&"linkedPosition"in t.entityDefault&&"boolean"==typeof t.entityDefault.linkedPosition&&(d=t.entityDefault.linkedPosition),void 0===u&&"y"in t.entityDefault&&"string"==typeof t.entityDefault.y&&(u=t.entityDefault.y));const g=new io({id:c,text:null!=l?l:"",linkedPosition:null==d||d,y:Wa(u,0,0),color:null!=h?h:[0,0,0,0],id_signal:r});e.push(g)}return new bs({labels:e})}}class so{constructor(t){this.filterParser=t}unpack(t){return new Ms({unitsXtoMmConvertKoef:this.parseUnitsToMmConvertKoef(t.entity,"unitsXtoMmConvertKoef",t.entityDefault),unitsYtoMmConvertKoef:this.parseUnitsToMmConvertKoef(t.entity,"unitsYtoMmConvertKoef",t.entityDefault),filters:this.parseFilters(t.entity,"filters",t.entityDefault),defaultFilters:this.parseDefaultFilters(t.entity,"defaultFilters",t.entityDefault),scaleX:this.parseScaleX(t.entity,"scaleX",t.entityDefault),scaleY:this.parseScaleY(t.entity,"scaleY",t.entityDefault),viewScale:this.parseViewScale(t.entity,"viewScale",t.entityDefault),labels:this.parseLabels(t.entity,"labels",t.entityDefault)})}parseUnitsToMmConvertKoef(t,e,i){if(void 0!==t&&I(t)&&e in t){const i=t[e];if("number"==typeof i)return i}if(void 0!==i&&I(i)&&e in i){const t=i[e];if("number"==typeof t)return t}}parseFilters(t,e,i){let n;if(void 0!==t&&I(t)&&e in t){const i=t[e];if(A(i))for(let t=0;t<i.length;++t){const e=this.filterParser.parse(i[t]);void 0!==e&&(void 0===n&&(n=[]),n.push(e))}}if(void 0!==i&&I(i)&&e in i){const t=i[e];if(A(t))for(let e=0;e<t.length;++e){const i=this.filterParser.parse(t[e]);if(void 0!==i){void 0===n&&(n=[]);void 0===C("name",i.name,n)&&n.push(i)}}}return n}parseDefaultFilters(t,e,i){if(void 0!==t&&I(t)&&e in t){const i=t[e];if(z(i))return[...i]}if(void 0!==i&&I(i)&&e in i){const t=i[e];if(z(t))return[...t]}}parseScaleX(t,e,i){let n,s,a,o,r;if(void 0!==t&&I(t)&&e in t){const i=t[e];I(i)&&(n=i)}if(void 0===n&&void 0!==i&&I(i)&&e in i){const t=i[e];I(t)&&(n=t)}if(void 0!==n)return"defaultValues"in n&&k(n.defaultValues)&&(s=[...n.defaultValues],"defaultIndex"in n&&"number"==typeof n.defaultIndex&&(a=n.defaultIndex)),"distanceUnit"in n&&"number"==typeof n.distanceUnit&&(o=n.distanceUnit),"timeUnit"in n&&"number"==typeof n.timeUnit&&(r=n.timeUnit),void 0!==i&&(void 0===s&&"defaultValues"in i&&k(i.defaultValues)&&(s=[...i.defaultValues]),void 0===a&&"defaultIndex"in i&&"number"==typeof i.defaultIndex&&(a=i.defaultIndex),void 0===o&&"distanceUnit"in i&&"number"==typeof i.distanceUnit&&(o=i.distanceUnit),void 0===r&&"timeUnit"in i&&"number"==typeof i.timeUnit&&(r=i.timeUnit)),new Bs({defaultValues:s,defaultIndex:a,distanceUnit:o,timeUnit:r})}parseScaleY(t,e,i){let n,s,a,o,r;if(void 0!==t&&I(t)&&e in t){const i=t[e];I(i)&&(n=i)}if(void 0===n&&void 0!==i&&I(i)&&e in i){const t=i[e];I(t)&&(n=t)}if(void 0!==n)return"defaultValues"in n&&k(n.defaultValues)&&(s=[...n.defaultValues],"defaultIndex"in n&&"number"==typeof n.defaultIndex&&(a=n.defaultIndex)),"distanceUnit"in n&&"number"==typeof n.distanceUnit&&(o=n.distanceUnit),"valueUnit"in n&&"number"==typeof n.valueUnit&&(r=n.valueUnit),void 0!==i&&(void 0===s&&"defaultValues"in i&&k(i.defaultValues)&&(s=[...i.defaultValues]),void 0===a&&"defaultIndex"in i&&"number"==typeof i.defaultIndex&&(a=i.defaultIndex),void 0===o&&"distanceUnit"in i&&"number"==typeof i.distanceUnit&&(o=i.distanceUnit),void 0===r&&"valueUnit"in i&&"number"==typeof i.valueUnit&&(r=i.valueUnit)),new Ds({defaultValues:s,defaultIndex:a,distanceUnit:o,valueUnit:r})}parseViewScale(t,e,i){let n,s,a;if(void 0!==t&&I(t)&&e in t){const i=t[e];I(i)&&(n=i)}if(void 0===n&&void 0!==i&&I(i)&&e in i){const t=i[e];I(t)&&(n=t)}if(void 0!==n)return"x"in n&&"number"==typeof n.x&&(s=n.x),"y"in n&&"number"==typeof n.y&&(a=n.y),void 0!==i&&(void 0===s&&"x"in i&&"number"==typeof i.x&&(s=i.x),void 0===a&&"y"in i&&"number"==typeof i.y&&(a=i.y)),{x:s,y:a}}parseLabels(t,e,i){let n,s,a,o;if(void 0!==t&&I(t)&&e in t){const i=t[e];I(i)&&(n=i)}if(void 0===n&&void 0!==i&&I(i)&&e in i){const t=i[e];I(t)&&(n=t)}if(void 0!==n){if("fontFamily"in n&&"string"==typeof n.fontFamily&&(s=n.fontFamily),"fontSize"in n&&"number"==typeof n.fontSize&&(a=n.fontSize),"color"in n){let t;void 0!==i&&I(i)&&(t=i),o=Oa.unpack(n,t,"color")}return{color:o,fontFamily:s,fontSize:a}}}}class ao{unpack(t){var e,i;if(!I(t.entity)||!("view"in t.entity)||"string"!=typeof t.entity.view)return;let n;void 0!==t.entityDefault&&I(t.entityDefault)&&(n=t.entityDefault);const s=Oa.unpack(t.entity,n,"color");let a,o;return"cellSize_mm"in t.entity&&I(t.entity.cellSize_mm)&&(a=t.entity.cellSize_mm),void 0!==t.entityDefault&&"cellSize_mm"in t.entityDefault&&I(t.entityDefault.cellSize_mm)&&(o=t.entityDefault.cellSize_mm),new vs({view:t.entity.view,cellSize_mm:new K({width:null!==(e=Xa.tryParseNumber(a,"width",o))&&void 0!==e?e:0,height:null!==(i=Xa.tryParseNumber(a,"height",o))&&void 0!==i?i:0}),color:s})}}class oo extends l{constructor(t){var e,i,n;super(),this.name=t.name,this.currVariant=null!==(e=t.currVariant)&&void 0!==e?e:null!==(i=t.defaultVariant)&&void 0!==i?i:"",this.defaultVariant=null!==(n=t.defaultVariant)&&void 0!==n?n:this.currVariant,this.variants=t.variants}getCurrVariantInfo(){return C("name",this.currVariant,this.variants)}}class ro{constructor(t){var e,i,n,s,a,o,r;this.id_dataSource=null!==(e=null==t?void 0:t.id_dataSource)&&void 0!==e?e:0,this.id=null!==(i=null==t?void 0:t.id)&&void 0!==i?i:0,this.y=null!==(n=null==t?void 0:t.y)&&void 0!==n?n:new N(0),this.height=null!==(s=null==t?void 0:t.height)&&void 0!==s?s:new Z(1),this.variantGroups=null!==(a=null==t?void 0:t.variantGroups)&&void 0!==a?a:[],this.showIsolines=null!==(o=null==t?void 0:t.showIsolines)&&void 0!==o&&o,this.unit=null==t?void 0:t.unit,this.scaleX=null==t?void 0:t.scaleX,this.scaleY=null==t?void 0:t.scaleY,this.isSynchronizedScaleX=null!==(r=null==t?void 0:t.isSynchronizedScaleX)&&void 0!==r&&r,this.frequency=null==t?void 0:t.frequency,this.filters=null==t?void 0:t.filters,this.selectedFiltersNames=null==t?void 0:t.selectedFiltersNames,this.defaultFilters=null==t?void 0:t.defaultFilters}getCurrSignalsVariant(){const t=C("name","signals",this.variantGroups);if(void 0!==t)return C("name",t.currVariant,t.variants)}forEachSignalsVariant(t){const e=C("name","signals",this.variantGroups);if(void 0!==e)for(let i=0;i<e.variants.length;++i){t(e.variants[i])}}}class lo{constructor(t){var e;this.values=t.values,this.index=null!==(e=t.index)&&void 0!==e?e:0==this.values.length?-1:0,this.distanceUnit=t.distanceUnit}}class co extends lo{constructor(t){super({index:t.index,values:t.values,distanceUnit:t.distanceUnit}),this.timeUnit=t.timeUnit}}class ho extends lo{constructor(t){super({index:t.index,values:t.values,distanceUnit:t.distanceUnit}),this.valueUnit=t.valueUnit}}function uo(t){return Ka(t)&&"index"in t}class go{constructor(t,e,i,n,s){this.variantGroupParserMap=t,this.unitParser=e,this.scaleXParser=i,this.scaleYParser=n,this.filterParser=s}unpack(t){if(!uo(t))return;let e,i=0;if(!("id_dataSource"in t.entity)||"number"!=typeof t.entity.id_dataSource)return;if(i=t.entity.id_dataSource,"id_channel"in t.entity&&"number"==typeof t.entity.id_channel)e=t.entity.id_channel;else{const n=C("id",i,t.dataSection.sources);void 0!==n&&t.index>=0&&t.index<n.channels.length&&(e=n.channels[t.index].id)}if(void 0===e)return;const n=[];let s=[];if("variantGroups"in t.entity&&A(t.entity.variantGroups)&&(s=t.entity.variantGroups),"variants"in t.entity){if("signals"in t.entity)return;if(!A(t.entity.variants))return;if(void 0!==C("name","signals",s))return;let n,a;"currVariant"in t.entity&&"string"==typeof t.entity.currVariant&&(n=t.entity.currVariant),"defaultVariant"in t.entity&&"string"==typeof t.entity.defaultVariant&&(a=t.entity.defaultVariant);const o=C("id",i,t.dataSection.sources);if(void 0===o)return;const r=C("id",e,o.channels);if(void 0===r)return;const l=C("name","signals",r.variantGroups);if(void 0!==l&&(void 0===n&&(n=l.currVariant),void 0===a&&(a=l.defaultVariant)),void 0===n&&(n=a),void 0===n&&t.entity.variants.length>0){const e=t.entity.variants[0];"name"in e&&"string"==typeof e.name&&(n=e.name)}s.push({name:"signals",currVariant:n,defaultVariant:a,variants:t.entity.variants})}else if("signals"in t.entity){if(void 0!==C("name","signals",s)||!A(t.entity.signals))return;const e={signals:[...t.entity.signals],name:"_default"};"isolines"in t.entity&&A(t.entity.isolines)&&(e.isolines=[...t.entity.isolines]),"content"in t.entity&&A(t.entity.content)&&(e.content=[...t.entity.content]),s.push({name:"signals",currVariant:"_default",defaultVariant:"_default",variants:[e]})}if(void 0===C("name","signals",s)){const e={name:"_default"};"isolines"in t.entity&&A(t.entity.isolines)&&(e.isolines=[...t.entity.isolines]),"content"in t.entity&&A(t.entity.content)&&(e.content=[...t.entity.content]),s.push({name:"signals",currVariant:"_default",defaultVariant:"_default",variants:[e]})}let a,o,r,l,c;if(void 0!==t.entityDefault)if("variantGroups"in t.entityDefault&&A(t.entityDefault.variantGroups)){if("variants"in t.entityDefault)return;a=t.entityDefault.variantGroups}else"variants"in t.entityDefault&&A(t.entityDefault.variants)&&(a=[{name:"signals",currVariant:"_default",defaultVariant:"_default",variants:[...t.entityDefault.variants]}]);for(let d=0;d<s.length;++d){const o=s[d];if("name"in o&&"string"==typeof o.name){const r=this.variantGroupParserMap.get(o.name);if(void 0!==r){let l;void 0!==a&&(l=C("name",o.name,a));const c={entity:s[d],entityDefault:l,root:t.root,dataSection:t.dataSection};if("signals"==o.name&&"variants"in c.entity&&A(c.entity.variants))for(let t=0;t<c.entity.variants.length;++t){const n=c.entity.variants[t];n.id_dataSource=i,n.id_channel=e}const h=r.unpack(c);void 0!==h&&h instanceof oo&&n.push(h)}}}if("unit"in t.entity&&I(t.entity.unit)){let e;void 0!==t.entityDefault&&"unit"in t.entityDefault&&I(t.entityDefault.unit)&&(e=t.entityDefault.unit);const i={entity:t.entity.unit,entityDefault:e,root:t.root,dataSection:t.dataSection},n=this.unitParser.unpack(i);void 0!==n&&n instanceof d&&(o=n)}else if(void 0!==t.entityDefault&&"unit"in t.entityDefault&&I(t.entityDefault.unit)){const e={entity:t.entityDefault.unit,root:t.root,dataSection:t.dataSection},i=this.unitParser.unpack(e);void 0!==i&&i instanceof d&&(o=i)}if("scaleX"in t.entity&&I(t.entity.scaleX)){let e;void 0!==t.entityDefault&&"scaleX"in t.entityDefault&&I(t.entityDefault.scaleX)&&(e=t.entityDefault.scaleX);const i={entity:t.entity.scaleX,entityDefault:e,root:t.root,dataSection:t.dataSection},n=this.scaleXParser.unpack(i);void 0!==n&&n instanceof co&&(r=n)}else if(void 0!==t.entityDefault&&"scaleX"in t.entityDefault&&I(t.entityDefault.scaleX)){const e={entity:t.entityDefault.scaleX,root:t.root,dataSection:t.dataSection},i=this.scaleXParser.unpack(e);void 0!==i&&i instanceof co&&(r=i)}if("scaleY"in t.entity&&I(t.entity.scaleY)){let e;void 0!==t.entityDefault&&"scaleY"in t.entityDefault&&I(t.entityDefault.scaleY)&&(e=t.entityDefault.scaleY);const i={entity:t.entity.scaleY,entityDefault:e,root:t.root,dataSection:t.dataSection},n=this.scaleYParser.unpack(i);void 0!==n&&n instanceof ho&&(l=n)}else if(void 0!==t.entityDefault&&"scaleY"in t.entityDefault&&I(t.entityDefault.scaleY)){const e={entity:t.entityDefault.scaleY,root:t.root,dataSection:t.dataSection},i=this.scaleYParser.unpack(e);void 0!==i&&i instanceof ho&&(l=i)}"y"in t.entity&&"string"==typeof t.entity.y&&(c=t.entity.y);let h=!1;"showIsolines"in t.entity&&"boolean"==typeof t.entity.showIsolines?h=t.entity.showIsolines:void 0!==t.entityDefault&&"showIsolines"in t.entityDefault&&"boolean"==typeof t.entityDefault.showIsolines&&(h=t.entityDefault.showIsolines);let u,g=!1;return"isSynchronizedScaleX"in t.entity&&"boolean"==typeof t.entity.isSynchronizedScaleX?g=t.entity.isSynchronizedScaleX:void 0!==t.entityDefault&&"isSynchronizedScaleX"in t.entityDefault&&"boolean"==typeof t.entityDefault.isSynchronizedScaleX&&(g=t.entityDefault.isSynchronizedScaleX),"frequency"in t.entity&&"number"==typeof t.entity.frequency?u=t.entity.frequency:void 0!==t.entityDefault&&"frequency"in t.entityDefault&&"number"==typeof t.entityDefault.frequency&&(u=t.entityDefault.frequency),new ro({id_dataSource:i,id:e,y:Wa(c,0,0),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),variantGroups:n,showIsolines:h,unit:o,scaleX:r,scaleY:l,isSynchronizedScaleX:g,frequency:u,filters:this.parseFilters(t.entity,"filters",t.entityDefault),selectedFiltersNames:this.parseSelectedFiltersNames(t.entity,"selectedFiltersNames",t.entityDefault)})}parseFilters(t,e,i){let n,s,a;if(void 0!==t&&I(t)&&e in t){const i=t[e];A(i)&&(n=i)}if(void 0!==i&&I(i)&&e in i){const t=i[e];A(t)&&(s=t)}if(void 0!==n)for(let o=0;o<n.length;++o){const t=this.filterParser.parse(n[o]);void 0!==t&&(void 0===a&&(a=[]),a.push(t))}if(void 0!==s)for(let o=0;o<s.length;++o){const t=this.filterParser.parse(s[o]);if(void 0!==t){void 0===a&&(a=[]);void 0===C("name",t.name,a)&&a.push(t)}}return a}parseSelectedFiltersNames(t,e,i){let n;if(void 0!==t&&I(t)&&e in t){const i=t[e];z(i)&&(n=i)}if(void 0===n&&void 0!==i&&I(i)&&e in i){const t=i[e];z(t)&&(n=t)}return void 0===n?void 0:[...n]}}class fo{unpack(t){let e,i,n,s;return"index"in t.entity&&"number"==typeof t.entity.index&&(e=t.entity.index),"values"in t.entity&&k(t.entity.values)&&(i=t.entity.values),"distanceUnit"in t.entity&&"number"==typeof t.entity.distanceUnit&&(n=t.entity.distanceUnit),"timeUnit"in t.entity&&"number"==typeof t.entity.timeUnit&&(s=t.entity.timeUnit),new co({index:e,values:null!=i?i:[],distanceUnit:n,timeUnit:s})}}class po{unpack(t){let e,i,n,s;return"index"in t.entity&&"number"==typeof t.entity.index&&(e=t.entity.index),"values"in t.entity&&k(t.entity.values)&&(i=t.entity.values),"distanceUnit"in t.entity&&"number"==typeof t.entity.distanceUnit&&(n=t.entity.distanceUnit),"valueUnit"in t.entity&&"number"==typeof t.entity.valueUnit&&(s=t.entity.valueUnit),new ho({index:e,values:null!=i?i:[],distanceUnit:n,valueUnit:s})}}class vo{constructor(t){var e,i;this.id=t.id,this.y=t.y,this.color=null!==(e=t.color)&&void 0!==e?e:[0,0,0,1],this.updateBorder=null!==(i=t.updateBorder)&&void 0!==i?i:0}copy(){return new vo({id:this.id,y:this.y.copy(),color:[...this.color],updateBorder:this.updateBorder})}}class yo{constructor(t){this.id=t.id,this.type=t.type,this.fillType=t.fillType,this.color=t.color,this.id_isoline=t.id_isoline,this.pointCount=t.pointCount,this.title=t.title}copy(){return new yo({id:this.id,type:this.type,fillType:this.fillType,color:[...this.color],id_isoline:this.id_isoline,pointCount:this.pointCount,title:this.title})}}class mo{constructor(t,e,i){this.isolineParser=t,this.signalParser=e,this.contentParserMap=i}unpack(t){if(!("name"in t.entity&&"string"==typeof t.entity.name&&Ka(t)&&"id_dataSource"in t.entity&&"number"==typeof t.entity.id_dataSource&&"id_channel"in t.entity&&"number"==typeof t.entity.id_channel))return;const e=[];let i;if("isolines"in t.entity&&A(t.entity.isolines))i=t.entity.isolines;else{const e=Za(t.entity.id_dataSource,t.entity.id_channel,t.entity.name,t.dataSection);if(void 0!==e){i=[];for(let t=0;t<e.length;++t)i.push({id:t})}}if(void 0!==i){let n;void 0!==t.entityDefault&&"isoline"in t.entityDefault&&I(t.entityDefault.isoline)&&(n=t.entityDefault.isoline);for(let s=0;s<i.length;++s){const a=i[s];a.id_dataSource=t.entity.id_dataSource,a.id_channel=t.entity.id_channel,a.variantName=t.entity.name;const o={entity:a,entityDefault:n,root:t.root,dataSection:t.dataSection,index:s},r=this.isolineParser.unpack(o);void 0!==r&&r instanceof vo&&e.push(r)}}const n=[];let s,a;if(void 0!==t.entityDefault&&"signal"in t.entityDefault&&I(t.entityDefault.signal)&&(s=t.entityDefault.signal),"signals"in t.entity&&A(t.entity.signals))a=t.entity.signals;else{const e=Za(t.entity.id_dataSource,t.entity.id_channel,t.entity.name,t.dataSection);if(void 0!==e){a=[];for(let t=0;t<e.length;++t)a.push({})}}if(void 0!==a)for(let d=0;d<a.length;++d){const i=a[d];i.id_dataSource=t.entity.id_dataSource,i.id_channel=t.entity.id_channel,i.variantName=t.entity.name;const o={entity:i,entityDefault:s,root:t.root,dataSection:t.dataSection,index:d,isolines:e},r=this.signalParser.unpack(o);void 0!==r&&r instanceof yo&&n.push(r)}const o=["central","bottom","bottomCentral","top","topCentral","left","leftCentral","right","rightCentral"],r=[];let l;if(void 0!==t.entityDefault&&"content"in t.entityDefault&&A(t.entityDefault.content)&&(l=t.entityDefault.content),"content"in t.entity&&A(t.entity.content)){const e=t.entity.content;for(let i=0;i<e.length;++i){const n=e[i];if(!("name"in n)||"string"!=typeof n.name||"sector"in n&&"string"==typeof n.sector&&!o.includes(n.sector))continue;const s=this.contentParserMap.get(n.name);if(void 0===s)continue;let a;void 0!==l&&(a=C("name",n.name,l));let d={};"settings"in n&&I(n.settings)&&(d=n.settings),d.id_dataSource=t.entity.id_dataSource,d.id_channel=t.entity.id_channel,d.variantName=t.entity.name,n.settings=d;const c={entity:n,entityDefault:a,root:t.root,dataSection:t.dataSection},h=s.unpack(c);void 0!==h&&h instanceof to&&r.push(h)}}if(void 0!==l)for(let d=0;d<l.length;++d){const e=l[d];if(!("name"in e&&"string"==typeof e.name&&("requiredMin"in e||"requiredMax"in e||"required"in e&&"boolean"==typeof e.required&&e.required)))continue;const i=this.contentParserMap.get(e.name);if(void 0===i)continue;let n=1,s=1,a=this.containsCount(e.name,r);"requiredMin"in e&&"number"==typeof e.requiredMin&&(n=e.requiredMin),"requiredMax"in e&&"number"==typeof e.requiredMax&&(s=e.requiredMax);const o=Math.max(n,s);for(;a<o;++a){const n={entity:{...e},root:t.root,dataSection:t.dataSection},s=i.unpack(n);void 0!==s&&s instanceof to&&r.push(s)}}return new As({name:t.entity.name,isolines:e,signals:n,content:r})}containsCount(t,e){let i=0;for(let n=0;n<e.length;++n)e[n].name==t&&i++;return i}}class So{constructor(t){var e,i,n;this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:0,this.channels=null!==(i=null==t?void 0:t.channels)&&void 0!==i?i:[],this.marks=null!==(n=null==t?void 0:t.marks)&&void 0!==n?n:[]}}class wo{constructor(t,e){this.channelParser=t,this.markParser=e}unpack(t){if(!uo(t))return;let e;if("id_dataSource"in t.entity&&"number"==typeof t.entity.id_dataSource?e=t.entity.id_dataSource:t.index>=0&&t.index<t.dataSection.sources.length&&(e=t.dataSection.sources[t.index].id),void 0===e)return;const i=[];let n,s,a=[];if("channels"in t.entity){if("channel"in t.entity)return;A(t.entity.channels)&&(a=t.entity.channels)}else if("channel"in t.entity&&I(t.entity.channel)){const e={};for(const i of Object.getOwnPropertyNames(t.entity.channel))e[i]=t.entity.channel[i];"id"in e||(e.id=0),a.push(e)}void 0!==t.entityDefault&&"channel"in t.entityDefault&&I(t.entityDefault.channel)&&(n=t.entityDefault.channel);for(let r=0;r<a.length;++r){const s=a[r];s.id_dataSource=e;const o={entity:s,entityDefault:n,root:t.root,dataSection:t.dataSection,index:r},l=this.channelParser.unpack(o);void 0!==l&&l instanceof ro&&i.push(l)}void 0!==t.entityDefault&&"marks"in t.entityDefault&&A(t.entityDefault.marks)&&(s=t.entityDefault.marks);const o=[];if("marks"in t.entity&&A(t.entity.marks)){const e=t.entity.marks;for(let i=0;i<e.length;++i){const n=e[i];let a;void 0!==s&&"type"in n&&"string"==typeof n.type&&(a=C("type",n.type,s));const r={entity:n,entityDefault:a,root:t.root,dataSection:t.dataSection,index:i},l=this.markParser.unpack(r);void 0!==l&&l instanceof Hs&&o.push(l)}}return new So({id:e,channels:i,marks:o})}}class xo{unpack(t){if(!uo(t)||!I(t.entity))return;let e,i;"id"in t.entity&&"number"==typeof t.entity.id&&(e=t.entity.id),void 0===e&&(e=t.index),void 0!==t.entityDefault&&I(t.entityDefault)&&(i=t.entityDefault);const n=Oa.unpack(t.entity,i,"color");let s;if("y"in t.entity&&"string"==typeof t.entity.y)s=t.entity.y;else{const e=this.getSignalCount(t);if(e>0){const i=100/(e+1);s=`${100-(t.index+1)*i}%`}}return new vo({id:e,y:Wa(s,0,0),color:null!=n?n:[0,0,0,1],updateBorder:Xa.tryParseNumber(t.entity,"updateBorder",t.entityDefault)})}getSignalCount(t){if(!("id_dataSource"in t.entity)||"number"!=typeof t.entity.id_dataSource||!("id_channel"in t.entity)||"number"!=typeof t.entity.id_channel||!("variantName"in t.entity)||"string"!=typeof t.entity.variantName)return 0;const e=C("id",t.entity.id_dataSource,t.dataSection.sources);if(void 0===e)return 0;const i=C("id",t.entity.id_channel,e.channels);if(void 0===i)return 0;const n=C("name","signals",i.variantGroups);if(void 0===n)return 0;const s=C("name",t.entity.variantName,n.variants);return s instanceof Y?s.signals.length:0}}class Co{unpack(t){var e,i,n,s;if(!I(t.entity))return;const a=null!==(e=Xa.tryParseString(t.entity,"x_axis",t.entityDefault))&&void 0!==e?e:"left",o=null!==(i=Xa.tryParseString(t.entity,"y_axis",t.entityDefault))&&void 0!==i?i:"down";let r="none",l="none";"xSignalDependency"in t.entity&&"string"==typeof t.entity.xSignalDependency&&(r=t.entity.xSignalDependency),"ySignalDependency"in t.entity&&"string"==typeof t.entity.ySignalDependency&&(l=t.entity.ySignalDependency);let d,c=Te.None,h=We.None;switch(r){case"none":c=Te.None;break;case"signalPoint":c=Te.SignalPoint}switch(l){case"none":h=We.None;break;case"signalPoint":h=We.SignalPoint;break;case"isoline":h=We.Isoline}void 0!==t.entityDefault&&I(t.entityDefault)&&(d=t.entityDefault);const u=Oa.unpack(t.entity,d,"color");let g,f,p,v,y;return"x"in t.entity&&"string"==typeof t.entity.x&&(g=t.entity.x),"y"in t.entity&&"string"==typeof t.entity.y&&(f=t.entity.y),"width"in t.entity&&"string"==typeof t.entity.width&&(p=t.entity.width),"height"in t.entity&&"string"==typeof t.entity.height&&(v=t.entity.height),"signal"in t.entity&&I(t.entity.signal)&&"id_signal"in t.entity.signal&&"number"==typeof t.entity.signal.id_signal&&"id_channel"in t.entity.signal&&"number"==typeof t.entity.signal.id_channel&&(y={id_signal:t.entity.signal.id_signal,id_channel:t.entity.signal.id_channel}),new Ws({axisX:"right"==a?Oe.FromRightToLeft:Oe.FromLeftToRight,axisY:"top"==o?Ue.FromTopToBottom:Ue.FromBottomToTop,y:Wa(f,0,0),x:Wa(g,0,0),width:Wa(p,0,1),height:Wa(v,0,1),minXSpace:null!==(n=Xa.tryParseNumber(t.entity,"min_x_space",t.entityDefault))&&void 0!==n?n:0,minYSpace:null!==(s=Xa.tryParseNumber(t.entity,"min_y_space",t.entityDefault))&&void 0!==s?s:0,signal:y,signalDependency:{x:c,y:h},color:null!=u?u:[0,0,0,255]})}}class bo{constructor(t,e){this.markAreaParser=t,this.markItemParser=e}unpack(t){if(!("id_mark"in t.entity)||"number"!=typeof t.entity.id_mark||!("type"in t.entity)||"string"!=typeof t.entity.type||!Ka(t))return;let e,i,n,s;if(void 0!==t.entityDefault&&"area"in t.entityDefault&&I(t.entityDefault.area)&&(i=t.entityDefault.area),"area"in t.entity&&I(t.entity.area)){const n={entity:t.entity.area,entityDefault:i,root:t.root,dataSection:t.dataSection},s=this.markAreaParser.unpack(n);void 0!==s&&s instanceof Xs&&(e=s)}if(void 0===e&&void 0!==i){const n={entity:i,root:t.root,dataSection:t.dataSection},s=this.markAreaParser.unpack(n);void 0!==s&&s instanceof Xs&&(e=s)}if(void 0!==t.entityDefault&&"item"in t.entityDefault&&I(t.entityDefault.item)&&(n=t.entityDefault.item),"item"in t.entity&&I(t.entity.item)){const e={entity:t.entity.item,entityDefault:n,root:t.root,dataSection:t.dataSection},i=this.markItemParser.unpack(e);void 0!==i&&i instanceof Ws&&(s=i)}else if(void 0!==n){const e={entity:n,root:t.root,dataSection:t.dataSection},i=this.markItemParser.unpack(e);void 0!==i&&i instanceof Ws&&(s=i)}return new Ns({id:t.entity.id_mark,type:t.entity.type,area:e,item:s})}}class Io{unpack(t){var e,i,n,s;if(!I(t.entity))return;const a=null!==(e=Xa.tryParseString(t.entity,"x_axis",t.entityDefault))&&void 0!==e?e:"left",o=null!==(i=Xa.tryParseString(t.entity,"y_axis",t.entityDefault))&&void 0!==i?i:"down";let r="none",l="none";"xSignalDependency"in t.entity&&"string"==typeof t.entity.xSignalDependency&&(r=t.entity.xSignalDependency),"ySignalDependency"in t.entity&&"string"==typeof t.entity.ySignalDependency&&(l=t.entity.ySignalDependency);let d,c=Te.None,h=We.None;switch(r){case"none":c=Te.None;break;case"signalPoint":c=Te.SignalPoint}switch(l){case"none":h=We.None;break;case"signalPoint":h=We.SignalPoint;break;case"isoline":h=We.Isoline}void 0!==t.entityDefault&&I(t.entityDefault)&&(d=t.entityDefault);const u=Oa.unpack(t.entity,d,"color");let g,f,p,v,y;return"x"in t.entity&&"string"==typeof t.entity.x&&(g=t.entity.x),"y"in t.entity&&"string"==typeof t.entity.y&&(f=t.entity.y),"width"in t.entity&&"string"==typeof t.entity.width&&(p=t.entity.width),"height"in t.entity&&"string"==typeof t.entity.height&&(v=t.entity.height),"signal"in t.entity&&I(t.entity.signal)&&"id_signal"in t.entity.signal&&"number"==typeof t.entity.signal.id_signal&&"id_channel"in t.entity.signal&&"number"==typeof t.entity.signal.id_channel&&(y={id_signal:t.entity.signal.id_signal,id_channel:t.entity.signal.id_channel}),new Ks({axisX:"right"==a?Oe.FromRightToLeft:Oe.FromLeftToRight,axisY:"top"==o?Ue.FromTopToBottom:Ue.FromBottomToTop,x:Wa(g,0,0),y:Wa(f,0,0),width:Wa(p,0,1),height:Wa(v,0,1),minXSpace:null!==(n=Xa.tryParseNumber(t.entity,"min_x_space",t.entityDefault))&&void 0!==n?n:0,minYSpace:null!==(s=Xa.tryParseNumber(t.entity,"min_y_space",t.entityDefault))&&void 0!==s?s:0,signal:y,signalDependency:{x:c,y:h},color:null!=u?u:[0,0,0,255]})}}class Po{constructor(t,e){this.markAreaParser=t,this.markItemParser=e}unpack(t){if(!("id_mark"in t.entity)||"number"!=typeof t.entity.id_mark||!("type"in t.entity)||"string"!=typeof t.entity.type||!Ka(t))return;let e,i,n,s;if(void 0!==t.entityDefault&&"area"in t.entityDefault&&I(t.entityDefault.area)&&(i=t.entityDefault.area),"area"in t.entity&&I(t.entity.area)){const n={entity:t.entity.area,entityDefault:i,root:t.root,dataSection:t.dataSection},s=this.markAreaParser.unpack(n);void 0!==s&&s instanceof Xs&&(e=s)}if(void 0===e&&void 0!==i){const n={entity:i,root:t.root,dataSection:t.dataSection},s=this.markAreaParser.unpack(n);void 0!==s&&s instanceof Xs&&(e=s)}if(void 0!==t.entityDefault&&"item"in t.entityDefault&&I(t.entityDefault.item)&&(n=t.entityDefault.item),"item"in t.entity&&I(t.entity.item)){const e={entity:t.entity.item,entityDefault:n,root:t.root,dataSection:t.dataSection},i=this.markItemParser.unpack(e);void 0!==i&&i instanceof Ks&&(s=i)}else if(void 0!==n){const e={entity:n,root:t.root,dataSection:t.dataSection},i=this.markItemParser.unpack(e);void 0!==i&&i instanceof Ks&&(s=i)}return new Zs({id:t.entity.id_mark,type:t.entity.type,area:e,item:s})}}class Bo{unpack(t){var e,i;if(!("place"in t.entity)||"string"!=typeof t.entity.place||!W(t.entity.place))return;const n=t.entity.place,s=null!==(e=Xa.tryParseString(t.entity,"x_axis",t.entityDefault))&&void 0!==e?e:"left",a=null!==(i=Xa.tryParseString(t.entity,"y_axis",t.entityDefault))&&void 0!==i?i:"down";let o,r,l,d;return"x"in t.entity&&"string"==typeof t.entity.x&&(o=t.entity.x),"y"in t.entity&&"string"==typeof t.entity.y&&(r=t.entity.y),"width"in t.entity&&"string"==typeof t.entity.width&&(l=t.entity.width),"height"in t.entity&&"string"==typeof t.entity.height&&(d=t.entity.height),new Xs({place:n,axisX:"right"==s?Oe.FromRightToLeft:Oe.FromLeftToRight,axisY:"top"==a?Ue.FromTopToBottom:Ue.FromBottomToTop,x:Wa(o,0,0),y:Wa(r,0,0),width:Wa(l,0,1),height:Wa(d,0,1)})}}class Do{constructor(t){this.markGroupParserMap=t}unpack(t){if(!("id_mark"in t.entity)||"number"!=typeof t.entity.id_mark||!("type"in t.entity)||"string"!=typeof t.entity.type||!Ka(t))return;const e=this.markGroupParserMap.get(t.entity.type);if(void 0===e)return;let i;if(void 0!==t.entityDefault&&A(t.entityDefault)){const e=t.entityDefault;for(let n=0;n<e.length;++n){const s=e[n];if("type"in s&&"string"==typeof s.type&&s.type==t.entity.type){i=s;break}}}const n={entity:t.entity,entityDefault:i,root:t.root,dataSection:t.dataSection};return e.unpack(n)}}class Mo extends l{constructor(t){super(),this.name=t.name,this.required=null==t?void 0:t.required,this.width=t.width,this.height=t.height}}class zo{unpack(t){if("name"in t.entity&&"string"==typeof t.entity.name)return new Mo({name:t.entity.name,width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,0),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,0)})}}class ko{unpack(t){if(!(e=t,uo(e)&&"isolines"in e&&I(t.entity)))return;var e;const i=this.createSignalId(t);if(void 0===i)return;let n,s,a;if("id_isoline"in t.entity&&"number"==typeof t.entity.id_isoline?n=t.entity.id_isoline:t.index>=0&&t.index<t.isolines.length&&(n=t.isolines[t.index].id),void 0===n)return;void 0!==t.entityDefault&&I(t.entityDefault)&&(s=t.entityDefault);let o="custom";"fillType"in t.entity&&"string"==typeof t.entity.fillType?o=t.entity.fillType:void 0!==s&&"fillType"in s&&"string"==typeof s.fillType&&(o=s.fillType),"custom"==o&&(a=Xa.tryParseNumber(t.entity,"pointCount",t.entityDefault),void 0===a&&(a=2));const r=Oa.unpack(t.entity,s,"color");let l="line";return"type"in t.entity&&"string"==typeof t.entity.type?l=t.entity.type:void 0!==s&&"type"in s&&"string"==typeof s.type&&(l=s.type),new yo({id:i,type:l,fillType:o,color:null!=r?r:[0,0,0,255],id_isoline:n,pointCount:a})}createSignalId(t){if(!("id_dataSource"in t.entity)||"number"!=typeof t.entity.id_dataSource||!("id_channel"in t.entity)||"number"!=typeof t.entity.id_channel||!("variantName"in t.entity)||"string"!=typeof t.entity.variantName||t.index<0)return;if("id_signal"in t.entity&&"number"==typeof t.entity.id_signal)return t.entity.id_signal;const e=C("id",t.entity.id_dataSource,t.dataSection.sources);if(void 0===e)return;const i=C("id",t.entity.id_channel,e.channels);if(void 0===i)return;const n=C("name","signals",i.variantGroups);if(void 0===n)return;const s=C("name",t.entity.variantName,n.variants);return s instanceof Y&&t.index<s.signals.length?s.signals[t.index].id:void 0}}class Ao{constructor(t){this.itemSettingsParserMap=t}unpack(t){if(!Ka(t))return;let e;if("columns"in t.entity&&A(t.entity.columns)){let i,n;e=[],void 0!==t.entityDefault&&"column"in t.entityDefault&&I(t.entityDefault.column)&&(i=t.entityDefault.column),void 0!==i&&"row"in i&&I(i.row)&&(n=i.row);const s=t.entity.columns;for(let a=0;a<s.length;++a){const o=s[a],r=[];if("rows"in o&&A(o.rows)){const e=o.rows;let i;void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)&&(i=t.entityDefault.items);for(let s=0;s<e.length;++s){const a=e[s];let o;if("item"in a&&I(a.item)&&"type"in a.item&&"string"==typeof a.item.type){const e=this.itemSettingsParserMap.get(a.item.type);if(void 0===e)continue;let n;void 0!==i&&(n=C("name",a.item.type,i)),void 0!==i&&(void 0===n&&(n={}),n.items=i);const s={entity:a.item,entityDefault:n,root:t.root,dataSection:t.dataSection},r=e.unpack(s);void 0!==r&&r instanceof ya&&(o=r)}r.push({height:Wa(Xa.tryParseString(a,"height",n),0,1),item:o})}}e.push({width:Wa(Xa.tryParseString(o,"width",i),0,1),rowsSpace:Wa(Xa.tryParseString(o,"rowsSpace",i),0,0),rows:r})}}return new Ca({x:Wa(Xa.tryParseString(t.entity,"x",t.entityDefault),0,0),y:Wa(Xa.tryParseString(t.entity,"y",t.entityDefault),0,0),width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,1),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),columnsSpace:Wa(Xa.tryParseString(t.entity,"columnsSpace",t.entityDefault),0,0),columns:e})}}class Fo{constructor(t){this.itemSettingsParserMap=t}unpack(t){if(!Ka(t))return;let e;if("rows"in t.entity&&A(t.entity.rows)){let i,n;e=[],void 0!==t.entityDefault&&"row"in t.entityDefault&&I(t.entityDefault.row)&&(i=t.entityDefault.row),void 0!==i&&"column"in i&&I(i.column)&&(n=i.column);const s=t.entity.rows;for(let a=0;a<s.length;++a){const o=s[a],r=[];if("columns"in o&&A(o.columns)){const e=o.columns;let i;void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)&&(i=t.entityDefault.items);for(let s=0;s<e.length;++s){const a=e[s];let o;if("item"in a&&I(a.item)&&"type"in a.item&&"string"==typeof a.item.type){const e=this.itemSettingsParserMap.get(a.item.type);if(void 0===e)continue;let n;void 0!==i&&(n=C("name",a.item.type,i)),void 0!==i&&(void 0===n&&(n={}),n.items=i);const s={entity:a.item,entityDefault:n,root:t.root,dataSection:t.dataSection},r=e.unpack(s);void 0!==r&&r instanceof ya&&(o=r)}r.push({width:Wa(Xa.tryParseString(a,"width",n),0,1),item:o})}}e.push({height:Wa(Xa.tryParseString(o,"height",i),0,1),columnsSpace:Wa(Xa.tryParseString(o,"columnsSpace",i),0,0),columns:r})}}return new Da({x:Wa(Xa.tryParseString(t.entity,"x",t.entityDefault),0,0),y:Wa(Xa.tryParseString(t.entity,"y",t.entityDefault),0,0),width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,1),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),rowsSpace:Wa(Xa.tryParseString(t.entity,"rowsSpace",t.entityDefault),0,0),rows:e})}}class Vo{constructor(t){this.itemSettingsParserMap=t}unpack(t){if(!Ka(t))return;let e;if("items"in t.entity&&A(t.entity.items)){const i=t.entity.items;let n;void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)&&(n=t.entityDefault.items);for(let s=0;s<i.length;++s){const a=i[s];if(!("type"in a)||"string"!=typeof a.type)continue;const o=this.itemSettingsParserMap.get(a.type);if(void 0===o)continue;let r;void 0!==n&&(r=C("name",a.type,n)),void 0!==n&&(void 0===r&&(r={}),r.items=n);const l={entity:a,entityDefault:r,root:t.root,dataSection:t.dataSection},d=o.unpack(l);void 0!==d&&d instanceof ya&&(void 0===e&&(e=[]),e.push(d))}}return new ka({x:Wa(Xa.tryParseString(t.entity,"x",t.entityDefault),0,0),y:Wa(Xa.tryParseString(t.entity,"y",t.entityDefault),0,0),width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,1),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),items:e})}}class _o extends ya{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u,g;super({id:null==t?void 0:t.id,type:null!==(e=null==t?void 0:t.type)&&void 0!==e?e:"plot",x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding}),this.content=null!==(i=null==t?void 0:t.content)&&void 0!==i?i:[],this.sectorBorders=void 0===(null==t?void 0:t.sectorBorders)?void 0:{topCentralHeight:null===(n=null==t?void 0:t.sectorBorders)||void 0===n?void 0:n.topCentralHeight,topHeight:null===(s=null==t?void 0:t.sectorBorders)||void 0===s?void 0:s.topHeight,bottomCentralHeight:null===(a=null==t?void 0:t.sectorBorders)||void 0===a?void 0:a.bottomCentralHeight,bottomHeight:null===(o=null==t?void 0:t.sectorBorders)||void 0===o?void 0:o.bottomHeight,leftCentralWidth:null===(r=null==t?void 0:t.sectorBorders)||void 0===r?void 0:r.leftCentralWidth,leftWidth:null===(l=null==t?void 0:t.sectorBorders)||void 0===l?void 0:l.leftWidth,rightCentralWidth:null===(d=null==t?void 0:t.sectorBorders)||void 0===d?void 0:d.rightCentralWidth,rightWidth:null===(c=null==t?void 0:t.sectorBorders)||void 0===c?void 0:c.rightWidth},this.isAutoMarkRestore=null!==(h=null==t?void 0:t.isAutoMarkRestore)&&void 0!==h&&h,this.title=null!==(u=null==t?void 0:t.title)&&void 0!==u?u:"",this.dataSources=null!==(g=null==t?void 0:t.dataSources)&&void 0!==g?g:[]}findContent(t){const e=C("name",t,this.content);if(void 0!==e)return{obj:e.settings,sector:e.sector}}findPlacedContent(t,e){const i=C("name",t,this.content);if(void 0!==i&&e.includes(i.sector))return{obj:i.settings,sector:i.sector}}}class Ro{constructor(t,e,i){this.dataSourceParser=t,this.sectorParser=e,this.contentParserMap=i}unpack(t){if(!("type"in t.entity)||"string"!=typeof t.entity.type||!Ka(t))return;let e;if(void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)){const i=C("type",t.entity.type,t.entityDefault.items);void 0!==i&&"settings"in i&&I(i.settings)&&(e=i.settings)}const i=["central","bottom","bottomCentral","top","topCentral","left","leftCentral","right","rightCentral"],n={};if("sectors"in t.entity&&A(t.entity.sectors)){const s=[],a=t.entity.sectors;for(let n=0;n<a.length;++n){const o=a[n];if(!("name"in o)||"string"!=typeof o.name)continue;if(!i.includes(o.name))continue;let r;if(void 0!==e&&"sectors"in e&&A(e.sectors))for(let t=0;t<e.sectors.length;++t){const i=e.sectors[t];if("name"in i&&"string"==typeof i.name&&i.name==o.name){r=i;break}}const l={entity:o,entityDefault:r,root:t.root,dataSection:t.dataSection},d=this.sectorParser.unpack(l);void 0!==d&&d instanceof Mo&&s.push(d)}if(void 0!==e&&"sectors"in e&&A(e.sectors))for(let i=0;i<e.sectors.length;++i){const n=e.sectors[i];if(!("name"in n)||"string"!=typeof n.name)continue;const a=C("name",n.name,s);if(void 0!==a&&!0!==a.required)continue;const o={entity:n,root:t.root,dataSection:t.dataSection},r=this.sectorParser.unpack(o);void 0!==r&&r instanceof Mo&&s.push(r)}const o=["central","left","leftCentral","right","rightCentral"],r=["central","bottom","bottomCentral","top","topCentral"];for(let t=0;t<s.length;++t){const e=s[t],i=e.name;if(!o.includes(i)&&void 0!==e.height){n[`${i}Height`]=e.height.copy()}if(!r.includes(i)&&void 0!==e.width){n[`${i}Width`]=e.width.copy()}}}const s=[];if("content"in t.entity&&A(t.entity.content)){const n=t.entity.content;for(let a=0;a<n.length;++a){const o=n[a];if(!("name"in o)||"string"!=typeof o.name||"sector"in o&&"string"==typeof o.sector&&!i.includes(o.sector))continue;const r=this.contentParserMap.get(o.name);if(void 0===r)continue;let l;void 0!==e&&"content"in e&&A(e.content)&&(l=C("name",o.name,e.content));const d={entity:o,entityDefault:l,root:t.root,dataSection:t.dataSection},c=r.unpack(d);void 0!==c&&c instanceof to&&s.push(c)}}if(void 0!==e&&"content"in e&&A(e.content)){const i=e.content;for(let e=0;e<i.length;++e){const n=i[e];if(!("name"in n&&"string"==typeof n.name&&("requiredMin"in n||"requiredMax"in n||"required"in n&&!0===n.required)))continue;const a=this.contentParserMap.get(n.name);if(void 0===a)continue;let o=1,r=1,l=this.containsCount(n.name,s);"requiredMin"in n&&"number"==typeof n.requiredMin&&(o=n.requiredMin),"requiredMax"in n&&"number"==typeof n.requiredMax&&(r=n.requiredMax);const d=Math.max(o,r);for(;l<d;++l){const e={entity:{...n},root:t.root,dataSection:t.dataSection},i=a.unpack(e);void 0!==i&&i instanceof to&&s.push(i)}}}const a=[];let o,r,l=[];if("dataSources"in t.entity&&A(t.entity.dataSources))l=t.entity.dataSources;else{if("channel"in t.entity&&"channels"in t.entity)return;const e={id_dataSource:0};"marks"in t.entity&&A(t.entity.marks)&&(e.marks=t.entity.marks),"channel"in t.entity&&I(t.entity.channel)&&(e.channel=t.entity.channel),"channels"in t.entity&&A(t.entity.channels)&&(e.channels=t.entity.channels),"channel"in e||"channels"in e||(e.channels=[{}]),l.push(e)}if(void 0!==e&&"dataSource"in e&&I(e.dataSource)&&(o=e.dataSource),l.length>0)for(let d=0;d<l.length;++d){const e={entity:l[d],entityDefault:o,root:t.root,dataSection:t.dataSection,index:d},i=this.dataSourceParser.unpack(e);void 0!==i&&i instanceof So&&a.push(i)}return"id"in t.entity&&"number"==typeof t.entity.id&&(r=t.entity.id),new _o({id:r,type:t.entity.type,x:Wa(Xa.tryParseString(t.entity,"x",e),0,0),y:Wa(Xa.tryParseString(t.entity,"y",e),0,0),width:Wa(Xa.tryParseString(t.entity,"width",e),0,1),height:Wa(Xa.tryParseString(t.entity,"height",e),0,1),content:s,sectorBorders:n,isAutoMarkRestore:Xa.tryParseBoolean(t.entity,"isAutoMarkRestore",e),title:Xa.tryParseString(t.entity,"title",e),dataSources:a})}containsCount(t,e){let i=0;for(let n=0;n<e.length;++n)e[n].name==t&&i++;return i}}class Lo{constructor(t){this.itemSettingsParserMap=t}unpack(t){if(!Ka(t))return;const e=[];if("rows"in t.entity&&A(t.entity.rows)){const i=t.entity.rows;let n;void 0!==t.entityDefault&&"row"in t.entityDefault&&I(t.entityDefault.row)&&(n=t.entityDefault.row);for(let t=0;t<i.length;++t){const s=i[t];e.push({height:Wa(Xa.tryParseString(s,"height",n),0,1)})}}const i=[];if("columns"in t.entity&&A(t.entity.columns)){const e=t.entity.columns;let n;void 0!==t.entityDefault&&"column"in t.entityDefault&&I(t.entityDefault.column)&&(n=t.entityDefault.column);for(let t=0;t<e.length;++t){const s=e[t];null!=s&&"object"==typeof s&&i.push({width:Wa(Xa.tryParseString(s,"width",n),0,1)})}}const n=[];if("mergedCells"in t.entity&&A(t.entity.mergedCells)){const e=t.entity.mergedCells;for(let t=0;t<e.length;++t){const i=e[t];n.push({rowBegin:this.getMergedCellValue("rowBegin",i),rowEnd:this.getMergedCellValue("rowEnd",i),columnBegin:this.getMergedCellValue("columnBegin",i),columnEnd:this.getMergedCellValue("columnEnd",i)})}}const s=[];if("items"in t.entity&&M(t.entity.items)){let e;void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)&&(e=t.entityDefault.items);const i=t.entity.items;for(let n=0;n<i.length;++n){const a=i[n];if(!A(a))continue;const o=[];for(let i=0;i<a.length;++i){const n=a[i];if(!("type"in n)||"string"!=typeof n.type)continue;const s=this.itemSettingsParserMap.get(n.type);if(void 0===s)continue;let r;void 0!==e&&(r=C("name",n.type,e)),void 0!==e&&(void 0===r&&(r={}),r.items=e);const l={entity:n,entityDefault:r,root:t.root,dataSection:t.dataSection},d=s.unpack(l);void 0!==d&&d instanceof ya&&o.push(d)}s.push(o)}}return new Va({x:Wa(Xa.tryParseString(t.entity,"x",t.entityDefault),0,0),y:Wa(Xa.tryParseString(t.entity,"y",t.entityDefault),0,0),width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,1),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),rowsSpace:Wa(Xa.tryParseString(t.entity,"rowsSpace",t.entityDefault),0,0),columnsSpace:Wa(Xa.tryParseString(t.entity,"columnsSpace",t.entityDefault),0,0),rows:e,columns:i,mergedCells:n,items:s})}getMergedCellValue(t,e){let i=0;if(t in e){const n=e[t];"number"==typeof n&&(i=n)}return i}}class Eo{static unpack(t,e,i){let n,s,a,o,r,l;if(I(t)&&e in t){const i=t[e];I(i)&&(n=i)}if(void 0!==i&&I(i)&&e in i){const t=i[e];I(t)&&(s=t)}if(void 0!==n||void 0!==s)return void 0!==n&&("left"in n&&"string"==typeof n.left&&(a=n.left),"right"in n&&"string"==typeof n.right&&(o=n.right),"top"in n&&"string"==typeof n.top&&(r=n.top),"bottom"in n&&"string"==typeof n.bottom&&(l=n.bottom)),void 0!==s&&(void 0===a&&"left"in s&&"string"==typeof s.left&&(a=s.left),void 0===o&&"right"in s&&"string"==typeof s.right&&(o=s.right),void 0===r&&"top"in s&&"string"==typeof s.top&&(r=s.top),void 0===l&&"bottom"in s&&"string"==typeof s.bottom&&(l=s.bottom)),new $({left:void 0===a?void 0:Wa(a,0,0),right:void 0===o?void 0:Wa(o,0,0),top:void 0===r?void 0:Wa(r,0,0),bottom:void 0===l?void 0:Wa(l,0,0)})}}class jo{constructor(t){this.itemSettingsParserMap=t}unpack(t){const e=this.parseCanvasSettings(t);return new wa(void 0===e?void 0:{x:e.x,y:e.y,width:e.width,height:e.height,items:e.items,parentWidth:e.parentWidth,parentHeight:e.parentHeight,parentHtmlObject:e.parentHtmlObject})}parseCanvasSettings(t){if(!Ka(t)||!("items"in t.entity)||!A(t.entity.items))return;let e;const i=t.entity.items;let n,s,a,o;void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)&&(n=t.entityDefault.items);for(let r=0;r<i.length;++r){const s=i[r];if(!("type"in s)||"string"!=typeof s.type)continue;const a=this.itemSettingsParserMap.get(s.type);if(void 0===a)continue;let o;void 0!==t.entityDefault&&void 0!==n&&(o=C("name",s.type,n)),void 0!==n&&(void 0===o&&(o={}),o.items=n);const l={entity:s,entityDefault:o,root:t.root,dataSection:t.dataSection},d=a.unpack(l);void 0!==d&&d instanceof ya&&(void 0===e&&(e=[]),e.push(d))}return"parentHeight"in t.entity&&"number"==typeof t.entity.parentHeight&&(s=t.entity.parentHeight),"parentWidth"in t.entity&&"number"==typeof t.entity.parentWidth&&(a=t.entity.parentWidth),"parentHtmlObject"in t.entity&&t.entity.parentHtmlObject instanceof HTMLElement&&(o=t.entity.parentHtmlObject),void 0!==t.entityDefault&&("parentHeight"in t.entityDefault&&"number"==typeof t.entityDefault.parentHeight&&(s=t.entityDefault.parentHeight),"parentWidth"in t.entityDefault&&"number"==typeof t.entityDefault.parentWidth&&(a=t.entityDefault.parentWidth),"parentHtmlObject"in t.entityDefault&&t.entityDefault.parentHtmlObject instanceof HTMLElement&&(o=t.entityDefault.parentHtmlObject)),{x:Wa(Xa.tryParseString(t.entity,"x",t.entityDefault),0,0),y:Wa(Xa.tryParseString(t.entity,"y",t.entityDefault),0,0),width:Wa(Xa.tryParseString(t.entity,"width",t.entityDefault),0,1),height:Wa(Xa.tryParseString(t.entity,"height",t.entityDefault),0,1),margin:Eo.unpack(t.entity,"margin",t.entityDefault),padding:Eo.unpack(t.entity,"padding",t.entityDefault),items:e,parentWidth:a,parentHeight:s,parentHtmlObject:o}}}class Yo extends jo{constructor(t){super(t)}unpack(t){const e=this.parseCanvasSettings(t);let i;return"withFpsMeter"in t.entity&&"boolean"==typeof t.entity.withFpsMeter&&(i=t.entity.withFpsMeter),new Ia(void 0===e?void 0:{x:e.x,y:e.y,width:e.width,height:e.height,items:e.items,parentWidth:e.parentWidth,parentHeight:e.parentHeight,parentHtmlObject:e.parentHtmlObject,withFpsMeter:i})}}class Oo{unpack(t){if(!("id_unit"in t.entity)||"number"!=typeof t.entity.id_unit)return;let e,i;return"text"in t.entity&&"string"==typeof t.entity.text&&(e=t.entity.text),"scale"in t.entity&&"number"==typeof t.entity.scale&&(i=t.entity.scale),new d({id_unit:t.entity.id_unit,text:e,scale:i})}}function Uo(t){return"index"in t}function To(t){return Uo(t)&&"units"in t}class Wo{constructor(t,e){this.variantGroupParserMap=t,this.unitParser=e}unpack(t){if(!To(t)||!("name"in t.entity)||"string"!=typeof t.entity.name)return;let e;"id"in t.entity&&"number"==typeof t.entity.id&&(e=t.entity.id),void 0===e&&(e=t.index);let i,n,s=0;if(t.units.length>0&&(n={id_unit:t.units[0].id}),"unit"in t.entity&&I(t.entity.unit)&&(n=t.entity.unit),void 0!==n){const e={entity:n,root:t.root},s=this.unitParser.unpack(e);void 0!==s&&s instanceof d&&(i=s)}let a,o=[];if("variantGroups"in t.entity&&A(t.entity.variantGroups)&&(o=t.entity.variantGroups),"variants"in t.entity){if("signals"in t.entity)return;if(void 0!==C("name","signals",o))return;if(!A(t.entity.variants))return;let e,i;if("defaultVariant"in t.entity&&"string"==typeof t.entity.defaultVariant&&(e=t.entity.defaultVariant),"currVariant"in t.entity&&"string"==typeof t.entity.currVariant&&(i=t.entity.currVariant),void 0===i&&(i=e),void 0===i&&t.entity.variants.length>0){const e=t.entity.variants[0];"name"in e&&"string"==typeof e.name&&(i=e.name)}o.push({name:"signals",currVariant:i,defaultVariant:e,variants:t.entity.variants})}else if("signals"in t.entity){if(void 0!==C("name","signals",o)||"number"!=typeof t.entity.signals&&!A(t.entity.signals))return;const e={signals:"number"==typeof t.entity.signals?t.entity.signals:[...t.entity.signals],name:"_default"};o.push({name:"signals",currVariant:"_default",defaultVariant:"_default",variants:[e]})}if(void 0!==t.entityDefault)if("variantGroups"in t.entityDefault&&A(t.entityDefault.variantGroups)){if("variants"in t.entityDefault)return;a=t.entityDefault.variantGroups}else"variants"in t.entityDefault&&A(t.entityDefault.variants)&&(a=[{name:"signals",currVariant:"_default",defaultVariant:"_default",variants:[...t.entityDefault.variants]}]);const r=[];for(let d=0;d<o.length;++d){const e=o[d];if("name"in e&&"string"==typeof e.name){const i=this.variantGroupParserMap.get(e.name);if(void 0!==i){let n;void 0!==a&&(n=C("name",e.name,a));const o={entity:e,entityDefault:n,root:t.root},l=i.unpack(o);if(void 0!==l&&l instanceof oo&&(r.push(l),"signals"===e.name)){const t=l.getCurrVariantInfo();t instanceof Y&&(s=t.signals.length)}}}}let l=!0;"original"in t.entity&&"boolean"==typeof t.entity.original?l=t.entity.original:void 0!==t.entityDefault&&"original"in t.entityDefault&&"boolean"==typeof t.entityDefault.original&&(l=t.entityDefault.original),"maxSignalCount"in t.entity&&"number"==typeof t.entity.maxSignalCount?s=t.entity.maxSignalCount:void 0!==t.entityDefault&&"maxSignalCount"in t.entityDefault&&"number"==typeof t.entityDefault.maxSignalCount&&(s=t.entityDefault.maxSignalCount);let c=!0;"hasVariableIsoline"in t.entity&&"boolean"==typeof t.entity.hasVariableIsoline?c=t.entity.hasVariableIsoline:void 0!==t.entityDefault&&"hasVariableIsoline"in t.entityDefault&&"boolean"==typeof t.entityDefault.hasVariableIsoline&&(c=t.entityDefault.hasVariableIsoline);let h=0;return"frequency"in t.entity&&"number"==typeof t.entity.frequency?h=t.entity.frequency:void 0!==t.entityDefault&&"frequency"in t.entityDefault&&"number"==typeof t.entityDefault.frequency&&(h=t.entityDefault.frequency),new E({id:e,name:t.entity.name,unit:i,original:l,maxSignalCount:s,hasVariableIsoline:c,variantGroups:r,frequency:h})}}class Xo{constructor(t){this.signalParser=t}unpack(t){if(!("name"in t.entity)||"string"!=typeof t.entity.name)return;const e=[];let i;if(void 0!==t.entityDefault&&"signal"in t.entityDefault&&I(t.entityDefault.signal)&&(i=t.entityDefault.signal),"signals"in t.entity){let n=[];if("number"==typeof t.entity.signals)for(let e=0;e<t.entity.signals;++e)n.push({});else{if(!A(t.entity.signals))return;n=t.entity.signals}for(let s=0;s<n.length;++s){const a={entity:n[s],entityDefault:i,root:t.root,index:s},o=this.signalParser.unpack(a);void 0!==o&&o instanceof U&&e.push(o)}}return new Y({name:t.entity.name,signals:e})}}class Ho{constructor(t){this.id=t.id,this.name=t.name}}class No{constructor(t,e){this.channelParser=t,this.markParser=e}unpack(t){if(!To(t))return;let e;"id"in t.entity&&"number"==typeof t.entity.id&&(e=t.entity.id),void 0===e&&(e=t.index);const i=[];let n,s=[];if("channels"in t.entity){if("channel"in t.entity)return;A(t.entity.channels)&&(s=t.entity.channels)}else if("channel"in t.entity&&I(t.entity.channel)){const e={id:0};for(const i of Object.getOwnPropertyNames(t.entity.channel))"id"!=i&&(e[i]=t.entity.channel[i]);s.push(e)}void 0!==t.entityDefault&&"channel"in t.entityDefault&&I(t.entityDefault.channel)&&(n=t.entityDefault.channel);for(let r=0;r<s.length;++r){const e={entity:s[r],entityDefault:n,root:t.root,index:r,units:t.units},a=this.channelParser.unpack(e);void 0!==a&&a instanceof E&&i.push(a)}const a=[];let o;if(void 0!==t.entityDefault&&"mark"in t.entityDefault&&I(t.entityDefault.mark)&&(o=t.entityDefault.mark),"marks"in t.entity&&A(t.entity.marks)){const e=t.entity.marks;for(let i=0;i<e.length;++i){const n={entity:e[i],entityDefault:o,root:t.root,index:i},s=this.markParser.unpack(n);void 0!==s&&s instanceof Ho&&a.push(s)}}return new O({id:e,channels:i,marks:a})}}class Go{unpack(t){if(!Uo(t))return;let e,i,n;return"id"in t.entity&&"number"==typeof t.entity.id&&(e=t.entity.id),void 0===e&&(e=t.index),"name"in t.entity&&"string"==typeof t.entity.name&&(i=t.entity.name),"title"in t.entity&&"string"==typeof t.entity.title&&(n=t.entity.title),void 0===i&&void 0===n&&(i=""),new U({id:e,name:i,title:n})}}class qo{unpack(t){if(!Uo(t))return;let e,i,n;return"id"in t.entity&&"number"==typeof t.entity.id&&(e=t.entity.id),void 0===e&&(e=t.index),"text"in t.entity&&"string"==typeof t.entity.text&&(i=t.entity.text),"scale"in t.entity&&"number"==typeof t.entity.scale&&(n=t.entity.scale),new T({id:e,text:i,scale:n})}}class $o extends j{constructor(t){var e,i,n,s;super("debug"),this.fillWebglElements=null===(e=null==t?void 0:t.fillWebglElements)||void 0===e||e,this.fillHtmlElements=null!==(i=null==t?void 0:t.fillHtmlElements)&&void 0!==i&&i,this.strokeWebglElements=null===(n=null==t?void 0:t.strokeWebglElements)||void 0===n||n,this.strokeHtmlElements=null===(s=null==t?void 0:t.strokeHtmlElements)||void 0===s||s}}class Ko{unpack(t){return new $o({fillWebglElements:Xa.tryParseBoolean(t.entity,"fillWebglElements",t.entityDefault),fillHtmlElements:Xa.tryParseBoolean(t.entity,"fillHtmlElements",t.entityDefault),strokeWebglElements:Xa.tryParseBoolean(t.entity,"strokeWebglElements",t.entityDefault),strokeHtmlElements:Xa.tryParseBoolean(t.entity,"strokeHtmlElements",t.entityDefault)})}}class Zo extends L{constructor(t){var e,i,n;super({variantGroups:null!==(e=null==t?void 0:t.variantGroups)&&void 0!==e?e:[]}),this.units=null!==(i=null==t?void 0:t.units)&&void 0!==i?i:[],this.sources=null!==(n=null==t?void 0:t.sources)&&void 0!==n?n:[]}}class Jo extends L{constructor(t){var e,i,n,s;super({variantGroups:null!==(e=null==t?void 0:t.variantGroups)&&void 0!==e?e:[]}),this.width=null!==(i=null==t?void 0:t.width)&&void 0!==i?i:new N(1),this.height=null!==(n=null==t?void 0:t.height)&&void 0!==n?n:new N(1),this.items=null!==(s=null==t?void 0:t.items)&&void 0!==s?s:[]}}class Qo extends l{constructor(t){super(),this.schemaVersion=t.schemaVersion,this.data=t.data,this.view=t.view}}class tr{constructor(t){this.dataUnpacker=t.dataUnpacker,this.viewUnpacker=t.viewUnpacker}unpack(t){if(!("schemaVersion"in t.entity&&"string"==typeof t.entity.schemaVersion&&"data"in t.entity&&I(t.entity.data)&&"view"in t.entity&&I(t.entity.view)))return;let e,i;void 0!==t.entityDefault&&("data"in t.entityDefault&&I(t.entityDefault.data)&&(e=t.entityDefault.data),"view"in t.entityDefault&&I(t.entityDefault.view)&&(i=t.entityDefault.view));const n={entity:t.entity.data,entityDefault:e,root:t.root},s=this.dataUnpacker.unpack(n);if(void 0===s||!(s instanceof Zo))return;const a={entity:t.entity.view,entityDefault:i,root:t.root,dataSection:s},o=this.viewUnpacker.unpack(a);return void 0!==o&&o instanceof Jo?new Qo({schemaVersion:t.entity.schemaVersion,data:s,view:o}):void 0}}class er{constructor(t,e,i){this.unitSettingsParser=t,this.sourceSettingsParser=e,this.variantGroupParserMap=i}unpack(t){const e=[];if("units"in t.entity&&A(t.entity.units)){const i=t.entity.units;let n;void 0!==t.entityDefault&&"unit"in t.entityDefault&&I(t.entityDefault.unit)&&(n=t.entityDefault.unit);for(let s=0;s<i.length;++s){const a={entity:i[s],entityDefault:n,root:t.root,index:s},o=this.unitSettingsParser.unpack(a);void 0!==o&&o instanceof T&&e.push(o)}}const i=[];let n=[];if("sources"in t.entity&&A(t.entity.sources))n=t.entity.sources;else if("marks"in t.entity||"channels"in t.entity||"channel"in t.entity){if("channels"in t.entity&&"channel"in t.entity)return;const e={id:0};"marks"in t.entity&&A(t.entity.marks)&&(e.marks=t.entity.marks),"channels"in t.entity&&A(t.entity.channels)&&(e.channels=t.entity.channels),"channel"in t.entity&&I(t.entity.channel)&&(e.channel=t.entity.channel),n.push(e)}if(n.length>0){let s;void 0!==t.entityDefault&&"source"in t.entityDefault&&I(t.entityDefault.source)&&(s=t.entityDefault.source);for(let a=0;a<n.length;++a){const o={entity:n[a],entityDefault:s,root:t.root,index:a,units:e},r=this.sourceSettingsParser.unpack(o);void 0!==r&&r instanceof O&&i.push(r)}}const s=[];if("variantGroups"in t.entity&&A(t.entity.variantGroups)){const e=t.entity.variantGroups;let i;void 0!==t.entityDefault&&"variantGroups"in t.entityDefault&&A(t.entityDefault.variantGroups)&&(i=t.entityDefault.variantGroups);for(let n=0;n<e.length;++n){const a=e[n];if("name"in a&&"string"==typeof a.name){const e=this.variantGroupParserMap.get(a.name);if(void 0!==e){let n;void 0!==i&&(n=C("name",a.name,i));const o={entity:a,entityDefault:n,root:t.root},r=e.unpack(o);void 0!==r&&r instanceof oo&&s.push(r)}}}}return new Zo({units:e,sources:i,variantGroups:s})}}class ir{constructor(t,e){this.itemSettingsParserMap=t,this.viewVariantGroupParserMap=e}unpack(t){if(!Ka(t))return;let e;const i=[];if("variantGroups"in t.entity&&A(t.entity.variantGroups)){const e=t.entity.variantGroups;for(let n=0;n<e.length;++n){const s=e[n];if("name"in s&&"string"==typeof s.name){const a=s.name,o=this.viewVariantGroupParserMap.get(a);if(void 0!==o){let s;void 0!==t.entityDefault&&"variantGroups"in t.entityDefault&&A(t.entityDefault.variantGroups)&&(s=C("name",a,t.entityDefault.variantGroups));const r={entity:e[n],entityDefault:s,root:t.root,dataSection:t.dataSection},l=o.unpack(r);void 0!==l&&l instanceof oo&&i.push(l)}}}}const n=[];if(void 0!==t.entityDefault&&"items"in t.entityDefault&&A(t.entityDefault.items)){const e=t.entityDefault.items;for(let t=0;t<e.length;++t){const i=e[t];if("type"in i)if(z(i.type)){const t=i.type;for(let e=0;e<t.length;++e){const s=P.typedDeepCopy(i);void 0!==s&&(s.type=t[e],n.push(s))}}else n.push(i)}}let s=[];if("canvas"in t.entity&&I(t.entity.canvas))"type"in t.entity.canvas||(t.entity.canvas.type="canvas"),s.push(t.entity.canvas);else{if(!("items"in t.entity)||!A(t.entity.items))return new Jo({variantGroups:i});s=t.entity.items}for(let a=0;a<s.length;++a){const i=s[a];if(!("type"in i)||"string"!=typeof i.type)continue;const o=this.itemSettingsParserMap.get(i.type);if(void 0===o)continue;let r=C("type",i.type,n);void 0===r&&(r={}),r.items=n;const l={entity:i,entityDefault:r,root:t.root,dataSection:t.dataSection},d=o.unpack(l);void 0!==d&&d instanceof ya&&(void 0===e&&(e=[]),e.push(d))}return new Jo({items:e,variantGroups:i})}}class nr{unpack(t){if("name"in t.entity&&"string"==typeof t.entity.name&&"release"==t.entity.name)return new j("release")}}class sr{constructor(t){this.variantUnpackerMap=t.variantUnpackerMap,this.defaultVariantUnpacker=t.defaultVariantUnpacker}unpack(t){if(!("name"in t.entity)||"string"!=typeof t.entity.name||!("variants"in t.entity)||!A(t.entity.variants))return;const e=t.entity.variants,i=[];let n,s;void 0!==t.entityDefault&&I(t.entityDefault)&&"variants"in t.entityDefault&&A(t.entityDefault.variants)&&(n=t.entityDefault.variants);for(let o=0;o<e.length;++o){const s=e[o];let a;if(!("name"in s)||"string"!=typeof s.name)continue;if(void 0!==n){const t=C("name","_common",n);if(void 0!==t){let{name:e,...i}=t;a=i}const e=C("name",s.name,n);void 0===a?a=e:void 0!==e&&(a=P.typedMerge(e,a))}let r=this.variantUnpackerMap.get(s.name);if(void 0===r){if(void 0===this.defaultVariantUnpacker)continue;r=this.defaultVariantUnpacker}const l={entity:s,entityDefault:a,root:t.root},d=r.unpack(l);void 0!==d&&d instanceof j&&i.push(d)}"currVariant"in t.entity&&"string"==typeof t.entity.currVariant?s=t.entity.currVariant:e.length>0&&"name"in e[0]&&"string"==typeof e[0].name&&(s=e[0].name);let a=s;return"defaultVariant"in t.entity&&"string"==typeof t.entity.defaultVariant&&(a=t.entity.defaultVariant),new oo({name:t.entity.name,currVariant:s,defaultVariant:a,variants:i})}}class ar extends sr{constructor(t){super(t)}unpack(t){if(!("name"in t.entity&&"string"==typeof t.entity.name&&"variants"in t.entity&&A(t.entity.variants)&&Ka(t)))return;const e=t.entity.variants,i=[];let n,s;void 0!==t.entityDefault&&I(t.entityDefault)&&"variants"in t.entityDefault&&A(t.entityDefault.variants)&&(n=t.entityDefault.variants);for(let o=0;o<e.length;++o){const s=e[o];let a;if(!("name"in s)||"string"!=typeof s.name)continue;if(void 0!==n){const t=C("name","_common",n);if(void 0!==t){let{name:e,...i}=t;a=i}const e=C("name",s.name,n);void 0===a?a=e:void 0!==e&&(a=P.typedMerge(e,a))}let r=this.variantUnpackerMap.get(s.name);if(void 0===r){if(void 0===this.defaultVariantUnpacker)continue;r=this.defaultVariantUnpacker}const l={entity:s,entityDefault:a,root:t.root,dataSection:t.dataSection},d=r.unpack(l);void 0!==d&&d instanceof j&&i.push(d)}"currVariant"in t.entity&&"string"==typeof t.entity.currVariant?s=t.entity.currVariant:e.length>0&&"name"in e[0]&&"string"==typeof e[0].name&&(s=e[0].name);let a=s;return"defaultVariant"in t.entity&&"string"==typeof t.entity.defaultVariant&&(a=t.entity.defaultVariant),new oo({name:t.entity.name,currVariant:s,defaultVariant:a,variants:i})}}class or{constructor(t){var e,i,n,s,a,o,r,l,d,c,h,u;this.x=null!==(e=null==t?void 0:t.x)&&void 0!==e?e:0,this.y=null!==(i=null==t?void 0:t.y)&&void 0!==i?i:0,this.width=null!==(n=null==t?void 0:t.width)&&void 0!==n?n:0,this.height=null!==(s=null==t?void 0:t.height)&&void 0!==s?s:0,this.linkedChannel={id_dataSource:null!==(o=null===(a=null==t?void 0:t.linkedChannel)||void 0===a?void 0:a.id_dataSource)&&void 0!==o?o:-1,id:null!==(l=null===(r=null==t?void 0:t.linkedChannel)||void 0===r?void 0:r.id)&&void 0!==l?l:-1},this.scaleX={current:null===(d=null==t?void 0:t.scaleX)||void 0===d?void 0:d.current,values:void 0===(null==t?void 0:t.scaleX)?[]:[...t.scaleX.values],unit:null===(c=null==t?void 0:t.scaleX)||void 0===c?void 0:c.unit},this.scaleY={current:null===(h=null==t?void 0:t.scaleY)||void 0===h?void 0:h.current,values:void 0===(null==t?void 0:t.scaleY)?[]:[...t.scaleY.values],unit:null===(u=null==t?void 0:t.scaleY)||void 0===u?void 0:u.unit},this.filters={current:void 0===(null==t?void 0:t.filters)?[]:[...t.filters.current],allowed:void 0===(null==t?void 0:t.filters)?[]:[...t.filters.allowed]}}}class rr{constructor(t){this.id=t.id,this.type=t.type,this.webglPlot=t.webglPlot,this.hasAddedPoints=!1,this.viewSettings=new or}async init(){}async setChannelVariant(t,e,i){this.hasAddedPoints=!1,await this.webglPlot.setChannelVariant(t,e,i),await this.webglPlot.onSignalLabelClicked(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id)}async setDefaultChannelVariant(t,e){this.hasAddedPoints=!1,await this.webglPlot.setDefaultChannelVariant(t,e),await this.webglPlot.onSignalLabelClicked(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id)}async setScaleX(t){await this.webglPlot.setScaleX(t)}async setScaleY(t){await this.webglPlot.setScaleY(t);const e=this.webglPlot.getParentCanvas();null==e||e.refreshGraphics()}async setFilters(t){await this.webglPlot.setFilters(t);const e=this.webglPlot.getParentCanvas();null==e||e.refreshGraphics()}async setChannelScaleX(t,e){var i;const n=this.webglPlot.typedSettings;if(null===(i=n.synchronizedScaleX)||void 0===i||i){const i=n.findPlacedContent("signals",[g.Central]);if(void 0!==i&&i.obj instanceof fi){const n=i.obj;n.scaleX.currIndex=e,n.scaleX.currValue=t}await this.webglPlot.setScaleX(t)}else await this.webglPlot.setChannelScaleX(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id,t)}async setChannelScaleY(t){await this.webglPlot.setChannelScaleY(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id,t);const e=this.webglPlot.getParentCanvas();null==e||e.refreshGraphics()}async setChannelFilters(t){await this.webglPlot.setChannelFilters(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id,t);const e=this.webglPlot.getParentCanvas();null==e||e.refreshGraphics()}setChannelUnit(t,e,i){this.webglPlot.setChannelUnit(t,e,i);const n=this.webglPlot.getParentCanvas();null==n||n.refreshGraphics()}addPoints(t,e,i){for(let n=0;n<i.length;n++)this.hasAddedPoints=!0,this.webglPlot.addSignalData(t,e,i[n].id,i[n].data)}addSignalData(t,e,i,n){this.hasAddedPoints=!0,this.webglPlot.addSignalData(t,e,i,n)}addMark(t,e,i){this.webglPlot.addMark(t,e,i)}clearMarks(t,e){this.webglPlot.clearMarks(t,e)}updateSourceChannelVariant(t){}updateChannelSource(t,e){}setMeanderUnit(t){var e,i,n,s,a,o;this.webglPlot.setMeanderUnit(t);const r=this.webglPlot.getChannelSettings(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id);if(void 0===r)return;const l=this.webglPlot.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===l||!(l.obj instanceof fi))return;const d=l.obj;if(void 0===d)return;let c=null!==(i=null===(e=this.webglPlot.getUnitSettings(d.scaleY.distanceUnit))||void 0===e?void 0:e.text)&&void 0!==i?i:"";void 0!==(null===(n=r.scaleY)||void 0===n?void 0:n.distanceUnit)&&(c=null!==(a=null===(s=this.webglPlot.getUnitSettings(r.scaleY.distanceUnit))||void 0===s?void 0:s.text)&&void 0!==a?a:""),this.viewSettings.scaleY.unit=`${c}/${t}`;const h=this.webglPlot.getParentCanvas();null==h||h.refreshGraphics(),null===(o=this.onViewSettingsChanged)||void 0===o||o.call(this,this.id)}getSelectedChannelSettings(){return this.webglPlot.getChannelSettings(this.viewSettings.linkedChannel.id_dataSource,this.viewSettings.linkedChannel.id)}selectChannel(t,e){var i,n,s,a,o,r,l,d,c,h,u,f,p;if(this.viewSettings.linkedChannel.id_dataSource==t&&this.viewSettings.linkedChannel.id==e)return;this.viewSettings.linkedChannel={id_dataSource:t,id:e},this.webglPlot.initChannelScaleXSettings(t,e),this.webglPlot.initChannelScaleYSettings(t,e),this.webglPlot.initChannelFilterSettings(t,e);const v=this.webglPlot.getChannelSettings(t,e);if(void 0===v)return;void 0!==v.scaleX&&(rr.setViewScales("scaleX",[...v.scaleX.values],this.viewSettings),this.viewSettings.scaleX.current=this.viewSettings.scaleX.values[v.scaleX.index]),void 0!==v.scaleY&&(rr.setViewScales("scaleY",[...v.scaleY.values],this.viewSettings),this.viewSettings.scaleY.current=this.viewSettings.scaleY.values[v.scaleY.index]),this.viewSettings.filters.allowed=null!==(n=null===(i=v.filters)||void 0===i?void 0:i.map((t=>t.name)))&&void 0!==n?n:[],void 0===v.selectedFiltersNames&&(v.selectedFiltersNames=[]),this.viewSettings.filters.current=[...v.selectedFiltersNames];const y=this.webglPlot.getChannelUnitText(v);void 0!==y&&this.webglPlot instanceof Ui&&this.webglPlot.setMeanderUnit(y),void 0!==this.viewSettings.scaleY.current&&this.webglPlot.setMeanderHeight(this.viewSettings.scaleY.current.value);const m=this.webglPlot.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===m||!(m.obj instanceof fi))return;const S=m.obj;if(void 0===S)return;let w=null!==(a=null===(s=this.webglPlot.getUnitSettings(S.scaleY.distanceUnit))||void 0===s?void 0:s.text)&&void 0!==a?a:"";void 0!==(null===(o=v.scaleY)||void 0===o?void 0:o.distanceUnit)&&(w=null!==(l=null===(r=this.webglPlot.getUnitSettings(v.scaleY.distanceUnit))||void 0===r?void 0:r.text)&&void 0!==l?l:"");let x=null!==(c=null===(d=this.webglPlot.getUnitSettings(S.scaleY.valueUnit))||void 0===d?void 0:d.text)&&void 0!==c?c:"";void 0!==(null===(h=v.scaleY)||void 0===h?void 0:h.valueUnit)&&(x=null!==(f=null===(u=this.webglPlot.getUnitSettings(v.scaleY.valueUnit))||void 0===u?void 0:u.text)&&void 0!==f?f:""),this.viewSettings.scaleY.unit=`${w}/${x}`;const C=this.webglPlot.getParentCanvas();null==C||C.refreshGraphics(),null===(p=this.onViewSettingsChanged)||void 0===p||p.call(this,this.id)}static setViewScales(t,e,i){i[t].values=[];for(let n=0;n<e.length;n++)i[t].values.push({text:`${e[n]}`,value:e[n],index:n})}}class lr{constructor(t){this.id_source=t.id_source,this.id_channel=t.id_channel}}class dr extends lr{constructor(t){super({id_source:t.id_source,id_channel:t.id_channel}),this.blockSize=t.blockSize,this.pointCounter=t.pointCounter,this.signals=t.signals}}class cr extends rr{constructor(t){super(t)}afterAddDataToChannels(t){var e,i;this.hasAddedPoints&&t instanceof dr&&(null===(i=(e=this.webglPlot).afterAddDataToChannels)||void 0===i||i.call(e,t.id_source,t.id_channel,{blockSize:t.blockSize,frameCounter:t.pointCounter}),this.hasAddedPoints=!1)}}class hr extends or{constructor(t){var e,i,n,s,a;super({x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,linkedChannel:null==t?void 0:t.linkedChannel,scaleX:null==t?void 0:t.scaleX,scaleY:null==t?void 0:t.scaleY,filters:null==t?void 0:t.filters}),this.controlsHeight=null!==(e=null==t?void 0:t.controlsHeight)&&void 0!==e?e:0,this.controlsMargin={top:null!==(n=null===(i=null==t?void 0:t.controlsMargin)||void 0===i?void 0:i.top)&&void 0!==n?n:0,bottom:null!==(a=null===(s=null==t?void 0:t.controlsMargin)||void 0===s?void 0:s.bottom)&&void 0!==a?a:0}}}class ur{static create(t){var e,i,n,s,a,o,r,l,d,c,h,u,f,p,v,y,m,S,w,x,C,b;const I=t.typedSettings,P=I.findPlacedContent("signals",[g.Central]);if(void 0===P||!(P.obj instanceof fi))return;const B=P.obj;if(void 0===B)return;const D={id_dataSource:I.linkedChannel.id_dataSource,id:I.linkedChannel.id},M=t.getChannelSettings(D.id_dataSource,D.id);if(void 0===M)return;void 0===M.scaleX&&(M.scaleX=new Pi({values:[]})),void 0===M.scaleY&&(M.scaleY=new Pi({values:[]})),0==M.scaleX.values.length&&(M.scaleX.values=[...B.scaleX.values]),0==M.scaleY.values.length&&(M.scaleY.values=[...B.scaleY.values]),void 0===M.scaleX.index&&(M.scaleX.index=null!==(e=B.scaleX.defaultIndex)&&void 0!==e?e:0),M.scaleX.index<0&&M.scaleX.values.length>0&&(M.scaleX.index=0),void 0===M.scaleY.index&&(M.scaleY.index=null!==(i=B.scaleY.defaultIndex)&&void 0!==i?i:0),M.scaleY.index<0&&M.scaleY.values.length>0&&(M.scaleY.index=0),void 0===M.filters&&(M.filters=B.filters.map((t=>t.copy())),M.selectedFiltersNames=[...B.defaultFilters]),void 0===M.selectedFiltersNames&&(M.selectedFiltersNames=[]);const z=[];let k;for(let g=0;g<M.scaleX.values.length;++g){const t=M.scaleX.values[g],e={index:g,value:t,text:`${t}`};g==M.scaleX.index&&(k=e),z.push(e)}const A=[];let F;for(let g=0;g<M.scaleY.values.length;++g){const t=M.scaleY.values[g],e={index:g,value:t,text:`${t}`};g==M.scaleY.index&&(F=e),A.push(e)}let V=null!==(s=null===(n=t.getUnitSettings(B.scaleX.distanceUnit))||void 0===n?void 0:n.text)&&void 0!==s?s:"";void 0!==(null===(a=M.scaleX)||void 0===a?void 0:a.distanceUnit)&&(V=null!==(r=null===(o=t.getUnitSettings(M.scaleX.distanceUnit))||void 0===o?void 0:o.text)&&void 0!==r?r:"");let _=null!==(d=null===(l=t.getUnitSettings(B.scaleY.distanceUnit))||void 0===l?void 0:l.text)&&void 0!==d?d:"";void 0!==(null===(c=M.scaleY)||void 0===c?void 0:c.distanceUnit)&&(_=null!==(u=null===(h=t.getUnitSettings(M.scaleY.distanceUnit))||void 0===h?void 0:h.text)&&void 0!==u?u:"");let R=null!==(p=null===(f=t.getUnitSettings(B.scaleX.timeUnit))||void 0===f?void 0:f.text)&&void 0!==p?p:"";void 0!==(null===(v=M.scaleX)||void 0===v?void 0:v.timeUnit)&&(R=null!==(m=null===(y=t.getUnitSettings(M.scaleX.timeUnit))||void 0===y?void 0:y.text)&&void 0!==m?m:"");let L=null!==(w=null===(S=t.getUnitSettings(B.scaleY.valueUnit))||void 0===S?void 0:S.text)&&void 0!==w?w:"";void 0!==(null===(x=M.scaleY)||void 0===x?void 0:x.valueUnit)&&(L=null!==(b=null===(C=t.getUnitSettings(M.scaleY.valueUnit))||void 0===C?void 0:C.text)&&void 0!==b?b:"");return new hr({width:12,linkedChannel:D,scaleX:{current:k,values:z,unit:`${V}/${R}`},scaleY:{current:F,values:A,unit:`${_}/${L}`},filters:{current:[...M.selectedFiltersNames],allowed:M.filters.map((t=>t.name))}})}}class gr extends hr{constructor(t){var e;super({x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,linkedChannel:null==t?void 0:t.linkedChannel,scaleX:null==t?void 0:t.scaleX,scaleY:null==t?void 0:t.scaleY,filters:null==t?void 0:t.filters}),this.signalBox={current:null===(e=null==t?void 0:t.signalBox)||void 0===e?void 0:e.current,values:void 0===(null==t?void 0:t.signalBox)?[]:[...t.signalBox.values]}}}class fr{constructor(t){this.deviceSignalId=t.deviceSignalId,this.plots=t.plots}}class pr extends fr{constructor(t){super({deviceSignalId:t.deviceSignalId,plots:t.plots}),this.clbK=t.clbK,this.clbB=t.clbB}}function vr(t){return t in qe}!function(t){t.BeforeSettingsParsing="BeforeSettingsParsing",t.AfterSettingsParsing="AfterSettingsParsing",t.AfterSaveableSettingsApplied="AfterSaveableSettingsApplied",t.BeforeObjectsCreation="BeforeObjectsCreation",t.AfterRootObjectCreated="AfterRootObjectCreated",t.AfterGraphicItemCreated="AfterGraphicItemCreated"}(qe||(qe={}));class yr{constructor(t){this.configParser=t,this.dataSourcesMap=new Map,this.eventsListeners=new Map,this.plotsInfo=[],this.eventHandlers=new Map,this.parentHtmlWidth=0,this.parentHtmlHeight=0,this.parserCallbacks=new Map;const e=Object.keys(qe).filter((t=>isNaN(Number(t))));this.parserCallbackPlaces=e;for(const i of e){if(!vr(i))continue;const t=qe[i];this.parserCallbacks.set(t,{forAll:[],forType:new Map})}}init(t,e){this.clearParserCallbacks(),void 0!==e&&null!=e&&I(e)&&(this.sourceSaveableUserSettings=P.typedDeepCopy(e)),null!=t&&I(t)&&(this.sourceSettings=P.typedDeepCopy(t));this.configParser.visualizatorCreator.addCallback("beforeAddItems",(async t=>{if(!(I(t)&&"graphicObject"in t&&"settings"in t&&"creator"in t&&t.graphicObject instanceof ft&&t.settings instanceof bi&&t.creator instanceof Ya))return;const e=t.graphicObject,i=window.devicePixelRatio,n=Mt();e.setDeviceScale(i),e.setPpi(n)}))}setParentHtml(t,e){void 0===e&&(e=void 0),void 0===e&&(e=t);this.configParser.visualizatorCreator.addCallback("beforeAddItems",(async i=>{if(!(I(i)&&"graphicObject"in i&&"settings"in i&&"creator"in i&&i.graphicObject instanceof ft&&i.settings instanceof ja&&i.creator instanceof Ya))return;const n=e.getBoundingClientRect(),s=Math.floor(n.width),a=Math.floor(n.height);i.graphicObject.typedSettings.htmlElement=t,i.graphicObject.typedSettings.size.width=new N(s),i.graphicObject.typedSettings.size.height=new N(a),await i.graphicObject.setParentSize(s,a),await i.graphicObject.setSize(new N(s),new N(a)),new ResizeObserver(this.tryUpdateRootSize.bind(this)).observe(e)}))}async create(){await this.applyParserCallbacks(qe.BeforeSettingsParsing);const t=await this.configParser.parseSettings(this.sourceSettings);if(void 0===t||!(t instanceof Qo))return;this.config=t,this.createDataSourceCachedInfo(),await this.applyParserCallbacks(qe.AfterSettingsParsing),await this.applyParserCallbacks(qe.AfterSaveableSettingsApplied),this.configParser.makeObjectCreators(),await this.applyParserCallbacks(qe.BeforeObjectsCreation);const e=await this.configParser.createObjects();void 0!==e&&e instanceof ft&&(this.rootObject=e,await this.applyParserCallbacks(qe.AfterGraphicItemCreated),this.rootObject.setDeviceScale(window.devicePixelRatio),this.updateSaveableSettings())}addEventListener(t,e,i){for(let n=0;n<this.plotsInfo.length;n++){this.plotsInfo[n].webglPlot.addEventListener(t,e,i)}}getPlotType(t){if(t.startsWith("plot"))return this.getPlotSubtype(t)}getTypedPlotsInfo(t){return this.plotsInfo.filter((e=>this.hasFitPlotSubtype(e.type,t))).map((t=>({id:t.id,viewSettings:t.viewSettings})))}getFirstPlot(){if(0!=this.plotsInfo.length)return this.plotsInfo[0].webglPlot}async setFrequency(t,e,i){const n=null!=t?t:0,s=this.getChannelId(n,e);s<0||await this.setChannelFrequency(n,s,i)}async setChannelFrequency(t,e,i){const n=null!=t?t:0;for(let s=0;s<this.plotsInfo.length;s++)await this.forPlotChannelAsync(n,e,this.plotsInfo[s],(async(t,e)=>{await t.webglPlot.setFrequency(e.id_dataSource,e.id,i),e.frequency=i}))}async setDefaultChannelVariant(t,e){const i=null!=t?t:0;if(this.clearChannelsData(i),void 0===this.config)return;const n=C("id",i,this.config.data.sources);if(void 0===n)return;const s=C("name",e,n.channels);if(void 0===s)return;const a=C("name","signals",s.variantGroups);if(void 0===a)return;const o=this.dataSourcesMap.get(i);if(void 0===o)return;const r=o.channelIdMap.get(e);if(void 0===r)return;const l=o.channels.get(r);if(void 0!==l){l.currVariant=a.defaultVariant;for(let t=0;t<this.plotsInfo.length;t++)await this.forPlotChannelAsync(i,r,this.plotsInfo[t],(async(t,e)=>{await t.setDefaultChannelVariant(e.id_dataSource,e.id)}));await this.updateLinkedChannelVariant(i,e,a.defaultVariant)}}async setChannelVariant(t,e,i){const n=null!=t?t:0;this.clearChannelsData(n);const s=this.dataSourcesMap.get(n);if(void 0===s)return;const a=s.channelIdMap.get(e);if(void 0===a)return;const o=s.channels.get(a);if(void 0!==o){o.currVariant=i;for(let t=0;t<this.plotsInfo.length;++t)await this.forPlotChannelAsync(n,a,this.plotsInfo[t],(async(t,e)=>{await t.setChannelVariant(e.id_dataSource,e.id,i)}));await this.updateLinkedChannelVariant(n,e,i)}}getChannelId(t,e){const i=this.dataSourcesMap.get(t);if(void 0===i)return-1;const n=i.channelIdMap.get(e);return null!=n?n:-1}getMappedChannelInfo(t,e){const i=this.dataSourcesMap.get(t);if(void 0!==i)return i.channels.get(e)}forEachChannelPlot(t,e,i){for(let n=0;n<this.plotsInfo.length;n++)this.forPlotChannel(t,e,this.plotsInfo[n],i)}getChannelPlots(t,e){const i=[];for(let n=0;n<this.plotsInfo.length;n++){const s=C("id",t,this.plotsInfo[n].webglPlot.typedSettings.dataSources);if(void 0!==s){void 0!==C("id",e,s.channels)&&i.push(this.plotsInfo[n])}}return i}addEventHandler(t,e){this.eventHandlers.set(t,e)}addParserCallback(t,e,i){const n=this.parserCallbacks.get(t);if(void 0!==n)if(void 0===e||"all"==e)n.forAll.push(i);else{const t=n.forType.get(e);if(void 0===t)return;t.push(i)}}clearParserCallbacks(){this.parserCallbacks.clear();for(let t=0;t<this.parserCallbackPlaces.length;t++){const e=this.parserCallbackPlaces[t];if(!vr(e))continue;const i=qe[e];this.parserCallbacks.set(i,{forAll:[],forType:new Map})}}clearChannelsData(t){const e=null!=t?t:0,i=this.dataSourcesMap.get(e);void 0!==i&&i.channelIdMap.forEach((t=>{const n=i.channels.get(t);if(void 0!==n&&0!=n.plots.length)for(let i=0;i<n.plots.length;i++){const s=C("id",n.plots[i].id,this.plotsInfo);null==s||s.webglPlot.clearChannelData(e,t)}}))}clearChannels(t){const e=null!=t?t:0,i=this.dataSourcesMap.get(e);void 0!==i&&i.channelIdMap.forEach((t=>{const n=i.channels.get(t);if(void 0!==n&&0!=n.plots.length)for(let i=0;i<n.plots.length;i++){const s=C("id",n.plots[i].id,this.plotsInfo);void 0!==s&&s.webglPlot.clearChannelData(e,t)}}))}refreshGraphics(){void 0!==this.rootObject&&requestAnimationFrame(this.rootObject.draw.bind(this.rootObject))}async setScaleX(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);if(void 0===n)return;const s=n.viewSettings.scaleX.values[e];i&&(n.viewSettings.scaleX.current=s),await n.setScaleX(s.value);const a=n.webglPlot.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===a||!(a.obj instanceof fi))return;const o=a.obj;o.scaleX.currIndex=s.index,o.scaleX.currValue=s.value,this.updateSaveableSettings()}async setScaleY(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);if(void 0===n)return;const s=n.viewSettings.scaleY.values[e];i&&(n.viewSettings.scaleY.current=s),await n.setScaleY(s.value);const a=n.webglPlot.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===a||!(a.obj instanceof fi))return;const o=a.obj;o.scaleY.currIndex=s.index,o.scaleY.currValue=s.value,this.updateSaveableSettings()}async setFilters(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);if(void 0===n)return;i&&(n.viewSettings.filters.current=[...e]),await n.setFilters(e);const s=n.webglPlot.typedSettings.findPlacedContent("signals",[g.Central]);if(void 0===s||!(s.obj instanceof fi))return;s.obj.selectedFilters=[...e],this.updateSaveableSettings()}async setChannelScaleX(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);if(void 0===n)return;const s=n.viewSettings.scaleX.values[e];i&&(n.viewSettings.scaleX.current=s),await n.setChannelScaleX(s.value,s.index),this.updateSaveableSettings()}async setChannelScaleY(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);if(void 0===n)return;const s=n.viewSettings.scaleY.values[e];i&&(n.viewSettings.scaleY.current=s),await n.setChannelScaleY(s.value),this.updateSaveableSettings()}async setChannelFilters(t,e,i){void 0===i&&(i=!1);const n=C("id",t,this.plotsInfo);void 0!==n&&(i&&(n.viewSettings.filters.current=[...e]),await n.setChannelFilters(e),this.updateSaveableSettings())}setChannelUnit(t,e,i){const n=null!=t?t:0,s=this.getChannelId(n,e);if(this.forEachChannelPlot(n,s,((t,e)=>{t.setChannelUnit(e.id_dataSource,e.id,i)})),void 0===this.config)return;const a=C("id",n,this.config.data.sources);if(void 0===a)return;const o=C("name",e,a.channels);if(void 0===o)return;const r=this.dataSourcesMap.get(n);void 0!==r&&this.forEachLinkedChannel(r,o.id,(t=>{this.forEachChannelPlot(n,t,function(t,e){t.setChannelUnit(e.id_dataSource,e.id,i)}.bind(this))}))}async updateRootSize(){if(this.updateRootSizeTimeout=void 0,void 0===this.rootObject||void 0===this.rootObject.typedSettings.htmlElement)return;const t=window.devicePixelRatio;if(this.rootObject.getDeviceScale()!=t){const e=Mt();this.rootObject.setDeviceScale(t),this.rootObject.setPpi(e)}const e=this.rootObject.typedSettings.htmlElement.getBoundingClientRect(),i=Math.floor(e.width),n=Math.floor(e.height);0!=i&&0!=n&&(this.parentHtmlWidth==i&&this.parentHtmlHeight==n||(this.parentHtmlWidth=i,this.parentHtmlHeight=n,await this.rootObject.setParentSize(i,n),await this.rootObject.setSize(new N(i),new N(n)),this.refreshGraphics()))}tryUpdateRootSize(){void 0!==this.updateRootSizeTimeout&&(clearTimeout(this.updateRootSizeTimeout),this.updateRootSizeTimeout=void 0),this.updateRootSizeTimeout=setTimeout(this.updateRootSize.bind(this),200)}clear(){clearTimeout(this.resizeTimeout),clearTimeout(this.initTimeout)}setActiveMode(t){void 0!==this.rootObject&&(t?(this.rootObject.typedSettings.drawEnabled=!0,this.refreshGraphics()):(this.rootObject.typedSettings.drawEnabled=!1,this.clear()))}updateSaveableSettings(){this.config}forPlotChannel(t,e,i,n){const s=C("id",t,i.webglPlot.typedSettings.dataSources);if(void 0===s)return;const a=C("id",e,s.channels);void 0!==a&&n(i,a)}async forPlotChannelAsync(t,e,i,n){const s=C("id",t,i.webglPlot.typedSettings.dataSources);if(void 0===s)return;const a=C("id",e,s.channels);void 0!==a&&await n(i,a)}clearMarks(t,e){const i=this.dataSourcesMap.get(t);if(void 0===i)return;const n=i.markIdMap.get(e);if(void 0===n)return;const s=i.marks.get(n);if(void 0!==s&&s.plots.length>0)for(let a=0;a<s.plots.length;a++){const e=C("id",s.plots[a],this.plotsInfo);null==e||e.clearMarks(t,n)}}addMarkToPlots(t,e,i){const n=this.dataSourcesMap.get(t);if(void 0===n)return;const s=n.markIdMap.get(e);if(void 0===s)return;const a=n.marks.get(s);if(void 0!==a&&a.plots.length>0)for(let o=0;o<a.plots.length;o++){const e=C("id",a.plots[o],this.plotsInfo);null==e||e.addMark(t,s,i)}}createDataSourceCachedInfo(){if(void 0!==this.config)for(let t=0;t<this.config.data.sources.length;t++){const e=this.config.data.sources[t],i=this.createDataSourceMappedInfo(e);this.dataSourcesMap.set(e.id,i)}}createDataSourceMappedInfo(t){const e={channelIdMap:new Map,channels:new Map,markIdMap:new Map,marks:new Map},i=[];for(let n=0;n<t.channels.length;n++){const s=t.channels[n],a=C("name","signals",s.variantGroups);if(void 0===a)continue;const o={linkedChannels:[],plots:[],currVariant:a.currVariant,variants:new Map};void 0!==s.conversionSettings&&"rhythm"==s.conversionSettings.type&&s.conversionSettings instanceof r&&i.push({id:s.conversionSettings.id_sourceChannel,linkedId:s.id}),e.channelIdMap.set(s.name,s.id),e.channels.set(s.id,o);for(let t=0;t<a.variants.length;t++){const e=a.variants[t];if(!(e instanceof Y))continue;const i={signalsIdMap:new Map,signals:new Map};o.variants.set(e.name,i);for(let t=0;t<e.signals.length;t++){const n=e.signals[t],s=new pr({deviceSignalId:t,plots:[],clbK:0,clbB:0});i.signals.set(n.id,s)}}}for(let n=0;n<i.length;n++){const t=i[n],s=e.channels.get(t.id);void 0!==s&&s.linkedChannels.push(t.linkedId)}for(let n=0;n<t.marks.length;n++){const i=t.marks[n],s={plots:[]};e.markIdMap.set(i.name,i.id),e.marks.set(i.id,s)}return e}async updateLinkedChannelVariant(t,e,i){const n=this.dataSourcesMap.get(t);if(void 0===n)return;const s=n.channelIdMap.get(e);if(void 0===s)return;const a=n.channels.get(s);if(void 0!==a)for(let o=0;o<a.linkedChannels.length;++o){const e=a.linkedChannels[o],s=n.channels.get(e);if(void 0!==s)for(let n=0;n<s.plots.length;++n){const a=C("id",s.plots[n].id,this.plotsInfo);void 0!==a&&(a.updateSourceChannelVariant(i),a.updateChannelSource(t,e),await a.webglPlot.onSignalLabelClicked(a.viewSettings.linkedChannel.id_dataSource,a.viewSettings.linkedChannel.id))}}}forEachLinkedChannel(t,e,i){const n=t.channels.get(e);void 0!==n&&0!=n.linkedChannels.length&&n.linkedChannels.forEach(i)}async applyParserCallbacks(t){const e=this.parserCallbacks.get(t);if(void 0!==e){for(let t=0;t<e.forAll.length;++t){const i=e.forAll[t];await i(this.configParser)}for(const[t,i]of e.forType.entries())for(let e=0;e<i.length;++e){const n=i[e];await n(this.configParser,t)}}}createSignalPlotIdList(t,e,i,n,s){if(0==s.plots.length)return[];const a=[];for(let o=0;o<s.plots.length;o++){const r=s.plots[o].id,l=C("id",r,this.plotsInfo);if(void 0===l)continue;const d=l.webglPlot.getChannelSettings(t,e);if(void 0===d)continue;const c=C("name","signals",d.variantGroups);if(void 0===c)continue;const h=C("id",i,c.variants);if(void 0===h||!(h instanceof si))continue;void 0!==C("id",n,h.signals)&&a.push(r)}return a}addPlotIdToChannelMappedInfo(t,e,i,n){const s=t.channels.get(e.id);if(void 0===s)return;void 0===C("id",i,s.plots)&&s.plots.push(n(i)),e.forEachSignalsVariant((t=>{if(!(t instanceof si))return;const e=s.variants.get(t.name);if(void 0!==e)for(let n=0;n<t.signals.length;n++){const s=t.signals[n],a=e.signals.get(s.id);void 0===a||a.plots.includes(i)||a.plots.push(i)}}))}addPlotIdToMarkMappedInfo(t,e,i){const n=t.marks.get(e.id);void 0!==n&&(n.plots.includes(i)||n.plots.push(i))}addValueToMappedArray(t,e,i){if(t.has(e)){const n=t.get(e);null==n||n.push(i)}else t.set(e,[i])}signalInfoHashCode(t,e){return 1e3*t+e}getPlotSubtype(t){if(t.length<8)return;const e=t.substring(5).split(":");return 2==e.length?{signalType:e[0],targetType:e[1]}:void 0}hasFitPlotSubtype(t,e){const i=this.getPlotSubtype(t);return void 0!==i&&i.targetType==e}}class mr extends yr{constructor(t){super(t)}setCalibration(t,e,i,n,s){if(void 0===this.config)return;const a=null!=t?t:0,o=this.dataSourcesMap.get(a);if(void 0===o)return;const r=o.channelIdMap.get(e);if(void 0===r)return;const l=C("id",a,this.config.data.sources);if(void 0===l)return;const d=C("name",e,l.channels);if(void 0===d)return;const c=o.channels.get(r);void 0!==c&&d.forEachSignalsVariant((t=>{if(!(t instanceof Y))return;const e=c.variants.get(t.name);if(void 0!==e){e.signalsIdMap=new Map;for(let a=0;a<t.signals.length;a++){const o=t.signals[a],r=e.signals.get(o.id);if(void 0!==r&&r instanceof pr)if(t.signals.length>i.length)r.deviceSignalId=a,r.clbK=n[0],r.clbB=s[0],e.signalsIdMap.set(a,a);else{const t=i[a];r.deviceSignalId=t,r.clbK=n[t],r.clbB=s[t],e.signalsIdMap.set(t,a)}}}}))}getPhysicValues(t,e,i,n){var s;const a=[];for(let o=0;o<e;o++){const r={id:null!==(s=n.signalsIdMap.get(o))&&void 0!==s?s:-1,data:[]};if(r.id>=0){r.data.length=i;const s=n.signals.get(r.id);if(void 0===s||!(s instanceof pr))continue;const l=.001*s.clbK;for(let n=0;n<i;n++)r.data[n]=t[n*e+o]*l+s.clbB;a.push(r)}}return a}addPointsToPlots(t,e){const i=this.dataSourcesMap.get(t);if(void 0===i)return;const n=e;for(let s=0;s<n.channels.length;s++)this.addChannelPointsToPlots(t,i,n.channels[s])}addChannelPointsToPlots(t,e,i){const n=e.channelIdMap.get(i.name);if(void 0===n)return;const s=e.channels.get(n);if(void 0===s)return;const a=s.variants.get(s.currVariant);if(void 0===a)return;const o=new dr({id_source:t,id_channel:n,blockSize:i.blockSize,pointCounter:i.pointCounter,signals:this.getPhysicValues(i.data,i.signalCount,i.blockSize,a)});this.addPointsToWebglPlot(o,s,t,n),this.forEachLinkedChannel(e,n,(i=>{const s=e.channels.get(i);if(void 0===n||void 0===s||0==s.plots.length)return;const a=new dr({id_source:t,id_channel:i,blockSize:o.blockSize,pointCounter:o.pointCounter,signals:o.signals}),r=[];for(let e=0;e<s.plots.length;e++){const i=s.plots[e].id;r.includes(i)||r.push(i);const a=C("id",s.plots[e].id,this.plotsInfo);if(void 0!==a)for(let e=0;e<o.signals.length;e++){const i=new Fn(o.signals[e].data);a.addSignalData(t,n,e,i)}}for(let t=0;t<r.length;t++){const e=C("id",r[t],this.plotsInfo);null==e||e.afterAddDataToChannels(a)}}))}addPointsToWebglPlot(t,e,i,n){const s=e.variants.get(e.currVariant);if(void 0===s)return;const a=[];for(let o=0;o<t.signals.length;o++){const e=s.signals.get(o);if(void 0!==e&&e.plots.length>0)for(let s=0;s<e.plots.length;s++){const r=e.plots[s];a.includes(r)||a.push(r);const l=C("id",r,this.plotsInfo),d=new Fn(t.signals[o].data);null==l||l.addSignalData(i,n,o,d)}}for(let o=0;o<a.length;o++){const e=C("id",a[o],this.plotsInfo);null==e||e.afterAddDataToChannels(t)}}addLinkedChannelPointsToWebglPlot(t,e,i,n){const s=e.channels.get(n);if(void 0!==s&&0!=s.plots.length)for(let a=0;a<s.plots.length;a++){const e=C("id",s.plots[a].id,this.plotsInfo);void 0!==e&&(e.addPoints(i,n,t.signals),e.afterAddDataToChannels(t))}}}class Sr{constructor(t){this.id=t.id}}class wr extends Sr{constructor(t){super({id:t.id}),this.channelWidth=t.channelWidth}}class xr{static parse(t){if(null!=t&&I(t)&&"type"in t&&"string"==typeof t.type)switch(t.type){case"adc":return xr.isVisMessage(t)?t:void 0;case"event":return xr.isEventMessage(t)?t:void 0}}static isVisMessage(t){if(!("time"in t)||!("channels"in t)||"string"!=typeof t.time||!A(t.channels))return!1;for(let e=0;e<t.channels.length;++e)if(!xr.isVisMessageChannel(t.channels[e]))return!1;return!0}static isEventMessage(t){return"data"in t}static isVisMessageChannel(t){return"name"in t&&"string"==typeof t.name&&"pointCounter"in t&&"number"==typeof t.pointCounter&&"data"in t&&k(t.data)&&"signalCount"in t&&"number"==typeof t.signalCount&&"blockSize"in t&&"number"==typeof t.blockSize}}class Cr{constructor(t){this.linkedChannels=t.linkedChannels,this.plots=t.plots,this.currVariant=t.currVariant,this.variants=t.variants}}class br extends Cr{constructor(t){super({linkedChannels:t.linkedChannels,plots:t.plots,currVariant:t.currVariant,variants:t.variants}),this.channelMaxWidth=t.channelMaxWidth}}class Ir{unpack(t){if("id"in t.entity&&"number"==typeof t.entity.id&&"name"in t.entity&&"string"==typeof t.entity.name)return new Ho({id:t.entity.id,name:t.entity.name})}}class Pr{constructor(t){this.gridViewParserMap=t}unpack(t){if(!Ka(t))return;let e;"view"in t.entity&&"string"==typeof t.entity.view&&(e=t.entity.view),void 0===e&&void 0!==t.entityDefault&&"view"in t.entityDefault&&"string"==typeof t.entityDefault.view&&(e=t.entityDefault.view),void 0===e&&(e="webgl-single");const i=this.gridViewParserMap.get(e);if(void 0===i)return;const n={entity:t.entity,entityDefault:t.entityDefault,root:t.root,dataSection:t.dataSection};return i.unpack(n)}}class Br{pack(t){return{}}}class Dr{constructor(t){this.markGroupCreators=t}create(t){const e=this.markGroupCreators.get(t.type);if(void 0!==e)return e.create(t)}}class Mr extends l{constructor(t){var e,i;super(),this.synchronized=null===(e=null==t?void 0:t.synchronized)||void 0===e||e,this.color=null!==(i=null==t?void 0:t.color)&&void 0!==i?i:[0,0,0,1]}}class zr{unpack(t){var e;if(!I(t.entity))return;let i;void 0!==t.entityDefault&&I(t.entityDefault)&&(i=t.entityDefault);const n=Oa.unpack(t.entity,i,"color");return new Mr({synchronized:null===(e=Xa.tryParseBoolean(t.entity,"synchronized",t.entityDefault))||void 0===e||e,color:null!=n?n:[0,0,0,255]})}}class kr extends _o{constructor(t){var e;super({id:null==t?void 0:t.id,type:null==t?void 0:t.type,x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,height:null==t?void 0:t.height,margin:null==t?void 0:t.margin,padding:null==t?void 0:t.padding,content:null==t?void 0:t.content,sectorBorders:null==t?void 0:t.sectorBorders,isAutoMarkRestore:null==t?void 0:t.isAutoMarkRestore,title:null==t?void 0:t.title,dataSources:null==t?void 0:t.dataSources}),this.isNeedChannelLeadRay=null===(e=null==t?void 0:t.isNeedChannelLeadRay)||void 0===e||e}}class Ar extends Fa{constructor(t,e,i){super(e),this.contentCreatorsMap=t,this.dataSourceSettingsCreator=i}createPlotObject(t){var e,i,n,s,a,o,r,l,d,c,h,u,g,f,p,v,y,m,S,w,x;if(void 0===t.parentObject||!(t.visualSettings instanceof kr))return;const C=t.visualSettings,b=void 0===t.parentObject?void 0:ct(t.parentObject,Nt.isCanvas);if(void 0===b||0==C.dataSources.length||0==C.dataSources[0].channels.length)return;const I=C.dataSources[0].channels[0],P=[];C.content.forEach((e=>{const i=this.contentSettingsCreators.get(e.name);if(void 0===i)return;const n=new Fs({sectorConfig:e,rootConfig:t.rootConfig,rootObject:t.rootObject}),s=i.create(n);if(void 0===s)return;const a=new ln({name:e.name,sector:e.sector,layerZ:e.layerZ,settings:s});P.push(a)}));const B=null===(e=b.typedSettings.html.ref)||void 0===e?void 0:e.parentElement,D=[];C.dataSources.forEach((e=>{const i=new ta({dataSourceConfig:e,rootConfig:t.rootConfig,rootObject:t.rootObject,dataSection:t.dataSection});D.push(this.dataSourceSettingsCreator.create(i))}));const M=new Qn({location:new G({x:C.x.copy(),y:C.y.copy()}),size:new J({width:C.width.copy(),height:C.height.copy()}),margin:null!==(n=null===(i=C.margin)||void 0===i?void 0:i.copy())&&void 0!==n?n:void 0,padding:null!==(a=null===(s=C.padding)||void 0===s?void 0:s.copy())&&void 0!==a?a:void 0,parent:void 0===t.parentObject?void 0:new Vt({ref:t.parentObject,jagmHtml:b}),isVisible:!0,isDebugMode:!1,html:{parent:{ref:null==B?void 0:B}},id:void 0===t.visualSettings.id?void 0:`${t.visualSettings.id}`,content:P,sectorBorders:{topHeight:null===(r=null===(o=C.sectorBorders)||void 0===o?void 0:o.topHeight)||void 0===r?void 0:r.copy(),bottomHeight:null===(d=null===(l=C.sectorBorders)||void 0===l?void 0:l.bottomHeight)||void 0===d?void 0:d.copy(),leftWidth:null===(h=null===(c=C.sectorBorders)||void 0===c?void 0:c.leftWidth)||void 0===h?void 0:h.copy(),rightWidth:null===(g=null===(u=C.sectorBorders)||void 0===u?void 0:u.rightWidth)||void 0===g?void 0:g.copy(),topCentralHeight:null===(p=null===(f=C.sectorBorders)||void 0===f?void 0:f.topCentralHeight)||void 0===p?void 0:p.copy(),bottomCentralHeight:null===(y=null===(v=C.sectorBorders)||void 0===v?void 0:v.bottomCentralHeight)||void 0===y?void 0:y.copy(),leftCentralWidth:null===(S=null===(m=C.sectorBorders)||void 0===m?void 0:m.leftCentralWidth)||void 0===S?void 0:S.copy(),rightCentralWidth:null===(x=null===(w=C.sectorBorders)||void 0===w?void 0:w.rightCentralWidth)||void 0===x?void 0:x.copy()},isAutoMarkRestore:!0,filterProviderCreator:()=>new ua(new aa),title:C.title,dataSources:D,contentCreatorsMap:this.contentCreatorsMap,dataSectionSettings:t.dataSection,linkedChannel:{id_dataSource:I.id_dataSource,id:I.id},isNeedChannelLeadRay:C.isNeedChannelLeadRay});return new es(M)}}const Fr={schemaVersion:"3.0.0",data:{isBuffered:!1,unit:{text:"",scale:1},source:{channel:{frequency:1e3,original:!0,hasVariableIsoline:!0,hasNullableData:!0}}},view:{variantGroups:[{name:"production",currVariant:"release",variants:[{name:"debug",settings:{fillWebglElements:!0,fillHtmlElements:!1,strokeWebglElements:!0,strokeHtmlElements:!0}},{name:"release",settings:{}}]},{name:"cursor",currVariant:"line",variants:[{name:"line",settings:{}},{name:"measurer",settings:{}}]}],items:[{type:["plot:online:base","plot:online:rhythm"],settings:{sectors:[{name:"central",required:!0,width:"100 %",height:"100 %"},{name:"left",width:"70 px",variantGroup:{name:"cursor",variants:[{name:"line",settings:{width:"70 px"}},{name:"measurer",settings:{width:"200 px"}}]}},{name:"right",width:"0 px"}],content:[{name:"grid",sector:"*",defaultSector:"central",layerZ:-1,variantKeyField:"view",defaultVariant:"webgl-single",variants:[{key:"webgl-single",settings:{color:"#C8C8C8",cellSize_mm:{width:10,height:10}}},{key:"svg-double",settings:{color:"#f4c5bd",majorCell:{size_mm:{width:10,height:10},lineWidth_mm:.3},minorCell:{size_mm:{width:1,height:1},lineWidth_mm:.1}}}]},{name:"border",sector:"*",defaultSector:"central",layerZ:1,variantKeyField:"view",defaultVariant:"webgl",variants:[{key:"webgl",settings:{color:"#C8C8C8"}},{key:"svg",settings:{color:"#f4c5bd"}}]},{name:"leadRay",sector:"central",layerZ:1,settings:{color:"#66ff00"}},{name:"meander",sector:"*",defaultSector:"leftCentral",layerZ:1,settings:{location:{x:4,y:0},size:{width:12,widthTop:6},unit:"\u043c\u043c",axisX:"FromRightToLeft",axisY:"FromBottomToTop",style:{color:"#C4C4C4"},label:{color:"#808080",fontFamily:"Roboto",fontSize:12}}},{name:"signals",sector:"central",layerZ:0,requiredMin:1,requiredMax:1,settings:{viewScale:{x:1,y:1},scaleX:{defaultValues:[10],defaultIndex:0},scaleY:{defaultValues:[5],defaultIndex:0},synchronizedScaleX:!0,filters:[],defaultFilters:[],labels:{color:"#808080",fontFamily:"Roboto",fontSize:12}}}],dataSource:{channel:{variants:[{name:"_common",isoline:{updateBorder:110},signal:{color:"#000000",type:"line",fillType:"period"},content:[{name:"signalLabels",sector:"*",defaultSector:"leftCentral",layerZ:1,settings:{linkedPosition:!0,y:"0px",color:[0,0,0,255]}},{name:"meanValueLabels",sector:"*",defaultSector:"leftCentral",layerZ:1,settings:{linkedPosition:!0,y:"-14px",color:[0,0,0,255]}}]}]}}}}]}};class Vr{create(t){if(!(t.sectorConfig.settings instanceof Mr))return;const e=t.sectorConfig.settings;let i;const n=x.convertToWebglRgba(e.color);return y(n)&&(i=n.data),new Zn({synchronized:e.synchronized,color:i})}}class _r extends Ro{constructor(t,e,i){super(t,e,i)}unpack(t){if(!Ka(t)||!("type"in t.entity)||"string"!=typeof t.entity.type)return;let e;if(void 0!==t.entityDefault&&"items"in t.entityDefault&&M(t.entityDefault.items)){const i=C("type",t.entity.type,t.entityDefault.items);void 0!==i&&"settings"in i&&"object"==typeof i.settings&&null!=i.settings&&(e=i.settings)}const i=["central","bottom","bottomCentral","top","topCentral","left","leftCentral","right","rightCentral"],n={};if("sectors"in t.entity&&A(t.entity.sectors)){const s=[],a=t.entity.sectors;for(let n=0;n<a.length;++n){const o=a[n];if(!("name"in o)||"string"!=typeof o.name)continue;const r=o.name;if(!i.includes(r))continue;let l;if(void 0!==e&&"sectors"in e&&A(e.sectors))for(let t=0;t<e.sectors.length;++t){const i=e.sectors[t];if("name"in i&&"string"==typeof i.name&&i.name==r){l=i;break}}const d={entity:o,entityDefault:l,root:t.root,dataSection:t.dataSection},c=this.sectorParser.unpack(d);void 0!==c&&c instanceof Mo&&s.push(c)}if(void 0!==e&&"sectors"in e&&A(e.sectors))for(let i=0;i<e.sectors.length;++i){const n=e.sectors[i];if(!("name"in n)||"string"!=typeof n.name)continue;const a=C("name",n.name,s);if(void 0!==a&&!0!==a.required)continue;const o={entity:n,root:t.root,dataSection:t.dataSection},r=this.sectorParser.unpack(o);void 0!==r&&r instanceof Mo&&s.push(r)}const o=["central","left","leftCentral","right","rightCentral"],r=["central","bottom","bottomCentral","top","topCentral"];for(let t=0;t<s.length;++t){const e=s[t];if(!o.includes(e.name)&&void 0!==e.height){n[`${e.name}Height`]=e.height.copy()}if(!r.includes(e.name)&&void 0!==e.width){n[`${e.name}Width`]=e.width.copy()}}}const s=[];if("content"in t.entity&&A(t.entity.content)){const n=t.entity.content;for(let a=0;a<n.length;++a){const o=n[a];if(!("name"in o)||"string"!=typeof o.name||"sector"in o&&"string"==typeof o.sector&&!i.includes(o.sector))continue;const r=this.contentParserMap.get(o.name);if(void 0===r)continue;let l;void 0!==e&&"content"in e&&A(e.content)&&(l=C("name",o.name,e.content));const d={entity:o,entityDefault:l,root:t.root,dataSection:t.dataSection},c=r.unpack(d);void 0!==c&&c instanceof to&&s.push(c)}}if(void 0!==e&&"content"in e&&A(e.content)){const i=e.content;for(let e=0;e<i.length;++e){const n=i[e];if(!("name"in n&&"string"==typeof n.name&&("requiredMin"in n||"requiredMax"in n||"required"in n&&"boolean"==typeof n.required&&n.required)))continue;const a=this.contentParserMap.get(n.name);if(void 0===a)continue;let o=1,r=1,l=this.containsCount(n.name,s);"requiredMin"in n&&"number"==typeof n.requiredMin&&(o=n.requiredMin),"requiredMax"in n&&"number"==typeof n.requiredMax&&(r=n.requiredMax);const d=Math.max(o,r);for(;l<d;++l){const e={entity:{...n},root:t.root,dataSection:t.dataSection},i=a.unpack(e);void 0!==i&&i instanceof to&&s.push(i)}}}const a=[];let o,r,l=[];if("dataSources"in t.entity&&A(t.entity.dataSources))l=t.entity.dataSources;else{if("channel"in t.entity&&"channels"in t.entity)return;const e={id_dataSource:0};"marks"in t.entity&&A(t.entity.marks)&&(e.marks=t.entity.marks),"channel"in t.entity&&I(t.entity.channel)&&(e.channel=t.entity.channel),"channels"in t.entity&&A(t.entity.channels)&&(e.channels=t.entity.channels),"channel"in e||"channels"in e||(e.channels=[{}]),l.push(e)}if(l.length>0){let i;void 0!==e&&"dataSource"in e&&I(e.dataSource)&&(i=e.dataSource);for(let e=0;e<l.length;++e){const n={entity:l[e],entityDefault:i,root:t.root,dataSection:t.dataSection,index:e},s=this.dataSourceParser.unpack(n);void 0!==s&&s instanceof So&&a.push(s)}}return"id"in t.entity&&"number"==typeof t.entity.id&&(o=t.entity.id),"type"in t.entity&&"string"==typeof t.entity.type&&(r=t.entity.type),new kr({id:o,type:r,x:Wa(Xa.tryParseString(t.entity,"x",e),0,0),y:Wa(Xa.tryParseString(t.entity,"y",e),0,0),width:Wa(Xa.tryParseString(t.entity,"width",e),0,1),height:Wa(Xa.tryParseString(t.entity,"height",e),0,1),content:s,sectorBorders:n,isAutoMarkRestore:Xa.tryParseBoolean(t.entity,"isAutoMarkRestore",e),title:Xa.tryParseString(t.entity,"title",e),dataSources:a,isNeedChannelLeadRay:Xa.tryParseBoolean(t.entity,"isNeedChannelLeadRay",e)})}}class Rr{constructor(){this.saveableConfigJsUnpacker=new Br,this.viewObjectCreators=new Map,this.visualizatorCreator=new Ya;const t=new Map;t.set("debug",new Ko),t.set("release",new nr);const e=new Map,i=new sr({variantUnpackerMap:t});e.set("production",i);const n=new qo,s=new Oo,a=new Go,o=new Xo(a),r=new Map,l=new sr({variantUnpackerMap:new Map,defaultVariantUnpacker:o});r.set("signals",l);const d=new Wo(r,s),c=new Ir,h=new No(d,c),u=new er(n,h,new Map),g=new Map;g.set("webgl-single",new ao),g.set("webgl-double",new Ha),g.set("svg-single",new ao),g.set("svg-double",new Ha);const f=new Map;f.set("grid",new eo(new Pr(g))),f.set("border",new eo(new Ua)),f.set("meander",new eo(new Qa)),f.set("leadRay",new eo(new zr)),f.set("signalLabels",new eo(new no)),f.set("meanValueLabels",new eo(new Ja)),f.set("signals",new eo(new so(new Ga)));const p=new xo,v=new ko,y=new mo(p,v,f),m=new Map,S=new ar({variantUnpackerMap:new Map,defaultVariantUnpacker:y});m.set("signals",S);const w=new go(m,new Oo,new fo,new po,new Ga),x=new Map;x.set("text",new bo(new Bo,new Co)),x.set("line",new Po(new Bo,new Io)),x.set("plot-line",new Po(new Bo,new Io));const C=new Do(x),b=new wo(w,C),I=new zo,P=new Map;P.set("panel",new Vo(P)),P.set("grid",new Fo(P)),P.set("column-grid",new Ao(P)),P.set("table",new Lo(P)),P.set("canvas",new Yo(P)),P.set("plot:online:base",new _r(b,I,f)),P.set("plot:online:rhythm",new _r(b,I,f));const B=new ir(P,e);this.configJsUnpacker=new tr({dataUnpacker:u,viewUnpacker:B})}async parseSettings(t){if(null==t||!I(t))return;const e={entity:t,entityDefault:Fr,root:t};return this.visualSettings=this.configJsUnpacker.unpack(e),this.visualSettings}createSaveableSettings(){}applySaveableSettings(t,e){}makeObjectCreators(){const t=new hs(new Map),e=new cs,i=new rs(e),n=new Ea(new Map,i),s=new Map;s.set("signals",n);const a=new ns,o=new is,r=new as(s,a,o),l=new ds,d=new ls(new Map,r,l);this.rootDataSettingsCreator=new La(new Map,t,d);const c=new Map;c.set("signals",new ga),c.set("grid",new sa),c.set("border",new na);const h=new Map;h.set("grid",new ms),h.set("border",new fs),h.set("meander",new Cs),h.set("leadRay",new Vr),h.set("signalLabels",new Is),h.set("meanValueLabels",new ws),h.set("signals",new zs);const u=new ks,g=new Ls,f=new Rs(h,u,g),p=new Ra(new Map,f),v=new Map;v.set("signals",p);const y=new ns,m=new is,S=new Es,w=new js,x=new Us(v,y,m,S,w),C=new Map;C.set("text",new $s),C.set("line",new Qs),C.set("plot-line",new Qs);const b=new Dr(C),I=new ea(x,b);this.viewObjectCreators=new Map,this.viewObjectCreators.set("panel",new Aa),this.viewObjectCreators.set("grid",new Ma),this.viewObjectCreators.set("column-grid",new ba),this.viewObjectCreators.set("table",new _a),this.viewObjectCreators.set("canvas",new Pa),this.viewObjectCreators.set("plot:online:base",new Ar(c,h,I)),this.viewObjectCreators.set("plot:online:rhythm",new Ar(c,h,I))}async createObjects(){if(void 0!==this.visualSettings&&void 0!==this.rootDataSettingsCreator&&this.visualSettings instanceof Qo)return await this.visualizatorCreator.create(new ja({visualSettings:this.visualSettings,viewObjectCreators:this.viewObjectCreators,rootDataSettingsCreator:this.rootDataSettingsCreator}))}}class Lr extends cr{constructor(t){super(t);const e=ur.create(this.webglPlot);void 0!==e&&(this.viewSettings=e)}}class Er extends Lr{constructor(t){var e;if(super({id:t.id,type:t.type,webglPlot:t.webglPlot}),this.viewSettings instanceof gr&&(this.typedViewSettings=this.viewSettings),this.signalIdMap=new Map,this.rhythmChannelInfo=Er.getFirstRhythmChannel(this.webglPlot),void 0!==(null===(e=this.rhythmChannelInfo)||void 0===e?void 0:e.channel.conversionSettings)&&this.rhythmChannelInfo.channel.conversionSettings instanceof Qi){const t=this.rhythmChannelInfo.channel.conversionSettings;this.sourceChannelInfo=Er.getChannelInfo(this.webglPlot,this.rhythmChannelInfo.sourceId,t.id_sourceChannel)}void 0!==this.sourceChannelInfo&&void 0!==this.typedViewSettings&&Er._updateChannelSource(this.typedViewSettings,this.sourceChannelInfo)}async init(){var t,e;if(await super.init(),void 0===this.typedViewSettings)return;const i=null!==(e=null===(t=this.typedViewSettings.signalBox.current)||void 0===t?void 0:t.id)&&void 0!==e?e:-1;i>=0&&await Er.changeSourceSignals([i],this.rhythmChannelInfo,this.sourceChannelInfo,this.webglPlot,this.signalIdMap,this.typedViewSettings)}addSignalPoints(t,e,i,n){const s=this.signalIdMap.get(i);void 0!==s&&(this.hasAddedPoints=!0,this.webglPlot.addSignalData(t,e,s,n))}addPoints(t,e,i){for(let n=0;n<i.length;n++){const s=this.signalIdMap.get(n);void 0!==s&&(this.hasAddedPoints=!0,this.webglPlot.addSignalData(t,e,s,i[n].data))}}updateChannelSource(){var t;void 0!==this.sourceChannelInfo&&void 0!==this.typedViewSettings&&(Er._updateChannelSource(this.typedViewSettings,this.sourceChannelInfo),null===(t=this.onViewSettingsChanged)||void 0===t||t.call(this,this.id))}updateSourceChannelVariant(t){if(void 0===this.sourceChannelInfo)return;const e=C("name","signals",this.sourceChannelInfo.variantGroups);void 0!==e&&(e.currVariant=t)}async changeSourceSignals(t){var e;void 0!==this.typedViewSettings&&(await Er.changeSourceSignals(t,this.rhythmChannelInfo,this.sourceChannelInfo,this.webglPlot,this.signalIdMap,this.typedViewSettings),t.forEach((t=>{if(void 0===this.typedViewSettings)return;const e=C("id",t,this.typedViewSettings.signalBox.values);this.typedViewSettings.signalBox.current=e})),null===(e=this.onViewSettingsChanged)||void 0===e||e.call(this,this.id))}static async changeSourceSignals(t,e,i,n,s,a){if(void 0===e||void 0===i)return;const o=i.getCurrSignalsVariant();if(void 0===o||!(o instanceof qi))return;const r=C("id",e.sourceId,n.typedSettings.dataSources);if(void 0===r)return;const l=C("id",e.channel.id,r.channels);if(void 0===l)return;if(void 0===C("name","signals",l.variantGroups))return;const d=l.getCurrSignalsVariant();if(void 0===d||!(d instanceof si))return;const c=d.copy(),h=c.findContent("signalLabels");if(void 0===h||!(h.obj instanceof Oi))return;const u=h.obj.labels;s.clear();for(let g=0;g<c.signals.length;g++){const e=c.signals[g],i=C("id",t[g],o.signals);if(void 0===i)continue;s.set(t[g],e.id),e.title=i.title;const n=C("id_signal",e.id,u);void 0!==n&&(n.text=i.title)}await n.updateCurrChannelVariant(e.sourceId,e.channel.id,c),void 0!==a.linkedChannel&&await n.onSignalLabelClicked(a.linkedChannel.id_dataSource,a.linkedChannel.id)}static getFirstRhythmChannel(t){const e=t.typedSettings.rootSettings;if(void 0===e)return;const i=e.data.sources;for(let n=0;n<i.length;n++){const t=i[n].channels;for(let e=0;e<t.length;e++){const i=t[e].conversionSettings;if(void 0!==i&&"rhythm"in i&&"rhythm"==i.type)return{sourceId:n,channel:t[e]}}}}static getChannelInfo(t,e,i){const n=t.typedSettings.rootSettings;if(void 0===n)return;const s=C("id",e,n.data.sources);return void 0!==s?C("id",i,s.channels):void 0}static _updateChannelSource(t,e){t.signalBox={current:void 0,values:[]};const i=e.getCurrSignalsVariant();if(void 0!==i&&i instanceof qi&&(i.signals.forEach((e=>{t.signalBox.values.push({title:e.title,id:e.id})})),t.signalBox.values.length>0)){const e=t.signalBox.values[0];t.signalBox.current={title:e.title,id:e.id}}}}class jr extends mr{constructor(){super(new Rr)}init(t,e){super.init(t,e),this.addParserCallback(qe.BeforeObjectsCreation,void 0,(async t=>{let e=t.viewObjectCreators.get("plot:online:base");void 0!==e&&e instanceof pa&&e.addCallback("afterCreate",this.afterAddItemAction.bind(this)),e=t.viewObjectCreators.get("plot:online:rhythm"),void 0!==e&&e instanceof pa&&e.addCallback("afterCreate",this.afterAddItemAction.bind(this))}))}async afterAddItemAction(t){var e,i,n,s,a,o,r;if(!(I(t)&&"graphicObject"in t&&"settings"in t&&"creator"in t&&t.graphicObject instanceof Ui&&t.settings instanceof fa&&t.creator instanceof pa&&t.settings.visualSettings instanceof _o))return;const l=t.settings.visualSettings,d=t.graphicObject;let c;if("plot:online:base"==l.type?c=new Lr({id:null!==(e=l.id)&&void 0!==e?e:0,type:l.type,webglPlot:d}):"plot:online:rhythm"==l.type&&(c=new Er({id:null!==(i=l.id)&&void 0!==i?i:0,type:l.type,webglPlot:d})),void 0===c)return;await c.init();const h=d.getParentCanvas();if(void 0===h||!(c.viewSettings instanceof hr))return;c.onViewSettingsChanged=this.onViewSettingsChanged;const u=c.viewSettings;u.width=d.settings.sizeInPixels.width,u.x=d.settings.absoluteLocation.x,u.y=h.settings.sizeInPixels.height-d.settings.absoluteLocation.y-d.settings.sizeInPixels.height;const g=d.typedSettings;u.height=null!==(a=null===(s=null===(n=g.sectorBorders)||void 0===n?void 0:n.topHeight)||void 0===s?void 0:s.calcValue(d.settings.sizeInPixels.height))&&void 0!==a?a:0,d.addEventListener("SelectChannel",(async function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const[n,s]=[...e];void 0!==c&&"number"==typeof n&&"number"==typeof s&&c.selectChannel(n,s)})),this.plotsInfo.push(c);for(let f=0;f<d.typedSettings.dataSources.length;f++){const t=d.typedSettings.dataSources[f],e=this.dataSourcesMap.get(t.id);if(void 0!==e)for(let i=0;i<t.channels.length;i++){const n=t.channels[i];if(void 0===l.id)continue;const s=d.getSignalsPointCount(t.id,n.id);this.addPlotIdToChannelMappedInfo(e,n,null!==(o=l.id)&&void 0!==o?o:0,(t=>({id:t,channelWidth:s})));for(let i=0;i<t.marks.length;i++){const n=t.marks[i];this.addPlotIdToMarkMappedInfo(e,n,null!==(r=l.id)&&void 0!==r?r:0)}const a=e.channels.get(n.id);void 0!==a&&a instanceof br&&(void 0!==a.channelMaxWidth&&s>a.channelMaxWidth&&(a.channelMaxWidth=s))}}await d.onSignalLabelClicked(c.viewSettings.linkedChannel.id_dataSource,c.viewSettings.linkedChannel.id),d.addEventListener("BufferSizeChanged",(async()=>{l.dataSources.forEach((t=>{t.channels.forEach((e=>{this._updateChannelInfo(t.id,e.id)}))}))}))}setMeanderUnit(t,e,i){const n=null!=t?t:0,s=this.getChannelId(n,e);s<0||this.forEachChannelPlot(n,s,(t=>{t.setMeanderUnit(i)}))}addMark(t,e){this.addMarkToPlots(null!=e?e:0,t.type,t.data);const i=this.eventHandlers.get(t.type);null==i||i(t.data)}addMarkedEvent(t,e){0!=this.plotsInfo.length&&(this.addMark({type:t,data:e},0),this.pushEventMessage({type:"event",data:[{type:t,data:e}]},void 0))}pushMessage(t){switch(t.type){case"adc":this.pushAdcMessage(t,void 0);break;case"event":this.pushEventMessage(t,void 0)}}pushAdcMessage(t,e){void 0===e&&(e=void 0),this.addPointsToPlots(null!=e?e:0,t),this.refreshGraphics()}pushEventMessage(t,e){for(let i=0;i<t.data.length;i++){const n=t.data[i];this.addMarkToPlots(null!=e?e:0,n.type,n.data);const s=this.eventHandlers.get(n.type);null==s||s(n.data)}}addPoints(t,e,i,n){var s,a;const o=null!=t?t:0,r=this.dataSourcesMap.get(o),l=null===(s=null==r?void 0:r.channels)||void 0===s?void 0:s.get(e);null===(a=null==l?void 0:l.plots)||void 0===a||a.forEach((t=>{const s=C("id",t.id,this.plotsInfo);null==s||s.addSignalData(o,e,i,n)}))}async setChannelFrequency(t,e,i){const n=null!=t?t:0;await super.setChannelFrequency(n,e,i),this._updateChannelInfo(n,e)}_updateChannelInfo(t,e){const i=this.dataSourcesMap.get(t);if(void 0===i)return;const n=i.channels.get(e);void 0!==n&&n instanceof br&&(n.channelMaxWidth=0,n.plots.forEach((i=>{const s=C("id",i.id,this.plotsInfo);void 0!==s&&i instanceof wr&&(i.channelWidth=s.webglPlot.getSignalsPointCount(t,e),void 0!==n.channelMaxWidth&&i.channelWidth>n.channelMaxWidth&&(n.channelMaxWidth=i.channelWidth))})))}}class Yr{constructor(t){this.freq=t.freq,this.pointBlockSize=t.pointBlockSize,this.frames=t.frames}}class Or{constructor(t){this.channels=t.channels}}class Ur{constructor(t){this.name=t.name,this.frequency=t.frequency,this.currVariant=t.currVariant,this.variants=t.variants,this.pointCounterMaxValue=t.pointCounterMaxValue}getCurrentVariant(){for(let t=0;t<this.variants.length;++t)if(this.variants[t].name===this.currVariant)return this.variants[t]}}class Tr{constructor(t){this.name=t.name,this.signals=t.signals}getSignal(t){for(let e=0;e<this.signals.length;++e)if(this.signals[e].id===t)return this.signals[e]}}class Wr{constructor(t){this.id=t.id,this.type=t.type,this.name=t.name}}class Xr extends Wr{constructor(t){super({id:t.id,name:t.name,type:"sin"}),this.period=t.period,this.ampl=t.ampl,this.shift=t.shift}}class Hr extends Wr{constructor(t){super({id:t.id,name:t.name,type:"rect"}),this.period=t.period,this.ampl=t.ampl,this.shift=t.shift}}class Nr{static parse(t){if(I(t)&&"type"in t&&"string"==typeof t.type)switch(t.type){case"sin":{if(!("id"in t&&"number"==typeof t.id&&"period"in t&&"number"==typeof t.period&&"ampl"in t&&"number"==typeof t.ampl&&"shift"in t&&"number"==typeof t.shift))return;let e;return"name"in t&&"string"==typeof t.name&&(e=t.name),new Xr({id:t.id,name:e,period:t.period,ampl:t.ampl,shift:t.shift})}case"rect":{if(!("id"in t&&"number"==typeof t.id&&"period"in t&&"number"==typeof t.period&&"ampl"in t&&"number"==typeof t.ampl&&"shift"in t&&"number"==typeof t.shift))return;let e;return"name"in t&&"string"==typeof t.name&&(e=t.name),new Hr({id:t.id,name:e,period:t.period,ampl:t.ampl,shift:t.shift})}default:return}}}class Gr{static parse(t){if(!(I(t)&&"name"in t&&"string"==typeof t.name&&"signals"in t&&A(t.signals)))return;const e=[];for(let i=0;i<t.signals.length;++i){const n=Nr.parse(t.signals[i]);void 0!==n&&e.push(n)}return new Tr({name:t.name,signals:e})}}class qr{static parse(t){if(!(I(t)&&"variants"in t&&A(t.variants)&&"name"in t&&"string"==typeof t.name&&"freq"in t&&"number"==typeof t.freq&&"currVariant"in t&&"string"==typeof t.currVariant))return;const e=[];for(let n=0;n<t.variants.length;++n){const i=Gr.parse(t.variants[n]);void 0!==i&&e.push(i)}let i=65535;return"pointCounterMaxValue"in t&&"number"==typeof t.pointCounterMaxValue&&(i=t.pointCounterMaxValue),new Ur({name:t.name,frequency:t.freq,variants:e,currVariant:t.currVariant,pointCounterMaxValue:i})}}class $r{static parse(t){if(!I(t)||!("channels"in t)||!A(t.channels))return;const e=[];for(let i=0;i<t.channels.length;++i){const n=qr.parse(t.channels[i]);void 0!==n&&e.push(n)}return new Or({channels:e})}}class Kr{static parse(t){if(!I(t)||!("freq"in t)||"number"!=typeof t.freq||!("pointBlockSize"in t)||"number"!=typeof t.pointBlockSize)return;const e=[];if("frames"in t&&A(t.frames))for(let i=0;i<t.frames.length;++i){const n=$r.parse(t.frames[i]);void 0!==n&&e.push(n)}return new Yr({freq:t.freq,pointBlockSize:t.pointBlockSize,frames:e})}}class Zr{}class Jr extends Zr{constructor(t){super(),this.type=t.type,this.time=t.time,this.channels=t.channels}}class Qr{constructor(t){this.name=t.name,this.blockSize=t.blockSize,this.pointCounter=t.pointCounter,this.signalCount=t.signalCount,this.data=t.data}}class tl{constructor(t){this.settings=t,this.data=[]}}class el{constructor(t){this.settings=t,this.divRest=0,this.signals=[],this.pointBlockSize=0,this.pointCounter=0,this.nextPointCounter=0,this.currPointCounter=0}createSignals(){this.divRest=0,this.signals=[];const t=this.settings.getCurrentVariant();if(void 0!==t)for(let e=0;e<t.signals.length;e++){const i=t.signals[e];this.signals.push(new tl(i))}}}class il{constructor(t){this.settings=t,this.channels=[]}createChannels(){for(let t=0;t<this.settings.channels.length;t++){const e=this.settings.channels[t],i=new el(e);i.createSignals(),this.channels.push(i)}}getChannel(t){for(let e=0;e<this.channels.length;e++)if(this.channels[e].settings.name==t)return this.channels[e]}}class nl{constructor(){this.interval=0,this.frames=[]}init(t){this.settings=t,this.interval=Math.floor(this.settings.freq/this.settings.pointBlockSize),this.createFrames()}createFrames(){if(void 0!==this.settings){this.frames=[];for(let t=0;t<this.settings.frames.length;++t){const e=this.settings.frames[t],i=new il(e);i.createChannels(),this.frames.push(i)}}}getChannel(t){for(let e=0;e<this.frames.length;++e){const i=this.frames[e].getChannel(t);if(void 0!==i)return i}}start(){this.stop(),this.timerId=setInterval(this.generateFrames.bind(this),this.interval)}encode(t){return t}getChannelPointCounter(t,e){return this.frames[t].channels[e].pointCounter}generateFrames(){var t;for(let e=0;e<this.frames.length;++e){const i=this.frames[e];for(let t=0;t<i.channels.length;++t){const e=i.channels[t];e.divRest+=e.settings.frequency/this.interval;const n=Math.floor(e.divRest);e.divRest-=n,e.pointBlockSize=n,e.pointCounter=e.nextPointCounter,e.nextPointCounter=(e.nextPointCounter+n)%e.settings.pointCounterMaxValue;for(let t=0;t<e.signals.length;t++)this.generatePointValues(e,t,n);e.currPointCounter=e.nextPointCounter}null===(t=this.onFrameIsReady)||void 0===t||t.call(this,this.encode(this.makeDataBlock(i)))}}generatePointValues(t,e,i){const n=t.settings.getCurrentVariant();if(void 0===n)return;const s=n.getSignal(e);if(void 0===s)return;const a=[];let o=t.currPointCounter;switch(s.type){case"sin":if(!(s instanceof Xr))return;for(let e=0;e<i;e++){const e=Math.sin(o%s.period/s.period*2*Math.PI)*s.ampl+s.shift;a.push(Math.round(e)),o++,o==t.settings.pointCounterMaxValue&&(o=0)}break;case"rect":if(!(s instanceof Hr))return;for(let e=0;e<i;e++){const e=(Math.sin(o%s.period/s.period*2*Math.PI)*s.ampl+s.shift>.5*s.ampl+s.shift?1:-1)*s.ampl;a.push(Math.round(e)),o++,o==t.settings.pointCounterMaxValue&&(o=0)}}t.signals[e].data=a}stop(){void 0!==this.timerId&&(clearInterval(this.timerId),this.timerId=void 0)}makePulseRateBlock(){return{type:"AvgHR",data:10+Math.floor(220*Math.random()),valid:Math.random()>.5}}makeSpoBlock(){return{type:"SPO",data:10+Math.floor(220*Math.random()),valid:Math.random()>.5}}makeAdBlock(t){return{type:t,sad:10+Math.floor(220*Math.random()),dad:10+Math.floor(220*Math.random()),valid:Math.random()>.5}}makeMarkBlock(t){return{type:"mark",markType:"button",pointCounter:t.pointCounter}}makeDataBlock(t){return new Zr}}class sl extends nl{constructor(){super(),this.startTime="2020-01-01T00:00:00z03"}makeDataBlock(t){const e=[];for(let i=0;i<t.channels.length;i++){const n=t.channels[i],s=n.pointBlockSize,a=n.signals.length,o=new Qr({name:n.settings.name,blockSize:s,pointCounter:n.pointCounter,signalCount:a,data:[]});o.data.length=s*a;for(let t=0;t<a;t++){const e=n.signals[t];for(let i=0;i<s;i++)o.data[i*a+t]=e.data[i]}e.push(o)}return new Jr({type:"adc",time:this.startTime,channels:e})}}const al=JSON.parse('{"freq":1000,"pointBlockSize":40,"frames":[{"channels":[{"id":0,"name":"ecg","state":"on","maxSignalCount":8,"currVariant":"1x3","unit":"mkV","normalValue":1000,"maxValue":300000,"minValue":-300000,"totalSignals":8,"freq":1000,"divFreq":1,"clbK":[800,800,800,800,800,800,800,800],"clbB":[0,0,0,0,0,0,0,0],"clbPtnADC_A":[0,0,0,0,0,0,0,0],"clbPtnADC_B":[12,12,12,12,12,12,12,12],"allowDivsFreq":[1,4],"allowFreqs":[1000,250],"allowCountsSignal":[0,1,3,8],"variants":[{"name":"1x3","signals":[{"id":0,"name":"ECG0","type":"sin","ampl":500,"period":2000,"shift":100}]}]},{"id":1,"name":"reo","state":"on","maxSignalCount":2,"freq":125,"divFreq":8,"allowDivsFreq":[8],"allowFreqs":[125],"allowCountsSignal":[1,2],"clbK":[1000,1000],"clbB":[0,0],"clbPtnADC_A":[0,0],"clbPtnADC_B":[-1000,-1000],"currVariant":"2chan","variants":[{"name":"2chan","signals":[{"id":0,"name":"Reo1","type":"sin","ampl":500,"period":200,"shift":0}]}]}]}]}'),ol=JSON.parse('{"schemaVersion":"3.0.0","data":{"units":[{"id":0,"text":"\u043c\u0412","scale":0.001}],"sources":[{"id":0,"channels":[{"id":0,"name":"ecg","maxSignalCount":8,"currVariant":"1x3","frequency":1000,"unit":{"id_unit":0},"variants":[{"name":"1x3","signals":[{"id":0,"title":""}]}]}]}]},"view":{"items":[{"type":"canvas","items":[{"type":"panel","items":[{"type":"plot:online:base","name":"plot1","sectors":[{"name":"left","width":"10 px"},{"name":"right","width":"10 px"},{"name":"top","height":"10 px"},{"name":"bottom","height":"10 px"}],"content":[{"name":"grid","sector":"central","layerZ":-1,"settings":{"view":"webgl-single","color":"#D2D2D3"}},{"name":"border","sector":"central","layerZ":1,"settings":{"view":"webgl","color":"#D2D2D3"}},{"name":"signals"}],"dataSources":[{"id_dataSource":0,"channels":[{"id_channel":0,"variants":[{"name":"1x3","isolines":[{"id":0,"y":"50 %","updateBorder":1}],"signals":[{"id_signal":0,"id_isoline":0,"type":"line","fillType":"period","color":"#026ce5"}]}]}]}]}]}]}]}}'),rl=t=>{const e=(0,a.useRef)(null);(0,a.useEffect)((()=>{(async()=>{const t=new jr,i=new sl,n=Kr.parse(al);i.init(n),i.onFrameIsReady=e=>{const i=xr.parse(e);t.pushMessage(i)},t.init(ol),t.setParentHtml(e.current),await t.create(),t.setCalibration(void 0,"ecg",[0],[1e3],[0]),i.start()})()}),[]);return(0,n.jsx)("div",{className:"canvas-wrap",ref:e,style:{height:"200px",position:"relative"}})},ll={},dl="\u0410 \u0435\u0449\u0451 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0442 \u0442\u0430\u043a",cl={id:"graph",title:"\u0410 \u0435\u0449\u0451 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0442 \u0442\u0430\u043a",description:"",source:"@site/docs/graph.mdx",sourceDirName:".",slug:"/graph",permalink:"/docs/graph",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/graph.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442",permalink:"/docs/getting-started"},next:{title:"\u041e\u0444\u0444\u043b\u0430\u0439\u043d JS",permalink:"/docs/\u0422\u0435\u0441\u0442 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438/offline-javascript"}},hl={},ul=[];function gl(t){const e={h1:"h1",header:"header",...(0,s.R)(),...t.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.header,{children:(0,n.jsx)(e.h1,{id:"\u0430-\u0435\u0449\u0451-\u043c\u043e\u0436\u043d\u043e-\u0432\u043e\u0442-\u0442\u0430\u043a",children:"\u0410 \u0435\u0449\u0451 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0442 \u0442\u0430\u043a"})}),"\n",(0,n.jsx)(rl,{})]})}function fl(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,n.jsx)(e,{...t,children:(0,n.jsx)(gl,{...t})}):gl(t)}},8453:(t,e,i)=>{i.d(e,{R:()=>o,x:()=>r});var n=i(6540);const s={},a=n.createContext(s);function o(t){const e=n.useContext(a);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:o(t.components),n.createElement(a.Provider,{value:e},t.children)}}}]);